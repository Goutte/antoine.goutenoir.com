/*!
 * Intellectual Property is fascism.
 * Thoughts ought to twine.
 * The following code, unless otherwise specified, is PUBLIC DOMAIN.
 */
;
/*!                                                              
 * LeapJS v1.0.0                                                  
 * http://github.com/leapmotion/leapjs/                                        
 *                                                                             
 * Copyright 2013 LeapMotion, Inc. and other contributors                      
 * Released under the Apache-2.0 license                                       
 * http://github.com/leapmotion/leapjs/blob/master/LICENSE                     
 */
(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c){return c(i,!0)}if(u){return u(i,!0)}var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++){o(t[i])}return o}return r})()({1:[function(require,module,exports){var Pointable=require("./pointable"),glMatrix=require("gl-matrix"),vec3=glMatrix.vec3,mat3=glMatrix.mat3,mat4=glMatrix.mat4,_=require("underscore");var Bone=module.exports=function(finger,data){this.finger=finger;this._center=null,this._matrix=null;this.type=data.type;this.prevJoint=data.prevJoint;this.nextJoint=data.nextJoint;this.width=data.width;var displacement=new Array(3);vec3.sub(displacement,data.nextJoint,data.prevJoint);this.length=vec3.length(displacement);this.basis=data.basis};Bone.prototype.left=function(){if(this._left){return this._left}this._left=mat3.determinant(this.basis[0].concat(this.basis[1]).concat(this.basis[2]))<0;return this._left};Bone.prototype.matrix=function(){if(this._matrix){return this._matrix}var b=this.basis,t=this._matrix=mat4.create();t[0]=b[0][0],t[1]=b[0][1],t[2]=b[0][2];t[4]=b[1][0],t[5]=b[1][1],t[6]=b[1][2];t[8]=b[2][0],t[9]=b[2][1],t[10]=b[2][2];t[3]=this.center()[0];t[7]=this.center()[1];t[11]=this.center()[2];if(this.left()){t[0]*=-1;t[1]*=-1;t[2]*=-1}return this._matrix};Bone.prototype.lerp=function(out,t){vec3.lerp(out,this.prevJoint,this.nextJoint,t)};Bone.prototype.center=function(){if(this._center){return this._center}var center=vec3.create();this.lerp(center,0.5);this._center=center;return center};Bone.prototype.direction=function(){return[this.basis[2][0]*-1,this.basis[2][1]*-1,this.basis[2][2]*-1]}},{"./pointable":15,"gl-matrix":23,underscore:34}],2:[function(require,module,exports){var CircularBuffer=module.exports=function(size){this.pos=0;this._buf=[];this.size=size};CircularBuffer.prototype.get=function(i){if(i==undefined){i=0}if(i>=this.size){return undefined}if(i>=this._buf.length){return undefined}return this._buf[(this.pos-i-1)%this.size]};CircularBuffer.prototype.push=function(o){this._buf[this.pos%this.size]=o;return this.pos++}},{}],3:[function(require,module,exports){var chooseProtocol=require("../protocol").chooseProtocol,EventEmitter=require("events").EventEmitter,_=require("underscore");var BaseConnection=module.exports=function(opts){this.opts=_.defaults(opts||{},{host:"127.0.0.1",enableGestures:false,scheme:this.getScheme(),port:this.getPort(),background:false,optimizeHMD:false,requestProtocolVersion:BaseConnection.defaultProtocolVersion});this.host=this.opts.host;this.port=this.opts.port;this.scheme=this.opts.scheme;this.protocolVersionVerified=false;this.background=null;this.optimizeHMD=null;this.on("ready",function(){this.enableGestures(this.opts.enableGestures);this.setBackground(this.opts.background);this.setOptimizeHMD(this.opts.optimizeHMD);if(this.opts.optimizeHMD){console.log("Optimized for head mounted display usage.")}else{console.log("Optimized for desktop usage.")}})};BaseConnection.defaultProtocolVersion=6;BaseConnection.prototype.getUrl=function(){return this.scheme+"//"+this.host+":"+this.port+"/v"+this.opts.requestProtocolVersion+".json"};BaseConnection.prototype.getScheme=function(){return"ws:"};BaseConnection.prototype.getPort=function(){return 6437};BaseConnection.prototype.setBackground=function(state){this.opts.background=state;if(this.protocol&&this.protocol.sendBackground&&this.background!==this.opts.background){this.background=this.opts.background;this.protocol.sendBackground(this,this.opts.background)}};BaseConnection.prototype.setOptimizeHMD=function(state){this.opts.optimizeHMD=state;if(this.protocol&&this.protocol.sendOptimizeHMD&&this.optimizeHMD!==this.opts.optimizeHMD){this.optimizeHMD=this.opts.optimizeHMD;this.protocol.sendOptimizeHMD(this,this.opts.optimizeHMD)}};BaseConnection.prototype.handleOpen=function(){if(!this.connected){this.connected=true;this.emit("connect")}};BaseConnection.prototype.enableGestures=function(enabled){this.gesturesEnabled=enabled?true:false;this.send(this.protocol.encode({enableGestures:this.gesturesEnabled}))};BaseConnection.prototype.handleClose=function(code,reason){if(!this.connected){return}this.disconnect();if(code===1001&&this.opts.requestProtocolVersion>1){if(this.protocolVersionVerified){this.protocolVersionVerified=false}else{this.opts.requestProtocolVersion--}}this.startReconnection()};BaseConnection.prototype.startReconnection=function(){var connection=this;if(!this.reconnectionTimer){(this.reconnectionTimer=setInterval(function(){connection.reconnect()},500))}};BaseConnection.prototype.stopReconnection=function(){this.reconnectionTimer=clearInterval(this.reconnectionTimer)};BaseConnection.prototype.disconnect=function(allowReconnect){if(!allowReconnect){this.stopReconnection()}if(!this.socket){return}this.socket.close();delete this.socket;delete this.protocol;delete this.background;delete this.optimizeHMD;delete this.focusedState;if(this.connected){this.connected=false;this.emit("disconnect")}return true};BaseConnection.prototype.reconnect=function(){if(this.connected){this.stopReconnection()}else{this.disconnect(true);this.connect()}};BaseConnection.prototype.handleData=function(data){var message=JSON.parse(data);var messageEvent;if(this.protocol===undefined){messageEvent=this.protocol=chooseProtocol(message);this.protocolVersionVerified=true;this.emit("ready")}else{messageEvent=this.protocol(message)}this.emit(messageEvent.type,messageEvent)};BaseConnection.prototype.connect=function(){if(this.socket){return}this.socket=this.setupSocket();return true};BaseConnection.prototype.send=function(data){this.socket.send(data)};BaseConnection.prototype.reportFocus=function(state){if(!this.connected||this.focusedState===state){return}this.focusedState=state;this.emit(this.focusedState?"focus":"blur");if(this.protocol&&this.protocol.sendFocused){this.protocol.sendFocused(this,this.focusedState)}};_.extend(BaseConnection.prototype,EventEmitter.prototype)},{"../protocol":16,events:21,underscore:34}],4:[function(require,module,exports){var BaseConnection=module.exports=require("./base"),_=require("underscore");var BrowserConnection=module.exports=function(opts){BaseConnection.call(this,opts);var connection=this;this.on("ready",function(){connection.startFocusLoop()});this.on("disconnect",function(){connection.stopFocusLoop()})};_.extend(BrowserConnection.prototype,BaseConnection.prototype);BrowserConnection.__proto__=BaseConnection;BrowserConnection.prototype.useSecure=function(){return location.protocol==="https:"};BrowserConnection.prototype.getScheme=function(){return this.useSecure()?"wss:":"ws:"};BrowserConnection.prototype.getPort=function(){return this.useSecure()?6436:6437};BrowserConnection.prototype.setupSocket=function(){var connection=this;var socket=new WebSocket(this.getUrl());socket.onopen=function(){connection.handleOpen()};socket.onclose=function(data){connection.handleClose(data.code,data.reason)};socket.onmessage=function(message){connection.handleData(message.data)};socket.onerror=function(error){if(connection.useSecure()&&connection.scheme==="wss:"){connection.scheme="ws:";connection.port=6437;connection.disconnect();connection.connect()}};return socket};BrowserConnection.prototype.startFocusLoop=function(){if(this.focusDetectorTimer){return}var connection=this;var propertyName=null;if(typeof document.hidden!=="undefined"){propertyName="hidden"}else{if(typeof document.mozHidden!=="undefined"){propertyName="mozHidden"}else{if(typeof document.msHidden!=="undefined"){propertyName="msHidden"}else{if(typeof document.webkitHidden!=="undefined"){propertyName="webkitHidden"}else{propertyName=undefined}}}}if(connection.windowVisible===undefined){connection.windowVisible=propertyName===undefined?true:document[propertyName]===false}var focusListener=window.addEventListener("focus",function(e){connection.windowVisible=true;updateFocusState()});var blurListener=window.addEventListener("blur",function(e){connection.windowVisible=false;updateFocusState()});this.on("disconnect",function(){window.removeEventListener("focus",focusListener);window.removeEventListener("blur",blurListener)});var updateFocusState=function(){var isVisible=propertyName===undefined?true:document[propertyName]===false;connection.reportFocus(isVisible&&connection.windowVisible)};updateFocusState();this.focusDetectorTimer=setInterval(updateFocusState,100)};BrowserConnection.prototype.stopFocusLoop=function(){if(!this.focusDetectorTimer){return}clearTimeout(this.focusDetectorTimer);delete this.focusDetectorTimer}},{"./base":3,underscore:34}],5:[function(require,module,exports){var WebSocket=require("ws"),BaseConnection=require("./base"),_=require("underscore");var NodeConnection=module.exports=function(opts){BaseConnection.call(this,opts);var connection=this;this.on("ready",function(){connection.reportFocus(true)})};_.extend(NodeConnection.prototype,BaseConnection.prototype);NodeConnection.__proto__=BaseConnection;NodeConnection.prototype.setupSocket=function(){var connection=this;var socket=new WebSocket(this.getUrl());socket.on("open",function(){connection.handleOpen()});socket.on("message",function(m){connection.handleData(m)});socket.on("close",function(code,reason){connection.handleClose(code,reason)});socket.on("error",function(){connection.startReconnection()});return socket}},{"./base":3,underscore:34,ws:35}],6:[function(require,module,exports){(function(process){var Frame=require("./frame"),Hand=require("./hand"),Pointable=require("./pointable"),Finger=require("./finger"),CircularBuffer=require("./circular_buffer"),Pipeline=require("./pipeline"),EventEmitter=require("events").EventEmitter,gestureListener=require("./gesture").gestureListener,Dialog=require("./dialog"),_=require("underscore");var Controller=module.exports=function(opts){var inNode=(typeof(process)!=="undefined"&&process.versions&&process.versions.node),controller=this;opts=_.defaults(opts||{},{inNode:inNode});this.inNode=opts.inNode;opts=_.defaults(opts||{},{frameEventName:this.useAnimationLoop()?"animationFrame":"deviceFrame",suppressAnimationLoop:!this.useAnimationLoop(),loopWhileDisconnected:true,useAllPlugins:false,checkVersion:true});this.animationFrameRequested=false;this.onAnimationFrame=function(timestamp){if(controller.lastConnectionFrame.valid){controller.emit("animationFrame",controller.lastConnectionFrame)}controller.emit("frameEnd",timestamp);if(controller.loopWhileDisconnected&&((controller.connection.focusedState!==false)||controller.connection.opts.background)){window.requestAnimationFrame(controller.onAnimationFrame)}else{controller.animationFrameRequested=false}};this.suppressAnimationLoop=opts.suppressAnimationLoop;this.loopWhileDisconnected=opts.loopWhileDisconnected;this.frameEventName=opts.frameEventName;this.useAllPlugins=opts.useAllPlugins;this.history=new CircularBuffer(200);this.lastFrame=Frame.Invalid;this.lastValidFrame=Frame.Invalid;this.lastConnectionFrame=Frame.Invalid;this.accumulatedGestures=[];this.checkVersion=opts.checkVersion;if(opts.connectionType===undefined){this.connectionType=(this.inBrowser()?require("./connection/browser"):require("./connection/node"))}else{this.connectionType=opts.connectionType}this.connection=new this.connectionType(opts);this.streamingCount=0;this.devices={};this.plugins={};this._pluginPipelineSteps={};this._pluginExtendedMethods={};if(opts.useAllPlugins){this.useRegisteredPlugins()}this.setupFrameEvents(opts);this.setupConnectionEvents();this.startAnimationLoop()};Controller.prototype.gesture=function(type,cb){var creator=gestureListener(this,type);if(cb!==undefined){creator.stop(cb)}return creator};Controller.prototype.setBackground=function(state){this.connection.setBackground(state);return this};Controller.prototype.setOptimizeHMD=function(state){this.connection.setOptimizeHMD(state);return this};Controller.prototype.inBrowser=function(){return !this.inNode};Controller.prototype.useAnimationLoop=function(){return this.inBrowser()&&!this.inBackgroundPage()};Controller.prototype.inBackgroundPage=function(){return(typeof(chrome)!=="undefined")&&chrome.extension&&chrome.extension.getBackgroundPage&&(chrome.extension.getBackgroundPage()===window)};Controller.prototype.connect=function(){this.connection.connect();return this};Controller.prototype.streaming=function(){return this.streamingCount>0};Controller.prototype.connected=function(){return !!this.connection.connected};Controller.prototype.startAnimationLoop=function(){if(!this.suppressAnimationLoop&&!this.animationFrameRequested){this.animationFrameRequested=true;window.requestAnimationFrame(this.onAnimationFrame)}};Controller.prototype.disconnect=function(){this.connection.disconnect();return this};Controller.prototype.frame=function(num){return this.history.get(num)||Frame.Invalid};Controller.prototype.loop=function(callback){if(callback){if(typeof callback==="function"){this.on(this.frameEventName,callback)}else{this.setupFrameEvents(callback)}}return this.connect()};Controller.prototype.addStep=function(step){if(!this.pipeline){this.pipeline=new Pipeline(this)}this.pipeline.addStep(step)};Controller.prototype.processFrame=function(frame){if(frame.gestures){this.accumulatedGestures=this.accumulatedGestures.concat(frame.gestures)}this.lastConnectionFrame=frame;this.startAnimationLoop();this.emit("deviceFrame",frame)};Controller.prototype.processFinishedFrame=function(frame){this.lastFrame=frame;if(frame.valid){this.lastValidFrame=frame}frame.controller=this;frame.historyIdx=this.history.push(frame);if(frame.gestures){frame.gestures=this.accumulatedGestures;this.accumulatedGestures=[];for(var gestureIdx=0;gestureIdx!=frame.gestures.length;gestureIdx++){this.emit("gesture",frame.gestures[gestureIdx],frame)}}if(this.pipeline){frame=this.pipeline.run(frame);if(!frame){frame=Frame.Invalid}}this.emit("frame",frame);this.emitHandEvents(frame)};Controller.prototype.emitHandEvents=function(frame){for(var i=0;i<frame.hands.length;i++){this.emit("hand",frame.hands[i])}};Controller.prototype.setupFrameEvents=function(opts){if(opts.frame){this.on("frame",opts.frame)}if(opts.hand){this.on("hand",opts.hand)}};Controller.prototype.setupConnectionEvents=function(){var controller=this;this.connection.on("frame",function(frame){controller.processFrame(frame)});this.on(this.frameEventName,function(frame){controller.processFinishedFrame(frame)});var backfillStreamingStartedEventsHandler=function(){if(controller.connection.opts.requestProtocolVersion<5&&controller.streamingCount==0){controller.streamingCount=1;var info={attached:true,streaming:true,type:"unknown",id:"Lx00000000000"};controller.devices[info.id]=info;controller.emit("deviceAttached",info);controller.emit("deviceStreaming",info);controller.emit("streamingStarted",info);controller.connection.removeListener("frame",backfillStreamingStartedEventsHandler)}};var backfillStreamingStoppedEvents=function(){if(controller.streamingCount>0){for(var deviceId in controller.devices){controller.emit("deviceStopped",controller.devices[deviceId]);controller.emit("deviceRemoved",controller.devices[deviceId])}controller.emit("streamingStopped",controller.devices[deviceId]);controller.streamingCount=0;for(var deviceId in controller.devices){delete controller.devices[deviceId]}}};this.connection.on("focus",function(){if(controller.loopWhileDisconnected){controller.startAnimationLoop()}controller.emit("focus")});this.connection.on("blur",function(){controller.emit("blur")});this.connection.on("protocol",function(protocol){protocol.on("beforeFrameCreated",function(frameData){controller.emit("beforeFrameCreated",frameData)});protocol.on("afterFrameCreated",function(frame,frameData){controller.emit("afterFrameCreated",frame,frameData)});controller.emit("protocol",protocol)});this.connection.on("ready",function(){if(controller.checkVersion&&!controller.inNode){controller.checkOutOfDate()}controller.emit("ready")});this.connection.on("connect",function(){controller.emit("connect");controller.connection.removeListener("frame",backfillStreamingStartedEventsHandler);controller.connection.on("frame",backfillStreamingStartedEventsHandler)});this.connection.on("disconnect",function(){controller.emit("disconnect");backfillStreamingStoppedEvents()});this.connection.on("deviceConnect",function(evt){if(evt.state){controller.emit("deviceConnected");controller.connection.removeListener("frame",backfillStreamingStartedEventsHandler);controller.connection.on("frame",backfillStreamingStartedEventsHandler)}else{controller.emit("deviceDisconnected");backfillStreamingStoppedEvents()}});this.connection.on("deviceEvent",function(evt){var info=evt.state,oldInfo=controller.devices[info.id];var changed={};for(var property in info){if(!oldInfo||!oldInfo.hasOwnProperty(property)||oldInfo[property]!=info[property]){changed[property]=true}}controller.devices[info.id]=info;if(changed.attached){controller.emit(info.attached?"deviceAttached":"deviceRemoved",info)}if(!changed.streaming){return}if(info.streaming){controller.streamingCount++;controller.emit("deviceStreaming",info);if(controller.streamingCount==1){controller.emit("streamingStarted",info)}if(!changed.attached){controller.emit("deviceConnected")}}else{if(!(changed.attached&&info.attached)){controller.streamingCount--;controller.emit("deviceStopped",info);if(controller.streamingCount==0){controller.emit("streamingStopped",info)}controller.emit("deviceDisconnected")}}});this.on("newListener",function(event,listener){if(event=="deviceConnected"||event=="deviceDisconnected"){console.warn(event+" events are depricated.  Consider using 'streamingStarted/streamingStopped' or 'deviceStreaming/deviceStopped' instead")}})};Controller.prototype.checkOutOfDate=function(){console.assert(this.connection&&this.connection.protocol);var serviceVersion=this.connection.protocol.serviceVersion;var protocolVersion=this.connection.protocol.version;var defaultProtocolVersion=this.connectionType.defaultProtocolVersion;if(defaultProtocolVersion>protocolVersion){console.warn("Your Protocol Version is v"+protocolVersion+", this app was designed for v"+defaultProtocolVersion);Dialog.warnOutOfDate({sV:serviceVersion,pV:protocolVersion});return true}else{return false}};Controller._pluginFactories={};Controller.plugin=function(pluginName,factory){if(this._pluginFactories[pluginName]){console.warn('Plugin "'+pluginName+'" already registered')}return this._pluginFactories[pluginName]=factory};Controller.plugins=function(){return _.keys(this._pluginFactories)};var setPluginCallbacks=function(pluginName,type,callback){if(["beforeFrameCreated","afterFrameCreated"].indexOf(type)!=-1){this.on(type,callback)}else{if(!this.pipeline){this.pipeline=new Pipeline(this)}if(!this._pluginPipelineSteps[pluginName]){this._pluginPipelineSteps[pluginName]=[]}this._pluginPipelineSteps[pluginName].push(this.pipeline.addWrappedStep(type,callback))}};var setPluginMethods=function(pluginName,type,hash){var klass;if(!this._pluginExtendedMethods[pluginName]){this._pluginExtendedMethods[pluginName]=[]}switch(type){case"frame":klass=Frame;break;case"hand":klass=Hand;break;case"pointable":klass=Pointable;_.extend(Finger.prototype,hash);_.extend(Finger.Invalid,hash);break;case"finger":klass=Finger;break;default:throw pluginName+' specifies invalid object type "'+type+'" for prototypical extension'}_.extend(klass.prototype,hash);_.extend(klass.Invalid,hash);this._pluginExtendedMethods[pluginName].push([klass,hash])};Controller.prototype.use=function(pluginName,options){var functionOrHash,pluginFactory,key,pluginInstance;pluginFactory=(typeof pluginName=="function")?pluginName:Controller._pluginFactories[pluginName];if(!pluginFactory){throw"Leap Plugin "+pluginName+" not found."}options||(options={});if(this.plugins[pluginName]){_.extend(this.plugins[pluginName],options);return this}this.plugins[pluginName]=options;pluginInstance=pluginFactory.call(this,options);for(key in pluginInstance){functionOrHash=pluginInstance[key];if(typeof functionOrHash==="function"){setPluginCallbacks.call(this,pluginName,key,functionOrHash)}else{setPluginMethods.call(this,pluginName,key,functionOrHash)}}return this};Controller.prototype.stopUsing=function(pluginName){var steps=this._pluginPipelineSteps[pluginName],extMethodHashes=this._pluginExtendedMethods[pluginName],i=0,klass,extMethodHash;if(!this.plugins[pluginName]){return}if(steps){for(i=0;i<steps.length;i++){this.pipeline.removeStep(steps[i])}}if(extMethodHashes){for(i=0;i<extMethodHashes.length;i++){klass=extMethodHashes[i][0];extMethodHash=extMethodHashes[i][1];for(var methodName in extMethodHash){delete klass.prototype[methodName];delete klass.Invalid[methodName]}}}delete this.plugins[pluginName];return this};Controller.prototype.useRegisteredPlugins=function(){for(var plugin in Controller._pluginFactories){this.use(plugin)}};_.extend(Controller.prototype,EventEmitter.prototype)}).call(this,require("_process"))},{"./circular_buffer":2,"./connection/browser":4,"./connection/node":5,"./dialog":7,"./finger":8,"./frame":9,"./gesture":10,"./hand":11,"./pipeline":14,"./pointable":15,_process:33,events:21,underscore:34}],7:[function(require,module,exports){(function(process){var Dialog=module.exports=function(message,options){this.options=(options||{});this.message=message;this.createElement()};Dialog.prototype.createElement=function(){this.element=document.createElement("div");this.element.className="leapjs-dialog";this.element.style.position="fixed";this.element.style.top="8px";this.element.style.left=0;this.element.style.right=0;this.element.style.textAlign="center";this.element.style.zIndex=1000;var dialog=document.createElement("div");this.element.appendChild(dialog);dialog.style.className="leapjs-dialog";dialog.style.display="inline-block";dialog.style.margin="auto";dialog.style.padding="8px";dialog.style.color="#222";dialog.style.background="#eee";dialog.style.borderRadius="4px";dialog.style.border="1px solid #999";dialog.style.textAlign="left";dialog.style.cursor="pointer";dialog.style.whiteSpace="nowrap";dialog.style.transition="box-shadow 1s linear";dialog.innerHTML=this.message;if(this.options.onclick){dialog.addEventListener("click",this.options.onclick)}if(this.options.onmouseover){dialog.addEventListener("mouseover",this.options.onmouseover)}if(this.options.onmouseout){dialog.addEventListener("mouseout",this.options.onmouseout)}if(this.options.onmousemove){dialog.addEventListener("mousemove",this.options.onmousemove)}};Dialog.prototype.show=function(){document.body.appendChild(this.element);return this};Dialog.prototype.hide=function(){document.body.removeChild(this.element);return this};Dialog.warnOutOfDate=function(params){params||(params={});var url="http://developer.leapmotion.com?";params.returnTo=window.location.href;for(var key in params){url+=key+"="+encodeURIComponent(params[key])+"&"}var dialog,onclick=function(event){if(event.target.id!="leapjs-decline-upgrade"){var popup=window.open(url,"_blank","height=800,width=1000,location=1,menubar=1,resizable=1,status=1,toolbar=1,scrollbars=1");if(window.focus){popup.focus()}}dialog.hide();return true},message="This site requires Leap Motion Tracking V2.<button id='leapjs-accept-upgrade'  style='color: #444; transition: box-shadow 100ms linear; cursor: pointer; vertical-align: baseline; margin-left: 16px;'>Upgrade</button><button id='leapjs-decline-upgrade' style='color: #444; transition: box-shadow 100ms linear; cursor: pointer; vertical-align: baseline; margin-left: 8px; '>Not Now</button>";dialog=new Dialog(message,{onclick:onclick,onmousemove:function(e){if(e.target==document.getElementById("leapjs-decline-upgrade")){document.getElementById("leapjs-decline-upgrade").style.color="#000";document.getElementById("leapjs-decline-upgrade").style.boxShadow="0px 0px 2px #5daa00";document.getElementById("leapjs-accept-upgrade").style.color="#444";document.getElementById("leapjs-accept-upgrade").style.boxShadow="none"}else{document.getElementById("leapjs-accept-upgrade").style.color="#000";document.getElementById("leapjs-accept-upgrade").style.boxShadow="0px 0px 2px #5daa00";document.getElementById("leapjs-decline-upgrade").style.color="#444";document.getElementById("leapjs-decline-upgrade").style.boxShadow="none"}},onmouseout:function(){document.getElementById("leapjs-decline-upgrade").style.color="#444";document.getElementById("leapjs-decline-upgrade").style.boxShadow="none";document.getElementById("leapjs-accept-upgrade").style.color="#444";document.getElementById("leapjs-accept-upgrade").style.boxShadow="none"}});return dialog.show()};Dialog.hasWarnedBones=false;Dialog.warnBones=function(){if(this.hasWarnedBones){return}this.hasWarnedBones=true;console.warn("Your Leap Service is out of date");if(!(typeof(process)!=="undefined"&&process.versions&&process.versions.node)){this.warnOutOfDate({reason:"bones"})}}}).call(this,require("_process"))},{_process:33}],8:[function(require,module,exports){var Pointable=require("./pointable"),Bone=require("./bone"),Dialog=require("./dialog"),_=require("underscore");var Finger=module.exports=function(data){Pointable.call(this,data);this.dipPosition=data.dipPosition;this.pipPosition=data.pipPosition;this.mcpPosition=data.mcpPosition;this.carpPosition=data.carpPosition;this.extended=data.extended;this.type=data.type;this.finger=true;this.positions=[this.carpPosition,this.mcpPosition,this.pipPosition,this.dipPosition,this.tipPosition];if(data.bases){this.addBones(data)}else{Dialog.warnBones()}};_.extend(Finger.prototype,Pointable.prototype);Finger.prototype.addBones=function(data){this.metacarpal=new Bone(this,{type:0,width:this.width,prevJoint:this.carpPosition,nextJoint:this.mcpPosition,basis:data.bases[0]});this.proximal=new Bone(this,{type:1,width:this.width,prevJoint:this.mcpPosition,nextJoint:this.pipPosition,basis:data.bases[1]});this.medial=new Bone(this,{type:2,width:this.width,prevJoint:this.pipPosition,nextJoint:this.dipPosition,basis:data.bases[2]});this.distal=new Bone(this,{type:3,width:this.width,prevJoint:this.dipPosition,nextJoint:data.btipPosition,basis:data.bases[3]});this.bones=[this.metacarpal,this.proximal,this.medial,this.distal]};Finger.prototype.toString=function(){return"Finger [ id:"+this.id+" "+this.length+"mmx | width:"+this.width+"mm | direction:"+this.direction+" ]"};Finger.Invalid={valid:false}},{"./bone":1,"./dialog":7,"./pointable":15,underscore:34}],9:[function(require,module,exports){var Hand=require("./hand"),Pointable=require("./pointable"),createGesture=require("./gesture").createGesture,glMatrix=require("gl-matrix"),mat3=glMatrix.mat3,vec3=glMatrix.vec3,InteractionBox=require("./interaction_box"),Finger=require("./finger"),_=require("underscore");var Frame=module.exports=function(data){this.valid=true;this.id=data.id;this.timestamp=data.timestamp;this.hands=[];this.handsMap={};this.pointables=[];this.tools=[];this.fingers=[];if(data.interactionBox){this.interactionBox=new InteractionBox(data.interactionBox)}this.gestures=[];this.pointablesMap={};this._translation=data.t;this._rotation=_.flatten(data.r);this._scaleFactor=data.s;this.data=data;this.type="frame";this.currentFrameRate=data.currentFrameRate;if(data.gestures){for(var gestureIdx=0,gestureCount=data.gestures.length;gestureIdx!=gestureCount;gestureIdx++){this.gestures.push(createGesture(data.gestures[gestureIdx]))}}this.postprocessData(data)};Frame.prototype.postprocessData=function(data){if(!data){data=this.data}for(var handIdx=0,handCount=data.hands.length;handIdx!=handCount;handIdx++){var hand=new Hand(data.hands[handIdx]);hand.frame=this;this.hands.push(hand);this.handsMap[hand.id]=hand}data.pointables=_.sortBy(data.pointables,function(pointable){return pointable.id});for(var pointableIdx=0,pointableCount=data.pointables.length;pointableIdx!=pointableCount;pointableIdx++){var pointableData=data.pointables[pointableIdx];var pointable=pointableData.dipPosition?new Finger(pointableData):new Pointable(pointableData);pointable.frame=this;this.addPointable(pointable)}};Frame.prototype.addPointable=function(pointable){this.pointables.push(pointable);this.pointablesMap[pointable.id]=pointable;(pointable.tool?this.tools:this.fingers).push(pointable);if(pointable.handId!==undefined&&this.handsMap.hasOwnProperty(pointable.handId)){var hand=this.handsMap[pointable.handId];hand.pointables.push(pointable);(pointable.tool?hand.tools:hand.fingers).push(pointable);switch(pointable.type){case 0:hand.thumb=pointable;break;case 1:hand.indexFinger=pointable;break;case 2:hand.middleFinger=pointable;break;case 3:hand.ringFinger=pointable;break;case 4:hand.pinky=pointable;break}}};Frame.prototype.tool=function(id){var pointable=this.pointable(id);return pointable.tool?pointable:Pointable.Invalid};Frame.prototype.pointable=function(id){return this.pointablesMap[id]||Pointable.Invalid};Frame.prototype.finger=function(id){var pointable=this.pointable(id);return !pointable.tool?pointable:Pointable.Invalid};Frame.prototype.hand=function(id){return this.handsMap[id]||Hand.Invalid};Frame.prototype.rotationAngle=function(sinceFrame,axis){if(!this.valid||!sinceFrame.valid){return 0}var rot=this.rotationMatrix(sinceFrame);var cs=(rot[0]+rot[4]+rot[8]-1)*0.5;var angle=Math.acos(cs);angle=isNaN(angle)?0:angle;if(axis!==undefined){var rotAxis=this.rotationAxis(sinceFrame);angle*=vec3.dot(rotAxis,vec3.normalize(vec3.create(),axis))}return angle};Frame.prototype.rotationAxis=function(sinceFrame){if(!this.valid||!sinceFrame.valid){return vec3.create()}return vec3.normalize(vec3.create(),[this._rotation[7]-sinceFrame._rotation[5],this._rotation[2]-sinceFrame._rotation[6],this._rotation[3]-sinceFrame._rotation[1]])};Frame.prototype.rotationMatrix=function(sinceFrame){if(!this.valid||!sinceFrame.valid){return mat3.create()}var transpose=mat3.transpose(mat3.create(),this._rotation);return mat3.multiply(mat3.create(),sinceFrame._rotation,transpose)};Frame.prototype.scaleFactor=function(sinceFrame){if(!this.valid||!sinceFrame.valid){return 1}return Math.exp(this._scaleFactor-sinceFrame._scaleFactor)};Frame.prototype.translation=function(sinceFrame){if(!this.valid||!sinceFrame.valid){return vec3.create()}return vec3.subtract(vec3.create(),this._translation,sinceFrame._translation)};Frame.prototype.toString=function(){var str="Frame [ id:"+this.id+" | timestamp:"+this.timestamp+" | Hand count:("+this.hands.length+") | Pointable count:("+this.pointables.length+")";if(this.gestures){str+=" | Gesture count:("+this.gestures.length+")"}str+=" ]";return str};Frame.prototype.dump=function(){var out="";out+="Frame Info:<br/>";out+=this.toString();out+="<br/><br/>Hands:<br/>";for(var handIdx=0,handCount=this.hands.length;handIdx!=handCount;handIdx++){out+="  "+this.hands[handIdx].toString()+"<br/>"}out+="<br/><br/>Pointables:<br/>";for(var pointableIdx=0,pointableCount=this.pointables.length;pointableIdx!=pointableCount;pointableIdx++){out+="  "+this.pointables[pointableIdx].toString()+"<br/>"}if(this.gestures){out+="<br/><br/>Gestures:<br/>";for(var gestureIdx=0,gestureCount=this.gestures.length;gestureIdx!=gestureCount;gestureIdx++){out+="  "+this.gestures[gestureIdx].toString()+"<br/>"}}out+="<br/><br/>Raw JSON:<br/>";out+=JSON.stringify(this.data);return out};Frame.Invalid={valid:false,hands:[],fingers:[],tools:[],gestures:[],pointables:[],pointable:function(){return Pointable.Invalid},finger:function(){return Pointable.Invalid},hand:function(){return Hand.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return mat3.create()},rotationAxis:function(){return vec3.create()},scaleFactor:function(){return 1},translation:function(){return vec3.create()}}},{"./finger":8,"./gesture":10,"./hand":11,"./interaction_box":13,"./pointable":15,"gl-matrix":23,underscore:34}],10:[function(require,module,exports){var glMatrix=require("gl-matrix"),vec3=glMatrix.vec3,EventEmitter=require("events").EventEmitter,_=require("underscore");var createGesture=exports.createGesture=function(data){var gesture;switch(data.type){case"circle":gesture=new CircleGesture(data);break;case"swipe":gesture=new SwipeGesture(data);break;case"screenTap":gesture=new ScreenTapGesture(data);break;case"keyTap":gesture=new KeyTapGesture(data);break;default:throw"unknown gesture type"}gesture.id=data.id;gesture.handIds=data.handIds.slice();gesture.pointableIds=data.pointableIds.slice();gesture.duration=data.duration;gesture.state=data.state;gesture.type=data.type;return gesture};var gestureListener=exports.gestureListener=function(controller,type){var handlers={};var gestureMap={};controller.on("gesture",function(gesture,frame){if(gesture.type==type){if(gesture.state=="start"||gesture.state=="stop"){if(gestureMap[gesture.id]===undefined){var gestureTracker=new Gesture(gesture,frame);gestureMap[gesture.id]=gestureTracker;_.each(handlers,function(cb,name){gestureTracker.on(name,cb)})}}gestureMap[gesture.id].update(gesture,frame);if(gesture.state=="stop"){delete gestureMap[gesture.id]}}});var builder={start:function(cb){handlers.start=cb;return builder},stop:function(cb){handlers.stop=cb;return builder},complete:function(cb){handlers.stop=cb;return builder},update:function(cb){handlers.update=cb;return builder}};return builder};var Gesture=exports.Gesture=function(gesture,frame){this.gestures=[gesture];this.frames=[frame]};Gesture.prototype.update=function(gesture,frame){this.lastGesture=gesture;this.lastFrame=frame;this.gestures.push(gesture);this.frames.push(frame);this.emit(gesture.state,this)};Gesture.prototype.translation=function(){return vec3.subtract(vec3.create(),this.lastGesture.startPosition,this.lastGesture.position)};_.extend(Gesture.prototype,EventEmitter.prototype);var CircleGesture=function(data){this.center=data.center;this.normal=data.normal;this.progress=data.progress;this.radius=data.radius};CircleGesture.prototype.toString=function(){return"CircleGesture ["+JSON.stringify(this)+"]"};var SwipeGesture=function(data){this.startPosition=data.startPosition;this.position=data.position;this.direction=data.direction;this.speed=data.speed};SwipeGesture.prototype.toString=function(){return"SwipeGesture ["+JSON.stringify(this)+"]"};var ScreenTapGesture=function(data){this.position=data.position;this.direction=data.direction;this.progress=data.progress};ScreenTapGesture.prototype.toString=function(){return"ScreenTapGesture ["+JSON.stringify(this)+"]"};var KeyTapGesture=function(data){this.position=data.position;this.direction=data.direction;this.progress=data.progress};KeyTapGesture.prototype.toString=function(){return"KeyTapGesture ["+JSON.stringify(this)+"]"}},{events:21,"gl-matrix":23,underscore:34}],11:[function(require,module,exports){var Pointable=require("./pointable"),Bone=require("./bone"),glMatrix=require("gl-matrix"),mat3=glMatrix.mat3,vec3=glMatrix.vec3,_=require("underscore");var Hand=module.exports=function(data){this.id=data.id;this.palmPosition=data.palmPosition;this.direction=data.direction;this.palmVelocity=data.palmVelocity;this.palmNormal=data.palmNormal;this.sphereCenter=data.sphereCenter;this.sphereRadius=data.sphereRadius;this.valid=true;this.pointables=[];this.fingers=[];if(data.armBasis){this.arm=new Bone(this,{type:4,width:data.armWidth,prevJoint:data.elbow,nextJoint:data.wrist,basis:data.armBasis})}else{this.arm=null}this.tools=[];this._translation=data.t;this._rotation=_.flatten(data.r);this._scaleFactor=data.s;this.timeVisible=data.timeVisible;this.stabilizedPalmPosition=data.stabilizedPalmPosition;this.type=data.type;this.grabStrength=data.grabStrength;this.pinchStrength=data.pinchStrength;this.confidence=data.confidence};Hand.prototype.finger=function(id){var finger=this.frame.finger(id);return(finger&&(finger.handId==this.id))?finger:Pointable.Invalid};Hand.prototype.rotationAngle=function(sinceFrame,axis){if(!this.valid||!sinceFrame.valid){return 0}var sinceHand=sinceFrame.hand(this.id);if(!sinceHand.valid){return 0}var rot=this.rotationMatrix(sinceFrame);var cs=(rot[0]+rot[4]+rot[8]-1)*0.5;var angle=Math.acos(cs);angle=isNaN(angle)?0:angle;if(axis!==undefined){var rotAxis=this.rotationAxis(sinceFrame);angle*=vec3.dot(rotAxis,vec3.normalize(vec3.create(),axis))}return angle};Hand.prototype.rotationAxis=function(sinceFrame){if(!this.valid||!sinceFrame.valid){return vec3.create()}var sinceHand=sinceFrame.hand(this.id);if(!sinceHand.valid){return vec3.create()}return vec3.normalize(vec3.create(),[this._rotation[7]-sinceHand._rotation[5],this._rotation[2]-sinceHand._rotation[6],this._rotation[3]-sinceHand._rotation[1]])};Hand.prototype.rotationMatrix=function(sinceFrame){if(!this.valid||!sinceFrame.valid){return mat3.create()}var sinceHand=sinceFrame.hand(this.id);if(!sinceHand.valid){return mat3.create()}var transpose=mat3.transpose(mat3.create(),this._rotation);var m=mat3.multiply(mat3.create(),sinceHand._rotation,transpose);return m};Hand.prototype.scaleFactor=function(sinceFrame){if(!this.valid||!sinceFrame.valid){return 1}var sinceHand=sinceFrame.hand(this.id);if(!sinceHand.valid){return 1}return Math.exp(this._scaleFactor-sinceHand._scaleFactor)};Hand.prototype.translation=function(sinceFrame){if(!this.valid||!sinceFrame.valid){return vec3.create()}var sinceHand=sinceFrame.hand(this.id);if(!sinceHand.valid){return vec3.create()}return[this._translation[0]-sinceHand._translation[0],this._translation[1]-sinceHand._translation[1],this._translation[2]-sinceHand._translation[2]]};Hand.prototype.toString=function(){return"Hand ("+this.type+") [ id: "+this.id+" | palm velocity:"+this.palmVelocity+" | sphere center:"+this.sphereCenter+" ] "};Hand.prototype.pitch=function(){return Math.atan2(this.direction[1],-this.direction[2])};Hand.prototype.yaw=function(){return Math.atan2(this.direction[0],-this.direction[2])};Hand.prototype.roll=function(){return Math.atan2(this.palmNormal[0],-this.palmNormal[1])};Hand.Invalid={valid:false,fingers:[],tools:[],pointables:[],left:false,pointable:function(){return Pointable.Invalid},finger:function(){return Pointable.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return mat3.create()},rotationAxis:function(){return vec3.create()},scaleFactor:function(){return 1},translation:function(){return vec3.create()}}},{"./bone":1,"./pointable":15,"gl-matrix":23,underscore:34}],12:[function(require,module,exports){module.exports={Controller:require("./controller"),Frame:require("./frame"),Gesture:require("./gesture"),Hand:require("./hand"),Pointable:require("./pointable"),Finger:require("./finger"),InteractionBox:require("./interaction_box"),CircularBuffer:require("./circular_buffer"),UI:require("./ui"),JSONProtocol:require("./protocol").JSONProtocol,glMatrix:require("gl-matrix"),mat3:require("gl-matrix").mat3,vec3:require("gl-matrix").vec3,loopController:undefined,version:require("./version.js"),_:require("underscore"),EventEmitter:require("events").EventEmitter,loop:function(opts,callback){if(opts&&callback===undefined&&(({}).toString.call(opts)==="[object Function]")){callback=opts;opts={}}if(this.loopController){if(opts){this.loopController.setupFrameEvents(opts)}}else{this.loopController=new this.Controller(opts)}this.loopController.loop(callback);return this.loopController},plugin:function(name,options){this.Controller.plugin(name,options)}}},{"./circular_buffer":2,"./controller":6,"./finger":8,"./frame":9,"./gesture":10,"./hand":11,"./interaction_box":13,"./pointable":15,"./protocol":16,"./ui":17,"./version.js":20,events:21,"gl-matrix":23,underscore:34}],13:[function(require,module,exports){var glMatrix=require("gl-matrix"),vec3=glMatrix.vec3;var InteractionBox=module.exports=function(data){this.valid=true;this.center=data.center;this.size=data.size;this.width=data.size[0];this.height=data.size[1];this.depth=data.size[2]};InteractionBox.prototype.denormalizePoint=function(normalizedPosition){return vec3.fromValues((normalizedPosition[0]-0.5)*this.size[0]+this.center[0],(normalizedPosition[1]-0.5)*this.size[1]+this.center[1],(normalizedPosition[2]-0.5)*this.size[2]+this.center[2])};InteractionBox.prototype.normalizePoint=function(position,clamp){var vec=vec3.fromValues(((position[0]-this.center[0])/this.size[0])+0.5,((position[1]-this.center[1])/this.size[1])+0.5,((position[2]-this.center[2])/this.size[2])+0.5);if(clamp){vec[0]=Math.min(Math.max(vec[0],0),1);vec[1]=Math.min(Math.max(vec[1],0),1);vec[2]=Math.min(Math.max(vec[2],0),1)}return vec};InteractionBox.prototype.toString=function(){return"InteractionBox [ width:"+this.width+" | height:"+this.height+" | depth:"+this.depth+" ]"};InteractionBox.Invalid={valid:false}},{"gl-matrix":23}],14:[function(require,module,exports){var Pipeline=module.exports=function(controller){this.steps=[];this.controller=controller};Pipeline.prototype.addStep=function(step){this.steps.push(step)};Pipeline.prototype.run=function(frame){var stepsLength=this.steps.length;for(var i=0;i!=stepsLength;i++){if(!frame){break}frame=this.steps[i](frame)}return frame};Pipeline.prototype.removeStep=function(step){var index=this.steps.indexOf(step);if(index===-1){throw"Step not found in pipeline"}this.steps.splice(index,1)};Pipeline.prototype.addWrappedStep=function(type,callback){var controller=this.controller,step=function(frame){var dependencies,i,len;dependencies=(type=="frame")?[frame]:(frame[type+"s"]||[]);for(i=0,len=dependencies.length;i<len;i++){callback.call(controller,dependencies[i])}return frame};this.addStep(step);return step}},{}],15:[function(require,module,exports){var glMatrix=require("gl-matrix"),vec3=glMatrix.vec3;var Pointable=module.exports=function(data){this.valid=true;this.id=data.id;this.handId=data.handId;this.length=data.length;this.tool=data.tool;this.width=data.width;this.direction=data.direction;this.stabilizedTipPosition=data.stabilizedTipPosition;this.tipPosition=data.tipPosition;this.tipVelocity=data.tipVelocity;this.touchZone=data.touchZone;this.touchDistance=data.touchDistance;this.timeVisible=data.timeVisible};Pointable.prototype.toString=function(){return"Pointable [ id:"+this.id+" "+this.length+"mmx | width:"+this.width+"mm | direction:"+this.direction+" ]"};Pointable.prototype.hand=function(){return this.frame.hand(this.handId)};Pointable.Invalid={valid:false}},{"gl-matrix":23}],16:[function(require,module,exports){var Frame=require("./frame"),Hand=require("./hand"),Pointable=require("./pointable"),Finger=require("./finger"),_=require("underscore"),EventEmitter=require("events").EventEmitter;var Event=function(data){this.type=data.type;this.state=data.state};exports.chooseProtocol=function(header){var protocol;switch(header.version){case 1:case 2:case 3:case 4:case 5:case 6:protocol=JSONProtocol(header);protocol.sendBackground=function(connection,state){connection.send(protocol.encode({background:state}))};protocol.sendFocused=function(connection,state){connection.send(protocol.encode({focused:state}))};protocol.sendOptimizeHMD=function(connection,state){connection.send(protocol.encode({optimizeHMD:state}))};break;default:throw"unrecognized version"}return protocol};var JSONProtocol=exports.JSONProtocol=function(header){var protocol=function(frameData){if(frameData.event){return new Event(frameData.event)}else{protocol.emit("beforeFrameCreated",frameData);var frame=new Frame(frameData);protocol.emit("afterFrameCreated",frame,frameData);return frame}};protocol.encode=function(message){return JSON.stringify(message)};protocol.version=header.version;protocol.serviceVersion=header.serviceVersion;protocol.versionLong="Version "+header.version;protocol.type="protocol";_.extend(protocol,EventEmitter.prototype);return protocol}},{"./finger":8,"./frame":9,"./hand":11,"./pointable":15,events:21,underscore:34}],17:[function(require,module,exports){exports.UI={Region:require("./ui/region"),Cursor:require("./ui/cursor")}},{"./ui/cursor":18,"./ui/region":19}],18:[function(require,module,exports){var Cursor=module.exports=function(){return function(frame){var pointable=frame.pointables.sort(function(a,b){return a.z-b.z})[0];if(pointable&&pointable.valid){frame.cursorPosition=pointable.tipPosition}return frame}}},{}],19:[function(require,module,exports){var EventEmitter=require("events").EventEmitter,_=require("underscore");var Region=module.exports=function(start,end){this.start=new Vector(start);this.end=new Vector(end);this.enteredFrame=null};Region.prototype.hasPointables=function(frame){for(var i=0;i!=frame.pointables.length;i++){var position=frame.pointables[i].tipPosition;if(position.x>=this.start.x&&position.x<=this.end.x&&position.y>=this.start.y&&position.y<=this.end.y&&position.z>=this.start.z&&position.z<=this.end.z){return true}}return false};Region.prototype.listener=function(opts){var region=this;if(opts&&opts.nearThreshold){this.setupNearRegion(opts.nearThreshold)}return function(frame){return region.updatePosition(frame)}};Region.prototype.clipper=function(){var region=this;return function(frame){region.updatePosition(frame);return region.enteredFrame?frame:null}};Region.prototype.setupNearRegion=function(distance){var nearRegion=this.nearRegion=new Region([this.start.x-distance,this.start.y-distance,this.start.z-distance],[this.end.x+distance,this.end.y+distance,this.end.z+distance]);var region=this;nearRegion.on("enter",function(frame){region.emit("near",frame)});nearRegion.on("exit",function(frame){region.emit("far",frame)});region.on("exit",function(frame){region.emit("near",frame)})};Region.prototype.updatePosition=function(frame){if(this.nearRegion){this.nearRegion.updatePosition(frame)}if(this.hasPointables(frame)&&this.enteredFrame==null){this.enteredFrame=frame;this.emit("enter",this.enteredFrame)}else{if(!this.hasPointables(frame)&&this.enteredFrame!=null){this.enteredFrame=null;this.emit("exit",this.enteredFrame)}}return frame};Region.prototype.normalize=function(position){return new Vector([(position.x-this.start.x)/(this.end.x-this.start.x),(position.y-this.start.y)/(this.end.y-this.start.y),(position.z-this.start.z)/(this.end.z-this.start.z)])};Region.prototype.mapToXY=function(position,width,height){var normalized=this.normalize(position);var x=normalized.x,y=normalized.y;if(x>1){x=1}else{if(x<-1){x=-1}}if(y>1){y=1}else{if(y<-1){y=-1}}return[(x+1)/2*width,(1-y)/2*height,normalized.z]};_.extend(Region.prototype,EventEmitter.prototype)},{events:21,underscore:34}],20:[function(require,module,exports){module.exports={full:"1.0.0",major:1,minor:0,dot:0}},{}],21:[function(require,module,exports){var objectCreate=Object.create||objectCreatePolyfill;var objectKeys=Object.keys||objectKeysPolyfill;var bind=Function.prototype.bind||functionBindPolyfill;function EventEmitter(){if(!this._events||!Object.prototype.hasOwnProperty.call(this,"_events")){this._events=objectCreate(null);this._eventsCount=0}this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;var defaultMaxListeners=10;var hasDefineProperty;try{var o={};if(Object.defineProperty){Object.defineProperty(o,"x",{value:0})}hasDefineProperty=o.x===0}catch(err){hasDefineProperty=false}if(hasDefineProperty){Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:true,get:function(){return defaultMaxListeners},set:function(arg){if(typeof arg!=="number"||arg<0||arg!==arg){throw new TypeError('"defaultMaxListeners" must be a positive number')}defaultMaxListeners=arg}})}else{EventEmitter.defaultMaxListeners=defaultMaxListeners}EventEmitter.prototype.setMaxListeners=function setMaxListeners(n){if(typeof n!=="number"||n<0||isNaN(n)){throw new TypeError('"n" argument must be a positive number')}this._maxListeners=n;return this};function $getMaxListeners(that){if(that._maxListeners===undefined){return EventEmitter.defaultMaxListeners}return that._maxListeners}EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return $getMaxListeners(this)};function emitNone(handler,isFn,self){if(isFn){handler.call(self)}else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i){listeners[i].call(self)}}}function emitOne(handler,isFn,self,arg1){if(isFn){handler.call(self,arg1)}else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i){listeners[i].call(self,arg1)}}}function emitTwo(handler,isFn,self,arg1,arg2){if(isFn){handler.call(self,arg1,arg2)}else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i){listeners[i].call(self,arg1,arg2)}}}function emitThree(handler,isFn,self,arg1,arg2,arg3){if(isFn){handler.call(self,arg1,arg2,arg3)}else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i){listeners[i].call(self,arg1,arg2,arg3)}}}function emitMany(handler,isFn,self,args){if(isFn){handler.apply(self,args)}else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i){listeners[i].apply(self,args)}}}EventEmitter.prototype.emit=function emit(type){var er,handler,len,args,i,events;var doError=(type==="error");events=this._events;if(events){doError=(doError&&events.error==null)}else{if(!doError){return false}}if(doError){if(arguments.length>1){er=arguments[1]}if(er instanceof Error){throw er}else{var err=new Error('Unhandled "error" event. ('+er+")");err.context=er;throw err}return false}handler=events[type];if(!handler){return false}var isFn=typeof handler==="function";len=arguments.length;switch(len){case 1:emitNone(handler,isFn,this);break;case 2:emitOne(handler,isFn,this,arguments[1]);break;case 3:emitTwo(handler,isFn,this,arguments[1],arguments[2]);break;case 4:emitThree(handler,isFn,this,arguments[1],arguments[2],arguments[3]);break;default:args=new Array(len-1);for(i=1;i<len;i++){args[i-1]=arguments[i]}emitMany(handler,isFn,this,args)}return true};function _addListener(target,type,listener,prepend){var m;var events;var existing;if(typeof listener!=="function"){throw new TypeError('"listener" argument must be a function')}events=target._events;if(!events){events=target._events=objectCreate(null);target._eventsCount=0}else{if(events.newListener){target.emit("newListener",type,listener.listener?listener.listener:listener);events=target._events}existing=events[type]}if(!existing){existing=events[type]=listener;++target._eventsCount}else{if(typeof existing==="function"){existing=events[type]=prepend?[listener,existing]:[existing,listener]}else{if(prepend){existing.unshift(listener)}else{existing.push(listener)}}if(!existing.warned){m=$getMaxListeners(target);if(m&&m>0&&existing.length>m){existing.warned=true;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+' "'+String(type)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');w.name="MaxListenersExceededWarning";w.emitter=target;w.type=type;w.count=existing.length;if(typeof console==="object"&&console.warn){console.warn("%s: %s",w.name,w.message)}}}}return target}EventEmitter.prototype.addListener=function addListener(type,listener){return _addListener(this,type,listener,false)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function prependListener(type,listener){return _addListener(this,type,listener,true)};function onceWrapper(){if(!this.fired){this.target.removeListener(this.type,this.wrapFn);this.fired=true;switch(arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}this.listener.apply(this.target,args)}}}function _onceWrap(target,type,listener){var state={fired:false,wrapFn:undefined,target:target,type:type,listener:listener};var wrapped=bind.call(onceWrapper,state);wrapped.listener=listener;state.wrapFn=wrapped;return wrapped}EventEmitter.prototype.once=function once(type,listener){if(typeof listener!=="function"){throw new TypeError('"listener" argument must be a function')}this.on(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.prependOnceListener=function prependOnceListener(type,listener){if(typeof listener!=="function"){throw new TypeError('"listener" argument must be a function')}this.prependListener(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.removeListener=function removeListener(type,listener){var list,events,position,i,originalListener;if(typeof listener!=="function"){throw new TypeError('"listener" argument must be a function')}events=this._events;if(!events){return this}list=events[type];if(!list){return this}if(list===listener||list.listener===listener){if(--this._eventsCount===0){this._events=objectCreate(null)}else{delete events[type];if(events.removeListener){this.emit("removeListener",type,list.listener||listener)}}}else{if(typeof list!=="function"){position=-1;for(i=list.length-1;i>=0;i--){if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener;position=i;break}}if(position<0){return this}if(position===0){list.shift()}else{spliceOne(list,position)}if(list.length===1){events[type]=list[0]}if(events.removeListener){this.emit("removeListener",type,originalListener||listener)}}}return this};EventEmitter.prototype.removeAllListeners=function removeAllListeners(type){var listeners,events,i;events=this._events;if(!events){return this}if(!events.removeListener){if(arguments.length===0){this._events=objectCreate(null);this._eventsCount=0}else{if(events[type]){if(--this._eventsCount===0){this._events=objectCreate(null)}else{delete events[type]}}}return this}if(arguments.length===0){var keys=objectKeys(events);var key;for(i=0;i<keys.length;++i){key=keys[i];if(key==="removeListener"){continue}this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events=objectCreate(null);this._eventsCount=0;return this}listeners=events[type];if(typeof listeners==="function"){this.removeListener(type,listeners)}else{if(listeners){for(i=listeners.length-1;i>=0;i--){this.removeListener(type,listeners[i])}}}return this};function _listeners(target,type,unwrap){var events=target._events;if(!events){return[]}var evlistener=events[type];if(!evlistener){return[]}if(typeof evlistener==="function"){return unwrap?[evlistener.listener||evlistener]:[evlistener]}return unwrap?unwrapListeners(evlistener):arrayClone(evlistener,evlistener.length)}EventEmitter.prototype.listeners=function listeners(type){return _listeners(this,type,true)};EventEmitter.prototype.rawListeners=function rawListeners(type){return _listeners(this,type,false)};EventEmitter.listenerCount=function(emitter,type){if(typeof emitter.listenerCount==="function"){return emitter.listenerCount(type)}else{return listenerCount.call(emitter,type)}};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(type){var events=this._events;if(events){var evlistener=events[type];if(typeof evlistener==="function"){return 1}else{if(evlistener){return evlistener.length}}}return 0}EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function spliceOne(list,index){for(var i=index,k=i+1,n=list.length;k<n;i+=1,k+=1){list[i]=list[k]}list.pop()}function arrayClone(arr,n){var copy=new Array(n);for(var i=0;i<n;++i){copy[i]=arr[i]}return copy}function unwrapListeners(arr){var ret=new Array(arr.length);for(var i=0;i<ret.length;++i){ret[i]=arr[i].listener||arr[i]}return ret}function objectCreatePolyfill(proto){var F=function(){};F.prototype=proto;return new F}function objectKeysPolyfill(obj){var keys=[];for(var k in obj){if(Object.prototype.hasOwnProperty.call(obj,k)){keys.push(k)}}return k}function functionBindPolyfill(context){var fn=this;return function(){return fn.apply(context,arguments)}}},{}],22:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.setMatrixArrayType=setMatrixArrayType;exports.toRadian=toRadian;exports.equals=equals;exports.RANDOM=exports.ARRAY_TYPE=exports.EPSILON=void 0;var EPSILON=0.000001;exports.EPSILON=EPSILON;var ARRAY_TYPE=typeof Float32Array!=="undefined"?Float32Array:Array;exports.ARRAY_TYPE=ARRAY_TYPE;var RANDOM=Math.random;exports.RANDOM=RANDOM;function setMatrixArrayType(type){exports.ARRAY_TYPE=ARRAY_TYPE=type}var degree=Math.PI/180;function toRadian(a){return a*degree}function equals(a,b){return Math.abs(a-b)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(b))}if(!Math.hypot){Math.hypot=function(){var y=0,i=arguments.length;while(i--){y+=arguments[i]*arguments[i]}return Math.sqrt(y)}}},{}],23:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.vec4=exports.vec3=exports.vec2=exports.quat2=exports.quat=exports.mat4=exports.mat3=exports.mat2d=exports.mat2=exports.glMatrix=void 0;var glMatrix=_interopRequireWildcard(require("./common.js"));exports.glMatrix=glMatrix;var mat2=_interopRequireWildcard(require("./mat2.js"));exports.mat2=mat2;var mat2d=_interopRequireWildcard(require("./mat2d.js"));exports.mat2d=mat2d;var mat3=_interopRequireWildcard(require("./mat3.js"));exports.mat3=mat3;var mat4=_interopRequireWildcard(require("./mat4.js"));exports.mat4=mat4;var quat=_interopRequireWildcard(require("./quat.js"));exports.quat=quat;var quat2=_interopRequireWildcard(require("./quat2.js"));exports.quat2=quat2;var vec2=_interopRequireWildcard(require("./vec2.js"));exports.vec2=vec2;var vec3=_interopRequireWildcard(require("./vec3.js"));exports.vec3=vec3;var vec4=_interopRequireWildcard(require("./vec4.js"));exports.vec4=vec4;function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj["default"]=obj;return newObj}}},{"./common.js":22,"./mat2.js":24,"./mat2d.js":25,"./mat3.js":26,"./mat4.js":27,"./quat.js":28,"./quat2.js":29,"./vec2.js":30,"./vec3.js":31,"./vec4.js":32}],24:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.create=create;exports.clone=clone;exports.copy=copy;exports.identity=identity;exports.fromValues=fromValues;exports.set=set;exports.transpose=transpose;exports.invert=invert;exports.adjoint=adjoint;exports.determinant=determinant;exports.multiply=multiply;exports.rotate=rotate;exports.scale=scale;exports.fromRotation=fromRotation;exports.fromScaling=fromScaling;exports.str=str;exports.frob=frob;exports.LDU=LDU;exports.add=add;exports.subtract=subtract;exports.exactEquals=exactEquals;exports.equals=equals;exports.multiplyScalar=multiplyScalar;exports.multiplyScalarAndAdd=multiplyScalarAndAdd;exports.sub=exports.mul=void 0;var glMatrix=_interopRequireWildcard(require("./common.js"));function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj["default"]=obj;return newObj}}function create(){var out=new glMatrix.ARRAY_TYPE(4);if(glMatrix.ARRAY_TYPE!=Float32Array){out[1]=0;out[2]=0}out[0]=1;out[3]=1;return out}function clone(a){var out=new glMatrix.ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out}function copy(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out}function identity(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;return out}function fromValues(m00,m01,m10,m11){var out=new glMatrix.ARRAY_TYPE(4);out[0]=m00;out[1]=m01;out[2]=m10;out[3]=m11;return out}function set(out,m00,m01,m10,m11){out[0]=m00;out[1]=m01;out[2]=m10;out[3]=m11;return out}function transpose(out,a){if(out===a){var a1=a[1];out[1]=a[2];out[2]=a1}else{out[0]=a[0];out[1]=a[2];out[2]=a[1];out[3]=a[3]}return out}function invert(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var det=a0*a3-a2*a1;if(!det){return null}det=1/det;out[0]=a3*det;out[1]=-a1*det;out[2]=-a2*det;out[3]=a0*det;return out}function adjoint(out,a){var a0=a[0];out[0]=a[3];out[1]=-a[1];out[2]=-a[2];out[3]=a0;return out}function determinant(a){return a[0]*a[3]-a[2]*a[1]}function multiply(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=a0*b0+a2*b1;out[1]=a1*b0+a3*b1;out[2]=a0*b2+a2*b3;out[3]=a1*b2+a3*b3;return out}function rotate(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var s=Math.sin(rad);var c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;return out}function scale(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;return out}function fromRotation(out,rad){var s=Math.sin(rad);var c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=-s;out[3]=c;return out}function fromScaling(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=v[1];return out}function str(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"}function frob(a){return Math.hypot(a[0],a[1],a[2],a[3])}function LDU(L,D,U,a){L[2]=a[2]/a[0];U[0]=a[0];U[1]=a[1];U[3]=a[3]-L[2]*U[1];return[L,D,U]}function add(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];return out}function subtract(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];return out}function exactEquals(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}function equals(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))}function multiplyScalar(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;return out}function multiplyScalarAndAdd(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;return out}var mul=multiply;exports.mul=mul;var sub=subtract;exports.sub=sub},{"./common.js":22}],25:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.create=create;exports.clone=clone;exports.copy=copy;exports.identity=identity;exports.fromValues=fromValues;exports.set=set;exports.invert=invert;exports.determinant=determinant;exports.multiply=multiply;exports.rotate=rotate;exports.scale=scale;exports.translate=translate;exports.fromRotation=fromRotation;exports.fromScaling=fromScaling;exports.fromTranslation=fromTranslation;exports.str=str;exports.frob=frob;exports.add=add;exports.subtract=subtract;exports.multiplyScalar=multiplyScalar;exports.multiplyScalarAndAdd=multiplyScalarAndAdd;exports.exactEquals=exactEquals;exports.equals=equals;exports.sub=exports.mul=void 0;var glMatrix=_interopRequireWildcard(require("./common.js"));function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj["default"]=obj;return newObj}}function create(){var out=new glMatrix.ARRAY_TYPE(6);if(glMatrix.ARRAY_TYPE!=Float32Array){out[1]=0;out[2]=0;out[4]=0;out[5]=0}out[0]=1;out[3]=1;return out}function clone(a){var out=new glMatrix.ARRAY_TYPE(6);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out}function copy(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out}function identity(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;return out}function fromValues(a,b,c,d,tx,ty){var out=new glMatrix.ARRAY_TYPE(6);out[0]=a;out[1]=b;out[2]=c;out[3]=d;out[4]=tx;out[5]=ty;return out}function set(out,a,b,c,d,tx,ty){out[0]=a;out[1]=b;out[2]=c;out[3]=d;out[4]=tx;out[5]=ty;return out}function invert(out,a){var aa=a[0],ab=a[1],ac=a[2],ad=a[3];var atx=a[4],aty=a[5];var det=aa*ad-ab*ac;if(!det){return null}det=1/det;out[0]=ad*det;out[1]=-ab*det;out[2]=-ac*det;out[3]=aa*det;out[4]=(ac*aty-ad*atx)*det;out[5]=(ab*atx-aa*aty)*det;return out}function determinant(a){return a[0]*a[3]-a[1]*a[2]}function multiply(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];out[0]=a0*b0+a2*b1;out[1]=a1*b0+a3*b1;out[2]=a0*b2+a2*b3;out[3]=a1*b2+a3*b3;out[4]=a0*b4+a2*b5+a4;out[5]=a1*b4+a3*b5+a5;return out}function rotate(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5];var s=Math.sin(rad);var c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;out[4]=a4;out[5]=a5;return out}function scale(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5];var v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;out[4]=a4;out[5]=a5;return out}function translate(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5];var v0=v[0],v1=v[1];out[0]=a0;out[1]=a1;out[2]=a2;out[3]=a3;out[4]=a0*v0+a2*v1+a4;out[5]=a1*v0+a3*v1+a5;return out}function fromRotation(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=-s;out[3]=c;out[4]=0;out[5]=0;return out}function fromScaling(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=v[1];out[4]=0;out[5]=0;return out}function fromTranslation(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=v[0];out[5]=v[1];return out}function str(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"}function frob(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],1)}function add(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];return out}function subtract(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];return out}function multiplyScalar(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;return out}function multiplyScalarAndAdd(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;return out}function exactEquals(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]}function equals(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=glMatrix.EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=glMatrix.EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))}var mul=multiply;exports.mul=mul;var sub=subtract;exports.sub=sub},{"./common.js":22}],26:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.create=create;exports.fromMat4=fromMat4;exports.clone=clone;exports.copy=copy;exports.fromValues=fromValues;exports.set=set;exports.identity=identity;exports.transpose=transpose;exports.invert=invert;exports.adjoint=adjoint;exports.determinant=determinant;exports.multiply=multiply;exports.translate=translate;exports.rotate=rotate;exports.scale=scale;exports.fromTranslation=fromTranslation;exports.fromRotation=fromRotation;exports.fromScaling=fromScaling;exports.fromMat2d=fromMat2d;exports.fromQuat=fromQuat;exports.normalFromMat4=normalFromMat4;exports.projection=projection;exports.str=str;exports.frob=frob;exports.add=add;exports.subtract=subtract;exports.multiplyScalar=multiplyScalar;exports.multiplyScalarAndAdd=multiplyScalarAndAdd;exports.exactEquals=exactEquals;exports.equals=equals;exports.sub=exports.mul=void 0;var glMatrix=_interopRequireWildcard(require("./common.js"));function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj["default"]=obj;return newObj}}function create(){var out=new glMatrix.ARRAY_TYPE(9);if(glMatrix.ARRAY_TYPE!=Float32Array){out[1]=0;out[2]=0;out[3]=0;out[5]=0;out[6]=0;out[7]=0}out[0]=1;out[4]=1;out[8]=1;return out}function fromMat4(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[4];out[4]=a[5];out[5]=a[6];out[6]=a[8];out[7]=a[9];out[8]=a[10];return out}function clone(a){var out=new glMatrix.ARRAY_TYPE(9);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out}function copy(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out}function fromValues(m00,m01,m02,m10,m11,m12,m20,m21,m22){var out=new glMatrix.ARRAY_TYPE(9);out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m10;out[4]=m11;out[5]=m12;out[6]=m20;out[7]=m21;out[8]=m22;return out}function set(out,m00,m01,m02,m10,m11,m12,m20,m21,m22){out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m10;out[4]=m11;out[5]=m12;out[6]=m20;out[7]=m21;out[8]=m22;return out}function identity(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out}function transpose(out,a){if(out===a){var a01=a[1],a02=a[2],a12=a[5];out[1]=a[3];out[2]=a[6];out[3]=a01;out[5]=a[7];out[6]=a02;out[7]=a12}else{out[0]=a[0];out[1]=a[3];out[2]=a[6];out[3]=a[1];out[4]=a[4];out[5]=a[7];out[6]=a[2];out[7]=a[5];out[8]=a[8]}return out}function invert(out,a){var a00=a[0],a01=a[1],a02=a[2];var a10=a[3],a11=a[4],a12=a[5];var a20=a[6],a21=a[7],a22=a[8];var b01=a22*a11-a12*a21;var b11=-a22*a10+a12*a20;var b21=a21*a10-a11*a20;var det=a00*b01+a01*b11+a02*b21;if(!det){return null}det=1/det;out[0]=b01*det;out[1]=(-a22*a01+a02*a21)*det;out[2]=(a12*a01-a02*a11)*det;out[3]=b11*det;out[4]=(a22*a00-a02*a20)*det;out[5]=(-a12*a00+a02*a10)*det;out[6]=b21*det;out[7]=(-a21*a00+a01*a20)*det;out[8]=(a11*a00-a01*a10)*det;return out}function adjoint(out,a){var a00=a[0],a01=a[1],a02=a[2];var a10=a[3],a11=a[4],a12=a[5];var a20=a[6],a21=a[7],a22=a[8];out[0]=a11*a22-a12*a21;out[1]=a02*a21-a01*a22;out[2]=a01*a12-a02*a11;out[3]=a12*a20-a10*a22;out[4]=a00*a22-a02*a20;out[5]=a02*a10-a00*a12;out[6]=a10*a21-a11*a20;out[7]=a01*a20-a00*a21;out[8]=a00*a11-a01*a10;return out}function determinant(a){var a00=a[0],a01=a[1],a02=a[2];var a10=a[3],a11=a[4],a12=a[5];var a20=a[6],a21=a[7],a22=a[8];return a00*(a22*a11-a12*a21)+a01*(-a22*a10+a12*a20)+a02*(a21*a10-a11*a20)}function multiply(out,a,b){var a00=a[0],a01=a[1],a02=a[2];var a10=a[3],a11=a[4],a12=a[5];var a20=a[6],a21=a[7],a22=a[8];var b00=b[0],b01=b[1],b02=b[2];var b10=b[3],b11=b[4],b12=b[5];var b20=b[6],b21=b[7],b22=b[8];out[0]=b00*a00+b01*a10+b02*a20;out[1]=b00*a01+b01*a11+b02*a21;out[2]=b00*a02+b01*a12+b02*a22;out[3]=b10*a00+b11*a10+b12*a20;out[4]=b10*a01+b11*a11+b12*a21;out[5]=b10*a02+b11*a12+b12*a22;out[6]=b20*a00+b21*a10+b22*a20;out[7]=b20*a01+b21*a11+b22*a21;out[8]=b20*a02+b21*a12+b22*a22;return out}function translate(out,a,v){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],x=v[0],y=v[1];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a10;out[4]=a11;out[5]=a12;out[6]=x*a00+y*a10+a20;out[7]=x*a01+y*a11+a21;out[8]=x*a02+y*a12+a22;return out}function rotate(out,a,rad){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],s=Math.sin(rad),c=Math.cos(rad);out[0]=c*a00+s*a10;out[1]=c*a01+s*a11;out[2]=c*a02+s*a12;out[3]=c*a10-s*a00;out[4]=c*a11-s*a01;out[5]=c*a12-s*a02;out[6]=a20;out[7]=a21;out[8]=a22;return out}function scale(out,a,v){var x=v[0],y=v[1];out[0]=x*a[0];out[1]=x*a[1];out[2]=x*a[2];out[3]=y*a[3];out[4]=y*a[4];out[5]=y*a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out}function fromTranslation(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=v[0];out[7]=v[1];out[8]=1;return out}function fromRotation(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=0;out[3]=-s;out[4]=c;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out}function fromScaling(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=0;out[4]=v[1];out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out}function fromMat2d(out,a){out[0]=a[0];out[1]=a[1];out[2]=0;out[3]=a[2];out[4]=a[3];out[5]=0;out[6]=a[4];out[7]=a[5];out[8]=1;return out}function fromQuat(out,q){var x=q[0],y=q[1],z=q[2],w=q[3];var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var yx=y*x2;var yy=y*y2;var zx=z*x2;var zy=z*y2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;out[0]=1-yy-zz;out[3]=yx-wz;out[6]=zx+wy;out[1]=yx+wz;out[4]=1-xx-zz;out[7]=zy-wx;out[2]=zx-wy;out[5]=zy+wx;out[8]=1-xx-yy;return out}function normalFromMat4(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3];var a10=a[4],a11=a[5],a12=a[6],a13=a[7];var a20=a[8],a21=a[9],a22=a[10],a23=a[11];var a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;var det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a12*b08-a10*b11-a13*b07)*det;out[2]=(a10*b10-a11*b08+a13*b06)*det;out[3]=(a02*b10-a01*b11-a03*b09)*det;out[4]=(a00*b11-a02*b08+a03*b07)*det;out[5]=(a01*b08-a00*b10-a03*b06)*det;out[6]=(a31*b05-a32*b04+a33*b03)*det;out[7]=(a32*b02-a30*b05-a33*b01)*det;out[8]=(a30*b04-a31*b02+a33*b00)*det;return out}function projection(out,width,height){out[0]=2/width;out[1]=0;out[2]=0;out[3]=0;out[4]=-2/height;out[5]=0;out[6]=-1;out[7]=1;out[8]=1;return out}function str(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"}function frob(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])}function add(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];out[6]=a[6]+b[6];out[7]=a[7]+b[7];out[8]=a[8]+b[8];return out}function subtract(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];out[6]=a[6]-b[6];out[7]=a[7]-b[7];out[8]=a[8]-b[8];return out}function multiplyScalar(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;out[6]=a[6]*b;out[7]=a[7]*b;out[8]=a[8]*b;return out}function multiplyScalarAndAdd(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;out[6]=a[6]+b[6]*scale;out[7]=a[7]+b[7]*scale;out[8]=a[8]+b[8]*scale;return out}function exactEquals(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]}function equals(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],a8=a[8];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7],b8=b[8];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=glMatrix.EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=glMatrix.EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=glMatrix.EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=glMatrix.EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=glMatrix.EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))}var mul=multiply;exports.mul=mul;var sub=subtract;exports.sub=sub},{"./common.js":22}],27:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.create=create;exports.clone=clone;exports.copy=copy;exports.fromValues=fromValues;exports.set=set;exports.identity=identity;exports.transpose=transpose;exports.invert=invert;exports.adjoint=adjoint;exports.determinant=determinant;exports.multiply=multiply;exports.translate=translate;exports.scale=scale;exports.rotate=rotate;exports.rotateX=rotateX;exports.rotateY=rotateY;exports.rotateZ=rotateZ;exports.fromTranslation=fromTranslation;exports.fromScaling=fromScaling;exports.fromRotation=fromRotation;exports.fromXRotation=fromXRotation;exports.fromYRotation=fromYRotation;exports.fromZRotation=fromZRotation;exports.fromRotationTranslation=fromRotationTranslation;exports.fromQuat2=fromQuat2;exports.getTranslation=getTranslation;exports.getScaling=getScaling;exports.getRotation=getRotation;exports.fromRotationTranslationScale=fromRotationTranslationScale;exports.fromRotationTranslationScaleOrigin=fromRotationTranslationScaleOrigin;exports.fromQuat=fromQuat;exports.frustum=frustum;exports.perspective=perspective;exports.perspectiveFromFieldOfView=perspectiveFromFieldOfView;exports.ortho=ortho;exports.lookAt=lookAt;exports.targetTo=targetTo;exports.str=str;exports.frob=frob;exports.add=add;exports.subtract=subtract;exports.multiplyScalar=multiplyScalar;exports.multiplyScalarAndAdd=multiplyScalarAndAdd;exports.exactEquals=exactEquals;exports.equals=equals;exports.sub=exports.mul=void 0;var glMatrix=_interopRequireWildcard(require("./common.js"));function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj["default"]=obj;return newObj}}function create(){var out=new glMatrix.ARRAY_TYPE(16);if(glMatrix.ARRAY_TYPE!=Float32Array){out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[11]=0;out[12]=0;out[13]=0;out[14]=0}out[0]=1;out[5]=1;out[10]=1;out[15]=1;return out}function clone(a){var out=new glMatrix.ARRAY_TYPE(16);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out}function copy(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out}function fromValues(m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){var out=new glMatrix.ARRAY_TYPE(16);out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m03;out[4]=m10;out[5]=m11;out[6]=m12;out[7]=m13;out[8]=m20;out[9]=m21;out[10]=m22;out[11]=m23;out[12]=m30;out[13]=m31;out[14]=m32;out[15]=m33;return out}function set(out,m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m03;out[4]=m10;out[5]=m11;out[6]=m12;out[7]=m13;out[8]=m20;out[9]=m21;out[10]=m22;out[11]=m23;out[12]=m30;out[13]=m31;out[14]=m32;out[15]=m33;return out}function identity(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function transpose(out,a){if(out===a){var a01=a[1],a02=a[2],a03=a[3];var a12=a[6],a13=a[7];var a23=a[11];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a01;out[6]=a[9];out[7]=a[13];out[8]=a02;out[9]=a12;out[11]=a[14];out[12]=a03;out[13]=a13;out[14]=a23}else{out[0]=a[0];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a[1];out[5]=a[5];out[6]=a[9];out[7]=a[13];out[8]=a[2];out[9]=a[6];out[10]=a[10];out[11]=a[14];out[12]=a[3];out[13]=a[7];out[14]=a[11];out[15]=a[15]}return out}function invert(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3];var a10=a[4],a11=a[5],a12=a[6],a13=a[7];var a20=a[8],a21=a[9],a22=a[10],a23=a[11];var a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;var det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a02*b10-a01*b11-a03*b09)*det;out[2]=(a31*b05-a32*b04+a33*b03)*det;out[3]=(a22*b04-a21*b05-a23*b03)*det;out[4]=(a12*b08-a10*b11-a13*b07)*det;out[5]=(a00*b11-a02*b08+a03*b07)*det;out[6]=(a32*b02-a30*b05-a33*b01)*det;out[7]=(a20*b05-a22*b02+a23*b01)*det;out[8]=(a10*b10-a11*b08+a13*b06)*det;out[9]=(a01*b08-a00*b10-a03*b06)*det;out[10]=(a30*b04-a31*b02+a33*b00)*det;out[11]=(a21*b02-a20*b04-a23*b00)*det;out[12]=(a11*b07-a10*b09-a12*b06)*det;out[13]=(a00*b09-a01*b07+a02*b06)*det;out[14]=(a31*b01-a30*b03-a32*b00)*det;out[15]=(a20*b03-a21*b01+a22*b00)*det;return out}function adjoint(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3];var a10=a[4],a11=a[5],a12=a[6],a13=a[7];var a20=a[8],a21=a[9],a22=a[10],a23=a[11];var a30=a[12],a31=a[13],a32=a[14],a33=a[15];out[0]=a11*(a22*a33-a23*a32)-a21*(a12*a33-a13*a32)+a31*(a12*a23-a13*a22);out[1]=-(a01*(a22*a33-a23*a32)-a21*(a02*a33-a03*a32)+a31*(a02*a23-a03*a22));out[2]=a01*(a12*a33-a13*a32)-a11*(a02*a33-a03*a32)+a31*(a02*a13-a03*a12);out[3]=-(a01*(a12*a23-a13*a22)-a11*(a02*a23-a03*a22)+a21*(a02*a13-a03*a12));out[4]=-(a10*(a22*a33-a23*a32)-a20*(a12*a33-a13*a32)+a30*(a12*a23-a13*a22));out[5]=a00*(a22*a33-a23*a32)-a20*(a02*a33-a03*a32)+a30*(a02*a23-a03*a22);out[6]=-(a00*(a12*a33-a13*a32)-a10*(a02*a33-a03*a32)+a30*(a02*a13-a03*a12));out[7]=a00*(a12*a23-a13*a22)-a10*(a02*a23-a03*a22)+a20*(a02*a13-a03*a12);out[8]=a10*(a21*a33-a23*a31)-a20*(a11*a33-a13*a31)+a30*(a11*a23-a13*a21);out[9]=-(a00*(a21*a33-a23*a31)-a20*(a01*a33-a03*a31)+a30*(a01*a23-a03*a21));out[10]=a00*(a11*a33-a13*a31)-a10*(a01*a33-a03*a31)+a30*(a01*a13-a03*a11);out[11]=-(a00*(a11*a23-a13*a21)-a10*(a01*a23-a03*a21)+a20*(a01*a13-a03*a11));out[12]=-(a10*(a21*a32-a22*a31)-a20*(a11*a32-a12*a31)+a30*(a11*a22-a12*a21));out[13]=a00*(a21*a32-a22*a31)-a20*(a01*a32-a02*a31)+a30*(a01*a22-a02*a21);out[14]=-(a00*(a11*a32-a12*a31)-a10*(a01*a32-a02*a31)+a30*(a01*a12-a02*a11));out[15]=a00*(a11*a22-a12*a21)-a10*(a01*a22-a02*a21)+a20*(a01*a12-a02*a11);return out}function determinant(a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3];var a10=a[4],a11=a[5],a12=a[6],a13=a[7];var a20=a[8],a21=a[9],a22=a[10],a23=a[11];var a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;return b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06}function multiply(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3];var a10=a[4],a11=a[5],a12=a[6],a13=a[7];var a20=a[8],a21=a[9],a22=a[10],a23=a[11];var a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=b0*a00+b1*a10+b2*a20+b3*a30;out[1]=b0*a01+b1*a11+b2*a21+b3*a31;out[2]=b0*a02+b1*a12+b2*a22+b3*a32;out[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];out[4]=b0*a00+b1*a10+b2*a20+b3*a30;out[5]=b0*a01+b1*a11+b2*a21+b3*a31;out[6]=b0*a02+b1*a12+b2*a22+b3*a32;out[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];out[8]=b0*a00+b1*a10+b2*a20+b3*a30;out[9]=b0*a01+b1*a11+b2*a21+b3*a31;out[10]=b0*a02+b1*a12+b2*a22+b3*a32;out[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];out[12]=b0*a00+b1*a10+b2*a20+b3*a30;out[13]=b0*a01+b1*a11+b2*a21+b3*a31;out[14]=b0*a02+b1*a12+b2*a22+b3*a32;out[15]=b0*a03+b1*a13+b2*a23+b3*a33;return out}function translate(out,a,v){var x=v[0],y=v[1],z=v[2];var a00,a01,a02,a03;var a10,a11,a12,a13;var a20,a21,a22,a23;if(a===out){out[12]=a[0]*x+a[4]*y+a[8]*z+a[12];out[13]=a[1]*x+a[5]*y+a[9]*z+a[13];out[14]=a[2]*x+a[6]*y+a[10]*z+a[14];out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]}else{a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a03;out[4]=a10;out[5]=a11;out[6]=a12;out[7]=a13;out[8]=a20;out[9]=a21;out[10]=a22;out[11]=a23;out[12]=a00*x+a10*y+a20*z+a[12];out[13]=a01*x+a11*y+a21*z+a[13];out[14]=a02*x+a12*y+a22*z+a[14];out[15]=a03*x+a13*y+a23*z+a[15]}return out}function scale(out,a,v){var x=v[0],y=v[1],z=v[2];out[0]=a[0]*x;out[1]=a[1]*x;out[2]=a[2]*x;out[3]=a[3]*x;out[4]=a[4]*y;out[5]=a[5]*y;out[6]=a[6]*y;out[7]=a[7]*y;out[8]=a[8]*z;out[9]=a[9]*z;out[10]=a[10]*z;out[11]=a[11]*z;out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out}function rotate(out,a,rad,axis){var x=axis[0],y=axis[1],z=axis[2];var len=Math.hypot(x,y,z);var s,c,t;var a00,a01,a02,a03;var a10,a11,a12,a13;var a20,a21,a22,a23;var b00,b01,b02;var b10,b11,b12;var b20,b21,b22;if(len<glMatrix.EPSILON){return null}len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];b00=x*x*t+c;b01=y*x*t+z*s;b02=z*x*t-y*s;b10=x*y*t-z*s;b11=y*y*t+c;b12=z*y*t+x*s;b20=x*z*t+y*s;b21=y*z*t-x*s;b22=z*z*t+c;out[0]=a00*b00+a10*b01+a20*b02;out[1]=a01*b00+a11*b01+a21*b02;out[2]=a02*b00+a12*b01+a22*b02;out[3]=a03*b00+a13*b01+a23*b02;out[4]=a00*b10+a10*b11+a20*b12;out[5]=a01*b10+a11*b11+a21*b12;out[6]=a02*b10+a12*b11+a22*b12;out[7]=a03*b10+a13*b11+a23*b12;out[8]=a00*b20+a10*b21+a20*b22;out[9]=a01*b20+a11*b21+a21*b22;out[10]=a02*b20+a12*b21+a22*b22;out[11]=a03*b20+a13*b21+a23*b22;if(a!==out){out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}return out}function rotateX(out,a,rad){var s=Math.sin(rad);var c=Math.cos(rad);var a10=a[4];var a11=a[5];var a12=a[6];var a13=a[7];var a20=a[8];var a21=a[9];var a22=a[10];var a23=a[11];if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[4]=a10*c+a20*s;out[5]=a11*c+a21*s;out[6]=a12*c+a22*s;out[7]=a13*c+a23*s;out[8]=a20*c-a10*s;out[9]=a21*c-a11*s;out[10]=a22*c-a12*s;out[11]=a23*c-a13*s;return out}function rotateY(out,a,rad){var s=Math.sin(rad);var c=Math.cos(rad);var a00=a[0];var a01=a[1];var a02=a[2];var a03=a[3];var a20=a[8];var a21=a[9];var a22=a[10];var a23=a[11];if(a!==out){out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c-a20*s;out[1]=a01*c-a21*s;out[2]=a02*c-a22*s;out[3]=a03*c-a23*s;out[8]=a00*s+a20*c;out[9]=a01*s+a21*c;out[10]=a02*s+a22*c;out[11]=a03*s+a23*c;return out}function rotateZ(out,a,rad){var s=Math.sin(rad);var c=Math.cos(rad);var a00=a[0];var a01=a[1];var a02=a[2];var a03=a[3];var a10=a[4];var a11=a[5];var a12=a[6];var a13=a[7];if(a!==out){out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c+a10*s;out[1]=a01*c+a11*s;out[2]=a02*c+a12*s;out[3]=a03*c+a13*s;out[4]=a10*c-a00*s;out[5]=a11*c-a01*s;out[6]=a12*c-a02*s;out[7]=a13*c-a03*s;return out}function fromTranslation(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out}function fromScaling(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=v[1];out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=v[2];out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function fromRotation(out,rad,axis){var x=axis[0],y=axis[1],z=axis[2];var len=Math.hypot(x,y,z);var s,c,t;if(len<glMatrix.EPSILON){return null}len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;out[0]=x*x*t+c;out[1]=y*x*t+z*s;out[2]=z*x*t-y*s;out[3]=0;out[4]=x*y*t-z*s;out[5]=y*y*t+c;out[6]=z*y*t+x*s;out[7]=0;out[8]=x*z*t+y*s;out[9]=y*z*t-x*s;out[10]=z*z*t+c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function fromXRotation(out,rad){var s=Math.sin(rad);var c=Math.cos(rad);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=c;out[6]=s;out[7]=0;out[8]=0;out[9]=-s;out[10]=c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function fromYRotation(out,rad){var s=Math.sin(rad);var c=Math.cos(rad);out[0]=c;out[1]=0;out[2]=-s;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=s;out[9]=0;out[10]=c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function fromZRotation(out,rad){var s=Math.sin(rad);var c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=0;out[3]=0;out[4]=-s;out[5]=c;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function fromRotationTranslation(out,q,v){var x=q[0],y=q[1],z=q[2],w=q[3];var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out}function fromQuat2(out,a){var translation=new glMatrix.ARRAY_TYPE(3);var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7];var magnitude=bx*bx+by*by+bz*bz+bw*bw;if(magnitude>0){translation[0]=(ax*bw+aw*bx+ay*bz-az*by)*2/magnitude;translation[1]=(ay*bw+aw*by+az*bx-ax*bz)*2/magnitude;translation[2]=(az*bw+aw*bz+ax*by-ay*bx)*2/magnitude}else{translation[0]=(ax*bw+aw*bx+ay*bz-az*by)*2;translation[1]=(ay*bw+aw*by+az*bx-ax*bz)*2;translation[2]=(az*bw+aw*bz+ax*by-ay*bx)*2}fromRotationTranslation(out,a,translation);return out}function getTranslation(out,mat){out[0]=mat[12];out[1]=mat[13];out[2]=mat[14];return out}function getScaling(out,mat){var m11=mat[0];var m12=mat[1];var m13=mat[2];var m21=mat[4];var m22=mat[5];var m23=mat[6];var m31=mat[8];var m32=mat[9];var m33=mat[10];out[0]=Math.hypot(m11,m12,m13);out[1]=Math.hypot(m21,m22,m23);out[2]=Math.hypot(m31,m32,m33);return out}function getRotation(out,mat){var scaling=new glMatrix.ARRAY_TYPE(3);getScaling(scaling,mat);var is1=1/scaling[0];var is2=1/scaling[1];var is3=1/scaling[2];var sm11=mat[0]*is1;var sm12=mat[1]*is2;var sm13=mat[2]*is3;var sm21=mat[4]*is1;var sm22=mat[5]*is2;var sm23=mat[6]*is3;var sm31=mat[8]*is1;var sm32=mat[9]*is2;var sm33=mat[10]*is3;var trace=sm11+sm22+sm33;var S=0;if(trace>0){S=Math.sqrt(trace+1)*2;out[3]=0.25*S;out[0]=(sm23-sm32)/S;out[1]=(sm31-sm13)/S;out[2]=(sm12-sm21)/S}else{if(sm11>sm22&&sm11>sm33){S=Math.sqrt(1+sm11-sm22-sm33)*2;out[3]=(sm23-sm32)/S;out[0]=0.25*S;out[1]=(sm12+sm21)/S;out[2]=(sm31+sm13)/S}else{if(sm22>sm33){S=Math.sqrt(1+sm22-sm11-sm33)*2;out[3]=(sm31-sm13)/S;out[0]=(sm12+sm21)/S;out[1]=0.25*S;out[2]=(sm23+sm32)/S}else{S=Math.sqrt(1+sm33-sm11-sm22)*2;out[3]=(sm12-sm21)/S;out[0]=(sm31+sm13)/S;out[1]=(sm23+sm32)/S;out[2]=0.25*S}}}return out}function fromRotationTranslationScale(out,q,v,s){var x=q[0],y=q[1],z=q[2],w=q[3];var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;var sx=s[0];var sy=s[1];var sz=s[2];out[0]=(1-(yy+zz))*sx;out[1]=(xy+wz)*sx;out[2]=(xz-wy)*sx;out[3]=0;out[4]=(xy-wz)*sy;out[5]=(1-(xx+zz))*sy;out[6]=(yz+wx)*sy;out[7]=0;out[8]=(xz+wy)*sz;out[9]=(yz-wx)*sz;out[10]=(1-(xx+yy))*sz;out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out}function fromRotationTranslationScaleOrigin(out,q,v,s,o){var x=q[0],y=q[1],z=q[2],w=q[3];var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;var sx=s[0];var sy=s[1];var sz=s[2];var ox=o[0];var oy=o[1];var oz=o[2];var out0=(1-(yy+zz))*sx;var out1=(xy+wz)*sx;var out2=(xz-wy)*sx;var out4=(xy-wz)*sy;var out5=(1-(xx+zz))*sy;var out6=(yz+wx)*sy;var out8=(xz+wy)*sz;var out9=(yz-wx)*sz;var out10=(1-(xx+yy))*sz;out[0]=out0;out[1]=out1;out[2]=out2;out[3]=0;out[4]=out4;out[5]=out5;out[6]=out6;out[7]=0;out[8]=out8;out[9]=out9;out[10]=out10;out[11]=0;out[12]=v[0]+ox-(out0*ox+out4*oy+out8*oz);out[13]=v[1]+oy-(out1*ox+out5*oy+out9*oz);out[14]=v[2]+oz-(out2*ox+out6*oy+out10*oz);out[15]=1;return out}function fromQuat(out,q){var x=q[0],y=q[1],z=q[2],w=q[3];var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var yx=y*x2;var yy=y*y2;var zx=z*x2;var zy=z*y2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;out[0]=1-yy-zz;out[1]=yx+wz;out[2]=zx-wy;out[3]=0;out[4]=yx-wz;out[5]=1-xx-zz;out[6]=zy+wx;out[7]=0;out[8]=zx+wy;out[9]=zy-wx;out[10]=1-xx-yy;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}function frustum(out,left,right,bottom,top,near,far){var rl=1/(right-left);var tb=1/(top-bottom);var nf=1/(near-far);out[0]=near*2*rl;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=near*2*tb;out[6]=0;out[7]=0;out[8]=(right+left)*rl;out[9]=(top+bottom)*tb;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near*2*nf;out[15]=0;return out}function perspective(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2),nf;out[0]=f/aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[11]=-1;out[12]=0;out[13]=0;out[15]=0;if(far!=null&&far!==Infinity){nf=1/(near-far);out[10]=(far+near)*nf;out[14]=2*far*near*nf}else{out[10]=-1;out[14]=-2*near}return out}function perspectiveFromFieldOfView(out,fov,near,far){var upTan=Math.tan(fov.upDegrees*Math.PI/180);var downTan=Math.tan(fov.downDegrees*Math.PI/180);var leftTan=Math.tan(fov.leftDegrees*Math.PI/180);var rightTan=Math.tan(fov.rightDegrees*Math.PI/180);var xScale=2/(leftTan+rightTan);var yScale=2/(upTan+downTan);out[0]=xScale;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=yScale;out[6]=0;out[7]=0;out[8]=-((leftTan-rightTan)*xScale*0.5);out[9]=(upTan-downTan)*yScale*0.5;out[10]=far/(near-far);out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near/(near-far);out[15]=0;return out}function ortho(out,left,right,bottom,top,near,far){var lr=1/(left-right);var bt=1/(bottom-top);var nf=1/(near-far);out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=2*nf;out[11]=0;out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=(far+near)*nf;out[15]=1;return out}function lookAt(out,eye,center,up){var x0,x1,x2,y0,y1,y2,z0,z1,z2,len;var eyex=eye[0];var eyey=eye[1];var eyez=eye[2];var upx=up[0];var upy=up[1];var upz=up[2];var centerx=center[0];var centery=center[1];var centerz=center[2];if(Math.abs(eyex-centerx)<glMatrix.EPSILON&&Math.abs(eyey-centery)<glMatrix.EPSILON&&Math.abs(eyez-centerz)<glMatrix.EPSILON){return identity(out)}z0=eyex-centerx;z1=eyey-centery;z2=eyez-centerz;len=1/Math.hypot(z0,z1,z2);z0*=len;z1*=len;z2*=len;x0=upy*z2-upz*z1;x1=upz*z0-upx*z2;x2=upx*z1-upy*z0;len=Math.hypot(x0,x1,x2);if(!len){x0=0;x1=0;x2=0}else{len=1/len;x0*=len;x1*=len;x2*=len}y0=z1*x2-z2*x1;y1=z2*x0-z0*x2;y2=z0*x1-z1*x0;len=Math.hypot(y0,y1,y2);if(!len){y0=0;y1=0;y2=0}else{len=1/len;y0*=len;y1*=len;y2*=len}out[0]=x0;out[1]=y0;out[2]=z0;out[3]=0;out[4]=x1;out[5]=y1;out[6]=z1;out[7]=0;out[8]=x2;out[9]=y2;out[10]=z2;out[11]=0;out[12]=-(x0*eyex+x1*eyey+x2*eyez);out[13]=-(y0*eyex+y1*eyey+y2*eyez);out[14]=-(z0*eyex+z1*eyey+z2*eyez);out[15]=1;return out}function targetTo(out,eye,target,up){var eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2];var z0=eyex-target[0],z1=eyey-target[1],z2=eyez-target[2];var len=z0*z0+z1*z1+z2*z2;if(len>0){len=1/Math.sqrt(len);z0*=len;z1*=len;z2*=len}var x0=upy*z2-upz*z1,x1=upz*z0-upx*z2,x2=upx*z1-upy*z0;len=x0*x0+x1*x1+x2*x2;if(len>0){len=1/Math.sqrt(len);x0*=len;x1*=len;x2*=len}out[0]=x0;out[1]=x1;out[2]=x2;out[3]=0;out[4]=z1*x2-z2*x1;out[5]=z2*x0-z0*x2;out[6]=z0*x1-z1*x0;out[7]=0;out[8]=z0;out[9]=z1;out[10]=z2;out[11]=0;out[12]=eyex;out[13]=eyey;out[14]=eyez;out[15]=1;return out}function str(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"}function frob(a){return Math.hypot(a[0],a[1],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])}function add(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];out[6]=a[6]+b[6];out[7]=a[7]+b[7];out[8]=a[8]+b[8];out[9]=a[9]+b[9];out[10]=a[10]+b[10];out[11]=a[11]+b[11];out[12]=a[12]+b[12];out[13]=a[13]+b[13];out[14]=a[14]+b[14];out[15]=a[15]+b[15];return out}function subtract(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];out[6]=a[6]-b[6];out[7]=a[7]-b[7];out[8]=a[8]-b[8];out[9]=a[9]-b[9];out[10]=a[10]-b[10];out[11]=a[11]-b[11];out[12]=a[12]-b[12];out[13]=a[13]-b[13];out[14]=a[14]-b[14];out[15]=a[15]-b[15];return out}function multiplyScalar(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;out[6]=a[6]*b;out[7]=a[7]*b;out[8]=a[8]*b;out[9]=a[9]*b;out[10]=a[10]*b;out[11]=a[11]*b;out[12]=a[12]*b;out[13]=a[13]*b;out[14]=a[14]*b;out[15]=a[15]*b;return out}function multiplyScalarAndAdd(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;out[6]=a[6]+b[6]*scale;out[7]=a[7]+b[7]*scale;out[8]=a[8]+b[8]*scale;out[9]=a[9]+b[9]*scale;out[10]=a[10]+b[10]*scale;out[11]=a[11]+b[11]*scale;out[12]=a[12]+b[12]*scale;out[13]=a[13]+b[13]*scale;out[14]=a[14]+b[14]*scale;out[15]=a[15]+b[15]*scale;return out}function exactEquals(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]}function equals(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var a4=a[4],a5=a[5],a6=a[6],a7=a[7];var a8=a[8],a9=a[9],a10=a[10],a11=a[11];var a12=a[12],a13=a[13],a14=a[14],a15=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];var b4=b[4],b5=b[5],b6=b[6],b7=b[7];var b8=b[8],b9=b[9],b10=b[10],b11=b[11];var b12=b[12],b13=b[13],b14=b[14],b15=b[15];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=glMatrix.EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=glMatrix.EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=glMatrix.EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=glMatrix.EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=glMatrix.EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))&&Math.abs(a9-b9)<=glMatrix.EPSILON*Math.max(1,Math.abs(a9),Math.abs(b9))&&Math.abs(a10-b10)<=glMatrix.EPSILON*Math.max(1,Math.abs(a10),Math.abs(b10))&&Math.abs(a11-b11)<=glMatrix.EPSILON*Math.max(1,Math.abs(a11),Math.abs(b11))&&Math.abs(a12-b12)<=glMatrix.EPSILON*Math.max(1,Math.abs(a12),Math.abs(b12))&&Math.abs(a13-b13)<=glMatrix.EPSILON*Math.max(1,Math.abs(a13),Math.abs(b13))&&Math.abs(a14-b14)<=glMatrix.EPSILON*Math.max(1,Math.abs(a14),Math.abs(b14))&&Math.abs(a15-b15)<=glMatrix.EPSILON*Math.max(1,Math.abs(a15),Math.abs(b15))}var mul=multiply;exports.mul=mul;var sub=subtract;exports.sub=sub},{"./common.js":22}],28:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.create=create;exports.identity=identity;exports.setAxisAngle=setAxisAngle;exports.getAxisAngle=getAxisAngle;exports.getAngle=getAngle;exports.multiply=multiply;exports.rotateX=rotateX;exports.rotateY=rotateY;exports.rotateZ=rotateZ;exports.calculateW=calculateW;exports.exp=exp;exports.ln=ln;exports.pow=pow;exports.slerp=slerp;exports.random=random;exports.invert=invert;exports.conjugate=conjugate;exports.fromMat3=fromMat3;exports.fromEuler=fromEuler;exports.str=str;exports.setAxes=exports.sqlerp=exports.rotationTo=exports.equals=exports.exactEquals=exports.normalize=exports.sqrLen=exports.squaredLength=exports.len=exports.length=exports.lerp=exports.dot=exports.scale=exports.mul=exports.add=exports.set=exports.copy=exports.fromValues=exports.clone=void 0;var glMatrix=_interopRequireWildcard(require("./common.js"));var mat3=_interopRequireWildcard(require("./mat3.js"));var vec3=_interopRequireWildcard(require("./vec3.js"));var vec4=_interopRequireWildcard(require("./vec4.js"));function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj["default"]=obj;return newObj}}function create(){var out=new glMatrix.ARRAY_TYPE(4);if(glMatrix.ARRAY_TYPE!=Float32Array){out[0]=0;out[1]=0;out[2]=0}out[3]=1;return out}function identity(out){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out}function setAxisAngle(out,axis,rad){rad=rad*0.5;var s=Math.sin(rad);out[0]=s*axis[0];out[1]=s*axis[1];out[2]=s*axis[2];out[3]=Math.cos(rad);return out}function getAxisAngle(out_axis,q){var rad=Math.acos(q[3])*2;var s=Math.sin(rad/2);if(s>glMatrix.EPSILON){out_axis[0]=q[0]/s;out_axis[1]=q[1]/s;out_axis[2]=q[2]/s}else{out_axis[0]=1;out_axis[1]=0;out_axis[2]=0}return rad}function getAngle(a,b){var dotproduct=dot(a,b);return Math.acos(2*dotproduct*dotproduct-1)}function multiply(out,a,b){var ax=a[0],ay=a[1],az=a[2],aw=a[3];var bx=b[0],by=b[1],bz=b[2],bw=b[3];out[0]=ax*bw+aw*bx+ay*bz-az*by;out[1]=ay*bw+aw*by+az*bx-ax*bz;out[2]=az*bw+aw*bz+ax*by-ay*bx;out[3]=aw*bw-ax*bx-ay*by-az*bz;return out}function rotateX(out,a,rad){rad*=0.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3];var bx=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+aw*bx;out[1]=ay*bw+az*bx;out[2]=az*bw-ay*bx;out[3]=aw*bw-ax*bx;return out}function rotateY(out,a,rad){rad*=0.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3];var by=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw-az*by;out[1]=ay*bw+aw*by;out[2]=az*bw+ax*by;out[3]=aw*bw-ay*by;return out}function rotateZ(out,a,rad){rad*=0.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3];var bz=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+ay*bz;out[1]=ay*bw-ax*bz;out[2]=az*bw+aw*bz;out[3]=aw*bw-az*bz;return out}function calculateW(out,a){var x=a[0],y=a[1],z=a[2];out[0]=x;out[1]=y;out[2]=z;out[3]=Math.sqrt(Math.abs(1-x*x-y*y-z*z));return out}function exp(out,a){var x=a[0],y=a[1],z=a[2],w=a[3];var r=Math.sqrt(x*x+y*y+z*z);var et=Math.exp(w);var s=r>0?et*Math.sin(r)/r:0;out[0]=x*s;out[1]=y*s;out[2]=z*s;out[3]=et*Math.cos(r);return out}function ln(out,a){var x=a[0],y=a[1],z=a[2],w=a[3];var r=Math.sqrt(x*x+y*y+z*z);var t=r>0?Math.atan2(r,w)/r:0;out[0]=x*t;out[1]=y*t;out[2]=z*t;out[3]=0.5*Math.log(x*x+y*y+z*z+w*w);return out}function pow(out,a,b){ln(out,a);scale(out,out,b);exp(out,out);return out}function slerp(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3];var bx=b[0],by=b[1],bz=b[2],bw=b[3];var omega,cosom,sinom,scale0,scale1;cosom=ax*bx+ay*by+az*bz+aw*bw;if(cosom<0){cosom=-cosom;bx=-bx;by=-by;bz=-bz;bw=-bw}if(1-cosom>glMatrix.EPSILON){omega=Math.acos(cosom);sinom=Math.sin(omega);scale0=Math.sin((1-t)*omega)/sinom;scale1=Math.sin(t*omega)/sinom}else{scale0=1-t;scale1=t}out[0]=scale0*ax+scale1*bx;out[1]=scale0*ay+scale1*by;out[2]=scale0*az+scale1*bz;out[3]=scale0*aw+scale1*bw;return out}function random(out){var u1=glMatrix.RANDOM();var u2=glMatrix.RANDOM();var u3=glMatrix.RANDOM();var sqrt1MinusU1=Math.sqrt(1-u1);var sqrtU1=Math.sqrt(u1);out[0]=sqrt1MinusU1*Math.sin(2*Math.PI*u2);out[1]=sqrt1MinusU1*Math.cos(2*Math.PI*u2);out[2]=sqrtU1*Math.sin(2*Math.PI*u3);out[3]=sqrtU1*Math.cos(2*Math.PI*u3);return out}function invert(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var dot=a0*a0+a1*a1+a2*a2+a3*a3;var invDot=dot?1/dot:0;out[0]=-a0*invDot;out[1]=-a1*invDot;out[2]=-a2*invDot;out[3]=a3*invDot;return out}function conjugate(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=a[3];return out}function fromMat3(out,m){var fTrace=m[0]+m[4]+m[8];var fRoot;if(fTrace>0){fRoot=Math.sqrt(fTrace+1);out[3]=0.5*fRoot;fRoot=0.5/fRoot;out[0]=(m[5]-m[7])*fRoot;out[1]=(m[6]-m[2])*fRoot;out[2]=(m[1]-m[3])*fRoot}else{var i=0;if(m[4]>m[0]){i=1}if(m[8]>m[i*3+i]){i=2}var j=(i+1)%3;var k=(i+2)%3;fRoot=Math.sqrt(m[i*3+i]-m[j*3+j]-m[k*3+k]+1);out[i]=0.5*fRoot;fRoot=0.5/fRoot;out[3]=(m[j*3+k]-m[k*3+j])*fRoot;out[j]=(m[j*3+i]+m[i*3+j])*fRoot;out[k]=(m[k*3+i]+m[i*3+k])*fRoot}return out}function fromEuler(out,x,y,z){var halfToRad=0.5*Math.PI/180;x*=halfToRad;y*=halfToRad;z*=halfToRad;var sx=Math.sin(x);var cx=Math.cos(x);var sy=Math.sin(y);var cy=Math.cos(y);var sz=Math.sin(z);var cz=Math.cos(z);out[0]=sx*cy*cz-cx*sy*sz;out[1]=cx*sy*cz+sx*cy*sz;out[2]=cx*cy*sz-sx*sy*cz;out[3]=cx*cy*cz+sx*sy*sz;return out}function str(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"}var clone=vec4.clone;exports.clone=clone;var fromValues=vec4.fromValues;exports.fromValues=fromValues;var copy=vec4.copy;exports.copy=copy;var set=vec4.set;exports.set=set;var add=vec4.add;exports.add=add;var mul=multiply;exports.mul=mul;var scale=vec4.scale;exports.scale=scale;var dot=vec4.dot;exports.dot=dot;var lerp=vec4.lerp;exports.lerp=lerp;var length=vec4.length;exports.length=length;var len=length;exports.len=len;var squaredLength=vec4.squaredLength;exports.squaredLength=squaredLength;var sqrLen=squaredLength;exports.sqrLen=sqrLen;var normalize=vec4.normalize;exports.normalize=normalize;var exactEquals=vec4.exactEquals;exports.exactEquals=exactEquals;var equals=vec4.equals;exports.equals=equals;var rotationTo=function(){var tmpvec3=vec3.create();var xUnitVec3=vec3.fromValues(1,0,0);var yUnitVec3=vec3.fromValues(0,1,0);return function(out,a,b){var dot=vec3.dot(a,b);if(dot<-0.999999){vec3.cross(tmpvec3,xUnitVec3,a);if(vec3.len(tmpvec3)<0.000001){vec3.cross(tmpvec3,yUnitVec3,a)}vec3.normalize(tmpvec3,tmpvec3);setAxisAngle(out,tmpvec3,Math.PI);return out}else{if(dot>0.999999){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out}else{vec3.cross(tmpvec3,a,b);out[0]=tmpvec3[0];out[1]=tmpvec3[1];out[2]=tmpvec3[2];out[3]=1+dot;return normalize(out,out)}}}}();exports.rotationTo=rotationTo;var sqlerp=function(){var temp1=create();var temp2=create();return function(out,a,b,c,d,t){slerp(temp1,a,d,t);slerp(temp2,b,c,t);slerp(out,temp1,temp2,2*t*(1-t));return out}}();exports.sqlerp=sqlerp;var setAxes=function(){var matr=mat3.create();return function(out,view,right,up){matr[0]=right[0];matr[3]=right[1];matr[6]=right[2];matr[1]=up[0];matr[4]=up[1];matr[7]=up[2];matr[2]=-view[0];matr[5]=-view[1];matr[8]=-view[2];return normalize(out,fromMat3(out,matr))}}();exports.setAxes=setAxes},{"./common.js":22,"./mat3.js":26,"./vec3.js":31,"./vec4.js":32}],29:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.create=create;exports.clone=clone;exports.fromValues=fromValues;exports.fromRotationTranslationValues=fromRotationTranslationValues;exports.fromRotationTranslation=fromRotationTranslation;exports.fromTranslation=fromTranslation;exports.fromRotation=fromRotation;exports.fromMat4=fromMat4;exports.copy=copy;exports.identity=identity;exports.set=set;exports.getDual=getDual;exports.setDual=setDual;exports.getTranslation=getTranslation;exports.translate=translate;exports.rotateX=rotateX;exports.rotateY=rotateY;exports.rotateZ=rotateZ;exports.rotateByQuatAppend=rotateByQuatAppend;exports.rotateByQuatPrepend=rotateByQuatPrepend;exports.rotateAroundAxis=rotateAroundAxis;exports.add=add;exports.multiply=multiply;exports.scale=scale;exports.lerp=lerp;exports.invert=invert;exports.conjugate=conjugate;exports.normalize=normalize;exports.str=str;exports.exactEquals=exactEquals;exports.equals=equals;exports.sqrLen=exports.squaredLength=exports.len=exports.length=exports.dot=exports.mul=exports.setReal=exports.getReal=void 0;var glMatrix=_interopRequireWildcard(require("./common.js"));var quat=_interopRequireWildcard(require("./quat.js"));var mat4=_interopRequireWildcard(require("./mat4.js"));function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj["default"]=obj;return newObj}}function create(){var dq=new glMatrix.ARRAY_TYPE(8);if(glMatrix.ARRAY_TYPE!=Float32Array){dq[0]=0;dq[1]=0;dq[2]=0;dq[4]=0;dq[5]=0;dq[6]=0;dq[7]=0}dq[3]=1;return dq}function clone(a){var dq=new glMatrix.ARRAY_TYPE(8);dq[0]=a[0];dq[1]=a[1];dq[2]=a[2];dq[3]=a[3];dq[4]=a[4];dq[5]=a[5];dq[6]=a[6];dq[7]=a[7];return dq}function fromValues(x1,y1,z1,w1,x2,y2,z2,w2){var dq=new glMatrix.ARRAY_TYPE(8);dq[0]=x1;dq[1]=y1;dq[2]=z1;dq[3]=w1;dq[4]=x2;dq[5]=y2;dq[6]=z2;dq[7]=w2;return dq}function fromRotationTranslationValues(x1,y1,z1,w1,x2,y2,z2){var dq=new glMatrix.ARRAY_TYPE(8);dq[0]=x1;dq[1]=y1;dq[2]=z1;dq[3]=w1;var ax=x2*0.5,ay=y2*0.5,az=z2*0.5;dq[4]=ax*w1+ay*z1-az*y1;dq[5]=ay*w1+az*x1-ax*z1;dq[6]=az*w1+ax*y1-ay*x1;dq[7]=-ax*x1-ay*y1-az*z1;return dq}function fromRotationTranslation(out,q,t){var ax=t[0]*0.5,ay=t[1]*0.5,az=t[2]*0.5,bx=q[0],by=q[1],bz=q[2],bw=q[3];out[0]=bx;out[1]=by;out[2]=bz;out[3]=bw;out[4]=ax*bw+ay*bz-az*by;out[5]=ay*bw+az*bx-ax*bz;out[6]=az*bw+ax*by-ay*bx;out[7]=-ax*bx-ay*by-az*bz;return out}function fromTranslation(out,t){out[0]=0;out[1]=0;out[2]=0;out[3]=1;out[4]=t[0]*0.5;out[5]=t[1]*0.5;out[6]=t[2]*0.5;out[7]=0;return out}function fromRotation(out,q){out[0]=q[0];out[1]=q[1];out[2]=q[2];out[3]=q[3];out[4]=0;out[5]=0;out[6]=0;out[7]=0;return out}function fromMat4(out,a){var outer=quat.create();mat4.getRotation(outer,a);var t=new glMatrix.ARRAY_TYPE(3);mat4.getTranslation(t,a);fromRotationTranslation(out,outer,t);return out}function copy(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];return out}function identity(out){out[0]=0;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;out[6]=0;out[7]=0;return out}function set(out,x1,y1,z1,w1,x2,y2,z2,w2){out[0]=x1;out[1]=y1;out[2]=z1;out[3]=w1;out[4]=x2;out[5]=y2;out[6]=z2;out[7]=w2;return out}var getReal=quat.copy;exports.getReal=getReal;function getDual(out,a){out[0]=a[4];out[1]=a[5];out[2]=a[6];out[3]=a[7];return out}var setReal=quat.copy;exports.setReal=setReal;function setDual(out,q){out[4]=q[0];out[5]=q[1];out[6]=q[2];out[7]=q[3];return out}function getTranslation(out,a){var ax=a[4],ay=a[5],az=a[6],aw=a[7],bx=-a[0],by=-a[1],bz=-a[2],bw=a[3];out[0]=(ax*bw+aw*bx+ay*bz-az*by)*2;out[1]=(ay*bw+aw*by+az*bx-ax*bz)*2;out[2]=(az*bw+aw*bz+ax*by-ay*bx)*2;return out}function translate(out,a,v){var ax1=a[0],ay1=a[1],az1=a[2],aw1=a[3],bx1=v[0]*0.5,by1=v[1]*0.5,bz1=v[2]*0.5,ax2=a[4],ay2=a[5],az2=a[6],aw2=a[7];out[0]=ax1;out[1]=ay1;out[2]=az1;out[3]=aw1;out[4]=aw1*bx1+ay1*bz1-az1*by1+ax2;out[5]=aw1*by1+az1*bx1-ax1*bz1+ay2;out[6]=aw1*bz1+ax1*by1-ay1*bx1+az2;out[7]=-ax1*bx1-ay1*by1-az1*bz1+aw2;return out}function rotateX(out,a,rad){var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-ax*bx-ay*by-az*bz;quat.rotateX(out,a,rad);bx=out[0];by=out[1];bz=out[2];bw=out[3];out[4]=ax1*bw+aw1*bx+ay1*bz-az1*by;out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz;out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx;out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz;return out}function rotateY(out,a,rad){var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-ax*bx-ay*by-az*bz;quat.rotateY(out,a,rad);bx=out[0];by=out[1];bz=out[2];bw=out[3];out[4]=ax1*bw+aw1*bx+ay1*bz-az1*by;out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz;out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx;out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz;return out}function rotateZ(out,a,rad){var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-ax*bx-ay*by-az*bz;quat.rotateZ(out,a,rad);bx=out[0];by=out[1];bz=out[2];bw=out[3];out[4]=ax1*bw+aw1*bx+ay1*bz-az1*by;out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz;out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx;out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz;return out}function rotateByQuatAppend(out,a,q){var qx=q[0],qy=q[1],qz=q[2],qw=q[3],ax=a[0],ay=a[1],az=a[2],aw=a[3];out[0]=ax*qw+aw*qx+ay*qz-az*qy;out[1]=ay*qw+aw*qy+az*qx-ax*qz;out[2]=az*qw+aw*qz+ax*qy-ay*qx;out[3]=aw*qw-ax*qx-ay*qy-az*qz;ax=a[4];ay=a[5];az=a[6];aw=a[7];out[4]=ax*qw+aw*qx+ay*qz-az*qy;out[5]=ay*qw+aw*qy+az*qx-ax*qz;out[6]=az*qw+aw*qz+ax*qy-ay*qx;out[7]=aw*qw-ax*qx-ay*qy-az*qz;return out}function rotateByQuatPrepend(out,q,a){var qx=q[0],qy=q[1],qz=q[2],qw=q[3],bx=a[0],by=a[1],bz=a[2],bw=a[3];out[0]=qx*bw+qw*bx+qy*bz-qz*by;out[1]=qy*bw+qw*by+qz*bx-qx*bz;out[2]=qz*bw+qw*bz+qx*by-qy*bx;out[3]=qw*bw-qx*bx-qy*by-qz*bz;bx=a[4];by=a[5];bz=a[6];bw=a[7];out[4]=qx*bw+qw*bx+qy*bz-qz*by;out[5]=qy*bw+qw*by+qz*bx-qx*bz;out[6]=qz*bw+qw*bz+qx*by-qy*bx;out[7]=qw*bw-qx*bx-qy*by-qz*bz;return out}function rotateAroundAxis(out,a,axis,rad){if(Math.abs(rad)<glMatrix.EPSILON){return copy(out,a)}var axisLength=Math.hypot(axis[0],axis[1],axis[2]);rad=rad*0.5;var s=Math.sin(rad);var bx=s*axis[0]/axisLength;var by=s*axis[1]/axisLength;var bz=s*axis[2]/axisLength;var bw=Math.cos(rad);var ax1=a[0],ay1=a[1],az1=a[2],aw1=a[3];out[0]=ax1*bw+aw1*bx+ay1*bz-az1*by;out[1]=ay1*bw+aw1*by+az1*bx-ax1*bz;out[2]=az1*bw+aw1*bz+ax1*by-ay1*bx;out[3]=aw1*bw-ax1*bx-ay1*by-az1*bz;var ax=a[4],ay=a[5],az=a[6],aw=a[7];out[4]=ax*bw+aw*bx+ay*bz-az*by;out[5]=ay*bw+aw*by+az*bx-ax*bz;out[6]=az*bw+aw*bz+ax*by-ay*bx;out[7]=aw*bw-ax*bx-ay*by-az*bz;return out}function add(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];out[6]=a[6]+b[6];out[7]=a[7]+b[7];return out}function multiply(out,a,b){var ax0=a[0],ay0=a[1],az0=a[2],aw0=a[3],bx1=b[4],by1=b[5],bz1=b[6],bw1=b[7],ax1=a[4],ay1=a[5],az1=a[6],aw1=a[7],bx0=b[0],by0=b[1],bz0=b[2],bw0=b[3];out[0]=ax0*bw0+aw0*bx0+ay0*bz0-az0*by0;out[1]=ay0*bw0+aw0*by0+az0*bx0-ax0*bz0;out[2]=az0*bw0+aw0*bz0+ax0*by0-ay0*bx0;out[3]=aw0*bw0-ax0*bx0-ay0*by0-az0*bz0;out[4]=ax0*bw1+aw0*bx1+ay0*bz1-az0*by1+ax1*bw0+aw1*bx0+ay1*bz0-az1*by0;out[5]=ay0*bw1+aw0*by1+az0*bx1-ax0*bz1+ay1*bw0+aw1*by0+az1*bx0-ax1*bz0;out[6]=az0*bw1+aw0*bz1+ax0*by1-ay0*bx1+az1*bw0+aw1*bz0+ax1*by0-ay1*bx0;out[7]=aw0*bw1-ax0*bx1-ay0*by1-az0*bz1+aw1*bw0-ax1*bx0-ay1*by0-az1*bz0;return out}var mul=multiply;exports.mul=mul;function scale(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;out[6]=a[6]*b;out[7]=a[7]*b;return out}var dot=quat.dot;exports.dot=dot;function lerp(out,a,b,t){var mt=1-t;if(dot(a,b)<0){t=-t}out[0]=a[0]*mt+b[0]*t;out[1]=a[1]*mt+b[1]*t;out[2]=a[2]*mt+b[2]*t;out[3]=a[3]*mt+b[3]*t;out[4]=a[4]*mt+b[4]*t;out[5]=a[5]*mt+b[5]*t;out[6]=a[6]*mt+b[6]*t;out[7]=a[7]*mt+b[7]*t;return out}function invert(out,a){var sqlen=squaredLength(a);out[0]=-a[0]/sqlen;out[1]=-a[1]/sqlen;out[2]=-a[2]/sqlen;out[3]=a[3]/sqlen;out[4]=-a[4]/sqlen;out[5]=-a[5]/sqlen;out[6]=-a[6]/sqlen;out[7]=a[7]/sqlen;return out}function conjugate(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=a[3];out[4]=-a[4];out[5]=-a[5];out[6]=-a[6];out[7]=a[7];return out}var length=quat.length;exports.length=length;var len=length;exports.len=len;var squaredLength=quat.squaredLength;exports.squaredLength=squaredLength;var sqrLen=squaredLength;exports.sqrLen=sqrLen;function normalize(out,a){var magnitude=squaredLength(a);if(magnitude>0){magnitude=Math.sqrt(magnitude);var a0=a[0]/magnitude;var a1=a[1]/magnitude;var a2=a[2]/magnitude;var a3=a[3]/magnitude;var b0=a[4];var b1=a[5];var b2=a[6];var b3=a[7];var a_dot_b=a0*b0+a1*b1+a2*b2+a3*b3;out[0]=a0;out[1]=a1;out[2]=a2;out[3]=a3;out[4]=(b0-a0*a_dot_b)/magnitude;out[5]=(b1-a1*a_dot_b)/magnitude;out[6]=(b2-a2*a_dot_b)/magnitude;out[7]=(b3-a3*a_dot_b)/magnitude}return out}function str(a){return"quat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+")"}function exactEquals(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]}function equals(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=glMatrix.EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=glMatrix.EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=glMatrix.EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=glMatrix.EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))}},{"./common.js":22,"./mat4.js":27,"./quat.js":28}],30:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.create=create;exports.clone=clone;exports.fromValues=fromValues;exports.copy=copy;exports.set=set;exports.add=add;exports.subtract=subtract;exports.multiply=multiply;exports.divide=divide;exports.ceil=ceil;exports.floor=floor;exports.min=min;exports.max=max;exports.round=round;exports.scale=scale;exports.scaleAndAdd=scaleAndAdd;exports.distance=distance;exports.squaredDistance=squaredDistance;exports.length=length;exports.squaredLength=squaredLength;exports.negate=negate;exports.inverse=inverse;exports.normalize=normalize;exports.dot=dot;exports.cross=cross;exports.lerp=lerp;exports.random=random;exports.transformMat2=transformMat2;exports.transformMat2d=transformMat2d;exports.transformMat3=transformMat3;exports.transformMat4=transformMat4;exports.rotate=rotate;exports.angle=angle;exports.zero=zero;exports.str=str;exports.exactEquals=exactEquals;exports.equals=equals;exports.forEach=exports.sqrLen=exports.sqrDist=exports.dist=exports.div=exports.mul=exports.sub=exports.len=void 0;var glMatrix=_interopRequireWildcard(require("./common.js"));function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj["default"]=obj;return newObj}}function create(){var out=new glMatrix.ARRAY_TYPE(2);if(glMatrix.ARRAY_TYPE!=Float32Array){out[0]=0;out[1]=0}return out}function clone(a){var out=new glMatrix.ARRAY_TYPE(2);out[0]=a[0];out[1]=a[1];return out}function fromValues(x,y){var out=new glMatrix.ARRAY_TYPE(2);out[0]=x;out[1]=y;return out}function copy(out,a){out[0]=a[0];out[1]=a[1];return out}function set(out,x,y){out[0]=x;out[1]=y;return out}function add(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];return out}function subtract(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];return out}function multiply(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];return out}function divide(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];return out}function ceil(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);return out}function floor(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);return out}function min(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);return out}function max(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);return out}function round(out,a){out[0]=Math.round(a[0]);out[1]=Math.round(a[1]);return out}function scale(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;return out}function scaleAndAdd(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;return out}function distance(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.hypot(x,y)}function squaredDistance(a,b){var x=b[0]-a[0],y=b[1]-a[1];return x*x+y*y}function length(a){var x=a[0],y=a[1];return Math.hypot(x,y)}function squaredLength(a){var x=a[0],y=a[1];return x*x+y*y}function negate(out,a){out[0]=-a[0];out[1]=-a[1];return out}function inverse(out,a){out[0]=1/a[0];out[1]=1/a[1];return out}function normalize(out,a){var x=a[0],y=a[1];var len=x*x+y*y;if(len>0){len=1/Math.sqrt(len)}out[0]=a[0]*len;out[1]=a[1]*len;return out}function dot(a,b){return a[0]*b[0]+a[1]*b[1]}function cross(out,a,b){var z=a[0]*b[1]-a[1]*b[0];out[0]=out[1]=0;out[2]=z;return out}function lerp(out,a,b,t){var ax=a[0],ay=a[1];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);return out}function random(out,scale){scale=scale||1;var r=glMatrix.RANDOM()*2*Math.PI;out[0]=Math.cos(r)*scale;out[1]=Math.sin(r)*scale;return out}function transformMat2(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y;out[1]=m[1]*x+m[3]*y;return out}function transformMat2d(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y+m[4];out[1]=m[1]*x+m[3]*y+m[5];return out}function transformMat3(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[3]*y+m[6];out[1]=m[1]*x+m[4]*y+m[7];return out}function transformMat4(out,a,m){var x=a[0];var y=a[1];out[0]=m[0]*x+m[4]*y+m[12];out[1]=m[1]*x+m[5]*y+m[13];return out}function rotate(out,a,b,c){var p0=a[0]-b[0],p1=a[1]-b[1],sinC=Math.sin(c),cosC=Math.cos(c);out[0]=p0*cosC-p1*sinC+b[0];out[1]=p0*sinC+p1*cosC+b[1];return out}function angle(a,b){var x1=a[0],y1=a[1],x2=b[0],y2=b[1];var len1=x1*x1+y1*y1;if(len1>0){len1=1/Math.sqrt(len1)}var len2=x2*x2+y2*y2;if(len2>0){len2=1/Math.sqrt(len2)}var cosine=(x1*x2+y1*y2)*len1*len2;if(cosine>1){return 0}else{if(cosine<-1){return Math.PI}else{return Math.acos(cosine)}}}function zero(out){out[0]=0;out[1]=0;return out}function str(a){return"vec2("+a[0]+", "+a[1]+")"}function exactEquals(a,b){return a[0]===b[0]&&a[1]===b[1]}function equals(a,b){var a0=a[0],a1=a[1];var b0=b[0],b1=b[1];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))}var len=length;exports.len=len;var sub=subtract;exports.sub=sub;var mul=multiply;exports.mul=mul;var div=divide;exports.div=div;var dist=distance;exports.dist=dist;var sqrDist=squaredDistance;exports.sqrDist=sqrDist;var sqrLen=squaredLength;exports.sqrLen=sqrLen;var forEach=function(){var vec=create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=2}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1]}return a}}();exports.forEach=forEach},{"./common.js":22}],31:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.create=create;exports.clone=clone;exports.length=length;exports.fromValues=fromValues;exports.copy=copy;exports.set=set;exports.add=add;exports.subtract=subtract;exports.multiply=multiply;exports.divide=divide;exports.ceil=ceil;exports.floor=floor;exports.min=min;exports.max=max;exports.round=round;exports.scale=scale;exports.scaleAndAdd=scaleAndAdd;exports.distance=distance;exports.squaredDistance=squaredDistance;exports.squaredLength=squaredLength;exports.negate=negate;exports.inverse=inverse;exports.normalize=normalize;exports.dot=dot;exports.cross=cross;exports.lerp=lerp;exports.hermite=hermite;exports.bezier=bezier;exports.random=random;exports.transformMat4=transformMat4;exports.transformMat3=transformMat3;exports.transformQuat=transformQuat;exports.rotateX=rotateX;exports.rotateY=rotateY;exports.rotateZ=rotateZ;exports.angle=angle;exports.zero=zero;exports.str=str;exports.exactEquals=exactEquals;exports.equals=equals;exports.forEach=exports.sqrLen=exports.len=exports.sqrDist=exports.dist=exports.div=exports.mul=exports.sub=void 0;var glMatrix=_interopRequireWildcard(require("./common.js"));function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj["default"]=obj;return newObj}}function create(){var out=new glMatrix.ARRAY_TYPE(3);if(glMatrix.ARRAY_TYPE!=Float32Array){out[0]=0;out[1]=0;out[2]=0}return out}function clone(a){var out=new glMatrix.ARRAY_TYPE(3);out[0]=a[0];out[1]=a[1];out[2]=a[2];return out}function length(a){var x=a[0];var y=a[1];var z=a[2];return Math.hypot(x,y,z)}function fromValues(x,y,z){var out=new glMatrix.ARRAY_TYPE(3);out[0]=x;out[1]=y;out[2]=z;return out}function copy(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];return out}function set(out,x,y,z){out[0]=x;out[1]=y;out[2]=z;return out}function add(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];return out}function subtract(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];return out}function multiply(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];return out}function divide(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];return out}function ceil(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);out[2]=Math.ceil(a[2]);return out}function floor(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);out[2]=Math.floor(a[2]);return out}function min(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);return out}function max(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);return out}function round(out,a){out[0]=Math.round(a[0]);out[1]=Math.round(a[1]);out[2]=Math.round(a[2]);return out}function scale(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;return out}function scaleAndAdd(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;return out}function distance(a,b){var x=b[0]-a[0];var y=b[1]-a[1];var z=b[2]-a[2];return Math.hypot(x,y,z)}function squaredDistance(a,b){var x=b[0]-a[0];var y=b[1]-a[1];var z=b[2]-a[2];return x*x+y*y+z*z}function squaredLength(a){var x=a[0];var y=a[1];var z=a[2];return x*x+y*y+z*z}function negate(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];return out}function inverse(out,a){out[0]=1/a[0];out[1]=1/a[1];out[2]=1/a[2];return out}function normalize(out,a){var x=a[0];var y=a[1];var z=a[2];var len=x*x+y*y+z*z;if(len>0){len=1/Math.sqrt(len)}out[0]=a[0]*len;out[1]=a[1]*len;out[2]=a[2]*len;return out}function dot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function cross(out,a,b){var ax=a[0],ay=a[1],az=a[2];var bx=b[0],by=b[1],bz=b[2];out[0]=ay*bz-az*by;out[1]=az*bx-ax*bz;out[2]=ax*by-ay*bx;return out}function lerp(out,a,b,t){var ax=a[0];var ay=a[1];var az=a[2];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);return out}function hermite(out,a,b,c,d,t){var factorTimes2=t*t;var factor1=factorTimes2*(2*t-3)+1;var factor2=factorTimes2*(t-2)+t;var factor3=factorTimes2*(t-1);var factor4=factorTimes2*(3-2*t);out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4;out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4;out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4;return out}function bezier(out,a,b,c,d,t){var inverseFactor=1-t;var inverseFactorTimesTwo=inverseFactor*inverseFactor;var factorTimes2=t*t;var factor1=inverseFactorTimesTwo*inverseFactor;var factor2=3*t*inverseFactorTimesTwo;var factor3=3*factorTimes2*inverseFactor;var factor4=factorTimes2*t;out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4;out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4;out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4;return out}function random(out,scale){scale=scale||1;var r=glMatrix.RANDOM()*2*Math.PI;var z=glMatrix.RANDOM()*2-1;var zScale=Math.sqrt(1-z*z)*scale;out[0]=Math.cos(r)*zScale;out[1]=Math.sin(r)*zScale;out[2]=z*scale;return out}function transformMat4(out,a,m){var x=a[0],y=a[1],z=a[2];var w=m[3]*x+m[7]*y+m[11]*z+m[15];w=w||1;out[0]=(m[0]*x+m[4]*y+m[8]*z+m[12])/w;out[1]=(m[1]*x+m[5]*y+m[9]*z+m[13])/w;out[2]=(m[2]*x+m[6]*y+m[10]*z+m[14])/w;return out}function transformMat3(out,a,m){var x=a[0],y=a[1],z=a[2];out[0]=x*m[0]+y*m[3]+z*m[6];out[1]=x*m[1]+y*m[4]+z*m[7];out[2]=x*m[2]+y*m[5]+z*m[8];return out}function transformQuat(out,a,q){var qx=q[0],qy=q[1],qz=q[2],qw=q[3];var x=a[0],y=a[1],z=a[2];var uvx=qy*z-qz*y,uvy=qz*x-qx*z,uvz=qx*y-qy*x;var uuvx=qy*uvz-qz*uvy,uuvy=qz*uvx-qx*uvz,uuvz=qx*uvy-qy*uvx;var w2=qw*2;uvx*=w2;uvy*=w2;uvz*=w2;uuvx*=2;uuvy*=2;uuvz*=2;out[0]=x+uvx+uuvx;out[1]=y+uvy+uuvy;out[2]=z+uvz+uuvz;return out}function rotateX(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[0];r[1]=p[1]*Math.cos(c)-p[2]*Math.sin(c);r[2]=p[1]*Math.sin(c)+p[2]*Math.cos(c);out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out}function rotateY(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[2]*Math.sin(c)+p[0]*Math.cos(c);r[1]=p[1];r[2]=p[2]*Math.cos(c)-p[0]*Math.sin(c);out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out}function rotateZ(out,a,b,c){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[0]*Math.cos(c)-p[1]*Math.sin(c);r[1]=p[0]*Math.sin(c)+p[1]*Math.cos(c);r[2]=p[2];out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out}function angle(a,b){var tempA=fromValues(a[0],a[1],a[2]);var tempB=fromValues(b[0],b[1],b[2]);normalize(tempA,tempA);normalize(tempB,tempB);var cosine=dot(tempA,tempB);if(cosine>1){return 0}else{if(cosine<-1){return Math.PI}else{return Math.acos(cosine)}}}function zero(out){out[0]=0;out[1]=0;out[2]=0;return out}function str(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"}function exactEquals(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function equals(a,b){var a0=a[0],a1=a[1],a2=a[2];var b0=b[0],b1=b[1],b2=b[2];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))}var sub=subtract;exports.sub=sub;var mul=multiply;exports.mul=mul;var div=divide;exports.div=div;var dist=distance;exports.dist=dist;var sqrDist=squaredDistance;exports.sqrDist=sqrDist;var len=length;exports.len=len;var sqrLen=squaredLength;exports.sqrLen=sqrLen;var forEach=function(){var vec=create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=3}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2]}return a}}();exports.forEach=forEach},{"./common.js":22}],32:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.create=create;exports.clone=clone;exports.fromValues=fromValues;exports.copy=copy;exports.set=set;exports.add=add;exports.subtract=subtract;exports.multiply=multiply;exports.divide=divide;exports.ceil=ceil;exports.floor=floor;exports.min=min;exports.max=max;exports.round=round;exports.scale=scale;exports.scaleAndAdd=scaleAndAdd;exports.distance=distance;exports.squaredDistance=squaredDistance;exports.length=length;exports.squaredLength=squaredLength;exports.negate=negate;exports.inverse=inverse;exports.normalize=normalize;exports.dot=dot;exports.cross=cross;exports.lerp=lerp;exports.random=random;exports.transformMat4=transformMat4;exports.transformQuat=transformQuat;exports.zero=zero;exports.str=str;exports.exactEquals=exactEquals;exports.equals=equals;exports.forEach=exports.sqrLen=exports.len=exports.sqrDist=exports.dist=exports.div=exports.mul=exports.sub=void 0;var glMatrix=_interopRequireWildcard(require("./common.js"));function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj["default"]=obj;return newObj}}function create(){var out=new glMatrix.ARRAY_TYPE(4);if(glMatrix.ARRAY_TYPE!=Float32Array){out[0]=0;out[1]=0;out[2]=0;out[3]=0}return out}function clone(a){var out=new glMatrix.ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out}function fromValues(x,y,z,w){var out=new glMatrix.ARRAY_TYPE(4);out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out}function copy(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out}function set(out,x,y,z,w){out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out}function add(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];return out}function subtract(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];return out}function multiply(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];out[3]=a[3]*b[3];return out}function divide(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];out[3]=a[3]/b[3];return out}function ceil(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);out[2]=Math.ceil(a[2]);out[3]=Math.ceil(a[3]);return out}function floor(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);out[2]=Math.floor(a[2]);out[3]=Math.floor(a[3]);return out}function min(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);out[3]=Math.min(a[3],b[3]);return out}function max(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);out[3]=Math.max(a[3],b[3]);return out}function round(out,a){out[0]=Math.round(a[0]);out[1]=Math.round(a[1]);out[2]=Math.round(a[2]);out[3]=Math.round(a[3]);return out}function scale(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;return out}function scaleAndAdd(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;return out}function distance(a,b){var x=b[0]-a[0];var y=b[1]-a[1];var z=b[2]-a[2];var w=b[3]-a[3];return Math.hypot(x,y,z,w)}function squaredDistance(a,b){var x=b[0]-a[0];var y=b[1]-a[1];var z=b[2]-a[2];var w=b[3]-a[3];return x*x+y*y+z*z+w*w}function length(a){var x=a[0];var y=a[1];var z=a[2];var w=a[3];return Math.hypot(x,y,z,w)}function squaredLength(a){var x=a[0];var y=a[1];var z=a[2];var w=a[3];return x*x+y*y+z*z+w*w}function negate(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=-a[3];return out}function inverse(out,a){out[0]=1/a[0];out[1]=1/a[1];out[2]=1/a[2];out[3]=1/a[3];return out}function normalize(out,a){var x=a[0];var y=a[1];var z=a[2];var w=a[3];var len=x*x+y*y+z*z+w*w;if(len>0){len=1/Math.sqrt(len)}out[0]=x*len;out[1]=y*len;out[2]=z*len;out[3]=w*len;return out}function dot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}function cross(out,u,v,w){var A=v[0]*w[1]-v[1]*w[0],B=v[0]*w[2]-v[2]*w[0],C=v[0]*w[3]-v[3]*w[0],D=v[1]*w[2]-v[2]*w[1],E=v[1]*w[3]-v[3]*w[1],F=v[2]*w[3]-v[3]*w[2];var G=u[0];var H=u[1];var I=u[2];var J=u[3];out[0]=H*F-I*E+J*D;out[1]=-(G*F)+I*C-J*B;out[2]=G*E-H*C+J*A;out[3]=-(G*D)+H*B-I*A;return out}function lerp(out,a,b,t){var ax=a[0];var ay=a[1];var az=a[2];var aw=a[3];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);out[3]=aw+t*(b[3]-aw);return out}function random(out,scale){scale=scale||1;var v1,v2,v3,v4;var s1,s2;do{v1=glMatrix.RANDOM()*2-1;v2=glMatrix.RANDOM()*2-1;s1=v1*v1+v2*v2}while(s1>=1);do{v3=glMatrix.RANDOM()*2-1;v4=glMatrix.RANDOM()*2-1;s2=v3*v3+v4*v4}while(s2>=1);var d=Math.sqrt((1-s1)/s2);out[0]=scale*v1;out[1]=scale*v2;out[2]=scale*v3*d;out[3]=scale*v4*d;return out}function transformMat4(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w;out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w;out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w;out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w;return out}function transformQuat(out,a,q){var x=a[0],y=a[1],z=a[2];var qx=q[0],qy=q[1],qz=q[2],qw=q[3];var ix=qw*x+qy*z-qz*y;var iy=qw*y+qz*x-qx*z;var iz=qw*z+qx*y-qy*x;var iw=-qx*x-qy*y-qz*z;out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy;out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz;out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx;out[3]=a[3];return out}function zero(out){out[0]=0;out[1]=0;out[2]=0;out[3]=0;return out}function str(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"}function exactEquals(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}function equals(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=glMatrix.EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=glMatrix.EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=glMatrix.EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=glMatrix.EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))}var sub=subtract;exports.sub=sub;var mul=multiply;exports.mul=mul;var div=divide;exports.div=div;var dist=distance;exports.dist=dist;var sqrDist=squaredDistance;exports.sqrDist=sqrDist;var len=length;exports.len=len;var sqrLen=squaredLength;exports.sqrLen=sqrLen;var forEach=function(){var vec=create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=4}if(!offset){offset=0}if(count){l=Math.min(count*stride+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];vec[3]=a[i+3];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2];a[i+3]=vec[3]}return a}}();exports.forEach=forEach},{"./common.js":22}],33:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}}());function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],34:[function(require,module,exports){(function(global){(function(){var root=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global||this||{};var previousUnderscore=root._;var ArrayProto=Array.prototype,ObjProto=Object.prototype;var SymbolProto=typeof Symbol!=="undefined"?Symbol.prototype:null;var push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeCreate=Object.create;var Ctor=function(){};var _=function(obj){if(obj instanceof _){return obj}if(!(this instanceof _)){return new _(obj)}this._wrapped=obj};if(typeof exports!="undefined"&&!exports.nodeType){if(typeof module!="undefined"&&!module.nodeType&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.9.1";var optimizeCb=function(func,context,argCount){if(context===void 0){return func}switch(argCount==null?3:argCount){case 1:return function(value){return func.call(context,value)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}};var builtinIteratee;var cb=function(value,context,argCount){if(_.iteratee!==builtinIteratee){return _.iteratee(value,context)}if(value==null){return _.identity}if(_.isFunction(value)){return optimizeCb(value,context,argCount)}if(_.isObject(value)&&!_.isArray(value)){return _.matcher(value)}return _.property(value)};_.iteratee=builtinIteratee=function(value,context){return cb(value,context,Infinity)};var restArguments=function(func,startIndex){startIndex=startIndex==null?func.length-1:+startIndex;return function(){var length=Math.max(arguments.length-startIndex,0),rest=Array(length),index=0;for(;index<length;index++){rest[index]=arguments[index+startIndex]}switch(startIndex){case 0:return func.call(this,rest);case 1:return func.call(this,arguments[0],rest);case 2:return func.call(this,arguments[0],arguments[1],rest)}var args=Array(startIndex+1);for(index=0;index<startIndex;index++){args[index]=arguments[index]}args[startIndex]=rest;return func.apply(this,args)}};var baseCreate=function(prototype){if(!_.isObject(prototype)){return{}}if(nativeCreate){return nativeCreate(prototype)}Ctor.prototype=prototype;var result=new Ctor;Ctor.prototype=null;return result};var shallowProperty=function(key){return function(obj){return obj==null?void 0:obj[key]}};var has=function(obj,path){return obj!=null&&hasOwnProperty.call(obj,path)};var deepGet=function(obj,path){var length=path.length;for(var i=0;i<length;i++){if(obj==null){return void 0}obj=obj[path[i]]}return length?obj:void 0};var MAX_ARRAY_INDEX=Math.pow(2,53)-1;var getLength=shallowProperty("length");var isArrayLike=function(collection){var length=getLength(collection);return typeof length=="number"&&length>=0&&length<=MAX_ARRAY_INDEX};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj)){for(i=0,length=obj.length;i<length;i++){iteratee(obj[i],i,obj)}}else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++){iteratee(obj[keys[i]],keys[i],obj)}}return obj};_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length);for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results};var createReduce=function(dir){var reducer=function(obj,iteratee,memo,initial){var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;if(!initial){memo=obj[keys?keys[index]:index];index+=dir}for(;index>=0&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo};return function(obj,iteratee,memo,context){var initial=arguments.length>=3;return reducer(obj,optimizeCb(iteratee,context,4),memo,initial)}};_.reduce=_.foldl=_.inject=createReduce(1);_.reduceRight=_.foldr=createReduce(-1);_.find=_.detect=function(obj,predicate,context){var keyFinder=isArrayLike(obj)?_.findIndex:_.findKey;var key=keyFinder(obj,predicate,context);if(key!==void 0&&key!==-1){return obj[key]}};_.filter=_.select=function(obj,predicate,context){var results=[];predicate=cb(predicate,context);_.each(obj,function(value,index,list){if(predicate(value,index,list)){results.push(value)}});return results};_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)};_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj)){return false}}return true};_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj)){return true}}return false};_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){if(!isArrayLike(obj)){obj=_.values(obj)}if(typeof fromIndex!="number"||guard){fromIndex=0}return _.indexOf(obj,item,fromIndex)>=0};_.invoke=restArguments(function(obj,path,args){var contextPath,func;if(_.isFunction(path)){func=path}else{if(_.isArray(path)){contextPath=path.slice(0,-1);path=path[path.length-1]}}return _.map(obj,function(context){var method=func;if(!method){if(contextPath&&contextPath.length){context=deepGet(context,contextPath)}if(context==null){return void 0}method=context[path]}return method==null?method:method.apply(context,args)})});_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))};_.max=function(obj,iteratee,context){var result=-Infinity,lastComputed=-Infinity,value,computed;if(iteratee==null||typeof iteratee=="number"&&typeof obj[0]!="object"&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value!=null&&value>result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(v,index,list){computed=iteratee(v,index,list);if(computed>lastComputed||computed===-Infinity&&result===-Infinity){result=v;lastComputed=computed}})}return result};_.min=function(obj,iteratee,context){var result=Infinity,lastComputed=Infinity,value,computed;if(iteratee==null||typeof iteratee=="number"&&typeof obj[0]!="object"&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value!=null&&value<result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(v,index,list){computed=iteratee(v,index,list);if(computed<lastComputed||computed===Infinity&&result===Infinity){result=v;lastComputed=computed}})}return result};_.shuffle=function(obj){return _.sample(obj,Infinity)};_.sample=function(obj,n,guard){if(n==null||guard){if(!isArrayLike(obj)){obj=_.values(obj)}return obj[_.random(obj.length-1)]}var sample=isArrayLike(obj)?_.clone(obj):_.values(obj);var length=getLength(sample);n=Math.max(Math.min(n,length),0);var last=length-1;for(var index=0;index<n;index++){var rand=_.random(index,last);var temp=sample[index];sample[index]=sample[rand];sample[rand]=temp}return sample.slice(0,n)};_.sortBy=function(obj,iteratee,context){var index=0;iteratee=cb(iteratee,context);return _.pluck(_.map(obj,function(value,key,list){return{value:value,index:index++,criteria:iteratee(value,key,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0){return 1}if(a<b||b===void 0){return -1}}return left.index-right.index}),"value")};var group=function(behavior,partition){return function(obj,iteratee,context){var result=partition?[[],[]]:{};iteratee=cb(iteratee,context);_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)});return result}};_.groupBy=group(function(result,value,key){if(has(result,key)){result[key].push(value)}else{result[key]=[value]}});_.indexBy=group(function(result,value,key){result[key]=value});_.countBy=group(function(result,value,key){if(has(result,key)){result[key]++}else{result[key]=1}});var reStrSymbol=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;_.toArray=function(obj){if(!obj){return[]}if(_.isArray(obj)){return slice.call(obj)}if(_.isString(obj)){return obj.match(reStrSymbol)}if(isArrayLike(obj)){return _.map(obj,_.identity)}return _.values(obj)};_.size=function(obj){if(obj==null){return 0}return isArrayLike(obj)?obj.length:_.keys(obj).length};_.partition=group(function(result,value,pass){result[pass?0:1].push(value)},true);_.first=_.head=_.take=function(array,n,guard){if(array==null||array.length<1){return n==null?void 0:[]}if(n==null||guard){return array[0]}return _.initial(array,array.length-n)};_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(n==null||guard?1:n)))};_.last=function(array,n,guard){if(array==null||array.length<1){return n==null?void 0:[]}if(n==null||guard){return array[array.length-1]}return _.rest(array,Math.max(0,array.length-n))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,Boolean)};var flatten=function(input,shallow,strict,output){output=output||[];var idx=output.length;for(var i=0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){if(shallow){var j=0,len=value.length;while(j<len){output[idx++]=value[j++]}}else{flatten(value,shallow,strict,output);idx=output.length}}else{if(!strict){output[idx++]=value}}}return output};_.flatten=function(array,shallow){return flatten(array,shallow,false)};_.without=restArguments(function(array,otherArrays){return _.difference(array,otherArrays)});_.uniq=_.unique=function(array,isSorted,iteratee,context){if(!_.isBoolean(isSorted)){context=iteratee;iteratee=isSorted;isSorted=false}if(iteratee!=null){iteratee=cb(iteratee,context)}var result=[];var seen=[];for(var i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;if(isSorted&&!iteratee){if(!i||seen!==computed){result.push(value)}seen=computed}else{if(iteratee){if(!_.contains(seen,computed)){seen.push(computed);result.push(value)}}else{if(!_.contains(result,value)){result.push(value)}}}}return result};_.union=restArguments(function(arrays){return _.uniq(flatten(arrays,true,true))});_.intersection=function(array){var result=[];var argsLength=arguments.length;for(var i=0,length=getLength(array);i<length;i++){var item=array[i];if(_.contains(result,item)){continue}var j;for(j=1;j<argsLength;j++){if(!_.contains(arguments[j],item)){break}}if(j===argsLength){result.push(item)}}return result};_.difference=restArguments(function(array,rest){rest=flatten(rest,true,true);return _.filter(array,function(value){return !_.contains(rest,value)})});_.unzip=function(array){var length=array&&_.max(array,getLength).length||0;var result=Array(length);for(var index=0;index<length;index++){result[index]=_.pluck(array,index)}return result};_.zip=restArguments(_.unzip);_.object=function(list,values){var result={};for(var i=0,length=getLength(list);i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};var createPredicateIndexFinder=function(dir){return function(array,predicate,context){predicate=cb(predicate,context);var length=getLength(array);var index=dir>0?0:length-1;for(;index>=0&&index<length;index+=dir){if(predicate(array[index],index,array)){return index}}return -1}};_.findIndex=createPredicateIndexFinder(1);_.findLastIndex=createPredicateIndexFinder(-1);_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);var value=iteratee(obj);var low=0,high=getLength(array);while(low<high){var mid=Math.floor((low+high)/2);if(iteratee(array[mid])<value){low=mid+1}else{high=mid}}return low};var createIndexFinder=function(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if(typeof idx=="number"){if(dir>0){i=idx>=0?idx:Math.max(idx+length,i)}else{length=idx>=0?Math.min(idx+1,length):idx+length+1}}else{if(sortedIndex&&idx&&length){idx=sortedIndex(array,item);return array[idx]===item?idx:-1}}if(item!==item){idx=predicateFind(slice.call(array,i,length),_.isNaN);return idx>=0?idx+i:-1}for(idx=dir>0?i:length-1;idx>=0&&idx<length;idx+=dir){if(array[idx]===item){return idx}}return -1}};_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex);_.lastIndexOf=createIndexFinder(-1,_.findLastIndex);_.range=function(start,stop,step){if(stop==null){stop=start||0;start=0}if(!step){step=stop<start?-1:1}var length=Math.max(Math.ceil((stop-start)/step),0);var range=Array(length);for(var idx=0;idx<length;idx++,start+=step){range[idx]=start}return range};_.chunk=function(array,count){if(count==null||count<1){return[]}var result=[];var i=0,length=array.length;while(i<length){result.push(slice.call(array,i,i+=count))}return result};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc)){return sourceFunc.apply(context,args)}var self=baseCreate(sourceFunc.prototype);var result=sourceFunc.apply(self,args);if(_.isObject(result)){return result}return self};_.bind=restArguments(function(func,context,args){if(!_.isFunction(func)){throw new TypeError("Bind must be called on a function")}var bound=restArguments(function(callArgs){return executeBound(func,bound,context,this,args.concat(callArgs))});return bound});_.partial=restArguments(function(func,boundArgs){var placeholder=_.partial.placeholder;var bound=function(){var position=0,length=boundArgs.length;var args=Array(length);for(var i=0;i<length;i++){args[i]=boundArgs[i]===placeholder?arguments[position++]:boundArgs[i]}while(position<arguments.length){args.push(arguments[position++])}return executeBound(func,bound,this,this,args)};return bound});_.partial.placeholder=_;_.bindAll=restArguments(function(obj,keys){keys=flatten(keys,false,false);var index=keys.length;if(index<1){throw new Error("bindAll must be passed function names")}while(index--){var key=keys[index];obj[key]=_.bind(obj[key],obj)}});_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache;var address=""+(hasher?hasher.apply(this,arguments):key);if(!has(cache,address)){cache[address]=func.apply(this,arguments)}return cache[address]};memoize.cache={};return memoize};_.delay=restArguments(function(func,wait,args){return setTimeout(function(){return func.apply(null,args)},wait)});_.defer=_.partial(_.delay,_,1);_.throttle=function(func,wait,options){var timeout,context,args,result;var previous=0;if(!options){options={}}var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);if(!timeout){context=args=null}};var throttled=function(){var now=_.now();if(!previous&&options.leading===false){previous=now}var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){if(timeout){clearTimeout(timeout);timeout=null}previous=now;result=func.apply(context,args);if(!timeout){context=args=null}}else{if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}}return result};throttled.cancel=function(){clearTimeout(timeout);previous=0;timeout=context=args=null};return throttled};_.debounce=function(func,wait,immediate){var timeout,result;var later=function(context,args){timeout=null;if(args){result=func.apply(context,args)}};var debounced=restArguments(function(args){if(timeout){clearTimeout(timeout)}if(immediate){var callNow=!timeout;timeout=setTimeout(later,wait);if(callNow){result=func.apply(this,args)}}else{timeout=_.delay(later,wait,this,args)}return result});debounced.cancel=function(){clearTimeout(timeout);timeout=null};return debounced};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.negate=function(predicate){return function(){return !predicate.apply(this,arguments)}};_.compose=function(){var args=arguments;var start=args.length-1;return function(){var i=start;var result=args[start].apply(this,arguments);while(i--){result=args[i].call(this,result)}return result}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.before=function(times,func){var memo;return function(){if(--times>0){memo=func.apply(this,arguments)}if(times<=1){func=null}return memo}};_.once=_.partial(_.before,2);_.restArguments=restArguments;var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString");var nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];var collectNonEnumProps=function(obj,keys){var nonEnumIdx=nonEnumerableProps.length;var constructor=obj.constructor;var proto=_.isFunction(constructor)&&constructor.prototype||ObjProto;var prop="constructor";if(has(obj,prop)&&!_.contains(keys,prop)){keys.push(prop)}while(nonEnumIdx--){prop=nonEnumerableProps[nonEnumIdx];if(prop in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)){keys.push(prop)}}};_.keys=function(obj){if(!_.isObject(obj)){return[]}if(nativeKeys){return nativeKeys(obj)}var keys=[];for(var key in obj){if(has(obj,key)){keys.push(key)}}if(hasEnumBug){collectNonEnumProps(obj,keys)}return keys};_.allKeys=function(obj){if(!_.isObject(obj)){return[]}var keys=[];for(var key in obj){keys.push(key)}if(hasEnumBug){collectNonEnumProps(obj,keys)}return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=_.keys(obj),length=keys.length,results={};for(var index=0;index<length;index++){var currentKey=keys[index];results[currentKey]=iteratee(obj[currentKey],currentKey,obj)}return results};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key])){names.push(key)}}return names.sort()};var createAssigner=function(keysFunc,defaults){return function(obj){var length=arguments.length;if(defaults){obj=Object(obj)}if(length<2||obj==null){return obj}for(var index=1;index<length;index++){var source=arguments[index],keys=keysFunc(source),l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(!defaults||obj[key]===void 0){obj[key]=source[key]}}}return obj}};_.extend=createAssigner(_.allKeys);_.extendOwn=_.assign=createAssigner(_.keys);_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);var keys=_.keys(obj),key;for(var i=0,length=keys.length;i<length;i++){key=keys[i];if(predicate(obj[key],key,obj)){return key}}};var keyInObj=function(value,key,obj){return key in obj};_.pick=restArguments(function(obj,keys){var result={},iteratee=keys[0];if(obj==null){return result}if(_.isFunction(iteratee)){if(keys.length>1){iteratee=optimizeCb(iteratee,keys[1])}keys=_.allKeys(obj)}else{iteratee=keyInObj;keys=flatten(keys,false,false);obj=Object(obj)}for(var i=0,length=keys.length;i<length;i++){var key=keys[i];var value=obj[key];if(iteratee(value,key,obj)){result[key]=value}}return result});_.omit=restArguments(function(obj,keys){var iteratee=keys[0],context;if(_.isFunction(iteratee)){iteratee=_.negate(iteratee);if(keys.length>1){context=keys[1]}}else{keys=_.map(flatten(keys,false,false),String);iteratee=function(value,key){return !_.contains(keys,key)}}return _.pick(obj,iteratee,context)});_.defaults=createAssigner(_.allKeys,true);_.create=function(prototype,props){var result=baseCreate(prototype);if(props){_.extendOwn(result,props)}return result};_.clone=function(obj){if(!_.isObject(obj)){return obj}return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(object==null){return !length}var obj=Object(object);for(var i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj)){return false}}return true};var eq,deepEq;eq=function(a,b,aStack,bStack){if(a===b){return a!==0||1/a===1/b}if(a==null||b==null){return false}if(a!==a){return b!==b}var type=typeof a;if(type!=="function"&&type!=="object"&&typeof b!="object"){return false}return deepEq(a,b,aStack,bStack)};deepEq=function(a,b,aStack,bStack){if(a instanceof _){a=a._wrapped}if(b instanceof _){b=b._wrapped}var className=toString.call(a);if(className!==toString.call(b)){return false}switch(className){case"[object RegExp]":case"[object String]":return""+a===""+b;case"[object Number]":if(+a!==+a){return +b!==+b}return +a===0?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return +a===+b;case"[object Symbol]":return SymbolProto.valueOf.call(a)===SymbolProto.valueOf.call(b)}var areArrays=className==="[object Array]";if(!areArrays){if(typeof a!="object"||typeof b!="object"){return false}var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&("constructor" in a&&"constructor" in b)){return false}}aStack=aStack||[];bStack=bStack||[];var length=aStack.length;while(length--){if(aStack[length]===a){return bStack[length]===b}}aStack.push(a);bStack.push(b);if(areArrays){length=a.length;if(length!==b.length){return false}while(length--){if(!eq(a[length],b[length],aStack,bStack)){return false}}}else{var keys=_.keys(a),key;length=keys.length;if(_.keys(b).length!==length){return false}while(length--){key=keys[length];if(!(has(b,key)&&eq(a[key],b[key],aStack,bStack))){return false}}}aStack.pop();bStack.pop();return true};_.isEqual=function(a,b){return eq(a,b)};_.isEmpty=function(obj){if(obj==null){return true}if(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj))){return obj.length===0}return _.keys(obj).length===0};_.isElement=function(obj){return !!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==="[object Array]"};_.isObject=function(obj){var type=typeof obj;return type==="function"||type==="object"&&!!obj};_.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return has(obj,"callee")}}var nodelist=root.document&&root.document.childNodes;if(typeof/./!="function"&&typeof Int8Array!="object"&&typeof nodelist!="function"){_.isFunction=function(obj){return typeof obj=="function"||false}}_.isFinite=function(obj){return !_.isSymbol(obj)&&isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&isNaN(obj)};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)==="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,path){if(!_.isArray(path)){return has(obj,path)}var length=path.length;for(var i=0;i<length;i++){var key=path[i];if(obj==null||!hasOwnProperty.call(obj,key)){return false}obj=obj[key]}return !!length};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.noop=function(){};_.property=function(path){if(!_.isArray(path)){return shallowProperty(path)}return function(obj){return deepGet(obj,path)}};_.propertyOf=function(obj){if(obj==null){return function(){}}return function(path){return !_.isArray(path)?obj[path]:deepGet(obj,path)}};_.matcher=_.matches=function(attrs){attrs=_.extendOwn({},attrs);return function(obj){return _.isMatch(obj,attrs)}};_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++){accum[i]=iteratee(i)}return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return new Date().getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var unescapeMap=_.invert(escapeMap);var createEscaper=function(map){var escaper=function(match){return map[match]};var source="(?:"+_.keys(map).join("|")+")";var testRegexp=RegExp(source);var replaceRegexp=RegExp(source,"g");return function(string){string=string==null?"":""+string;return testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap);_.unescape=createEscaper(unescapeMap);_.result=function(obj,path,fallback){if(!_.isArray(path)){path=[path]}var length=path.length;if(!length){return _.isFunction(fallback)?fallback.call(obj):fallback}for(var i=0;i<length;i++){var prop=obj==null?void 0:obj[path[i]];if(prop===void 0){prop=fallback;i=length}obj=_.isFunction(prop)?prop.call(obj):prop}return obj};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var escapeRegExp=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){if(!settings&&oldSettings){settings=oldSettings}settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escapeRegExp,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}else{if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}else{if(evaluate){source+="';\n"+evaluate+"\n__p+='"}}}return match});source+="';\n";if(!settings.variable){source="with(obj||{}){\n"+source+"}\n"}source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";var render;try{render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}var template=function(data){return render.call(this,data,_)};var argument=settings.variable||"obj";template.source="function("+argument+"){\n"+source+"}";return template};_.chain=function(obj){var instance=_(obj);instance._chain=true;return instance};var chainResult=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return chainResult(this,func.apply(_,args))}});return _};_.mixin(_);_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name==="shift"||name==="splice")&&obj.length===0){delete obj[0]}return chainResult(this,obj)}});_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return chainResult(this,method.apply(this._wrapped,arguments))}});_.prototype.value=function(){return this._wrapped};_.prototype.valueOf=_.prototype.toJSON=_.prototype.value;_.prototype.toString=function(){return String(this._wrapped)};if(typeof define=="function"&&define.amd){define("underscore",[],function(){return _})}}())}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],35:[function(require,module,exports){module.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},{}],36:[function(require,module,exports){if(typeof(window)!=="undefined"&&typeof(window.requestAnimationFrame)!=="function"){window.requestAnimationFrame=(window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){setTimeout(callback,1000/60)})}Leap=require("../lib/index")},{"../lib/index":12}]},{},[36]);var LZString=(function(){var f=String.fromCharCode;var keyStrBase64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var keyStrUriSafe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$";var baseReverseDic={};function getBaseValue(alphabet,character){if(!baseReverseDic[alphabet]){baseReverseDic[alphabet]={};for(var i=0;i<alphabet.length;i++){baseReverseDic[alphabet][alphabet.charAt(i)]=i}}return baseReverseDic[alphabet][character]}var LZString={compressToBase64:function(input){if(input==null){return""}var res=LZString._compress(input,6,function(a){return keyStrBase64.charAt(a)});switch(res.length%4){default:case 0:return res;case 1:return res+"===";case 2:return res+"==";case 3:return res+"="}},decompressFromBase64:function(input){if(input==null){return""}if(input==""){return null}return LZString._decompress(input.length,32,function(index){return getBaseValue(keyStrBase64,input.charAt(index))})},compressToUTF16:function(input){if(input==null){return""}return LZString._compress(input,15,function(a){return f(a+32)})+" "},decompressFromUTF16:function(compressed){if(compressed==null){return""}if(compressed==""){return null}return LZString._decompress(compressed.length,16384,function(index){return compressed.charCodeAt(index)-32})},compressToUint8Array:function(uncompressed){var compressed=LZString.compress(uncompressed);var buf=new Uint8Array(compressed.length*2);for(var i=0,TotalLen=compressed.length;i<TotalLen;i++){var current_value=compressed.charCodeAt(i);buf[i*2]=current_value>>>8;buf[i*2+1]=current_value%256}return buf},decompressFromUint8Array:function(compressed){if(compressed===null||compressed===undefined){return LZString.decompress(compressed)}else{var buf=new Array(compressed.length/2);for(var i=0,TotalLen=buf.length;i<TotalLen;i++){buf[i]=compressed[i*2]*256+compressed[i*2+1]}var result=[];buf.forEach(function(c){result.push(f(c))});return LZString.decompress(result.join(""))}},compressToEncodedURIComponent:function(input){if(input==null){return""}return LZString._compress(input,6,function(a){return keyStrUriSafe.charAt(a)})},decompressFromEncodedURIComponent:function(input){if(input==null){return""}if(input==""){return null}input=input.replace(/ /g,"+");return LZString._decompress(input.length,32,function(index){return getBaseValue(keyStrUriSafe,input.charAt(index))})},compress:function(uncompressed){return LZString._compress(uncompressed,16,function(a){return f(a)})},_compress:function(uncompressed,bitsPerChar,getCharFromInt){if(uncompressed==null){return""}var i,value,context_dictionary={},context_dictionaryToCreate={},context_c="",context_wc="",context_w="",context_enlargeIn=2,context_dictSize=3,context_numBits=2,context_data=[],context_data_val=0,context_data_position=0,ii;for(ii=0;ii<uncompressed.length;ii+=1){context_c=uncompressed.charAt(ii);if(!Object.prototype.hasOwnProperty.call(context_dictionary,context_c)){context_dictionary[context_c]=context_dictSize++;context_dictionaryToCreate[context_c]=true}context_wc=context_w+context_c;if(Object.prototype.hasOwnProperty.call(context_dictionary,context_wc)){context_w=context_wc}else{if(Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)){if(context_w.charCodeAt(0)<256){for(i=0;i<context_numBits;i++){context_data_val=(context_data_val<<1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}}value=context_w.charCodeAt(0);for(i=0;i<8;i++){context_data_val=(context_data_val<<1)|(value&1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}value=value>>1}}else{value=1;for(i=0;i<context_numBits;i++){context_data_val=(context_data_val<<1)|value;if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}value=0}value=context_w.charCodeAt(0);for(i=0;i<16;i++){context_data_val=(context_data_val<<1)|(value&1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}value=value>>1}}context_enlargeIn--;if(context_enlargeIn==0){context_enlargeIn=Math.pow(2,context_numBits);context_numBits++}delete context_dictionaryToCreate[context_w]}else{value=context_dictionary[context_w];for(i=0;i<context_numBits;i++){context_data_val=(context_data_val<<1)|(value&1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}value=value>>1}}context_enlargeIn--;if(context_enlargeIn==0){context_enlargeIn=Math.pow(2,context_numBits);context_numBits++}context_dictionary[context_wc]=context_dictSize++;context_w=String(context_c)}}if(context_w!==""){if(Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)){if(context_w.charCodeAt(0)<256){for(i=0;i<context_numBits;i++){context_data_val=(context_data_val<<1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}}value=context_w.charCodeAt(0);for(i=0;i<8;i++){context_data_val=(context_data_val<<1)|(value&1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}value=value>>1}}else{value=1;for(i=0;i<context_numBits;i++){context_data_val=(context_data_val<<1)|value;if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}value=0}value=context_w.charCodeAt(0);for(i=0;i<16;i++){context_data_val=(context_data_val<<1)|(value&1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}value=value>>1}}context_enlargeIn--;if(context_enlargeIn==0){context_enlargeIn=Math.pow(2,context_numBits);context_numBits++}delete context_dictionaryToCreate[context_w]}else{value=context_dictionary[context_w];for(i=0;i<context_numBits;i++){context_data_val=(context_data_val<<1)|(value&1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}value=value>>1}}context_enlargeIn--;if(context_enlargeIn==0){context_enlargeIn=Math.pow(2,context_numBits);context_numBits++}}value=2;for(i=0;i<context_numBits;i++){context_data_val=(context_data_val<<1)|(value&1);if(context_data_position==bitsPerChar-1){context_data_position=0;context_data.push(getCharFromInt(context_data_val));context_data_val=0}else{context_data_position++}value=value>>1}while(true){context_data_val=(context_data_val<<1);if(context_data_position==bitsPerChar-1){context_data.push(getCharFromInt(context_data_val));break}else{context_data_position++}}return context_data.join("")},decompress:function(compressed){if(compressed==null){return""}if(compressed==""){return null}return LZString._decompress(compressed.length,32768,function(index){return compressed.charCodeAt(index)})},_decompress:function(length,resetValue,getNextValue){var dictionary=[],next,enlargeIn=4,dictSize=4,numBits=3,entry="",result=[],i,w,bits,resb,maxpower,power,c,data={val:getNextValue(0),position:resetValue,index:1};for(i=0;i<3;i+=1){dictionary[i]=i}bits=0;maxpower=Math.pow(2,2);power=1;while(power!=maxpower){resb=data.val&data.position;data.position>>=1;if(data.position==0){data.position=resetValue;data.val=getNextValue(data.index++)}bits|=(resb>0?1:0)*power;power<<=1}switch(next=bits){case 0:bits=0;maxpower=Math.pow(2,8);power=1;while(power!=maxpower){resb=data.val&data.position;data.position>>=1;if(data.position==0){data.position=resetValue;data.val=getNextValue(data.index++)}bits|=(resb>0?1:0)*power;power<<=1}c=f(bits);break;case 1:bits=0;maxpower=Math.pow(2,16);power=1;while(power!=maxpower){resb=data.val&data.position;data.position>>=1;if(data.position==0){data.position=resetValue;data.val=getNextValue(data.index++)}bits|=(resb>0?1:0)*power;power<<=1}c=f(bits);break;case 2:return""}dictionary[3]=c;w=c;result.push(c);while(true){if(data.index>length){return""}bits=0;maxpower=Math.pow(2,numBits);power=1;while(power!=maxpower){resb=data.val&data.position;data.position>>=1;if(data.position==0){data.position=resetValue;data.val=getNextValue(data.index++)}bits|=(resb>0?1:0)*power;power<<=1}switch(c=bits){case 0:bits=0;maxpower=Math.pow(2,8);power=1;while(power!=maxpower){resb=data.val&data.position;data.position>>=1;if(data.position==0){data.position=resetValue;data.val=getNextValue(data.index++)}bits|=(resb>0?1:0)*power;power<<=1}dictionary[dictSize++]=f(bits);c=dictSize-1;enlargeIn--;break;case 1:bits=0;maxpower=Math.pow(2,16);power=1;while(power!=maxpower){resb=data.val&data.position;data.position>>=1;if(data.position==0){data.position=resetValue;data.val=getNextValue(data.index++)}bits|=(resb>0?1:0)*power;power<<=1}dictionary[dictSize++]=f(bits);c=dictSize-1;enlargeIn--;break;case 2:return result.join("")}if(enlargeIn==0){enlargeIn=Math.pow(2,numBits);numBits++}if(dictionary[c]){entry=dictionary[c]}else{if(c===dictSize){entry=w+w.charAt(0)}else{return null}}result.push(entry);dictionary[dictSize++]=w+entry.charAt(0);enlargeIn--;w=entry;if(enlargeIn==0){enlargeIn=Math.pow(2,numBits);numBits++}}}};return LZString})();if(typeof define==="function"&&define.amd){define(function(){return LZString})}else{if(typeof module!=="undefined"&&module!=null){module.exports=LZString}}
/*!
* screenfull
* v1.0.2 - 2012-10-15
* https://github.com/sindresorhus/screenfull.js
* (c) Sindre Sorhus; MIT License
*/
(function(window,document){var keyboardAllowed=typeof Element!=="undefined"&&"ALLOW_KEYBOARD_INPUT" in Element,fn=(function(){var val,valLength;var fnMap=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"]];var i=0;var l=fnMap.length;var ret={};for(;i<l;i++){val=fnMap[i];if(val&&val[1] in document){for(i=0,valLength=val.length;i<valLength;i++){ret[fnMap[0][i]]=val[i]}return ret}}return false})(),screenfull={request:function(elem){var request=fn.requestFullscreen;elem=elem||document.documentElement;if(/5\.1[\.\d]* Safari/.test(navigator.userAgent)){elem[request]()}else{elem[request](keyboardAllowed&&Element.ALLOW_KEYBOARD_INPUT)}},exit:function(){document[fn.exitFullscreen]()},toggle:function(elem){if(this.isFullscreen){this.exit()}else{this.request(elem)}},onchange:function(){},onerror:function(){}};if(!fn){return window.screenfull=false}Object.defineProperties(screenfull,{isFullscreen:{get:function(){return !!document[fn.fullscreenElement]}},element:{enumerable:true,get:function(){return document[fn.fullscreenElement]}},enabled:{enumerable:true,get:function(){return document[fn.fullscreenEnabled]}}});document.addEventListener(fn.fullscreenchange,function(e){screenfull.onchange.call(screenfull,e)});document.addEventListener(fn.fullscreenerror,function(e){screenfull.onerror.call(screenfull,e)});window.screenfull=screenfull})(window,document);
/*!
 * jQuery JavaScript Library v1.12.4
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2016-05-20T17:17Z
 */
(function(global,factory){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=global.document?factory(global,true):function(w){if(!w.document){throw new Error("jQuery requires a window with a document")}return factory(w)}}else{factory(global)}}(typeof window!=="undefined"?window:this,function(window,noGlobal){var deletedIds=[];var document=window.document;var slice=deletedIds.slice;var concat=deletedIds.concat;var push=deletedIds.push;var indexOf=deletedIds.indexOf;var class2type={};var toString=class2type.toString;var hasOwn=class2type.hasOwnProperty;var support={};var version="1.12.4",jQuery=function(selector,context){return new jQuery.fn.init(selector,context)},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()};jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,selector:"",length:0,toArray:function(){return slice.call(this)},get:function(num){return num!=null?(num<0?this[num+this.length]:this[num]):slice.call(this)},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret},each:function(callback){return jQuery.each(this,callback)},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},end:function(){return this.prevObject||this.constructor()},push:push,sort:deletedIds.sort,splice:deletedIds.splice};jQuery.extend=jQuery.fn.extend=function(){var src,copyIsArray,copy,name,options,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[i]||{};i++}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={}}if(i===length){target=this;i--}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else{if(copy!==undefined){target[name]=copy}}}}}return target};jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:true,error:function(msg){throw new Error(msg)},noop:function(){},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray||function(obj){return jQuery.type(obj)==="array"},isWindow:function(obj){return obj!=null&&obj==obj.window},isNumeric:function(obj){var realStringObj=obj&&obj.toString();return !jQuery.isArray(obj)&&(realStringObj-parseFloat(realStringObj)+1)>=0},isEmptyObject:function(obj){var name;for(name in obj){return false}return true},isPlainObject:function(obj){var key;if(!obj||jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false}try{if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}if(!support.ownFirst){for(key in obj){return hasOwn.call(obj,key)}}for(key in obj){}return key===undefined||hasOwn.call(obj,key)},type:function(obj){if(obj==null){return obj+""}return typeof obj==="object"||typeof obj==="function"?class2type[toString.call(obj)]||"object":typeof obj},globalEval:function(data){if(data&&jQuery.trim(data)){(window.execScript||function(data){window["eval"].call(window,data)})(data)}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback){var length,i=0;if(isArrayLike(obj)){length=obj.length;for(;i<length;i++){if(callback.call(obj[i],i,obj[i])===false){break}}}else{for(i in obj){if(callback.call(obj[i],i,obj[i])===false){break}}}return obj},trim:function(text){return text==null?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArrayLike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr)}else{push.call(ret,arr)}}return ret},inArray:function(elem,arr,i){var len;if(arr){if(indexOf){return indexOf.call(arr,elem,i)}len=arr.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++){if(i in arr&&arr[i]===elem){return i}}}return -1},merge:function(first,second){var len=+second.length,j=0,i=first.length;while(j<len){first[i++]=second[j++]}if(len!==len){while(second[j]!==undefined){first[i++]=second[j++]}}first.length=i;return first},grep:function(elems,callback,invert){var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;for(;i<length;i++){callbackInverse=!callback(elems[i],i);if(callbackInverse!==callbackExpect){matches.push(elems[i])}}return matches},map:function(elems,callback,arg){var length,value,i=0,ret=[];if(isArrayLike(elems)){length=elems.length;for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}return concat.apply([],ret)},guid:1,proxy:function(fn,context){var args,proxy,tmp;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn)){return undefined}args=slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy},now:function(){return +(new Date())},support:support});if(typeof Symbol==="function"){jQuery.fn[Symbol.iterator]=deletedIds[Symbol.iterator]}jQuery.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});function isArrayLike(obj){var length=!!obj&&"length" in obj&&obj.length,type=jQuery.type(obj);if(type==="function"||jQuery.isWindow(obj)){return false}return type==="array"||length===0||typeof length==="number"&&length>0&&(length-1) in obj}var Sizzle=
/*!
 * Sizzle CSS Selector Engine v2.2.1
 * http://sizzlejs.com/
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2015-10-17
 */
(function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date(),preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){if(a===b){hasDuplicate=true}return 0},MAX_NEGATIVE=1<<31,hasOwn=({}).hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){var i=0,len=list.length;for(;i<len;i++){if(list[i]===elem){return i}}return -1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|.*)\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)},unloadHandler=function(){setDocument()};try{push.apply((arr=slice.call(preferredDoc.childNodes)),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){var j=target.length,i=0;while((target[j++]=els[i++])){}target.length=j-1}}}function Sizzle(selector,context,results,seed){var m,i,elem,nid,nidselect,match,groups,newSelector,newContext=context&&context.ownerDocument,nodeType=context?context.nodeType:9;results=results||[];if(typeof selector!=="string"||!selector||nodeType!==1&&nodeType!==9&&nodeType!==11){return results}if(!seed){if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context)}context=context||document;if(documentIsHTML){if(nodeType!==11&&(match=rquickExpr.exec(selector))){if((m=match[1])){if(nodeType===9){if((elem=context.getElementById(m))){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(newContext&&(elem=newContext.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else{if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results}else{if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results}}}}if(support.qsa&&!compilerCache[selector+" "]&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nodeType!==1){newContext=context;newSelector=selector}else{if(context.nodeName.toLowerCase()!=="object"){if((nid=context.getAttribute("id"))){nid=nid.replace(rescape,"\\$&")}else{context.setAttribute("id",(nid=expando))}groups=tokenize(selector);i=groups.length;nidselect=ridentifier.test(nid)?"#"+nid:"[id='"+nid+"']";while(i--){groups[i]=nidselect+" "+toSelector(groups[i])}newSelector=groups.join(",");newContext=rsibling.test(selector)&&testContext(context.parentNode)||context}}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results}catch(qsaError){}finally{if(nid===expando){context.removeAttribute("id")}}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];function cache(key,value){if(keys.push(key+" ")>Expr.cacheLength){delete cache[keys.shift()]}return(cache[key+" "]=value)}return cache}function markFunction(fn){fn[expando]=true;return fn}function assert(fn){var div=document.createElement("div");try{return !!fn(div)}catch(e){return false}finally{if(div.parentNode){div.parentNode.removeChild(div)}div=null}}function addHandle(attrs,handler){var arr=attrs.split("|"),i=arr.length;while(i--){Expr.attrHandle[arr[i]]=handler}}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff}if(cur){while((cur=cur.nextSibling)){if(cur===b){return -1}}}return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[(j=matchIndexes[i])]){seed[j]=!(matches[j]=seed[j])}}})})}function testContext(context){return context&&typeof context.getElementsByTagName!=="undefined"&&context}support=Sizzle.support={};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};setDocument=Sizzle.setDocument=function(node){var hasCompare,parent,doc=node?node.ownerDocument||node:preferredDoc;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document}document=doc;docElem=document.documentElement;documentIsHTML=!isXML(document);if((parent=document.defaultView)&&parent.top!==parent){if(parent.addEventListener){parent.addEventListener("unload",unloadHandler,false)}else{if(parent.attachEvent){parent.attachEvent("onunload",unloadHandler)}}}support.attributes=assert(function(div){div.className="i";return !div.getAttribute("className")});support.getElementsByTagName=assert(function(div){div.appendChild(document.createComment(""));return !div.getElementsByTagName("*").length});support.getElementsByClassName=rnative.test(document.getElementsByClassName);support.getById=assert(function(div){docElem.appendChild(div).id=expando;return !document.getElementsByName||!document.getElementsByName(expando).length});if(support.getById){Expr.find.ID=function(id,context){if(typeof context.getElementById!=="undefined"&&documentIsHTML){var m=context.getElementById(id);return m?[m]:[]}};Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}}else{delete Expr.find.ID;Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");return node&&node.value===attrId}}}Expr.find.TAG=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!=="undefined"){return context.getElementsByTagName(tag)}else{if(support.qsa){return context.querySelectorAll(tag)}}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while((elem=results[i++])){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results};Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(typeof context.getElementsByClassName!=="undefined"&&documentIsHTML){return context.getElementsByClassName(className)}};rbuggyMatches=[];rbuggyQSA=[];if((support.qsa=rnative.test(document.querySelectorAll))){assert(function(div){docElem.appendChild(div).innerHTML="<a id='"+expando+"'></a><select id='"+expando+"-\r\\' msallowcapture=''><option selected=''></option></select>";if(div.querySelectorAll("[msallowcapture^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")")}if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")")}if(!div.querySelectorAll("[id~="+expando+"-]").length){rbuggyQSA.push("~=")}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}if(!div.querySelectorAll("a#"+expando+"+*").length){rbuggyQSA.push(".#.+[+~]")}});assert(function(div){var input=document.createElement("input");input.setAttribute("type","hidden");div.appendChild(input).setAttribute("name","D");if(div.querySelectorAll("[name=d]").length){rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?=")}if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled")}div.querySelectorAll("*,:x");rbuggyQSA.push(",.*:")})}if((support.matchesSelector=rnative.test((matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)))){assert(function(div){support.disconnectedMatch=matches.call(div,"div");matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos)})}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));hasCompare=rnative.test(docElem.compareDocumentPosition);contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16))}:function(a,b){if(b){while((b=b.parentNode)){if(b===a){return true}}}return false};sortOrder=hasCompare?function(a,b){if(a===b){hasDuplicate=true;return 0}var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;if(compare){return compare}compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1;if(compare&1||(!support.sortDetached&&b.compareDocumentPosition(a)===compare)){if(a===document||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)){return -1}if(b===document||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)){return 1}return sortInput?(indexOf(sortInput,a)-indexOf(sortInput,b)):0}return compare&4?-1:1}:function(a,b){if(a===b){hasDuplicate=true;return 0}var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup){return a===document?-1:b===document?1:aup?-1:bup?1:sortInput?(indexOf(sortInput,a)-indexOf(sortInput,b)):0}else{if(aup===bup){return siblingCheck(a,b)}}cur=a;while((cur=cur.parentNode)){ap.unshift(cur)}cur=b;while((cur=cur.parentNode)){bp.unshift(cur)}while(ap[i]===bp[i]){i++}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0};return document};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem)}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&!compilerCache[expr+" "]&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context)}return contains(context,elem)};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem)}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while((elem=results[i++])){if(elem===results[i]){j=duplicates.push(i)}}while(j--){results.splice(duplicates[j],1)}}sortInput=null;return results};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){while((node=elem[i++])){ret+=getText(node)}}else{if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else{if(nodeType===3||nodeType===4){return elem.nodeValue}}}return ret};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" "}return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0])}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+((match[7]+match[8])||match[3]==="odd")}else{if(match[3]){Sizzle.error(match[0])}}return match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];if(matchExpr.CHILD.test(match[0])){return null}if(match[3]){match[2]=match[4]||match[5]||""}else{if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess)}}return match.slice(0,3)}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!=="undefined"&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!="}if(!operator){return true}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result.replace(rwhitespace," ")+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false}},CHILD:function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return !!elem.parentNode}:function(elem,context,xml){var cache,uniqueCache,outerCache,node,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType,diff=false;if(parent){if(simple){while(dir){node=elem;while((node=node[dir])){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false}}start=dir=type==="only"&&!start&&"nextSibling"}return true}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){node=parent;outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});cache=uniqueCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=nodeIndex&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while((node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())){if(node.nodeType===1&&++diff&&node===elem){uniqueCache[type]=[dirruns,nodeIndex,diff];break}}}else{if(useCache){node=elem;outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});cache=uniqueCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=nodeIndex}if(diff===false){while((node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});uniqueCache[type]=[dirruns,diff]}if(node===elem){break}}}}}diff-=last;return diff===first||(diff%first===0&&diff/first>=0)}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument)}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if((elem=unmatched[i])){seed[i]=!(matches[i]=elem)}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);input[0]=null;return !results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){text=text.replace(runescape,funescape);return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang)}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if((elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0}}while((elem=elem.parentNode)&&elem.nodeType===1);return false}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===false},disabled:function(elem){return elem.disabled===true},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return(nodeName==="input"&&!!elem.checked)||(nodeName==="option"&&!!elem.selected)},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeType<6){return false}}return true},parent:function(elem){return !Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},text:function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()==="text")},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i)}return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i)}return matchIndexes})}};Expr.pseudos.nth=Expr.pseudos.eq;for(i in {radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i)}for(i in {submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i)}function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters();tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0)}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar}groups.push((tokens=[]))}matched=false;if((match=rcombinators.exec(soFar))){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length)}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length)}}if(!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)};function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value}return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml)}}}:function(elem,context,xml){var oldCache,uniqueCache,outerCache,newCache=[dirruns,doneName];if(xml){while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true}}}}else{while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});uniqueCache=outerCache[elem.uniqueID]||(outerCache[elem.uniqueID]={});if((oldCache=uniqueCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName){return(newCache[2]=oldCache[2])}else{uniqueCache[dir]=newCache;if((newCache[2]=matcher(elem,context,xml))){return true}}}}}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false}}return true}:matchers[0]}function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results)}return results}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if((elem=unmatched[i])){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter)}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector)}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml)}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if((elem=temp[i])){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if((elem=matcherOut[i])){temp.push((matcherIn[i]=elem))}}postFinder(null,(matcherOut=[]),temp,xml)}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem)}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml)}else{push.apply(results,matcherOut)}}})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf(checkContext,elem)>-1},implicitRelative,true),matchers=[function(elem,context,xml){var ret=(!leadingRelative&&(xml||context!==outermostContext))||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));checkContext=null;return ret}];for(;i<len;i++){if((matcher=Expr.relative[tokens[i].type])){matchers=[addCombinator(elementMatcher(matchers),matcher)]}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens((tokens=tokens.slice(j))),j<len&&toSelector(tokens))}matchers.push(matcher)}}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=(dirruns+=contextBackup==null?1:Math.random()||0.1),len=elems.length;if(outermost){outermostContext=context===document||context||outermost}for(;i!==len&&(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;if(!context&&elem.ownerDocument!==document){setDocument(elem);xml=!documentIsHTML}while((matcher=elementMatchers[j++])){if(matcher(elem,context||document,xml)){results.push(elem);break}}if(outermost){dirruns=dirrunsUnique}}if(bySet){if((elem=!matcher&&elem)){matchedCount--}if(seed){unmatched.push(elem)}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while((matcher=setMatchers[j++])){matcher(unmatched,setMatched,context,xml)}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results)}}}setMatched=condense(setMatched)}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&(matchedCount+setMatchers.length)>1){Sizzle.uniqueSort(results)}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};return bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!match){match=tokenize(selector)}i=match.length;while(i--){cached=matcherFromTokens(match[i]);if(cached[expando]){setMatchers.push(cached)}else{elementMatchers.push(cached)}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));cached.selector=selector}return cached};select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled=typeof selector==="function"&&selector,match=!seed&&tokenize((selector=compiled.selector||selector));results=results||[];if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results}else{if(compiled){context=context.parentNode}}selector=selector.slice(tokens.shift().value.length)}i=matchExpr.needsContext.test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[(type=token.type)]){break}if((find=Expr.find[type])){if((seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results}break}}}}(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,!context||rsibling.test(selector)&&testContext(context.parentNode)||context);return results};support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=!!hasDuplicate;setDocument();support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement("div"))&1});if(!assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild.getAttribute("href")==="#"})){addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2)}})}if(!support.attributes||!assert(function(div){div.innerHTML="<input/>";div.firstChild.setAttribute("value","");return div.firstChild.getAttribute("value")===""})){addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input"){return elem.defaultValue}})}if(!assert(function(div){return div.getAttribute("disabled")==null})){addHandle(booleans,function(elem,name,isXML){var val;if(!isXML){return elem[name]===true?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}})}return Sizzle})(window);jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.uniqueSort=jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;var dir=function(elem,dir,until){var matched=[],truncate=until!==undefined;while((elem=elem[dir])&&elem.nodeType!==9){if(elem.nodeType===1){if(truncate&&jQuery(elem).is(until)){break}matched.push(elem)}}return matched};var siblings=function(n,elem){var matched=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){matched.push(n)}}return matched};var rneedsContext=jQuery.expr.match.needsContext;var rsingleTag=(/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/);var risSimple=/^.[^:#\[\.,]*$/;function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return !!qualifier.call(elem,i,elem)!==not})}if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return(elem===qualifier)!==not})}if(typeof qualifier==="string"){if(risSimple.test(qualifier)){return jQuery.filter(qualifier,elements,not)}qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return(jQuery.inArray(elem,qualifier)>-1)!==not})}jQuery.filter=function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")"}return elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1}))};jQuery.fn.extend({find:function(selector){var i,ret=[],self=this,len=self.length;if(typeof selector!=="string"){return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++){if(jQuery.contains(self[i],this)){return true}}}))}for(i=0;i<len;i++){jQuery.find(selector,self[i],ret)}ret=this.pushStack(len>1?jQuery.unique(ret):ret);ret.selector=this.selector?this.selector+" "+selector:selector;return ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],false))},not:function(selector){return this.pushStack(winnow(this,selector||[],true))},is:function(selector){return !!winnow(this,typeof selector==="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,init=jQuery.fn.init=function(selector,context,root){var match,elem;if(!selector){return this}root=root||rootjQuery;if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(jQuery.isFunction(this[match])){this[match](context[match])}else{this.attr(match,context[match])}}}return this}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){if(elem.id!==match[2]){return rootjQuery.find(selector)}this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else{if(!context||context.jquery){return(context||root).find(selector)}else{return this.constructor(context).find(selector)}}}else{if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}else{if(jQuery.isFunction(selector)){return typeof root.ready!=="undefined"?root.ready(selector):selector(jQuery)}}}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)};init.prototype=jQuery.fn;rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({has:function(target){var i,targets=jQuery(target,this),len=targets.length;return this.filter(function(){for(i=0;i<len;i++){if(jQuery.contains(this,targets[i])){return true}}})},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}}}return this.pushStack(matched.length>1?jQuery.uniqueSort(matched):matched)},index:function(elem){if(!elem){return(this[0]&&this[0].parentNode)?this.first().prevAll().length:-1}if(typeof elem==="string"){return jQuery.inArray(this[0],jQuery(elem))}return jQuery.inArray(elem.jquery?elem[0]:elem,this)},add:function(selector,context){return this.pushStack(jQuery.uniqueSort(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});function sibling(cur,dir){do{cur=cur[dir]}while(cur&&cur.nodeType!==1);return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return dir(elem,"nextSibling")},prevAll:function(elem){return dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return dir(elem,"previousSibling",until)},siblings:function(elem){return siblings((elem.parentNode||{}).firstChild,elem)},children:function(elem){return siblings(elem.firstChild)},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until}if(selector&&typeof selector==="string"){ret=jQuery.filter(selector,ret)}if(this.length>1){if(!guaranteedUnique[name]){ret=jQuery.uniqueSort(ret)}if(rparentsprev.test(name)){ret=ret.reverse()}}return this.pushStack(ret)}});var rnotwhite=(/\S+/g);function createOptions(options){var object={};jQuery.each(options.match(rnotwhite)||[],function(_,flag){object[flag]=true});return object}jQuery.Callbacks=function(options){options=typeof options==="string"?createOptions(options):jQuery.extend({},options);var firing,memory,fired,locked,list=[],queue=[],firingIndex=-1,fire=function(){locked=options.once;fired=firing=true;for(;queue.length;firingIndex=-1){memory=queue.shift();while(++firingIndex<list.length){if(list[firingIndex].apply(memory[0],memory[1])===false&&options.stopOnFalse){firingIndex=list.length;memory=false}}}if(!options.memory){memory=false}firing=false;if(locked){if(memory){list=[]}else{list=""}}},self={add:function(){if(list){if(memory&&!firing){firingIndex=list.length-1;queue.push(memory)}(function add(args){jQuery.each(args,function(_,arg){if(jQuery.isFunction(arg)){if(!options.unique||!self.has(arg)){list.push(arg)}}else{if(arg&&arg.length&&jQuery.type(arg)!=="string"){add(arg)}}})})(arguments);if(memory&&!firing){fire()}}return this},remove:function(){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(index<=firingIndex){firingIndex--}}});return this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:list.length>0},empty:function(){if(list){list=[]}return this},disable:function(){locked=queue=[];list=memory="";return this},disabled:function(){return !list},lock:function(){locked=true;if(!memory){self.disable()}return this},locked:function(){return !!locked},fireWith:function(context,args){if(!locked){args=args||[];args=[context,args.slice?args.slice():args];queue.push(args);if(!firing){fire()}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return !!fired}};return self};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().progress(newDefer.notify).done(newDefer.resolve).fail(newDefer.reject)}else{newDefer[tuple[0]+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)}})});fns=null}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock)}deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?promise:this,arguments);return this};deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred},when:function(subordinate){var i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=length!==1||(subordinate&&jQuery.isFunction(subordinate.promise))?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values)}else{if(!(--remaining)){deferred.resolveWith(contexts,values)}}}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().progress(updateFunc(i,progressContexts,progressValues)).done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject)}else{--remaining}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues)}return deferred.promise()}});var readyList;jQuery.fn.ready=function(fn){jQuery.ready.promise().done(fn);return this};jQuery.extend({isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.triggerHandler){jQuery(document).triggerHandler("ready");jQuery(document).off("ready")}}});function detach(){if(document.addEventListener){document.removeEventListener("DOMContentLoaded",completed);window.removeEventListener("load",completed)}else{document.detachEvent("onreadystatechange",completed);window.detachEvent("onload",completed)}}function completed(){if(document.addEventListener||window.event.type==="load"||document.readyState==="complete"){detach();jQuery.ready()}}jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"||(document.readyState!=="loading"&&!document.documentElement.doScroll)){window.setTimeout(jQuery.ready)}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",completed);window.addEventListener("load",completed)}else{document.attachEvent("onreadystatechange",completed);window.attachEvent("onload",completed);var top=false;try{top=window.frameElement==null&&document.documentElement}catch(e){}if(top&&top.doScroll){(function doScrollCheck(){if(!jQuery.isReady){try{top.doScroll("left")}catch(e){return window.setTimeout(doScrollCheck,50)}detach();jQuery.ready()}})()}}}}return readyList.promise(obj)};jQuery.ready.promise();var i;for(i in jQuery(support)){break}support.ownFirst=i==="0";support.inlineBlockNeedsLayout=false;jQuery(function(){var val,div,body,container;body=document.getElementsByTagName("body")[0];if(!body||!body.style){return}div=document.createElement("div");container=document.createElement("div");container.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px";body.appendChild(container).appendChild(div);if(typeof div.style.zoom!=="undefined"){div.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1";support.inlineBlockNeedsLayout=val=div.offsetWidth===3;if(val){body.style.zoom=1}}body.removeChild(container)});(function(){var div=document.createElement("div");support.deleteExpando=true;try{delete div.test}catch(e){support.deleteExpando=false}div=null})();var acceptData=function(elem){var noData=jQuery.noData[(elem.nodeName+" ").toLowerCase()],nodeType=+elem.nodeType||1;return nodeType!==1&&nodeType!==9?false:!noData||noData!==true&&elem.getAttribute("classid")===noData};var rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/([A-Z])/g;function dataAttr(elem,key,data){if(data===undefined&&elem.nodeType===1){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}jQuery.data(elem,key,data)}else{data=undefined}}return data}function isEmptyDataObject(obj){var name;for(name in obj){if(name==="data"&&jQuery.isEmptyObject(obj[name])){continue}if(name!=="toJSON"){return false}}return true}function internalData(elem,name,data,pvt){if(!acceptData(elem)){return}var ret,thisCache,internalKey=jQuery.expando,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey;if((!id||!cache[id]||(!pvt&&!cache[id].data))&&data===undefined&&typeof name==="string"){return}if(!id){if(isNode){id=elem[internalKey]=deletedIds.pop()||jQuery.guid++}else{id=internalKey}}if(!cache[id]){cache[id]=isNode?{}:{toJSON:jQuery.noop}}if(typeof name==="object"||typeof name==="function"){if(pvt){cache[id]=jQuery.extend(cache[id],name)}else{cache[id].data=jQuery.extend(cache[id].data,name)}}thisCache=cache[id];if(!pvt){if(!thisCache.data){thisCache.data={}}thisCache=thisCache.data}if(data!==undefined){thisCache[jQuery.camelCase(name)]=data}if(typeof name==="string"){ret=thisCache[name];if(ret==null){ret=thisCache[jQuery.camelCase(name)]}}else{ret=thisCache}return ret}function internalRemoveData(elem,name,pvt){if(!acceptData(elem)){return}var thisCache,i,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:jQuery.expando;if(!cache[id]){return}if(name){thisCache=pvt?cache[id]:cache[id].data;if(thisCache){if(!jQuery.isArray(name)){if(name in thisCache){name=[name]}else{name=jQuery.camelCase(name);if(name in thisCache){name=[name]}else{name=name.split(" ")}}}else{name=name.concat(jQuery.map(name,jQuery.camelCase))}i=name.length;while(i--){delete thisCache[name[i]]}if(pvt?!isEmptyDataObject(thisCache):!jQuery.isEmptyObject(thisCache)){return}}}if(!pvt){delete cache[id].data;if(!isEmptyDataObject(cache[id])){return}}if(isNode){jQuery.cleanData([elem],true)}else{if(support.deleteExpando||cache!=cache.window){delete cache[id]}else{cache[id]=undefined}}}jQuery.extend({cache:{},noData:{"applet ":true,"embed ":true,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(elem){elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando];return !!elem&&!isEmptyDataObject(elem)},data:function(elem,name,data){return internalData(elem,name,data)},removeData:function(elem,name){return internalRemoveData(elem,name)},_data:function(elem,name,data){return internalData(elem,name,data,true)},_removeData:function(elem,name){return internalRemoveData(elem,name,true)}});jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(key===undefined){if(this.length){data=jQuery.data(elem);if(elem.nodeType===1&&!jQuery._data(elem,"parsedAttrs")){i=attrs.length;while(i--){if(attrs[i]){name=attrs[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.slice(5));dataAttr(elem,name,data[name])}}}jQuery._data(elem,"parsedAttrs",true)}}return data}if(typeof key==="object"){return this.each(function(){jQuery.data(this,key)})}return arguments.length>1?this.each(function(){jQuery.data(this,key,value)}):elem?dataAttr(elem,key,jQuery.data(elem,key)):undefined},removeData:function(key){return this.each(function(){jQuery.removeData(this,key)})}});jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=jQuery._data(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=jQuery._data(elem,type,jQuery.makeArray(data))}else{queue.push(data)}}return queue||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if(fn==="inprogress"){fn=queue.shift();startLength--}if(fn){if(type==="fx"){queue.unshift("inprogress")}delete hooks.stop;fn.call(elem,next,hooks)}if(!startLength&&hooks){hooks.empty.fire()}},_queueHooks:function(elem,type){var key=type+"queueHooks";return jQuery._data(elem,key)||jQuery._data(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){jQuery._removeData(elem,type+"queue");jQuery._removeData(elem,key)})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--}if(arguments.length<setter){return jQuery.queue(this[0],type)}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!(--count)){defer.resolveWith(elements,[elements])}};if(typeof type!=="string"){obj=type;type=undefined}type=type||"fx";while(i--){tmp=jQuery._data(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});(function(){var shrinkWrapBlocksVal;support.shrinkWrapBlocks=function(){if(shrinkWrapBlocksVal!=null){return shrinkWrapBlocksVal}shrinkWrapBlocksVal=false;var div,body,container;body=document.getElementsByTagName("body")[0];if(!body||!body.style){return}div=document.createElement("div");container=document.createElement("div");container.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px";body.appendChild(container).appendChild(div);if(typeof div.style.zoom!=="undefined"){div.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1";div.appendChild(document.createElement("div")).style.width="5px";shrinkWrapBlocksVal=div.offsetWidth!==3}body.removeChild(container);return shrinkWrapBlocksVal}})();var pnum=(/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/).source;var rcssNum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i");var cssExpand=["Top","Right","Bottom","Left"];var isHidden=function(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem)};function adjustCSS(elem,prop,valueParts,tween){var adjusted,scale=1,maxIterations=20,currentValue=tween?function(){return tween.cur()}:function(){return jQuery.css(elem,prop,"")},initial=currentValue(),unit=valueParts&&valueParts[3]||(jQuery.cssNumber[prop]?"":"px"),initialInUnit=(jQuery.cssNumber[prop]||unit!=="px"&&+initial)&&rcssNum.exec(jQuery.css(elem,prop));if(initialInUnit&&initialInUnit[3]!==unit){unit=unit||initialInUnit[3];valueParts=valueParts||[];initialInUnit=+initial||1;do{scale=scale||".5";initialInUnit=initialInUnit/scale;jQuery.style(elem,prop,initialInUnit+unit)}while(scale!==(scale=currentValue()/initial)&&scale!==1&&--maxIterations)}if(valueParts){initialInUnit=+initialInUnit||+initial||0;adjusted=valueParts[1]?initialInUnit+(valueParts[1]+1)*valueParts[2]:+valueParts[2];if(tween){tween.unit=unit;tween.start=initialInUnit;tween.end=adjusted}}return adjusted}var access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,length=elems.length,bulk=key==null;if(jQuery.type(key)==="object"){chainable=true;for(i in key){access(elems,fn,i,key[i],true,emptyGet,raw)}}else{if(value!==undefined){chainable=true;if(!jQuery.isFunction(value)){raw=true}if(bulk){if(raw){fn.call(elems,value);fn=null}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value)}}}if(fn){for(;i<length;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)))}}}}return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet};var rcheckableType=(/^(?:checkbox|radio)$/i);var rtagName=(/<([\w:-]+)/);var rscriptType=(/^$|\/(?:java|ecma)script/i);var rleadingWhitespace=(/^\s+/);var nodeNames="abbr|article|aside|audio|bdi|canvas|data|datalist|details|dialog|figcaption|figure|footer|header|hgroup|main|mark|meter|nav|output|picture|progress|section|summary|template|time|video";function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();if(safeFrag.createElement){while(list.length){safeFrag.createElement(list.pop())}}return safeFrag}(function(){var div=document.createElement("div"),fragment=document.createDocumentFragment(),input=document.createElement("input");div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";support.leadingWhitespace=div.firstChild.nodeType===3;support.tbody=!div.getElementsByTagName("tbody").length;support.htmlSerialize=!!div.getElementsByTagName("link").length;support.html5Clone=document.createElement("nav").cloneNode(true).outerHTML!=="<:nav></:nav>";input.type="checkbox";input.checked=true;fragment.appendChild(input);support.appendChecked=input.checked;div.innerHTML="<textarea>x</textarea>";support.noCloneChecked=!!div.cloneNode(true).lastChild.defaultValue;fragment.appendChild(div);input=document.createElement("input");input.setAttribute("type","radio");input.setAttribute("checked","checked");input.setAttribute("name","t");div.appendChild(input);support.checkClone=div.cloneNode(true).cloneNode(true).lastChild.checked;support.noCloneEvent=!!div.addEventListener;div[jQuery.expando]=1;support.attributes=!div.getAttribute(jQuery.expando)})();var wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]};wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;function getAll(context,tag){var elems,elem,i=0,found=typeof context.getElementsByTagName!=="undefined"?context.getElementsByTagName(tag||"*"):typeof context.querySelectorAll!=="undefined"?context.querySelectorAll(tag||"*"):undefined;if(!found){for(found=[],elems=context.childNodes||context;(elem=elems[i])!=null;i++){if(!tag||jQuery.nodeName(elem,tag)){found.push(elem)}else{jQuery.merge(found,getAll(elem,tag))}}}return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],found):found}function setGlobalEval(elems,refElements){var elem,i=0;for(;(elem=elems[i])!=null;i++){jQuery._data(elem,"globalEval",!refElements||jQuery._data(refElements[i],"globalEval"))}}var rhtml=/<|&#?\w+;/,rtbody=/<tbody/i;function fixDefaultChecked(elem){if(rcheckableType.test(elem.type)){elem.defaultChecked=elem.checked}}function buildFragment(elems,context,scripts,selection,ignored){var j,elem,contains,tmp,tag,tbody,wrap,l=elems.length,safe=createSafeFragment(context),nodes=[],i=0;for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(jQuery.type(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem)}else{if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem))}else{tmp=tmp||safe.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+jQuery.htmlPrefilter(elem)+wrap[2];j=wrap[0];while(j--){tmp=tmp.lastChild}if(!support.leadingWhitespace&&rleadingWhitespace.test(elem)){nodes.push(context.createTextNode(rleadingWhitespace.exec(elem)[0]))}if(!support.tbody){elem=tag==="table"&&!rtbody.test(elem)?tmp.firstChild:wrap[1]==="<table>"&&!rtbody.test(elem)?tmp:0;j=elem&&elem.childNodes.length;while(j--){if(jQuery.nodeName((tbody=elem.childNodes[j]),"tbody")&&!tbody.childNodes.length){elem.removeChild(tbody)}}}jQuery.merge(nodes,tmp.childNodes);tmp.textContent="";while(tmp.firstChild){tmp.removeChild(tmp.firstChild)}tmp=safe.lastChild}}}}if(tmp){safe.removeChild(tmp)}if(!support.appendChecked){jQuery.grep(getAll(nodes,"input"),fixDefaultChecked)}i=0;while((elem=nodes[i++])){if(selection&&jQuery.inArray(elem,selection)>-1){if(ignored){ignored.push(elem)}continue}contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(safe.appendChild(elem),"script");if(contains){setGlobalEval(tmp)}if(scripts){j=0;while((elem=tmp[j++])){if(rscriptType.test(elem.type||"")){scripts.push(elem)}}}}tmp=null;return safe}(function(){var i,eventName,div=document.createElement("div");for(i in {submit:true,change:true,focusin:true}){eventName="on"+i;if(!(support[i]=eventName in window)){div.setAttribute(eventName,"t");support[i]=div.attributes[eventName].expando===false}}div=null})();var rformElems=/^(?:input|select|textarea)$/i,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)/;function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return document.activeElement}catch(err){}}function on(elem,types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined}for(type in types){on(elem,type,selector,data,types[type],one)}return elem}if(data==null&&fn==null){fn=selector;data=selector=undefined}else{if(fn==null){if(typeof selector==="string"){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}}if(fn===false){fn=returnFalse}else{if(!fn){return elem}}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return elem.each(function(){jQuery.event.add(this,types,fn,data,selector)})}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var tmp,events,t,handleObjIn,special,eventHandle,handleObj,handlers,type,namespaces,origType,elemData=jQuery._data(elem);if(!elemData){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}if(!handler.guid){handler.guid=jQuery.guid++}if(!(events=elemData.events)){events=elemData.events={}}if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!=="undefined"&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined};eventHandle.elem=elem}types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false)}else{if(elem.attachEvent){elem.attachEvent("on"+type,eventHandle)}}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}elem=null},remove:function(elem,types,handler,selector,mappedTypes){var j,handleObj,tmp,origCount,t,events,special,handlers,type,namespaces,origType,elemData=jQuery.hasData(elem)&&jQuery._data(elem);if(!elemData||!(events=elemData.events)){return}types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){delete elemData.handle;jQuery._removeData(elem,"events")}},trigger:function(event,data,elem,onlyHandlers){var handle,ontype,cur,bubbleType,special,tmp,i,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return}if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf(".")>-1){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.rnamespace=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;if(!event.target){event.target=elem}data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return}if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode}for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur}if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window)}}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){event.type=i>1?bubbleType:special.bindType||type;handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle");if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&handle.apply&&acceptData(cur)){event.result=handle.apply(cur,data);if(event.result===false){event.preventDefault()}}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&acceptData(elem)){if(ontype&&elem[type]&&!jQuery.isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null}jQuery.event.triggered=type;try{elem[type]()}catch(e){}jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp}}}}return event.result},dispatch:function(event){event=jQuery.event.fix(event);var i,j,ret,matched,handleObj,handlerQueue=[],args=slice.call(arguments),handlers=(jQuery._data(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return}handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.rnamespace||event.rnamespace.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation()}}}}}if(special.postDispatch){special.postDispatch.call(this,event)}return event.result},handlers:function(event,handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(event.type!=="click"||isNaN(event.button)||event.button<1)){for(;cur!=this;cur=cur.parentNode||this){if(cur.nodeType===1&&(cur.disabled!==true||event.type!=="click")){matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matches[sel]===undefined){matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>-1:jQuery.find(sel,this,null,[cur]).length}if(matches[sel]){matches.push(handleObj)}}if(matches.length){handlerQueue.push({elem:cur,handlers:matches})}}}}if(delegateCount<handlers.length){handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)})}return handlerQueue},fix:function(event){if(event[jQuery.expando]){return event}var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];if(!fixHook){this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}}copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);i=copy.length;while(i--){prop=copy[i];event[prop]=originalEvent[prop]}if(!event.target){event.target=originalEvent.srcElement||document}if(event.target.nodeType===3){event.target=event.target.parentNode}event.metaKey=!!event.metaKey;return fixHook.filter?fixHook.filter(event,originalEvent):event},props:("altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which").split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode}return event}},mouseHooks:{props:("button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement").split(" "),filter:function(event,original){var body,eventDoc,doc,button=original.button,fromElement=original.fromElement;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(!event.relatedTarget&&fromElement){event.relatedTarget=fromElement===event.target?original.toElement:fromElement}if(!event.which&&button!==undefined){event.which=(button&1?1:(button&2?3:(button&4?2:0)))}return event}},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){try{this.focus();return false}catch(e){}}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(jQuery.nodeName(this,"input")&&this.type==="checkbox"&&this.click){this.click();return false}},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){if(event.result!==undefined&&event.originalEvent){event.originalEvent.returnValue=event.result}}}},simulate:function(type,elem,event){var e=jQuery.extend(new jQuery.Event(),event,{type:type,isSimulated:true});jQuery.event.trigger(e,null,elem);if(e.isDefaultPrevented()){event.preventDefault()}}};jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle)}}:function(elem,type,handle){var name="on"+type;if(elem.detachEvent){if(typeof elem[name]==="undefined"){elem[name]=null}elem.detachEvent(name,handle)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.defaultPrevented===undefined&&src.returnValue===false?returnTrue:returnFalse}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true};jQuery.Event.prototype={constructor:jQuery.Event,isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(!e){return}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(!e||this.isSimulated){return}if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue;if(e&&e.stopImmediatePropagation){e.stopImmediatePropagation()}this.stopPropagation()}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||(related!==target&&!jQuery.contains(target,related))){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});if(!support.submit){jQuery.event.special.submit={setup:function(){if(jQuery.nodeName(this,"form")){return false}jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?jQuery.prop(elem,"form"):undefined;if(form&&!jQuery._data(form,"submit")){jQuery.event.add(form,"submit._submit",function(event){event._submitBubble=true});jQuery._data(form,"submit",true)}})},postDispatch:function(event){if(event._submitBubble){delete event._submitBubble;if(this.parentNode&&!event.isTrigger){jQuery.event.simulate("submit",this.parentNode,event)}}},teardown:function(){if(jQuery.nodeName(this,"form")){return false}jQuery.event.remove(this,"._submit")}}}if(!support.change){jQuery.event.special.change={setup:function(){if(rformElems.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){jQuery.event.add(this,"propertychange._change",function(event){if(event.originalEvent.propertyName==="checked"){this._justChanged=true}});jQuery.event.add(this,"click._change",function(event){if(this._justChanged&&!event.isTrigger){this._justChanged=false}jQuery.event.simulate("change",this,event)})}return false}jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;if(rformElems.test(elem.nodeName)&&!jQuery._data(elem,"change")){jQuery.event.add(elem,"change._change",function(event){if(this.parentNode&&!event.isSimulated&&!event.isTrigger){jQuery.event.simulate("change",this.parentNode,event)}});jQuery._data(elem,"change",true)}})},handle:function(event){var elem=event.target;if(this!==elem||event.isSimulated||event.isTrigger||(elem.type!=="radio"&&elem.type!=="checkbox")){return event.handleObj.handler.apply(this,arguments)}},teardown:function(){jQuery.event.remove(this,"._change");return !rformElems.test(this.nodeName)}}}if(!support.focusin){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event))};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=jQuery._data(doc,fix);if(!attaches){doc.addEventListener(orig,handler,true)}jQuery._data(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this,attaches=jQuery._data(doc,fix)-1;if(!attaches){doc.removeEventListener(orig,handler,true);jQuery._removeData(doc,fix)}else{jQuery._data(doc,fix,attaches)}}}})}jQuery.fn.extend({on:function(types,selector,data,fn){return on(this,types,selector,data,fn)},one:function(types,selector,data,fn){return on(this,types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true)}}});var rinlinejQuery=/ jQuery\d+="(?:null|\d+)"/g,rnoshimcache=new RegExp("<(?:"+nodeNames+")[\\s/>]","i"),rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,rnoInnerhtml=/<script|<style|<link/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,safeFragment=createSafeFragment(document),fragmentDiv=safeFragment.appendChild(document.createElement("div"));function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(content.nodeType!==11?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){elem.type=(jQuery.find.attr(elem,"type")!==null)+"/"+elem.type;return elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);if(match){elem.type=match[1]}else{elem.removeAttribute("type")}return elem}function cloneCopyEvent(src,dest){if(dest.nodeType!==1||!jQuery.hasData(src)){return}var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle;curData.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i])}}}if(curData.data){curData.data=jQuery.extend({},curData.data)}}function fixCloneNodeIssues(src,dest){var nodeName,e,data;if(dest.nodeType!==1){return}nodeName=dest.nodeName.toLowerCase();if(!support.noCloneEvent&&dest[jQuery.expando]){data=jQuery._data(dest);for(e in data.events){jQuery.removeEvent(dest,e,data.handle)}dest.removeAttribute(jQuery.expando)}if(nodeName==="script"&&dest.text!==src.text){disableScript(dest).text=src.text;restoreScript(dest)}else{if(nodeName==="object"){if(dest.parentNode){dest.outerHTML=src.outerHTML}if(support.html5Clone&&(src.innerHTML&&!jQuery.trim(dest.innerHTML))){dest.innerHTML=src.innerHTML}}else{if(nodeName==="input"&&rcheckableType.test(src.type)){dest.defaultChecked=dest.checked=src.checked;if(dest.value!==src.value){dest.value=src.value}}else{if(nodeName==="option"){dest.defaultSelected=dest.selected=src.defaultSelected}else{if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue}}}}}}function domManip(collection,args,callback,ignored){args=concat.apply([],args);var first,node,hasScripts,scripts,doc,fragment,i=0,l=collection.length,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||(l>1&&typeof value==="string"&&!support.checkClone&&rchecked.test(value))){return collection.each(function(index){var self=collection.eq(index);if(isFunction){args[0]=value.call(this,index,self.html())}domManip(self,args,callback,ignored)})}if(l){fragment=buildFragment(args,collection[0].ownerDocument,false,collection,ignored);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first}if(first||ignored){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,"script"))}}callback.call(collection[i],node,i)}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!jQuery._data(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src){if(jQuery._evalUrl){jQuery._evalUrl(node.src)}}else{jQuery.globalEval((node.text||node.textContent||node.innerHTML||"").replace(rcleanScript,""))}}}}fragment=first=null}}return collection}function remove(elem,selector,keepData){var node,elems=selector?jQuery.filter(selector,elem):elem,i=0;for(;(node=elems[i])!=null;i++){if(!keepData&&node.nodeType===1){jQuery.cleanData(getAll(node))}if(node.parentNode){if(keepData&&jQuery.contains(node.ownerDocument,node)){setGlobalEval(getAll(node,"script"))}node.parentNode.removeChild(node)}}return elem}jQuery.extend({htmlPrefilter:function(html){return html.replace(rxhtmlTag,"<$1></$2>")},clone:function(elem,dataAndEvents,deepDataAndEvents){var destElements,node,clone,i,srcElements,inPage=jQuery.contains(elem.ownerDocument,elem);if(support.html5Clone||jQuery.isXMLDoc(elem)||!rnoshimcache.test("<"+elem.nodeName+">")){clone=elem.cloneNode(true)}else{fragmentDiv.innerHTML=elem.outerHTML;fragmentDiv.removeChild(clone=fragmentDiv.firstChild)}if((!support.noCloneEvent||!support.noCloneChecked)&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0;(node=srcElements[i])!=null;++i){if(destElements[i]){fixCloneNodeIssues(node,destElements[i])}}}if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0;(node=srcElements[i])!=null;i++){cloneCopyEvent(node,destElements[i])}}else{cloneCopyEvent(elem,clone)}}destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"))}destElements=srcElements=node=null;return clone},cleanData:function(elems,forceAcceptData){var elem,type,id,data,i=0,internalKey=jQuery.expando,cache=jQuery.cache,attributes=support.attributes,special=jQuery.event.special;for(;(elem=elems[i])!=null;i++){if(forceAcceptData||acceptData(elem)){id=elem[internalKey];data=id&&cache[id];if(data){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}}if(cache[id]){delete cache[id];if(!attributes&&typeof elem.removeAttribute!=="undefined"){elem.removeAttribute(internalKey)}else{elem[internalKey]=undefined}deletedIds.push(id)}}}}}});jQuery.fn.extend({domManip:domManip,detach:function(selector){return remove(this,selector,true)},remove:function(selector){return remove(this,selector)},text:function(value){return access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},append:function(){return domManip(this,arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return domManip(this,arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return domManip(this,arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this)}})},after:function(){return domManip(this,arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling)}})},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false))}while(elem.firstChild){elem.removeChild(elem.firstChild)}if(elem.options&&jQuery.nodeName(elem,"select")){elem.options.length=0}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined){return elem.nodeType===1?elem.innerHTML.replace(rinlinejQuery,""):undefined}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&(support.htmlSerialize||!rnoshimcache.test(value))&&(support.leadingWhitespace||!rleadingWhitespace.test(value))&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=jQuery.htmlPrefilter(value);try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value}}elem=0}catch(e){}}if(elem){this.empty().append(value)}},null,value,arguments.length)},replaceWith:function(){var ignored=[];return domManip(this,arguments,function(elem){var parent=this.parentNode;if(jQuery.inArray(this,ignored)<0){jQuery.cleanData(getAll(this));if(parent){parent.replaceChild(elem,this)}}},ignored)}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,i=0,ret=[],insert=jQuery(selector),last=insert.length-1;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);push.apply(ret,elems.get())}return this.pushStack(ret)}});var iframe,elemdisplay={HTML:"block",BODY:"block"};function actualDisplay(name,doc){var elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=jQuery.css(elem[0],"display");elem.detach();return display}function defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if(display==="none"||!display){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(doc.documentElement);doc=(iframe[0].contentWindow||iframe[0].contentDocument).document;doc.write();doc.close();display=actualDisplay(nodeName,doc);iframe.detach()}elemdisplay[nodeName]=display}return display}var rmargin=(/^margin/);var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i");var swap=function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name]}return ret};var documentElement=document.documentElement;(function(){var pixelPositionVal,pixelMarginRightVal,boxSizingReliableVal,reliableHiddenOffsetsVal,reliableMarginRightVal,reliableMarginLeftVal,container=document.createElement("div"),div=document.createElement("div");if(!div.style){return}div.style.cssText="float:left;opacity:.5";support.opacity=div.style.opacity==="0.5";support.cssFloat=!!div.style.cssFloat;div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=div.style.backgroundClip==="content-box";container=document.createElement("div");container.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute";div.innerHTML="";container.appendChild(div);support.boxSizing=div.style.boxSizing===""||div.style.MozBoxSizing===""||div.style.WebkitBoxSizing==="";jQuery.extend(support,{reliableHiddenOffsets:function(){if(pixelPositionVal==null){computeStyleTests()}return reliableHiddenOffsetsVal},boxSizingReliable:function(){if(pixelPositionVal==null){computeStyleTests()}return boxSizingReliableVal},pixelMarginRight:function(){if(pixelPositionVal==null){computeStyleTests()}return pixelMarginRightVal},pixelPosition:function(){if(pixelPositionVal==null){computeStyleTests()}return pixelPositionVal},reliableMarginRight:function(){if(pixelPositionVal==null){computeStyleTests()}return reliableMarginRightVal},reliableMarginLeft:function(){if(pixelPositionVal==null){computeStyleTests()}return reliableMarginLeftVal}});function computeStyleTests(){var contents,divStyle,documentElement=document.documentElement;documentElement.appendChild(container);div.style.cssText="-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%";pixelPositionVal=boxSizingReliableVal=reliableMarginLeftVal=false;pixelMarginRightVal=reliableMarginRightVal=true;if(window.getComputedStyle){divStyle=window.getComputedStyle(div);pixelPositionVal=(divStyle||{}).top!=="1%";reliableMarginLeftVal=(divStyle||{}).marginLeft==="2px";boxSizingReliableVal=(divStyle||{width:"4px"}).width==="4px";div.style.marginRight="50%";pixelMarginRightVal=(divStyle||{marginRight:"4px"}).marginRight==="4px";contents=div.appendChild(document.createElement("div"));contents.style.cssText=div.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0";contents.style.marginRight=contents.style.width="0";div.style.width="1px";reliableMarginRightVal=!parseFloat((window.getComputedStyle(contents)||{}).marginRight);div.removeChild(contents)}div.style.display="none";reliableHiddenOffsetsVal=div.getClientRects().length===0;if(reliableHiddenOffsetsVal){div.style.display="";div.innerHTML="<table><tr><td></td><td>t</td></tr></table>";div.childNodes[0].style.borderCollapse="separate";contents=div.getElementsByTagName("td");contents[0].style.cssText="margin:0;border:0;padding:0;display:none";reliableHiddenOffsetsVal=contents[0].offsetHeight===0;if(reliableHiddenOffsetsVal){contents[0].style.display="";contents[1].style.display="none";reliableHiddenOffsetsVal=contents[0].offsetHeight===0}}documentElement.removeChild(container)}})();var getStyles,curCSS,rposition=/^(top|right|bottom|left)$/;if(window.getComputedStyle){getStyles=function(elem){var view=elem.ownerDocument.defaultView;if(!view||!view.opener){view=window}return view.getComputedStyle(elem)};curCSS=function(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;computed=computed||getStyles(elem);ret=computed?computed.getPropertyValue(name)||computed[name]:undefined;if((ret===""||ret===undefined)&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name)}if(computed){if(!support.pixelMarginRight()&&rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret===undefined?ret:ret+""}}else{if(documentElement.currentStyle){getStyles=function(elem){return elem.currentStyle};curCSS=function(elem,name,computed){var left,rs,rsLeft,ret,style=elem.style;computed=computed||getStyles(elem);ret=computed?computed[name]:undefined;if(ret==null&&style&&style[name]){ret=style[name]}if(rnumnonpx.test(ret)&&!rposition.test(name)){left=style.left;rs=elem.runtimeStyle;rsLeft=rs&&rs.left;if(rsLeft){rs.left=elem.currentStyle.left}style.left=name==="fontSize"?"1em":ret;ret=style.pixelLeft+"px";style.left=left;if(rsLeft){rs.left=rsLeft}}return ret===undefined?ret:ret+""||"auto"}}}function addGetHookIf(conditionFn,hookFn){return{get:function(){if(conditionFn()){delete this.get;return}return(this.get=hookFn).apply(this,arguments)}}}var ralpha=/alpha\([^)]*\)/i,ropacity=/opacity\s*=\s*([^)]*)/i,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rnumsplit=new RegExp("^("+pnum+")(.*)$","i"),cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","O","Moz","ms"],emptyStyle=document.createElement("div").style;function vendorPropName(name){if(name in emptyStyle){return name}var capName=name.charAt(0).toUpperCase()+name.slice(1),i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in emptyStyle){return name}}}function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue}values[index]=jQuery._data(elem,"olddisplay");display=elem.style.display;if(show){if(!values[index]&&display==="none"){elem.style.display=""}if(elem.style.display===""&&isHidden(elem)){values[index]=jQuery._data(elem,"olddisplay",defaultDisplay(elem.nodeName))}}else{hidden=isHidden(elem);if(display&&display!=="none"||!hidden){jQuery._data(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue}if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none"}}return elements}function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true,styles)}if(isBorderBox){if(extra==="content"){val-=jQuery.css(elem,"padding"+cssExpand[i],true,styles)}if(extra!=="margin"){val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}else{val+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);if(extra!=="padding"){val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}}return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=true,val=name==="width"?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box";if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null){val=elem.style[name]}if(rnumnonpx.test(val)){return val}valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===elem.style[name]);val=parseFloat(val)||0}return(val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles))+"px"}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{animationIterationCount:true,columnCount:true,fillOpacity:true,flexGrow:true,flexShrink:true,fontWeight:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(origName)||origName);hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rcssNum.exec(value))&&ret[1]){value=adjustCSS(elem,name,ret);type="number"}if(value==null||value!==value){return}if(type==="number"){value+=ret&&ret[3]||(jQuery.cssNumber[origName]?"":"px")}if(!support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit"}if(!hooks||!("set" in hooks)||(value=hooks.set(elem,value,extra))!==undefined){try{style[name]=value}catch(e){}}}else{if(hooks&&"get" in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,extra,styles){var num,val,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(origName)||origName);hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get" in hooks){val=hooks.get(elem,true,extra)}if(val===undefined){val=curCSS(elem,name,styles)}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name]}if(extra===""||extra){num=parseFloat(val);return extra===true||isFinite(num)?num||0:val}return val}});jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){return rdisplayswap.test(jQuery.css(elem,"display"))&&elem.offsetWidth===0?swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)}},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box",styles):0)}}});if(!support.opacity){jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?(0.01*parseFloat(RegExp.$1))+"":computed?"1":""},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+value*100+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1;if((value>=1||value==="")&&jQuery.trim(filter.replace(ralpha,""))===""&&style.removeAttribute){style.removeAttribute("filter");if(value===""||currentStyle&&!currentStyle.filter){return}}style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity}}}jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(elem,computed){if(computed){return swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"])}});jQuery.cssHooks.marginLeft=addGetHookIf(support.reliableMarginLeft,function(elem,computed){if(computed){return(parseFloat(curCSS(elem,"marginLeft"))||(jQuery.contains(elem.ownerDocument,elem)?elem.getBoundingClientRect().left-swap(elem,{marginLeft:0},function(){return elem.getBoundingClientRect().left}):0))+"px"}});jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0]}return expanded}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber}});jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles)}return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(state){if(typeof state==="boolean"){return state?this.show():this.hide()}return this.each(function(){if(isHidden(this)){jQuery(this).show()}else{jQuery(this).hide()}})}});function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||jQuery.easing._default;this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration)}else{this.pos=eased=percent}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(hooks&&hooks.set){hooks.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem.nodeType!==1||tween.elem[tween.prop]!=null&&tween.elem.style[tween.prop]==null){return tween.elem[tween.prop]}result=jQuery.css(tween.elem,tween.prop,"");return !result||result==="auto"?0:result},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)}else{if(tween.elem.nodeType===1&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}else{tween.elem[tween.prop]=tween.now}}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now}}};jQuery.easing={linear:function(p){return p},swing:function(p){return 0.5-Math.cos(p*Math.PI)/2},_default:"swing"};jQuery.fx=Tween.prototype.init;jQuery.fx.step={};var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rrun=/queueHooks$/;function createFxNow(){window.setTimeout(function(){fxNow=undefined});return(fxNow=jQuery.now())}function genFx(type,includeWidth){var which,attrs={height:type},i=0;includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type}if(includeWidth){attrs.opacity=attrs.width=type}return attrs}function createTween(value,prop,animation){var tween,collection=(Animation.tweeners[prop]||[]).concat(Animation.tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if((tween=collection[index].call(animation,prop,value))){return tween}}}function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,display,checkDisplay,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=jQuery._data(elem,"fxshow");if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire()}}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire()}})})}if(elem.nodeType===1&&("height" in props||"width" in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];display=jQuery.css(elem,"display");checkDisplay=display==="none"?jQuery._data(elem,"olddisplay")||defaultDisplay(elem.nodeName):display;if(checkDisplay==="inline"&&jQuery.css(elem,"float")==="none"){if(!support.inlineBlockNeedsLayout||defaultDisplay(elem.nodeName)==="inline"){style.display="inline-block"}else{style.zoom=1}}}if(opts.overflow){style.overflow="hidden";if(!support.shrinkWrapBlocks()){anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}}for(prop in props){value=props[prop];if(rfxtypes.exec(value)){delete props[prop];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value==="show"&&dataShow&&dataShow[prop]!==undefined){hidden=true}else{continue}}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}else{display=undefined}}if(!jQuery.isEmptyObject(orig)){if(dataShow){if("hidden" in dataShow){hidden=dataShow.hidden}}else{dataShow=jQuery._data(elem,"fxshow",{})}if(toggle){dataShow.hidden=!hidden}if(hidden){jQuery(elem).show()}else{anim.done(function(){jQuery(elem).hide()})}anim.done(function(){var prop;jQuery._removeData(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop])}});for(prop in orig){tween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0}}}}else{if((display==="none"?defaultDisplay(elem.nodeName):display)==="inline"){style.display=display}}}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&"expand" in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}}else{specialEasing[name]=easing}}}function Animation(elem,properties,options){var result,stopped,index=0,length=Animation.prefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped){return false}var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining}else{deferred.resolveWith(elem,[animation]);return false}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{},easing:jQuery.easing._default},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this}stopped=true;for(;index<length;index++){animation.tweens[index].run(1)}if(gotoEnd){deferred.notifyWith(elem,[animation,1,0]);deferred.resolveWith(elem,[animation,gotoEnd])}else{deferred.rejectWith(elem,[animation,gotoEnd])}return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=Animation.prefilters[index].call(animation,elem,props,animation.opts);if(result){if(jQuery.isFunction(result.stop)){jQuery._queueHooks(animation.elem,animation.opts.queue).stop=jQuery.proxy(result.stop,result)}return result}}jQuery.map(props,createTween,animation);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation)}jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}jQuery.Animation=jQuery.extend(Animation,{tweeners:{"*":[function(prop,value){var tween=this.createTween(prop,value);adjustCSS(tween.elem,prop,rcssNum.exec(value),tween);return tween}]},tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"]}else{props=props.match(rnotwhite)}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];Animation.tweeners[prop]=Animation.tweeners[prop]||[];Animation.tweeners[prop].unshift(callback)}},prefilters:[defaultPrefilter],prefilter:function(callback,prepend){if(prepend){Animation.prefilters.unshift(callback)}else{Animation.prefilters.push(callback)}}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx"}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}};return opt};jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty||jQuery._data(this,"finish")){anim.stop(true)}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||"fx",[])}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=jQuery._data(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index])}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index])}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1)}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type)}})},finish:function(type){if(type!==false){type=type||"fx"}return this.each(function(){var index,data=jQuery._data(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true)}for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1)}}for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this)}}delete data.finish})}});jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback)}});jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.timers=[];jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}fxNow=undefined};jQuery.fx.timer=function(timer){jQuery.timers.push(timer);if(timer()){jQuery.fx.start()}else{jQuery.timers.pop()}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=window.setInterval(jQuery.fx.tick,jQuery.fx.interval)}};jQuery.fx.stop=function(){window.clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fn.delay=function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=window.setTimeout(next,time);hooks.stop=function(){window.clearTimeout(timeout)}})};(function(){var a,input=document.createElement("input"),div=document.createElement("div"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));div=document.createElement("div");div.setAttribute("className","t");div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";a=div.getElementsByTagName("a")[0];input.setAttribute("type","checkbox");div.appendChild(input);a=div.getElementsByTagName("a")[0];a.style.cssText="top:1px";support.getSetAttribute=div.className!=="t";support.style=/top/.test(a.getAttribute("style"));support.hrefNormalized=a.getAttribute("href")==="/a";support.checkOn=!!input.value;support.optSelected=opt.selected;support.enctype=!!document.createElement("form").enctype;select.disabled=true;support.optDisabled=!opt.disabled;input=document.createElement("input");input.setAttribute("value","");support.input=input.getAttribute("value")==="";input.value="t";input.setAttribute("type","radio");support.radioValue=input.value==="t"})();var rreturn=/\r/g,rspaces=/[\x20\t\r\n\f]+/g;jQuery.fn.extend({val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get" in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret}return}isFunction=jQuery.isFunction(value);return this.each(function(i){var val;if(this.nodeType!==1){return}if(isFunction){val=value.call(this,i,jQuery(this).val())}else{val=value}if(val==null){val=""}else{if(typeof val==="number"){val+=""}else{if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+""})}}}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set" in hooks)||hooks.set(this,val,"value")===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return val!=null?val:jQuery.trim(jQuery.text(elem)).replace(rspaces," ")}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value}values.push(value)}}return values},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if(jQuery.inArray(jQuery.valHooks.option.get(option),values)>-1){try{option.selected=optionSet=true}catch(_){option.scrollHeight}}else{option.selected=false}}if(!optionSet){elem.selectedIndex=-1}return options}}}});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value)){return(elem.checked=jQuery.inArray(jQuery(elem).val(),value)>-1)}}};if(!support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value}}});var nodeHook,boolHook,attrHandle=jQuery.expr.attrHandle,ruseDefault=/^(?:checked|selected)$/i,getSetAttribute=support.getSetAttribute,getSetInput=support.input;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})}});jQuery.extend({attr:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(nType===3||nType===8||nType===2){return}if(typeof elem.getAttribute==="undefined"){return jQuery.prop(elem,name,value)}if(nType!==1||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name);return}if(hooks&&"set" in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}elem.setAttribute(name,value+"");return value}if(hooks&&"get" in hooks&&(ret=hooks.get(elem,name))!==null){return ret}ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val}return value}}}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(rnotwhite);if(attrNames&&elem.nodeType===1){while((name=attrNames[i++])){propName=jQuery.propFix[name]||name;if(jQuery.expr.match.bool.test(name)){if(getSetInput&&getSetAttribute||!ruseDefault.test(name)){elem[propName]=false}else{elem[jQuery.camelCase("default-"+name)]=elem[propName]=false}}else{jQuery.attr(elem,name,"")}elem.removeAttribute(getSetAttribute?name:propName)}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name)}else{if(getSetInput&&getSetAttribute||!ruseDefault.test(name)){elem.setAttribute(!getSetAttribute&&jQuery.propFix[name]||name,name)}else{elem[jQuery.camelCase("default-"+name)]=elem[name]=true}}return name}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;if(getSetInput&&getSetAttribute||!ruseDefault.test(name)){attrHandle[name]=function(elem,name,isXML){var ret,handle;if(!isXML){handle=attrHandle[name];attrHandle[name]=ret;ret=getter(elem,name,isXML)!=null?name.toLowerCase():null;attrHandle[name]=handle}return ret}}else{attrHandle[name]=function(elem,name,isXML){if(!isXML){return elem[jQuery.camelCase("default-"+name)]?name.toLowerCase():null}}}});if(!getSetInput||!getSetAttribute){jQuery.attrHooks.value={set:function(elem,value,name){if(jQuery.nodeName(elem,"input")){elem.defaultValue=value}else{return nodeHook&&nodeHook.set(elem,value,name)}}}}if(!getSetAttribute){nodeHook={set:function(elem,value,name){var ret=elem.getAttributeNode(name);if(!ret){elem.setAttributeNode((ret=elem.ownerDocument.createAttribute(name)))}ret.value=value+="";if(name==="value"||value===elem.getAttribute(name)){return value}}};attrHandle.id=attrHandle.name=attrHandle.coords=function(elem,name,isXML){var ret;if(!isXML){return(ret=elem.getAttributeNode(name))&&ret.value!==""?ret.value:null}};jQuery.valHooks.button={get:function(elem,name){var ret=elem.getAttributeNode(name);if(ret&&ret.specified){return ret.value}},set:nodeHook.set};jQuery.attrHooks.contenteditable={set:function(elem,value,name){nodeHook.set(elem,value===""?false:value,name)}};jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]={set:function(elem,value){if(value===""){elem.setAttribute(name,"auto");return value}}}})}if(!support.style){jQuery.attrHooks.style={get:function(elem){return elem.style.cssText||undefined},set:function(elem,value){return(elem.style.cssText=value+"")}}}var rfocusable=/^(?:input|select|textarea|button|object)$/i,rclickable=/^(?:a|area)$/i;jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){name=jQuery.propFix[name]||name;return this.each(function(){try{this[name]=undefined;delete this[name]}catch(e){}})}});jQuery.extend({prop:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(nType===3||nType===8||nType===2){return}if(nType!==1||!jQuery.isXMLDoc(elem)){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){if(hooks&&"set" in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}return(elem[name]=value)}if(hooks&&"get" in hooks&&(ret=hooks.get(elem,name))!==null){return ret}return elem[name]},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}});if(!support.hrefNormalized){jQuery.each(["href","src"],function(i,name){jQuery.propHooks[name]={get:function(elem){return elem.getAttribute(name,4)}}})}if(!support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex}}return null},set:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex}}}}}jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});if(!support.enctype){jQuery.propFix.enctype="encoding"}var rclass=/[\t\r\n\f]/g;function getClass(elem){return jQuery.attr(elem,"class")||""}jQuery.fn.extend({addClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,getClass(this)))})}if(typeof value==="string"&&value){classes=value.match(rnotwhite)||[];while((elem=this[i++])){curValue=getClass(elem);cur=elem.nodeType===1&&(" "+curValue+" ").replace(rclass," ");if(cur){j=0;while((clazz=classes[j++])){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" "}}finalValue=jQuery.trim(cur);if(curValue!==finalValue){jQuery.attr(elem,"class",finalValue)}}}}return this},removeClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,getClass(this)))})}if(!arguments.length){return this.attr("class","")}if(typeof value==="string"&&value){classes=value.match(rnotwhite)||[];while((elem=this[i++])){curValue=getClass(elem);cur=elem.nodeType===1&&(" "+curValue+" ").replace(rclass," ");if(cur){j=0;while((clazz=classes[j++])){while(cur.indexOf(" "+clazz+" ")>-1){cur=cur.replace(" "+clazz+" "," ")}}finalValue=jQuery.trim(cur);if(curValue!==finalValue){jQuery.attr(elem,"class",finalValue)}}}}return this},toggleClass:function(value,stateVal){var type=typeof value;if(typeof stateVal==="boolean"&&type==="string"){return stateVal?this.addClass(value):this.removeClass(value)}if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,getClass(this),stateVal),stateVal)})}return this.each(function(){var className,i,self,classNames;if(type==="string"){i=0;self=jQuery(this);classNames=value.match(rnotwhite)||[];while((className=classNames[i++])){if(self.hasClass(className)){self.removeClass(className)}else{self.addClass(className)}}}else{if(value===undefined||type==="boolean"){className=getClass(this);if(className){jQuery._data(this,"__className__",className)}jQuery.attr(this,"class",className||value===false?"":jQuery._data(this,"__className__")||"")}}})},hasClass:function(selector){var className,elem,i=0;className=" "+selector+" ";while((elem=this[i++])){if(elem.nodeType===1&&(" "+getClass(elem)+" ").replace(rclass," ").indexOf(className)>-1){return true}}return false}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)}});var location=window.location;var nonce=jQuery.now();var rquery=(/\?/);var rvalidtokens=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;jQuery.parseJSON=function(data){if(window.JSON&&window.JSON.parse){return window.JSON.parse(data+"")}var requireNonComma,depth=null,str=jQuery.trim(data+"");return str&&!jQuery.trim(str.replace(rvalidtokens,function(token,comma,open,close){if(requireNonComma&&comma){depth=0}if(depth===0){return token}requireNonComma=open||comma;depth+=!close-!open;return""}))?(Function("return "+str))():jQuery.error("Invalid JSON: "+data)};jQuery.parseXML=function(data){var xml,tmp;if(!data||typeof data!=="string"){return null}try{if(window.DOMParser){tmp=new window.DOMParser();xml=tmp.parseFromString(data,"text/xml")}else{xml=new window.ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(data)}}catch(e){xml=undefined}if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data)}return xml};var rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,prefilters={},transports={},allTypes="*/".concat("*"),ajaxLocation=location.href,ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*"}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnotwhite)||[];if(jQuery.isFunction(func)){while((dataType=dataTypes[i++])){if(dataType.charAt(0)==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func)}else{(structure[dataType]=structure[dataType]||[]).push(func)}}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=(structure===transports);function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false}else{if(seekingTransport){return !(selected=dataTypeOrTransport)}}});return selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var deep,key,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:(deep||(deep={})))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}return target}function ajaxHandleResponses(s,jqXHR,responses){var firstDataType,ct,finalDataType,type,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type")}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0] in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv]}}current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response}if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType)}prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev}else{if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2]}else{if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1])}}break}}}}if(conv!==true){if(conv&&s["throws"]){response=conv(response)}else{try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}}}}}}return{state:"success",data:response}}jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var parts,i,cacheURL,responseHeadersString,timeoutTimer,fireGlobals,transport,responseHeaders,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while((match=rheaders.exec(responseHeadersString))){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match==null?null:match},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},overrideMimeType:function(type){if(!state){s.mimeType=type}return this},statusCode:function(map){var code;if(map){if(state<2){for(code in map){statusCode[code]=[statusCode[code],map[code]]}}else{jqXHR.always(map[jqXHR.status])}}return this},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText)}done(0,finalText);return this}};deferred.promise(jqXHR).complete=completeDeferred.add;jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(rnotwhite)||[""];if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?"80":"443"))!==(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443"))))}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR}fireGlobals=jQuery.event&&s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=(s.url+=(rquery.test(cacheURL)?"&":"?")+s.data);delete s.data}if(s.cache===false){s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+nonce++):cacheURL+(rquery.test(cacheURL)?"&":"?")+"_="+nonce++}}if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL])}if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType)}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort()}strAbort="abort";for(i in {success:1,error:1,complete:1}){jqXHR[i](s[i])}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport")}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s])}if(state===2){return jqXHR}if(s.async&&s.timeout>0){timeoutTimer=window.setTimeout(function(){jqXHR.abort("timeout")},s.timeout)}try{state=1;transport.send(requestHeaders,done)}catch(e){if(state<2){done(-1,e)}else{throw e}}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return}state=2;if(timeoutTimer){window.clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses)}response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified}modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified}}if(status===204||s.type==="HEAD"){statusText="nocontent"}else{if(status===304){statusText="notmodified"}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error}}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!(--jQuery.active)){jQuery.event.trigger("ajaxStop")}}}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax(jQuery.extend({url:url,type:method,dataType:type,data:data,success:callback},jQuery.isPlainObject(url)&&url))}});jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",cache:true,async:false,global:false,"throws":true})};jQuery.fn.extend({wrapAll:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))})}if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstChild&&elem.firstChild.nodeType===1){elem=elem.firstChild}return elem}).append(this)}return this},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html)}else{self.append(html)}})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes)}}).end()}});function getDisplay(elem){return elem.style&&elem.style.display||jQuery.css(elem,"display")}function filterHidden(elem){if(!jQuery.contains(elem.ownerDocument||document,elem)){return true}while(elem&&elem.nodeType===1){if(getDisplay(elem)==="none"||elem.type==="hidden"){return true}elem=elem.parentNode}return false}jQuery.expr.filters.hidden=function(elem){return support.reliableHiddenOffsets()?(elem.offsetWidth<=0&&elem.offsetHeight<=0&&!elem.getClientRects().length):filterHidden(elem)};jQuery.expr.filters.visible=function(elem){return !jQuery.expr.filters.hidden(elem)};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"&&v!=null?i:"")+"]",v,traditional,add)}})}else{if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}}jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():(value==null?"":value);s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional}if(jQuery.isArray(a)||(a.jquery&&!jQuery.isPlainObject(a))){jQuery.each(a,function(){add(this.name,this.value)})}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join("&").replace(r20,"+")};jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});jQuery.ajaxSettings.xhr=window.ActiveXObject!==undefined?function(){if(this.isLocal){return createActiveXHR()}if(document.documentMode>8){return createStandardXHR()}return/^(get|post|head|put|delete|options)$/i.test(this.type)&&createStandardXHR()||createActiveXHR()}:createStandardXHR;var xhrId=0,xhrCallbacks={},xhrSupported=jQuery.ajaxSettings.xhr();if(window.attachEvent){window.attachEvent("onunload",function(){for(var key in xhrCallbacks){xhrCallbacks[key](undefined,true)}})}support.cors=!!xhrSupported&&("withCredentials" in xhrSupported);xhrSupported=support.ajax=!!xhrSupported;if(xhrSupported){jQuery.ajaxTransport(function(options){if(!options.crossDomain||support.cors){var callback;return{send:function(headers,complete){var i,xhr=options.xhr(),id=++xhrId;xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i]}}if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType)}if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}for(i in headers){if(headers[i]!==undefined){xhr.setRequestHeader(i,headers[i]+"")}}xhr.send((options.hasContent&&options.data)||null);callback=function(_,isAbort){var status,statusText,responses;if(callback&&(isAbort||xhr.readyState===4)){delete xhrCallbacks[id];callback=undefined;xhr.onreadystatechange=jQuery.noop;if(isAbort){if(xhr.readyState!==4){xhr.abort()}}else{responses={};status=xhr.status;if(typeof xhr.responseText==="string"){responses.text=xhr.responseText}try{statusText=xhr.statusText}catch(e){statusText=""}if(!status&&options.isLocal&&!options.crossDomain){status=responses.text?200:404}else{if(status===1223){status=204}}}}if(responses){complete(status,statusText,responses,xhr.getAllResponseHeaders())}};if(!options.async){callback()}else{if(xhr.readyState===4){window.setTimeout(callback)}else{xhr.onreadystatechange=xhrCallbacks[id]=callback}}},abort:function(){if(callback){callback(undefined,true)}}}}})}function createStandardXHR(){try{return new window.XMLHttpRequest()}catch(e){}}function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type="GET";s.global=false}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||jQuery("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script");script.async=true;if(s.scriptCharset){script.charset=s.scriptCharset}script.src=s.url;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(script.parentNode){script.parentNode.removeChild(script)}script=null;if(!isAbort){callback(200,"success")}}};head.insertBefore(script,head.firstChild)},abort:function(){if(script){script.onload(undefined,true)}}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||(jQuery.expando+"_"+(nonce++));this[callback]=true;return callback}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&(s.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName)}else{if(s.jsonp!==false){s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName}}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called")}return responseContainer[0]};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){if(overwritten===undefined){jQuery(window).removeProp(callbackName)}else{window[callbackName]=overwritten}if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer=overwritten=undefined});return"script"}});jQuery.parseHTML=function(data,context,keepScripts){if(!data||typeof data!=="string"){return null}if(typeof context==="boolean"){keepScripts=context;context=false}context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])]}parsed=buildFragment([data],context,scripts);if(scripts&&scripts.length){jQuery(scripts).remove()}return jQuery.merge([],parsed.childNodes)};var _load=jQuery.fn.load;jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments)}var selector,type,response,self=this,off=url.indexOf(" ");if(off>-1){selector=jQuery.trim(url.slice(off,url.length));url=url.slice(0,off)}if(jQuery.isFunction(params)){callback=params;params=undefined}else{if(params&&typeof params==="object"){type="POST"}}if(self.length>0){jQuery.ajax({url:url,type:type||"GET",dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).always(callback&&function(jqXHR,status){self.each(function(){callback.apply(this,response||[jqXHR.responseText,status,jqXHR])})})}return this};jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}});jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length};function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:false}jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};if(position==="static"){elem.style.position="relative"}curOffset=curElem.offset();curCSSTop=jQuery.css(elem,"top");curCSSLeft=jQuery.css(elem,"left");calculatePosition=(position==="absolute"||position==="fixed")&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(jQuery.isFunction(options)){options=options.call(elem,i,jQuery.extend({},curOffset))}if(options.top!=null){props.top=(options.top-curOffset.top)+curTop}if(options.left!=null){props.left=(options.left-curOffset.left)+curLeft}if("using" in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({offset:function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)})}var docElem,win,box={top:0,left:0},elem=this[0],doc=elem&&elem.ownerDocument;if(!doc){return}docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box}if(typeof elem.getBoundingClientRect!=="undefined"){box=elem.getBoundingClientRect()}win=getWindow(doc);return{top:box.top+(win.pageYOffset||docElem.scrollTop)-(docElem.clientTop||0),left:box.left+(win.pageXOffset||docElem.scrollLeft)-(docElem.clientLeft||0)}},position:function(){if(!this[0]){return}var offsetParent,offset,parentOffset={top:0,left:0},elem=this[0];if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect()}else{offsetParent=this.offsetParent();offset=this.offset();if(!jQuery.nodeName(offsetParent[0],"html")){parentOffset=offsetParent.offset()}parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",true)}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent;while(offsetParent&&(!jQuery.nodeName(offsetParent,"html")&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent}return offsetParent||documentElement})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top=/Y/.test(prop);jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?(prop in win)?win[prop]:win.document.documentElement[method]:elem[method]}if(win){win.scrollTo(!top?val:jQuery(win).scrollLeft(),top?val:jQuery(win).scrollTop())}else{elem[method]=val}},method,val,arguments.length,null)}});jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed}})});jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name]}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})});jQuery.fn.extend({bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn)}});jQuery.fn.size=function(){return this.length};jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof define==="function"&&define.amd){define("jquery",[],function(){return jQuery})}var _jQuery=window.jQuery,_$=window.$;jQuery.noConflict=function(deep){if(window.$===jQuery){window.$=_$}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery};if(!noGlobal){window.jQuery=window.$=jQuery}return jQuery}));(function(_global){var shim={};if(typeof(exports)==="undefined"){if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){shim.exports={};define(function(){return shim.exports})}else{shim.exports=typeof(window)!=="undefined"?window:_global}}else{shim.exports=exports}(function(exports){if(!GLMAT_EPSILON){var GLMAT_EPSILON=0.000001}if(!GLMAT_ARRAY_TYPE){var GLMAT_ARRAY_TYPE=(typeof Float32Array!=="undefined")?Float32Array:Array}var glMatrix={};glMatrix.setMatrixArrayType=function(type){GLMAT_ARRAY_TYPE=type};if(typeof(exports)!=="undefined"){exports.glMatrix=glMatrix}var vec2={};vec2.create=function(){var out=new GLMAT_ARRAY_TYPE(2);out[0]=0;out[1]=0;return out};vec2.clone=function(a){var out=new GLMAT_ARRAY_TYPE(2);out[0]=a[0];out[1]=a[1];return out};vec2.fromValues=function(x,y){var out=new GLMAT_ARRAY_TYPE(2);out[0]=x;out[1]=y;return out};vec2.copy=function(out,a){out[0]=a[0];out[1]=a[1];return out};vec2.set=function(out,x,y){out[0]=x;out[1]=y;return out};vec2.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];return out};vec2.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];return out};vec2.sub=vec2.subtract;vec2.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];return out};vec2.mul=vec2.multiply;vec2.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];return out};vec2.div=vec2.divide;vec2.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);return out};vec2.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);return out};vec2.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;return out};vec2.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+(b[0]*scale);out[1]=a[1]+(b[1]*scale);return out};vec2.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.sqrt(x*x+y*y)};vec2.dist=vec2.distance;vec2.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return x*x+y*y};vec2.sqrDist=vec2.squaredDistance;vec2.length=function(a){var x=a[0],y=a[1];return Math.sqrt(x*x+y*y)};vec2.len=vec2.length;vec2.squaredLength=function(a){var x=a[0],y=a[1];return x*x+y*y};vec2.sqrLen=vec2.squaredLength;vec2.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];return out};vec2.normalize=function(out,a){var x=a[0],y=a[1];var len=x*x+y*y;if(len>0){len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len}return out};vec2.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};vec2.cross=function(out,a,b){var z=a[0]*b[1]-a[1]*b[0];out[0]=out[1]=0;out[2]=z;return out};vec2.lerp=function(out,a,b,t){var ax=a[0],ay=a[1];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);return out};vec2.transformMat2=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y;out[1]=m[1]*x+m[3]*y;return out};vec2.transformMat2d=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y+m[4];out[1]=m[1]*x+m[3]*y+m[5];return out};vec2.transformMat3=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[3]*y+m[6];out[1]=m[1]*x+m[4]*y+m[7];return out};vec2.transformMat4=function(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[4]*y+m[12];out[1]=m[1]*x+m[5]*y+m[13];return out};vec2.forEach=(function(){var vec=vec2.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=2}if(!offset){offset=0}if(count){l=Math.min((count*stride)+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1]}return a}})();vec2.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};if(typeof(exports)!=="undefined"){exports.vec2=vec2}var vec3={};vec3.create=function(){var out=new GLMAT_ARRAY_TYPE(3);out[0]=0;out[1]=0;out[2]=0;return out};vec3.clone=function(a){var out=new GLMAT_ARRAY_TYPE(3);out[0]=a[0];out[1]=a[1];out[2]=a[2];return out};vec3.fromValues=function(x,y,z){var out=new GLMAT_ARRAY_TYPE(3);out[0]=x;out[1]=y;out[2]=z;return out};vec3.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];return out};vec3.set=function(out,x,y,z){out[0]=x;out[1]=y;out[2]=z;return out};vec3.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];return out};vec3.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];return out};vec3.sub=vec3.subtract;vec3.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];return out};vec3.mul=vec3.multiply;vec3.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];return out};vec3.div=vec3.divide;vec3.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);return out};vec3.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);return out};vec3.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;return out};vec3.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+(b[0]*scale);out[1]=a[1]+(b[1]*scale);out[2]=a[2]+(b[2]*scale);return out};vec3.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return Math.sqrt(x*x+y*y+z*z)};vec3.dist=vec3.distance;vec3.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return x*x+y*y+z*z};vec3.sqrDist=vec3.squaredDistance;vec3.length=function(a){var x=a[0],y=a[1],z=a[2];return Math.sqrt(x*x+y*y+z*z)};vec3.len=vec3.length;vec3.squaredLength=function(a){var x=a[0],y=a[1],z=a[2];return x*x+y*y+z*z};vec3.sqrLen=vec3.squaredLength;vec3.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];return out};vec3.normalize=function(out,a){var x=a[0],y=a[1],z=a[2];var len=x*x+y*y+z*z;if(len>0){len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len;out[2]=a[2]*len}return out};vec3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};vec3.cross=function(out,a,b){var ax=a[0],ay=a[1],az=a[2],bx=b[0],by=b[1],bz=b[2];out[0]=ay*bz-az*by;out[1]=az*bx-ax*bz;out[2]=ax*by-ay*bx;return out};vec3.lerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);return out};vec3.transformMat4=function(out,a,m){var x=a[0],y=a[1],z=a[2];out[0]=m[0]*x+m[4]*y+m[8]*z+m[12];out[1]=m[1]*x+m[5]*y+m[9]*z+m[13];out[2]=m[2]*x+m[6]*y+m[10]*z+m[14];return out};vec3.transformMat3=function(out,a,m){var x=a[0],y=a[1],z=a[2];out[0]=x*m[0]+y*m[3]+z*m[6];out[1]=x*m[1]+y*m[4]+z*m[7];out[2]=x*m[2]+y*m[5]+z*m[8];return out};vec3.transformQuat=function(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy;out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz;out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx;return out};vec3.forEach=(function(){var vec=vec3.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=3}if(!offset){offset=0}if(count){l=Math.min((count*stride)+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2]}return a}})();vec3.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};if(typeof(exports)!=="undefined"){exports.vec3=vec3}var vec4={};vec4.create=function(){var out=new GLMAT_ARRAY_TYPE(4);out[0]=0;out[1]=0;out[2]=0;out[3]=0;return out};vec4.clone=function(a){var out=new GLMAT_ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};vec4.fromValues=function(x,y,z,w){var out=new GLMAT_ARRAY_TYPE(4);out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out};vec4.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};vec4.set=function(out,x,y,z,w){out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out};vec4.add=function(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];return out};vec4.subtract=function(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];return out};vec4.sub=vec4.subtract;vec4.multiply=function(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];out[3]=a[3]*b[3];return out};vec4.mul=vec4.multiply;vec4.divide=function(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];out[3]=a[3]/b[3];return out};vec4.div=vec4.divide;vec4.min=function(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);out[3]=Math.min(a[3],b[3]);return out};vec4.max=function(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);out[3]=Math.max(a[3],b[3]);return out};vec4.scale=function(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;return out};vec4.scaleAndAdd=function(out,a,b,scale){out[0]=a[0]+(b[0]*scale);out[1]=a[1]+(b[1]*scale);out[2]=a[2]+(b[2]*scale);out[3]=a[3]+(b[3]*scale);return out};vec4.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return Math.sqrt(x*x+y*y+z*z+w*w)};vec4.dist=vec4.distance;vec4.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return x*x+y*y+z*z+w*w};vec4.sqrDist=vec4.squaredDistance;vec4.length=function(a){var x=a[0],y=a[1],z=a[2],w=a[3];return Math.sqrt(x*x+y*y+z*z+w*w)};vec4.len=vec4.length;vec4.squaredLength=function(a){var x=a[0],y=a[1],z=a[2],w=a[3];return x*x+y*y+z*z+w*w};vec4.sqrLen=vec4.squaredLength;vec4.negate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=-a[3];return out};vec4.normalize=function(out,a){var x=a[0],y=a[1],z=a[2],w=a[3];var len=x*x+y*y+z*z+w*w;if(len>0){len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len;out[2]=a[2]*len;out[3]=a[3]*len}return out};vec4.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};vec4.lerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);out[3]=aw+t*(b[3]-aw);return out};vec4.transformMat4=function(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w;out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w;out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w;out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w;return out};vec4.transformQuat=function(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy;out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz;out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx;return out};vec4.forEach=(function(){var vec=vec4.create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride){stride=4}if(!offset){offset=0}if(count){l=Math.min((count*stride)+offset,a.length)}else{l=a.length}for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];vec[3]=a[i+3];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2];a[i+3]=vec[3]}return a}})();vec4.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};if(typeof(exports)!=="undefined"){exports.vec4=vec4}var mat2={};mat2.create=function(){var out=new GLMAT_ARRAY_TYPE(4);out[0]=1;out[1]=0;out[2]=0;out[3]=1;return out};mat2.clone=function(a){var out=new GLMAT_ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};mat2.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out};mat2.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;return out};mat2.transpose=function(out,a){if(out===a){var a1=a[1];out[1]=a[2];out[2]=a1}else{out[0]=a[0];out[1]=a[2];out[2]=a[1];out[3]=a[3]}return out};mat2.invert=function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],det=a0*a3-a2*a1;if(!det){return null}det=1/det;out[0]=a3*det;out[1]=-a1*det;out[2]=-a2*det;out[3]=a0*det;return out};mat2.adjoint=function(out,a){var a0=a[0];out[0]=a[3];out[1]=-a[1];out[2]=-a[2];out[3]=a0;return out};mat2.determinant=function(a){return a[0]*a[3]-a[2]*a[1]};mat2.multiply=function(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=a0*b0+a1*b2;out[1]=a0*b1+a1*b3;out[2]=a2*b0+a3*b2;out[3]=a2*b1+a3*b3;return out};mat2.mul=mat2.multiply;mat2.rotate=function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],s=Math.sin(rad),c=Math.cos(rad);out[0]=a0*c+a1*s;out[1]=a0*-s+a1*c;out[2]=a2*c+a3*s;out[3]=a2*-s+a3*c;return out};mat2.scale=function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v1;out[2]=a2*v0;out[3]=a3*v1;return out};mat2.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};if(typeof(exports)!=="undefined"){exports.mat2=mat2}var mat2d={};mat2d.create=function(){var out=new GLMAT_ARRAY_TYPE(6);out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;return out};mat2d.clone=function(a){var out=new GLMAT_ARRAY_TYPE(6);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out};mat2d.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out};mat2d.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;return out};mat2d.invert=function(out,a){var aa=a[0],ab=a[1],ac=a[2],ad=a[3],atx=a[4],aty=a[5];var det=aa*ad-ab*ac;if(!det){return null}det=1/det;out[0]=ad*det;out[1]=-ab*det;out[2]=-ac*det;out[3]=aa*det;out[4]=(ac*aty-ad*atx)*det;out[5]=(ab*atx-aa*aty)*det;return out};mat2d.determinant=function(a){return a[0]*a[3]-a[1]*a[2]};mat2d.multiply=function(out,a,b){var aa=a[0],ab=a[1],ac=a[2],ad=a[3],atx=a[4],aty=a[5],ba=b[0],bb=b[1],bc=b[2],bd=b[3],btx=b[4],bty=b[5];out[0]=aa*ba+ab*bc;out[1]=aa*bb+ab*bd;out[2]=ac*ba+ad*bc;out[3]=ac*bb+ad*bd;out[4]=ba*atx+bc*aty+btx;out[5]=bb*atx+bd*aty+bty;return out};mat2d.mul=mat2d.multiply;mat2d.rotate=function(out,a,rad){var aa=a[0],ab=a[1],ac=a[2],ad=a[3],atx=a[4],aty=a[5],st=Math.sin(rad),ct=Math.cos(rad);out[0]=aa*ct+ab*st;out[1]=-aa*st+ab*ct;out[2]=ac*ct+ad*st;out[3]=-ac*st+ct*ad;out[4]=ct*atx+st*aty;out[5]=ct*aty-st*atx;return out};mat2d.scale=function(out,a,v){var vx=v[0],vy=v[1];out[0]=a[0]*vx;out[1]=a[1]*vy;out[2]=a[2]*vx;out[3]=a[3]*vy;out[4]=a[4]*vx;out[5]=a[5]*vy;return out};mat2d.translate=function(out,a,v){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4]+v[0];out[5]=a[5]+v[1];return out};mat2d.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};if(typeof(exports)!=="undefined"){exports.mat2d=mat2d}var mat3={};mat3.create=function(){var out=new GLMAT_ARRAY_TYPE(9);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.fromMat4=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[4];out[4]=a[5];out[5]=a[6];out[6]=a[8];out[7]=a[9];out[8]=a[10];return out};mat3.clone=function(a){var out=new GLMAT_ARRAY_TYPE(9);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out};mat3.transpose=function(out,a){if(out===a){var a01=a[1],a02=a[2],a12=a[5];out[1]=a[3];out[2]=a[6];out[3]=a01;out[5]=a[7];out[6]=a02;out[7]=a12}else{out[0]=a[0];out[1]=a[3];out[2]=a[6];out[3]=a[1];out[4]=a[4];out[5]=a[7];out[6]=a[2];out[7]=a[5];out[8]=a[8]}return out};mat3.invert=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b01=a22*a11-a12*a21,b11=-a22*a10+a12*a20,b21=a21*a10-a11*a20,det=a00*b01+a01*b11+a02*b21;if(!det){return null}det=1/det;out[0]=b01*det;out[1]=(-a22*a01+a02*a21)*det;out[2]=(a12*a01-a02*a11)*det;out[3]=b11*det;out[4]=(a22*a00-a02*a20)*det;out[5]=(-a12*a00+a02*a10)*det;out[6]=b21*det;out[7]=(-a21*a00+a01*a20)*det;out[8]=(a11*a00-a01*a10)*det;return out};mat3.adjoint=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];out[0]=(a11*a22-a12*a21);out[1]=(a02*a21-a01*a22);out[2]=(a01*a12-a02*a11);out[3]=(a12*a20-a10*a22);out[4]=(a00*a22-a02*a20);out[5]=(a02*a10-a00*a12);out[6]=(a10*a21-a11*a20);out[7]=(a01*a20-a00*a21);out[8]=(a00*a11-a01*a10);return out};mat3.determinant=function(a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];return a00*(a22*a11-a12*a21)+a01*(-a22*a10+a12*a20)+a02*(a21*a10-a11*a20)};mat3.multiply=function(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b00=b[0],b01=b[1],b02=b[2],b10=b[3],b11=b[4],b12=b[5],b20=b[6],b21=b[7],b22=b[8];out[0]=b00*a00+b01*a10+b02*a20;out[1]=b00*a01+b01*a11+b02*a21;out[2]=b00*a02+b01*a12+b02*a22;out[3]=b10*a00+b11*a10+b12*a20;out[4]=b10*a01+b11*a11+b12*a21;out[5]=b10*a02+b11*a12+b12*a22;out[6]=b20*a00+b21*a10+b22*a20;out[7]=b20*a01+b21*a11+b22*a21;out[8]=b20*a02+b21*a12+b22*a22;return out};mat3.mul=mat3.multiply;mat3.translate=function(out,a,v){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],x=v[0],y=v[1];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a10;out[4]=a11;out[5]=a12;out[6]=x*a00+y*a10+a20;out[7]=x*a01+y*a11+a21;out[8]=x*a02+y*a12+a22;return out};mat3.rotate=function(out,a,rad){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],s=Math.sin(rad),c=Math.cos(rad);out[0]=c*a00+s*a10;out[1]=c*a01+s*a11;out[2]=c*a02+s*a12;out[3]=c*a10-s*a00;out[4]=c*a11-s*a01;out[5]=c*a12-s*a02;out[6]=a20;out[7]=a21;out[8]=a22;return out};mat3.scale=function(out,a,v){var x=v[0],y=v[1];out[0]=x*a[0];out[1]=x*a[1];out[2]=x*a[2];out[3]=y*a[3];out[4]=y*a[4];out[5]=y*a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out};mat3.fromMat2d=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=0;out[3]=a[2];out[4]=a[3];out[5]=0;out[6]=a[4];out[7]=a[5];out[8]=1;return out};mat3.fromQuat=function(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-(yy+zz);out[3]=xy+wz;out[6]=xz-wy;out[1]=xy-wz;out[4]=1-(xx+zz);out[7]=yz+wx;out[2]=xz+wy;out[5]=yz-wx;out[8]=1-(xx+yy);return out};mat3.normalFromMat4=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a12*b08-a10*b11-a13*b07)*det;out[2]=(a10*b10-a11*b08+a13*b06)*det;out[3]=(a02*b10-a01*b11-a03*b09)*det;out[4]=(a00*b11-a02*b08+a03*b07)*det;out[5]=(a01*b08-a00*b10-a03*b06)*det;out[6]=(a31*b05-a32*b04+a33*b03)*det;out[7]=(a32*b02-a30*b05-a33*b01)*det;out[8]=(a30*b04-a31*b02+a33*b00)*det;return out};mat3.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};if(typeof(exports)!=="undefined"){exports.mat3=mat3}var mat4={};mat4.create=function(){var out=new GLMAT_ARRAY_TYPE(16);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.clone=function(a){var out=new GLMAT_ARRAY_TYPE(16);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.copy=function(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.identity=function(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.transpose=function(out,a){if(out===a){var a01=a[1],a02=a[2],a03=a[3],a12=a[6],a13=a[7],a23=a[11];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a01;out[6]=a[9];out[7]=a[13];out[8]=a02;out[9]=a12;out[11]=a[14];out[12]=a03;out[13]=a13;out[14]=a23}else{out[0]=a[0];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a[1];out[5]=a[5];out[6]=a[9];out[7]=a[13];out[8]=a[2];out[9]=a[6];out[10]=a[10];out[11]=a[14];out[12]=a[3];out[13]=a[7];out[14]=a[11];out[15]=a[15]}return out};mat4.invert=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a02*b10-a01*b11-a03*b09)*det;out[2]=(a31*b05-a32*b04+a33*b03)*det;out[3]=(a22*b04-a21*b05-a23*b03)*det;out[4]=(a12*b08-a10*b11-a13*b07)*det;out[5]=(a00*b11-a02*b08+a03*b07)*det;out[6]=(a32*b02-a30*b05-a33*b01)*det;out[7]=(a20*b05-a22*b02+a23*b01)*det;out[8]=(a10*b10-a11*b08+a13*b06)*det;out[9]=(a01*b08-a00*b10-a03*b06)*det;out[10]=(a30*b04-a31*b02+a33*b00)*det;out[11]=(a21*b02-a20*b04-a23*b00)*det;out[12]=(a11*b07-a10*b09-a12*b06)*det;out[13]=(a00*b09-a01*b07+a02*b06)*det;out[14]=(a31*b01-a30*b03-a32*b00)*det;out[15]=(a20*b03-a21*b01+a22*b00)*det;return out};mat4.adjoint=function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];out[0]=(a11*(a22*a33-a23*a32)-a21*(a12*a33-a13*a32)+a31*(a12*a23-a13*a22));out[1]=-(a01*(a22*a33-a23*a32)-a21*(a02*a33-a03*a32)+a31*(a02*a23-a03*a22));out[2]=(a01*(a12*a33-a13*a32)-a11*(a02*a33-a03*a32)+a31*(a02*a13-a03*a12));out[3]=-(a01*(a12*a23-a13*a22)-a11*(a02*a23-a03*a22)+a21*(a02*a13-a03*a12));out[4]=-(a10*(a22*a33-a23*a32)-a20*(a12*a33-a13*a32)+a30*(a12*a23-a13*a22));out[5]=(a00*(a22*a33-a23*a32)-a20*(a02*a33-a03*a32)+a30*(a02*a23-a03*a22));out[6]=-(a00*(a12*a33-a13*a32)-a10*(a02*a33-a03*a32)+a30*(a02*a13-a03*a12));out[7]=(a00*(a12*a23-a13*a22)-a10*(a02*a23-a03*a22)+a20*(a02*a13-a03*a12));out[8]=(a10*(a21*a33-a23*a31)-a20*(a11*a33-a13*a31)+a30*(a11*a23-a13*a21));out[9]=-(a00*(a21*a33-a23*a31)-a20*(a01*a33-a03*a31)+a30*(a01*a23-a03*a21));out[10]=(a00*(a11*a33-a13*a31)-a10*(a01*a33-a03*a31)+a30*(a01*a13-a03*a11));out[11]=-(a00*(a11*a23-a13*a21)-a10*(a01*a23-a03*a21)+a20*(a01*a13-a03*a11));out[12]=-(a10*(a21*a32-a22*a31)-a20*(a11*a32-a12*a31)+a30*(a11*a22-a12*a21));out[13]=(a00*(a21*a32-a22*a31)-a20*(a01*a32-a02*a31)+a30*(a01*a22-a02*a21));out[14]=-(a00*(a11*a32-a12*a31)-a10*(a01*a32-a02*a31)+a30*(a01*a12-a02*a11));out[15]=(a00*(a11*a22-a12*a21)-a10*(a01*a22-a02*a21)+a20*(a01*a12-a02*a11));return out};mat4.determinant=function(a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32;return b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06};mat4.multiply=function(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=b0*a00+b1*a10+b2*a20+b3*a30;out[1]=b0*a01+b1*a11+b2*a21+b3*a31;out[2]=b0*a02+b1*a12+b2*a22+b3*a32;out[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];out[4]=b0*a00+b1*a10+b2*a20+b3*a30;out[5]=b0*a01+b1*a11+b2*a21+b3*a31;out[6]=b0*a02+b1*a12+b2*a22+b3*a32;out[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];out[8]=b0*a00+b1*a10+b2*a20+b3*a30;out[9]=b0*a01+b1*a11+b2*a21+b3*a31;out[10]=b0*a02+b1*a12+b2*a22+b3*a32;out[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];out[12]=b0*a00+b1*a10+b2*a20+b3*a30;out[13]=b0*a01+b1*a11+b2*a21+b3*a31;out[14]=b0*a02+b1*a12+b2*a22+b3*a32;out[15]=b0*a03+b1*a13+b2*a23+b3*a33;return out};mat4.mul=mat4.multiply;mat4.translate=function(out,a,v){var x=v[0],y=v[1],z=v[2],a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23;if(a===out){out[12]=a[0]*x+a[4]*y+a[8]*z+a[12];out[13]=a[1]*x+a[5]*y+a[9]*z+a[13];out[14]=a[2]*x+a[6]*y+a[10]*z+a[14];out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]}else{a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a03;out[4]=a10;out[5]=a11;out[6]=a12;out[7]=a13;out[8]=a20;out[9]=a21;out[10]=a22;out[11]=a23;out[12]=a00*x+a10*y+a20*z+a[12];out[13]=a01*x+a11*y+a21*z+a[13];out[14]=a02*x+a12*y+a22*z+a[14];out[15]=a03*x+a13*y+a23*z+a[15]}return out};mat4.scale=function(out,a,v){var x=v[0],y=v[1],z=v[2];out[0]=a[0]*x;out[1]=a[1]*x;out[2]=a[2]*x;out[3]=a[3]*x;out[4]=a[4]*y;out[5]=a[5]*y;out[6]=a[6]*y;out[7]=a[7]*y;out[8]=a[8]*z;out[9]=a[9]*z;out[10]=a[10]*z;out[11]=a[11]*z;out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out};mat4.rotate=function(out,a,rad,axis){var x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z),s,c,t,a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,b00,b01,b02,b10,b11,b12,b20,b21,b22;if(Math.abs(len)<GLMAT_EPSILON){return null}len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];b00=x*x*t+c;b01=y*x*t+z*s;b02=z*x*t-y*s;b10=x*y*t-z*s;b11=y*y*t+c;b12=z*y*t+x*s;b20=x*z*t+y*s;b21=y*z*t-x*s;b22=z*z*t+c;out[0]=a00*b00+a10*b01+a20*b02;out[1]=a01*b00+a11*b01+a21*b02;out[2]=a02*b00+a12*b01+a22*b02;out[3]=a03*b00+a13*b01+a23*b02;out[4]=a00*b10+a10*b11+a20*b12;out[5]=a01*b10+a11*b11+a21*b12;out[6]=a02*b10+a12*b11+a22*b12;out[7]=a03*b10+a13*b11+a23*b12;out[8]=a00*b20+a10*b21+a20*b22;out[9]=a01*b20+a11*b21+a21*b22;out[10]=a02*b20+a12*b21+a22*b22;out[11]=a03*b20+a13*b21+a23*b22;if(a!==out){out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}return out};mat4.rotateX=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11];if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[4]=a10*c+a20*s;out[5]=a11*c+a21*s;out[6]=a12*c+a22*s;out[7]=a13*c+a23*s;out[8]=a20*c-a10*s;out[9]=a21*c-a11*s;out[10]=a22*c-a12*s;out[11]=a23*c-a13*s;return out};mat4.rotateY=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a20=a[8],a21=a[9],a22=a[10],a23=a[11];if(a!==out){out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c-a20*s;out[1]=a01*c-a21*s;out[2]=a02*c-a22*s;out[3]=a03*c-a23*s;out[8]=a00*s+a20*c;out[9]=a01*s+a21*c;out[10]=a02*s+a22*c;out[11]=a03*s+a23*c;return out};mat4.rotateZ=function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7];if(a!==out){out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}out[0]=a00*c+a10*s;out[1]=a01*c+a11*s;out[2]=a02*c+a12*s;out[3]=a03*c+a13*s;out[4]=a10*c-a00*s;out[5]=a11*c-a01*s;out[6]=a12*c-a02*s;out[7]=a13*c-a03*s;return out};mat4.fromRotationTranslation=function(out,q,v){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out};mat4.fromQuat=function(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out};mat4.frustum=function(out,left,right,bottom,top,near,far){var rl=1/(right-left),tb=1/(top-bottom),nf=1/(near-far);out[0]=(near*2)*rl;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=(near*2)*tb;out[6]=0;out[7]=0;out[8]=(right+left)*rl;out[9]=(top+bottom)*tb;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=(far*near*2)*nf;out[15]=0;return out};mat4.perspective=function(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2),nf=1/(near-far);out[0]=f/aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=(2*far*near)*nf;out[15]=0;return out};mat4.ortho=function(out,left,right,bottom,top,near,far){var lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=2*nf;out[11]=0;out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=(far+near)*nf;out[15]=1;return out};mat4.lookAt=function(out,eye,center,up){var x0,x1,x2,y0,y1,y2,z0,z1,z2,len,eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],centerx=center[0],centery=center[1],centerz=center[2];if(Math.abs(eyex-centerx)<GLMAT_EPSILON&&Math.abs(eyey-centery)<GLMAT_EPSILON&&Math.abs(eyez-centerz)<GLMAT_EPSILON){return mat4.identity(out)}z0=eyex-centerx;z1=eyey-centery;z2=eyez-centerz;len=1/Math.sqrt(z0*z0+z1*z1+z2*z2);z0*=len;z1*=len;z2*=len;x0=upy*z2-upz*z1;x1=upz*z0-upx*z2;x2=upx*z1-upy*z0;len=Math.sqrt(x0*x0+x1*x1+x2*x2);if(!len){x0=0;x1=0;x2=0}else{len=1/len;x0*=len;x1*=len;x2*=len}y0=z1*x2-z2*x1;y1=z2*x0-z0*x2;y2=z0*x1-z1*x0;len=Math.sqrt(y0*y0+y1*y1+y2*y2);if(!len){y0=0;y1=0;y2=0}else{len=1/len;y0*=len;y1*=len;y2*=len}out[0]=x0;out[1]=y0;out[2]=z0;out[3]=0;out[4]=x1;out[5]=y1;out[6]=z1;out[7]=0;out[8]=x2;out[9]=y2;out[10]=z2;out[11]=0;out[12]=-(x0*eyex+x1*eyey+x2*eyez);out[13]=-(y0*eyex+y1*eyey+y2*eyez);out[14]=-(z0*eyex+z1*eyey+z2*eyez);out[15]=1;return out};mat4.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};if(typeof(exports)!=="undefined"){exports.mat4=mat4}var quat={};quat.create=function(){var out=new GLMAT_ARRAY_TYPE(4);out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out};quat.rotationTo=(function(){var tmpvec3=vec3.create();var xUnitVec3=vec3.fromValues(1,0,0);var yUnitVec3=vec3.fromValues(0,1,0);return function(out,a,b){var dot=vec3.dot(a,b);if(dot<-0.999999){vec3.cross(tmpvec3,xUnitVec3,a);if(vec3.length(tmpvec3)<0.000001){vec3.cross(tmpvec3,yUnitVec3,a)}vec3.normalize(tmpvec3,tmpvec3);quat.setAxisAngle(out,tmpvec3,Math.PI);return out}else{if(dot>0.999999){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out}else{vec3.cross(tmpvec3,a,b);out[0]=tmpvec3[0];out[1]=tmpvec3[1];out[2]=tmpvec3[2];out[3]=1+dot;return quat.normalize(out,out)}}}})();quat.setAxes=(function(){var matr=mat3.create();return function(out,view,right,up){matr[0]=right[0];matr[3]=right[1];matr[6]=right[2];matr[1]=up[0];matr[4]=up[1];matr[7]=up[2];matr[2]=view[0];matr[5]=view[1];matr[8]=view[2];return quat.normalize(out,quat.fromMat3(out,matr))}})();quat.clone=vec4.clone;quat.fromValues=vec4.fromValues;quat.copy=vec4.copy;quat.set=vec4.set;quat.identity=function(out){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out};quat.setAxisAngle=function(out,axis,rad){rad=rad*0.5;var s=Math.sin(rad);out[0]=s*axis[0];out[1]=s*axis[1];out[2]=s*axis[2];out[3]=Math.cos(rad);return out};quat.add=vec4.add;quat.multiply=function(out,a,b){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];out[0]=ax*bw+aw*bx+ay*bz-az*by;out[1]=ay*bw+aw*by+az*bx-ax*bz;out[2]=az*bw+aw*bz+ax*by-ay*bx;out[3]=aw*bw-ax*bx-ay*by-az*bz;return out};quat.mul=quat.multiply;quat.scale=vec4.scale;quat.rotateX=function(out,a,rad){rad*=0.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+aw*bx;out[1]=ay*bw+az*bx;out[2]=az*bw-ay*bx;out[3]=aw*bw-ax*bx;return out};quat.rotateY=function(out,a,rad){rad*=0.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],by=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw-az*by;out[1]=ay*bw+aw*by;out[2]=az*bw+ax*by;out[3]=aw*bw-ay*by;return out};quat.rotateZ=function(out,a,rad){rad*=0.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bz=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+ay*bz;out[1]=ay*bw-ax*bz;out[2]=az*bw+aw*bz;out[3]=aw*bw-az*bz;return out};quat.calculateW=function(out,a){var x=a[0],y=a[1],z=a[2];out[0]=x;out[1]=y;out[2]=z;out[3]=-Math.sqrt(Math.abs(1-x*x-y*y-z*z));return out};quat.dot=vec4.dot;quat.lerp=vec4.lerp;quat.slerp=function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];var omega,cosom,sinom,scale0,scale1;cosom=ax*bx+ay*by+az*bz+aw*bw;if(cosom<0){cosom=-cosom;bx=-bx;by=-by;bz=-bz;bw=-bw}if((1-cosom)>0.000001){omega=Math.acos(cosom);sinom=Math.sin(omega);scale0=Math.sin((1-t)*omega)/sinom;scale1=Math.sin(t*omega)/sinom}else{scale0=1-t;scale1=t}out[0]=scale0*ax+scale1*bx;out[1]=scale0*ay+scale1*by;out[2]=scale0*az+scale1*bz;out[3]=scale0*aw+scale1*bw;return out};quat.invert=function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],dot=a0*a0+a1*a1+a2*a2+a3*a3,invDot=dot?1/dot:0;out[0]=-a0*invDot;out[1]=-a1*invDot;out[2]=-a2*invDot;out[3]=a3*invDot;return out};quat.conjugate=function(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=a[3];return out};quat.length=vec4.length;quat.len=quat.length;quat.squaredLength=vec4.squaredLength;quat.sqrLen=quat.squaredLength;quat.normalize=vec4.normalize;quat.fromMat3=(function(){var s_iNext=(typeof(Int8Array)!=="undefined"?new Int8Array([1,2,0]):[1,2,0]);return function(out,m){var fTrace=m[0]+m[4]+m[8];var fRoot;if(fTrace>0){fRoot=Math.sqrt(fTrace+1);out[3]=0.5*fRoot;fRoot=0.5/fRoot;out[0]=(m[7]-m[5])*fRoot;out[1]=(m[2]-m[6])*fRoot;out[2]=(m[3]-m[1])*fRoot}else{var i=0;if(m[4]>m[0]){i=1}if(m[8]>m[i*3+i]){i=2}var j=s_iNext[i];var k=s_iNext[j];fRoot=Math.sqrt(m[i*3+i]-m[j*3+j]-m[k*3+k]+1);out[i]=0.5*fRoot;fRoot=0.5/fRoot;out[3]=(m[k*3+j]-m[j*3+k])*fRoot;out[j]=(m[j*3+i]+m[i*3+j])*fRoot;out[k]=(m[k*3+i]+m[i*3+k])*fRoot}return out}})();quat.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};if(typeof(exports)!=="undefined"){exports.quat=quat}})(shim.exports)})(this);(function(){vec2.equalish=function(a,b){return Math.abs(a[0]-b[0])<Math.EPSILON&&Math.abs(a[1]-b[1])<Math.EPSILON};vec3.equalish=function(a,b){return Math.abs(a[0]-b[0])<Math.EPSILON&&Math.abs(a[1]-b[1])<Math.EPSILON&&Math.abs(a[2]-b[2])<Math.EPSILON};vec4.equalish=mat2.equalish=quat.equalish=function(a,b){return Math.abs(a[0]-b[0])<Math.EPSILON&&Math.abs(a[1]-b[1])<Math.EPSILON&&Math.abs(a[2]-b[2])<Math.EPSILON&&Math.abs(a[3]-b[3])<Math.EPSILON};mat2d.equalish=function(a,b){return Math.abs(a[0]-b[0])<Math.EPSILON&&Math.abs(a[1]-b[1])<Math.EPSILON&&Math.abs(a[2]-b[2])<Math.EPSILON&&Math.abs(a[3]-b[3])<Math.EPSILON&&Math.abs(a[4]-b[4])<Math.EPSILON&&Math.abs(a[5]-b[5])<Math.EPSILON};mat3.equalish=function(a,b){return Math.abs(a[0]-b[0])<Math.EPSILON&&Math.abs(a[1]-b[1])<Math.EPSILON&&Math.abs(a[2]-b[2])<Math.EPSILON&&Math.abs(a[3]-b[3])<Math.EPSILON&&Math.abs(a[4]-b[4])<Math.EPSILON&&Math.abs(a[5]-b[5])<Math.EPSILON&&Math.abs(a[6]-b[6])<Math.EPSILON&&Math.abs(a[7]-b[7])<Math.EPSILON&&Math.abs(a[8]-b[8])<Math.EPSILON};mat4.equalish=function(a,b){return Math.abs(a[0]-b[0])<Math.EPSILON&&Math.abs(a[1]-b[1])<Math.EPSILON&&Math.abs(a[2]-b[2])<Math.EPSILON&&Math.abs(a[3]-b[3])<Math.EPSILON&&Math.abs(a[4]-b[4])<Math.EPSILON&&Math.abs(a[5]-b[5])<Math.EPSILON&&Math.abs(a[6]-b[6])<Math.EPSILON&&Math.abs(a[7]-b[7])<Math.EPSILON&&Math.abs(a[8]-b[8])<Math.EPSILON&&Math.abs(a[9]-b[9])<Math.EPSILON&&Math.abs(a[10]-b[10])<Math.EPSILON&&Math.abs(a[11]-b[11])<Math.EPSILON&&Math.abs(a[12]-b[12])<Math.EPSILON&&Math.abs(a[13]-b[13])<Math.EPSILON&&Math.abs(a[14]-b[14])<Math.EPSILON&&Math.abs(a[15]-b[15])<Math.EPSILON};mat4.IDENTITY=mat4.identity(mat4.create());quat.IDENTITY=quat.identity(quat.create());vec3.UNIT_X=vec3.fromValues(1,0,0);vec3.UNIT_Y=vec3.fromValues(0,1,0);vec3.UNIT_Z=vec3.fromValues(0,0,1)}).call(this);(function(){}).call(this);var Jax={PRODUCTION:1,webgl_not_supported_path:null,Mixins:{},shaderTemplates:{},getGlobal:function(){return window},reraise:function(original_error,new_error){if(original_error._stack){new_error._stack=original_error._stack}else{if(original_error.stack){new_error._stack=original_error.stack}}throw new_error},click_speed:0.2};(function(){var guid=0;Jax.guid=function(){return guid++}})();Jax.default_shader="basic";Jax.shaders={};Jax._shader_data={};Jax.import_shader_code=function(shader_name,shader_type){return Jax.shader_data(shader_name)[shader_type]};Jax.shader_data=function(name){Jax._shader_data[name]=Jax._shader_data[name]||{name:name};return Jax._shader_data[name]};Jax.loaded=true;Jax.update_speed=33;Jax.max_lights=undefined;Jax.uptime=0;Jax.VERSION="3.0.0.rc3";(function(){var i,lastTime,len,vendor,vendors;lastTime=0;vendors=["ms","moz","webkit","o"];this.cancelAnimationFrame||(this.cancelAnimationFrame=this.cancelRequestAnimationFrame);if(!this.requestAnimationFrame){for(i=0,len=vendors.length;i<len;i++){vendor=vendors[i];this.requestAnimationFrame||(this.requestAnimationFrame=this[vendor+"RequestAnimationFrame"]);this.cancelAnimationFrame=this.cancelRequestAnimationFrame||(this.cancelRequestAnimationFrame=this[vendor+"CancelRequestAnimationFrame"])}}if(!this.requestAnimationFrame){this.requestAnimationFrame=function(callback,element){var currTime,id,timeToCall;currTime=new Date().getTime();timeToCall=Math.max(0,16-(currTime-lastTime));id=this.setTimeout((function(){return callback(currTime+timeToCall)}),timeToCall);lastTime=currTime+timeToCall;return id}}if(!this.cancelAnimationFrame){this.cancelAnimationFrame=this.cancelRequestAnimationFrame=function(id){return clearTimeout(id)}}}).call(this);Jax.Buffer=(function(){function each_gl_buffer(self,func){for(var id in self.gl){func(self.gl[id].context,self.gl[id].buffer)}}function Buffer(bufferType,deprecated,drawType,jsarr,itemSize,dataType){if(!itemSize){throw new Error("Expected an itemSize - how many JS array elements represent a single buffered element?")}this.itemSize=itemSize;this.js=jsarr;this.gl={};this.numItems=this.length=jsarr.length/itemSize;this.bufferType=bufferType;this.drawType=drawType;if(dataType){this.dataType=dataType}else{if(jsarr instanceof Float32Array){this.dataType=GL_FLOAT}}if(jsarr instanceof Uint8Array){this.dataType=GL_UNSIGNED_BYTE}if(jsarr instanceof Uint16Array){this.dataType=GL_UNSIGNED_SHORT}if(jsarr instanceof Uint32Array){this.dataType=GL_UNSIGNED_INT}if(!this.dataType){throw new Error("Couldn't detect dataType")}}jQuery.extend(Buffer.prototype,{refresh:function(){var self=this;var instance=this.refreshTypedArray();if(!self.gl){return}each_gl_buffer(self,function(context,buffer){context.renderer.bindBuffer(self.bufferType,buffer);context.renderer.bufferData(self.bufferType,instance,self.drawType)});return this},refreshTypedArray:function(){var self=this;var instance=this.js;self.numItems=self.length=self.js.length/self.itemSize;return instance},dispose:function(){var self=this;each_gl_buffer(this,function(context,buffer){context.renderer.deleteBuffer(buffer);self.gl[context.id]=null});self.gl={};return self},isDisposed:function(){return !this.gl},bind:function(context){context.renderer.bindBuffer(this.bufferType,this.getGLBuffer(context));return this},getGLBuffer:function(context){if(!context||typeof(context.id)=="undefined"){throw new Error("Cannot build a buffer without a context!")}if(!this.gl[context.id]){var buffer=context.renderer.createBuffer();buffer.itemSize=this.itemSize;this.gl[context.id]={context:context,buffer:buffer};this.refresh()}return this.gl[context.id].buffer}});return Buffer})();(function(){var slice=[].slice;Function.prototype.define=function(prop,desc){return Object.defineProperty(this.prototype,prop,desc)};Function.prototype.setter=function(prop,setter){return Object.defineProperty(this.prototype,prop,{set:setter})};Function.prototype.getter=function(prop,getter){return Object.defineProperty(this.prototype,prop,{get:getter})};Function.prototype.accessor=function(prop,setter,getter){return Object.defineProperty(this.prototype,prop,{get:getter,set:setter})};Function.prototype.extend=function(){var i,len,method,mixin,mixins,name,results;mixins=1<=arguments.length?slice.call(arguments,0):[];results=[];for(i=0,len=mixins.length;i<len;i++){mixin=mixins[i];results.push((function(){var results1;results1=[];for(name in mixin){method=mixin[name];if(!this.hasOwnProperty(name)){results1.push(this[name]=method)}else{results1.push(void 0)}}return results1}).call(this))}return results};Function.prototype.include=function(){var mixins;mixins=1<=arguments.length?slice.call(arguments,0):[];return Function.prototype.extend.apply(this.prototype,mixins)}}).call(this);if(typeof(KeyEvent)=="undefined"){KeyEvent={fake:true,DOM_VK_CANCEL:3,DOM_VK_HELP:6,DOM_VK_BACK_SPACE:8,DOM_VK_TAB:9,DOM_VK_CLEAR:12,DOM_VK_RETURN:13,DOM_VK_ENTER:14,DOM_VK_SHIFT:16,DOM_VK_CONTROL:17,DOM_VK_ALT:18,DOM_VK_PAUSE:19,DOM_VK_CAPS_LOCK:20,DOM_VK_ESCAPE:27,DOM_VK_SPACE:32,DOM_VK_PAGE_UP:33,DOM_VK_PAGE_DOWN:34,DOM_VK_END:35,DOM_VK_HOME:36,DOM_VK_LEFT:37,DOM_VK_UP:38,DOM_VK_RIGHT:39,DOM_VK_DOWN:40,DOM_VK_PRINTSCREEN:44,DOM_VK_INSERT:45,DOM_VK_DELETE:46,DOM_VK_0:48,DOM_VK_1:49,DOM_VK_2:50,DOM_VK_3:51,DOM_VK_4:52,DOM_VK_5:53,DOM_VK_6:54,DOM_VK_7:55,DOM_VK_8:56,DOM_VK_9:57,DOM_VK_SEMICOLON:59,DOM_VK_EQUALS:61,DOM_VK_A:65,DOM_VK_B:66,DOM_VK_C:67,DOM_VK_D:68,DOM_VK_E:69,DOM_VK_F:70,DOM_VK_G:71,DOM_VK_H:72,DOM_VK_I:73,DOM_VK_J:74,DOM_VK_K:75,DOM_VK_L:76,DOM_VK_M:77,DOM_VK_N:78,DOM_VK_O:79,DOM_VK_P:80,DOM_VK_Q:81,DOM_VK_R:82,DOM_VK_S:83,DOM_VK_T:84,DOM_VK_U:85,DOM_VK_V:86,DOM_VK_W:87,DOM_VK_X:88,DOM_VK_Y:89,DOM_VK_Z:90,DOM_VK_CONTEXT_MENU:93,DOM_VK_NUMPAD0:96,DOM_VK_NUMPAD1:97,DOM_VK_NUMPAD2:98,DOM_VK_NUMPAD3:99,DOM_VK_NUMPAD4:100,DOM_VK_NUMPAD5:101,DOM_VK_NUMPAD6:102,DOM_VK_NUMPAD7:103,DOM_VK_NUMPAD8:104,DOM_VK_NUMPAD9:105,DOM_VK_MULTIPLY:106,DOM_VK_ADD:107,DOM_VK_SEPARATOR:108,DOM_VK_SUBTRACT:109,DOM_VK_DECIMAL:110,DOM_VK_DIVIDE:111,DOM_VK_F1:112,DOM_VK_F2:113,DOM_VK_F3:114,DOM_VK_F4:115,DOM_VK_F5:116,DOM_VK_F6:117,DOM_VK_F7:118,DOM_VK_F8:119,DOM_VK_F9:120,DOM_VK_F10:121,DOM_VK_F11:122,DOM_VK_F12:123,DOM_VK_F13:124,DOM_VK_F14:125,DOM_VK_F15:126,DOM_VK_F16:127,DOM_VK_F17:128,DOM_VK_F18:129,DOM_VK_F19:130,DOM_VK_F20:131,DOM_VK_F21:132,DOM_VK_F22:133,DOM_VK_F23:134,DOM_VK_F24:135,DOM_VK_NUM_LOCK:144,DOM_VK_SCROLL_LOCK:145,DOM_VK_COMMA:188,DOM_VK_PERIOD:190,DOM_VK_SLASH:191,DOM_VK_BACK_QUOTE:192,DOM_VK_OPEN_BRACKET:219,DOM_VK_BACK_SLASH:220,DOM_VK_CLOSE_BRACKET:221,DOM_VK_QUOTE:222,DOM_VK_META:224}}(function(){var JaxError,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;JaxError=(function(superClass){extend(JaxError,superClass);function JaxError(){var err;err=new Error();this.name=err.name=this.__proto__.constructor.name;if(err.stack){this.stack=err.stack}}return JaxError})(Error);Jax.Error=JaxError}).call(this);Jax.Framebuffer=(function(){function build(context,self){var handle=context.renderer.createFramebuffer();var width=self.options.width,height=self.options.height;self.setHandle(context,handle);context.renderer.bindFramebuffer(GL_FRAMEBUFFER,handle);if(self.options.depth&&self.options.stencil){handle.depthstencilbuffer=context.renderer.createRenderbuffer();context.renderer.bindRenderbuffer(GL_RENDERBUFFER,handle.depthstencilbuffer);context.renderer.renderbufferStorage(GL_RENDERBUFFER,GL_DEPTH_STENCIL,width,height);context.renderer.framebufferRenderbuffer(GL_FRAMEBUFFER,GL_DEPTH_STENCIL_ATTACHMENT,GL_RENDERBUFFER,handle.depthstencilbuffer);context.renderer.bindRenderbuffer(GL_RENDERBUFFER,null)}if(self.options.depth&&!self.options.stencil){handle.depthbuffer=context.renderer.createRenderbuffer();context.renderer.bindRenderbuffer(GL_RENDERBUFFER,handle.depthbuffer);context.renderer.renderbufferStorage(GL_RENDERBUFFER,GL_DEPTH_COMPONENT16,width,height);context.renderer.framebufferRenderbuffer(GL_FRAMEBUFFER,GL_DEPTH_ATTACHMENT,GL_RENDERBUFFER,handle.depthbuffer);context.renderer.bindRenderbuffer(GL_RENDERBUFFER,null)}if(self.options.stencil&&!self.options.depth){handle.stencilbuffer=context.renderer.createRenderbuffer();context.renderer.bindRenderbuffer(GL_RENDERBUFFER,handle.stencilbuffer);context.renderer.renderbufferStorage(GL_RENDERBUFFER,GL_STENCIL_INDEX8,width,height);context.renderer.framebufferRenderbuffer(GL_FRAMEBUFFER,GL_STENCIL_ATTACHMENT,GL_RENDERBUFFER,handle.stencilbuffer);context.renderer.bindRenderbuffer(GL_RENDERBUFFER,null)}handle.textures=[];var attachment=GL_COLOR_ATTACHMENT0;for(var i=0;i<self.options.colors.length;i++){var format=self.options.colors[i];if(self.options.colors[i] instanceof Jax.Texture){handle.textures[i]=self.options.colors[i]}else{var texture_options={format:GL_RGBA,width:width,height:height,min_filter:self.options.min_filter,mag_filter:self.options.mag_filter,wrap_s:self.options.wrap_s,wrap_t:self.options.wrap_t,generate_mipmap:self.options.generate_mipmap,data_type:self.options.data_type};if(typeof(format)!="number"){texture_options=Jax.Util.merge(format,texture_options)}else{texture_options.format=format}handle.textures[i]=new Jax.Texture(texture_options)}if(handle.textures[i].get("target")==GL_TEXTURE_2D){var handle;if(handle=handle.textures[i].validate(context)){context.renderer.framebufferTexture2D(GL_FRAMEBUFFER,attachment,GL_TEXTURE_2D,handle,0)}}else{context.renderer.framebufferTexture2D(GL_FRAMEBUFFER,attachment,GL_TEXTURE_CUBE_MAP_POSITIVE_X,handle.textures[i].getHandle(context),0)}attachment++}try{checkStatus(context,self)}catch(e){self.dispose(context);throw e}}function checkStatus(context,self){var status=context.renderer.checkFramebufferStatus(GL_FRAMEBUFFER);self.unbind(context);switch(status){case GL_FRAMEBUFFER_COMPLETE:break;case GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("Jax.Framebuffer: one or more attachments is incomplete. (GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT)");case GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("Jax.Framebuffer: there are no images attached to the framebuffer. (GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT)");case GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("Jax.Framebuffer: all attachments must have the same dimensions. (GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS)");case GL_FRAMEBUFFER_UNSUPPORTED:throw new Error("Jax.Framebuffer: the requested framebuffer layout is unsupported on this hardware. (GL_FRAMEBUFFER_UNSUPPORTED)");case (Jax.getGlobal()["GL_FRAMEBUFFER_INCOMPLETE_DRAW_BUFFER"]||36059):throw new Error("Jax.Framebuffer: make sure the framebuffer has at least 1 texture attachment. (GL_FRAMEBUFFER_INCOMPLETE_DRAW_BUFFER)");default:var which;for(which in context.renderer){if(context.renderer[which]==status){throw new Error("Jax.Framebuffer: an unknown error occurred. ("+status+" - "+which+")")}}throw new Error("Jax.Framebuffer: an unknown error occurred. ("+status+")")}}function Framebuffer(options){var defaults={depth:false,stencil:false,width:512,height:512,data_type:GL_UNSIGNED_BYTE,min_filter:GL_LINEAR,mag_filter:GL_LINEAR,wrap_s:GL_CLAMP_TO_EDGE,wrap_t:GL_CLAMP_TO_EDGE,generate_mipmap:false};if(!(options&&(options.color||options.colors))){defaults.colors=[GL_RGBA]}this.handles={};this.options=options=Jax.Util.merge(options,defaults);if(options.color!=undefined){if(options.colors!=undefined){options.colors.push(options.color)}else{options.colors=[options.color]}delete options.color}}jQuery.extend(Framebuffer.prototype,{dispose:function(context){if(!this.handles){return}var handle=this.getHandle(context);if(!handle){return}if(handle.stencilbuffer){context.renderer.deleteRenderbuffer(handle.stencilbuffer);delete handle.stencilbuffer}if(handle.depthbuffer){context.renderer.deleteRenderbuffer(handle.depthbuffer);delete handle.depthbuffer}if(handle.depthstencilbuffer){context.renderer.deleteRenderbuffer(handle.depthstencilbuffer);delete handle.depthstencilbuffer}if(handle.textures){while(handle.textures.length>0){handle.textures[0].dispose(context);handle.textures.splice(0,1)}delete handle.textures}context.renderer.deleteFramebuffer(handle);this.setHandle(context,null)},bindCubeFace:function(context,texIndex,faceEnum,callback){var texture=this.getTexture(context,texIndex);if(texture.options.target!=GL_TEXTURE_CUBE_MAP){throw new Error("Texture at index "+texIndex+" is not a cube map!")}this.bind(context);context.renderer.framebufferTexture2D(GL_FRAMEBUFFER,window["GL_COLOR_ATTACHMENT"+texIndex],faceEnum,texture.getHandle(context),0);if(callback){callback();this.unbind(context)}return this},bind:function(context,callback){this.validate(context);context.renderer.bindFramebuffer(GL_FRAMEBUFFER,this.getHandle(context));if(callback){callback.call(this);this.unbind(context)}return this},validate:function(context){if(!this.getHandle(context)){build(context,this)}return this},countTextures:function(context){return this.validate().getHandle(context).textures.length},unbind:function(context){context.renderer.bindFramebuffer(GL_FRAMEBUFFER,null);return this},viewport:function(context){context.renderer.viewport(0,0,this.options.width,this.options.height);return this},getDepthTexture:function(context){this.validate(context);return this.depthTexture},getStencilTexture:function(context){this.validate(context);return self.stencilTexture},getTexture:function(context,index){this.validate(context);return this.getHandle(context).textures[index||0]},getTextureHandle:function(context,index){return this.getTexture(context,index).getHandle(context)},getHandle:function(context){return this.handles[context.id]},setHandle:function(context,handle){if(handle){this.handles[context.id]=handle}else{if(this.handles[context.id]){delete this.handles[context.id]}}return this}});return Framebuffer})();(function(){var _global;_global=Jax.getGlobal();_global.GL_DEPTH_BUFFER_BIT=256;_global.GL_STENCIL_BUFFER_BIT=1024;_global.GL_COLOR_BUFFER_BIT=16384;_global.GL_POINTS=0;_global.GL_LINES=1;_global.GL_LINE_LOOP=2;_global.GL_LINE_STRIP=3;_global.GL_TRIANGLES=4;_global.GL_TRIANGLE_STRIP=5;_global.GL_TRIANGLE_FAN=6;_global.GL_ZERO=0;_global.GL_ONE=1;_global.GL_SRC_COLOR=768;_global.GL_ONE_MINUS_SRC_COLOR=769;_global.GL_SRC_ALPHA=770;_global.GL_ONE_MINUS_SRC_ALPHA=771;_global.GL_DST_ALPHA=772;_global.GL_ONE_MINUS_DST_ALPHA=773;_global.GL_DST_COLOR=774;_global.GL_ONE_MINUS_DST_COLOR=775;_global.GL_SRC_ALPHA_SATURATE=776;_global.GL_FUNC_ADD=32774;_global.GL_BLEND_EQUATION=32777;_global.GL_BLEND_EQUATION_RGB=32777;_global.GL_BLEND_EQUATION_ALPHA=34877;_global.GL_FUNC_SUBTRACT=32778;_global.GL_FUNC_REVERSE_SUBTRACT=32779;_global.GL_BLEND_DST_RGB=32968;_global.GL_BLEND_SRC_RGB=32969;_global.GL_BLEND_DST_ALPHA=32970;_global.GL_BLEND_SRC_ALPHA=32971;_global.GL_CONSTANT_COLOR=32769;_global.GL_ONE_MINUS_CONSTANT_COLOR=32770;_global.GL_CONSTANT_ALPHA=32771;_global.GL_ONE_MINUS_CONSTANT_ALPHA=32772;_global.GL_BLEND_COLOR=32773;_global.GL_ARRAY_BUFFER=34962;_global.GL_ELEMENT_ARRAY_BUFFER=34963;_global.GL_ARRAY_BUFFER_BINDING=34964;_global.GL_ELEMENT_ARRAY_BUFFER_BINDING=34965;_global.GL_STREAM_DRAW=35040;_global.GL_STATIC_DRAW=35044;_global.GL_DYNAMIC_DRAW=35048;_global.GL_BUFFER_SIZE=34660;_global.GL_BUFFER_USAGE=34661;_global.GL_CURRENT_VERTEX_ATTRIB=34342;_global.GL_FRONT=1028;_global.GL_BACK=1029;_global.GL_FRONT_AND_BACK=1032;_global.GL_CULL_FACE=2884;_global.GL_BLEND=3042;_global.GL_DITHER=3024;_global.GL_STENCIL_TEST=2960;_global.GL_DEPTH_TEST=2929;_global.GL_SCISSOR_TEST=3089;_global.GL_POLYGON_OFFSET_FILL=32823;_global.GL_SAMPLE_ALPHA_TO_COVERAGE=32926;_global.GL_SAMPLE_COVERAGE=32928;_global.GL_NO_ERROR=0;_global.GL_INVALID_ENUM=1280;_global.GL_INVALID_VALUE=1281;_global.GL_INVALID_OPERATION=1282;_global.GL_OUT_OF_MEMORY=1285;_global.GL_CW=2304;_global.GL_CCW=2305;_global.GL_LINE_WIDTH=2849;_global.GL_ALIASED_POINT_SIZE_RANGE=33901;_global.GL_ALIASED_LINE_WIDTH_RANGE=33902;_global.GL_CULL_FACE_MODE=2885;_global.GL_FRONT_FACE=2886;_global.GL_DEPTH_RANGE=2928;_global.GL_DEPTH_WRITEMASK=2930;_global.GL_DEPTH_CLEAR_VALUE=2931;_global.GL_DEPTH_FUNC=2932;_global.GL_STENCIL_CLEAR_VALUE=2961;_global.GL_STENCIL_FUNC=2962;_global.GL_STENCIL_FAIL=2964;_global.GL_STENCIL_PASS_DEPTH_FAIL=2965;_global.GL_STENCIL_PASS_DEPTH_PASS=2966;_global.GL_STENCIL_REF=2967;_global.GL_STENCIL_VALUE_MASK=2963;_global.GL_STENCIL_WRITEMASK=2968;_global.GL_STENCIL_BACK_FUNC=34816;_global.GL_STENCIL_BACK_FAIL=34817;_global.GL_STENCIL_BACK_PASS_DEPTH_FAIL=34818;_global.GL_STENCIL_BACK_PASS_DEPTH_PASS=34819;_global.GL_STENCIL_BACK_REF=36003;_global.GL_STENCIL_BACK_VALUE_MASK=36004;_global.GL_STENCIL_BACK_WRITEMASK=36005;_global.GL_VIEWPORT=2978;_global.GL_SCISSOR_BOX=3088;_global.GL_COLOR_CLEAR_VALUE=3106;_global.GL_COLOR_WRITEMASK=3107;_global.GL_UNPACK_ALIGNMENT=3317;_global.GL_PACK_ALIGNMENT=3333;_global.GL_MAX_TEXTURE_SIZE=3379;_global.GL_MAX_VIEWPORT_DIMS=3386;_global.GL_SUBPIXEL_BITS=3408;_global.GL_RED_BITS=3410;_global.GL_GREEN_BITS=3411;_global.GL_BLUE_BITS=3412;_global.GL_ALPHA_BITS=3413;_global.GL_DEPTH_BITS=3414;_global.GL_STENCIL_BITS=3415;_global.GL_POLYGON_OFFSET_UNITS=10752;_global.GL_POLYGON_OFFSET_FACTOR=32824;_global.GL_TEXTURE_BINDING_2D=32873;_global.GL_SAMPLE_BUFFERS=32936;_global.GL_SAMPLES=32937;_global.GL_SAMPLE_COVERAGE_VALUE=32938;_global.GL_SAMPLE_COVERAGE_INVERT=32939;_global.GL_COMPRESSED_TEXTURE_FORMATS=34467;_global.GL_DONT_CARE=4352;_global.GL_FASTEST=4353;_global.GL_NICEST=4354;_global.GL_GENERATE_MIPMAP_HINT=33170;_global.GL_BYTE=5120;_global.GL_UNSIGNED_BYTE=5121;_global.GL_SHORT=5122;_global.GL_UNSIGNED_SHORT=5123;_global.GL_INT=5124;_global.GL_UNSIGNED_INT=5125;_global.GL_FLOAT=5126;_global.GL_DEPTH_COMPONENT=6402;_global.GL_ALPHA=6406;_global.GL_RGB=6407;_global.GL_RGBA=6408;_global.GL_LUMINANCE=6409;_global.GL_LUMINANCE_ALPHA=6410;_global.GL_UNSIGNED_SHORT_4_4_4_4=32819;_global.GL_UNSIGNED_SHORT_5_5_5_1=32820;_global.GL_UNSIGNED_SHORT_5_6_5=33635;_global.GL_FRAGMENT_SHADER=35632;_global.GL_VERTEX_SHADER=35633;_global.GL_MAX_VERTEX_ATTRIBS=34921;_global.GL_MAX_VERTEX_UNIFORM_VECTORS=36347;_global.GL_MAX_VARYING_VECTORS=36348;_global.GL_MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661;_global.GL_MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660;_global.GL_MAX_TEXTURE_IMAGE_UNITS=34930;_global.GL_MAX_FRAGMENT_UNIFORM_VECTORS=36349;_global.GL_SHADER_TYPE=35663;_global.GL_DELETE_STATUS=35712;_global.GL_LINK_STATUS=35714;_global.GL_VALIDATE_STATUS=35715;_global.GL_ATTACHED_SHADERS=35717;_global.GL_ACTIVE_UNIFORMS=35718;_global.GL_ACTIVE_ATTRIBUTES=35721;_global.GL_SHADING_LANGUAGE_VERSION=35724;_global.GL_CURRENT_PROGRAM=35725;_global.GL_NEVER=512;_global.GL_LESS=513;_global.GL_EQUAL=514;_global.GL_LEQUAL=515;_global.GL_GREATER=516;_global.GL_NOTEQUAL=517;_global.GL_GEQUAL=518;_global.GL_ALWAYS=519;_global.GL_KEEP=7680;_global.GL_REPLACE=7681;_global.GL_INCR=7682;_global.GL_DECR=7683;_global.GL_INVERT=5386;_global.GL_INCR_WRAP=34055;_global.GL_DECR_WRAP=34056;_global.GL_VENDOR=7936;_global.GL_RENDERER=7937;_global.GL_VERSION=7938;_global.GL_NEAREST=9728;_global.GL_LINEAR=9729;_global.GL_NEAREST_MIPMAP_NEAREST=9984;_global.GL_LINEAR_MIPMAP_NEAREST=9985;_global.GL_NEAREST_MIPMAP_LINEAR=9986;_global.GL_LINEAR_MIPMAP_LINEAR=9987;_global.GL_TEXTURE_MAG_FILTER=10240;_global.GL_TEXTURE_MIN_FILTER=10241;_global.GL_TEXTURE_WRAP_S=10242;_global.GL_TEXTURE_WRAP_T=10243;_global.GL_TEXTURE_2D=3553;_global.GL_TEXTURE=5890;_global.GL_TEXTURE_CUBE_MAP=34067;_global.GL_TEXTURE_BINDING_CUBE_MAP=34068;_global.GL_TEXTURE_CUBE_MAP_POSITIVE_X=34069;_global.GL_TEXTURE_CUBE_MAP_NEGATIVE_X=34070;_global.GL_TEXTURE_CUBE_MAP_POSITIVE_Y=34071;_global.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y=34072;_global.GL_TEXTURE_CUBE_MAP_POSITIVE_Z=34073;_global.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z=34074;_global.GL_MAX_CUBE_MAP_TEXTURE_SIZE=34076;_global.GL_TEXTURE0=33984;_global.GL_TEXTURE1=33985;_global.GL_TEXTURE2=33986;_global.GL_TEXTURE3=33987;_global.GL_TEXTURE4=33988;_global.GL_TEXTURE5=33989;_global.GL_TEXTURE6=33990;_global.GL_TEXTURE7=33991;_global.GL_TEXTURE8=33992;_global.GL_TEXTURE9=33993;_global.GL_TEXTURE10=33994;_global.GL_TEXTURE11=33995;_global.GL_TEXTURE12=33996;_global.GL_TEXTURE13=33997;_global.GL_TEXTURE14=33998;_global.GL_TEXTURE15=33999;_global.GL_TEXTURE16=34000;_global.GL_TEXTURE17=34001;_global.GL_TEXTURE18=34002;_global.GL_TEXTURE19=34003;_global.GL_TEXTURE20=34004;_global.GL_TEXTURE21=34005;_global.GL_TEXTURE22=34006;_global.GL_TEXTURE23=34007;_global.GL_TEXTURE24=34008;_global.GL_TEXTURE25=34009;_global.GL_TEXTURE26=34010;_global.GL_TEXTURE27=34011;_global.GL_TEXTURE28=34012;_global.GL_TEXTURE29=34013;_global.GL_TEXTURE30=34014;_global.GL_TEXTURE31=34015;_global.GL_ACTIVE_TEXTURE=34016;_global.GL_REPEAT=10497;_global.GL_CLAMP_TO_EDGE=33071;_global.GL_MIRRORED_REPEAT=33648;_global.GL_FLOAT_VEC2=35664;_global.GL_FLOAT_VEC3=35665;_global.GL_FLOAT_VEC4=35666;_global.GL_INT_VEC2=35667;_global.GL_INT_VEC3=35668;_global.GL_INT_VEC4=35669;_global.GL_BOOL=35670;_global.GL_BOOL_VEC2=35671;_global.GL_BOOL_VEC3=35672;_global.GL_BOOL_VEC4=35673;_global.GL_FLOAT_MAT2=35674;_global.GL_FLOAT_MAT3=35675;_global.GL_FLOAT_MAT4=35676;_global.GL_SAMPLER_2D=35678;_global.GL_SAMPLER_CUBE=35680;_global.GL_VERTEX_ATTRIB_ARRAY_ENABLED=34338;_global.GL_VERTEX_ATTRIB_ARRAY_SIZE=34339;_global.GL_VERTEX_ATTRIB_ARRAY_STRIDE=34340;_global.GL_VERTEX_ATTRIB_ARRAY_TYPE=34341;_global.GL_VERTEX_ATTRIB_ARRAY_NORMALIZED=34922;_global.GL_VERTEX_ATTRIB_ARRAY_POINTER=34373;_global.GL_VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975;_global.GL_COMPILE_STATUS=35713;_global.GL_LOW_FLOAT=36336;_global.GL_MEDIUM_FLOAT=36337;_global.GL_HIGH_FLOAT=36338;_global.GL_LOW_INT=36339;_global.GL_MEDIUM_INT=36340;_global.GL_HIGH_INT=36341;_global.GL_FRAMEBUFFER=36160;_global.GL_RENDERBUFFER=36161;_global.GL_RGBA4=32854;_global.GL_RGB5_A1=32855;_global.GL_RGB565=36194;_global.GL_DEPTH_COMPONENT16=33189;_global.GL_STENCIL_INDEX=6401;_global.GL_STENCIL_INDEX8=36168;_global.GL_DEPTH_STENCIL=34041;_global.GL_RENDERBUFFER_WIDTH=36162;_global.GL_RENDERBUFFER_HEIGHT=36163;_global.GL_RENDERBUFFER_INTERNAL_FORMAT=36164;_global.GL_RENDERBUFFER_RED_SIZE=36176;_global.GL_RENDERBUFFER_GREEN_SIZE=36177;_global.GL_RENDERBUFFER_BLUE_SIZE=36178;_global.GL_RENDERBUFFER_ALPHA_SIZE=36179;_global.GL_RENDERBUFFER_DEPTH_SIZE=36180;_global.GL_RENDERBUFFER_STENCIL_SIZE=36181;_global.GL_FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048;_global.GL_FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049;_global.GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050;_global.GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051;_global.GL_COLOR_ATTACHMENT0=36064;_global.GL_DEPTH_ATTACHMENT=36096;_global.GL_STENCIL_ATTACHMENT=36128;_global.GL_DEPTH_STENCIL_ATTACHMENT=33306;_global.GL_NONE=0;_global.GL_FRAMEBUFFER_COMPLETE=36053;_global.GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054;_global.GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055;_global.GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057;_global.GL_FRAMEBUFFER_UNSUPPORTED=36061;_global.GL_FRAMEBUFFER_BINDING=36006;_global.GL_RENDERBUFFER_BINDING=36007;_global.GL_MAX_RENDERBUFFER_SIZE=34024;_global.GL_INVALID_FRAMEBUFFER_OPERATION=1286;_global.GL_UNPACK_FLIP_Y_WEBGL=37440;_global.GL_UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441;_global.GL_CONTEXT_LOST_WEBGL=37442;_global.GL_UNPACK_COLORSPACE_CONVERSION_WEBGL=37443;_global.GL_BROWSER_DEFAULT_WEBGL=37444}).call(this);Math.EPSILON=Math.EPSILON||0.00001;Math.TAU=Math.TAU||6.283185307179586;Math.radToDeg=Math.radToDeg||function(rad){return rad*360/Math.TAU};Math.rad2deg=Math.rad2deg||Math.radToDeg;Math.degToRad=Math.degToRad||function(deg){return deg*Math.TAU/360};Math.deg2rad=Math.deg2rad||Math.degToRad;Math.hcf=function(text1,text2){var gcd=1;if(text1>text2){text1=text1+text2;text2=text1-text2;text1=text1-text2}if((text2==(Math.round(text2/text1))*text1)){gcd=text1}else{for(var i=Math.round(text1/2);i>1;i=i-1){if((text1==(Math.round(text1/i))*i)){if((text2==(Math.round(text2/i))*i)){gcd=i;i=-1}}}}return gcd};Math.lcm=function(t1,t2){var cm=1;var f=Math.hcf(t1,t2);cm=t1*t2/f;return cm};Math.equalish=Math.equalish||function(a,b){var ta=typeof(a),tb=typeof(b);if(ta==="number"&&tb==="number"){return Math.abs(a-b)<=Math.EPSILON}if(ta!==tb){return false}if(ta.length!==tb.length){return false}for(var i=0;i<a.length;i++){if(a[i]===undefined||b[i]===undefined||isNaN(a[i])!==isNaN(b[i])||isFinite(a[i])!==isFinite(b[i])||Math.abs(a[i]-b[i])>Math.EPSILON){return false}}return true};Math.sign=Math.sign||function(x){return x>0?1:x<0?-1:0};(function(){Jax.MatrixStack=(function(){var TYPES;TYPES=["model","view","projection","inverseModel","inverseView","inverseProjection","normal","viewNormal","modelNormal","inverseViewNormal","modelView","modelViewProjection","inverseModelView"];function MatrixStack(){this.maxDepth=0;this.valid={inverseModel:[true],normal:[true],inverseView:[true],viewNormal:[true],modelNormal:[true],inverseViewNormal:[true],modelView:[true],inverseModelView:[true],inverseProjection:[true],modelViewProjection:[true]};this.matrices={model:[mat4.identity(mat4.create())],inverseModel:[mat4.identity(mat4.create())],normal:[mat3.identity(mat3.create())],modelNormal:[mat3.identity(mat3.create())],view:[mat4.identity(mat4.create())],inverseView:[mat4.identity(mat4.create())],viewNormal:[mat3.identity(mat3.create())],inverseViewNormal:[mat3.identity(mat3.create())],modelView:[mat4.identity(mat4.create())],inverseModelView:[mat4.identity(mat4.create())],projection:[mat4.identity(mat4.create())],inverseProjection:[mat4.identity(mat4.create())],modelViewProjection:[mat4.identity(mat4.create())]};this.reset()}MatrixStack.prototype.reset=function(){return this.depth=0};MatrixStack.prototype.push=function(){var ref,ref1,stack,type;this.depth++;if(this.depth>this.maxDepth){ref=this.matrices;for(type in ref){stack=ref[type];while(stack.length<=this.depth){stack.push(new Float32Array(stack[stack.length-1]))}}ref1=this.valid;for(type in ref1){stack=ref1[type];while(stack.length<=this.depth){stack.push(stack[stack.length-1])}}this.maxDepth=this.depth}this.loadModelMatrix(this.matrices.model[this.depth-1]);this.loadViewMatrix(this.matrices.view[this.depth-1]);this.loadProjectionMatrix(this.matrices.projection[this.depth-1]);return true};MatrixStack.prototype.pop=function(){if(this.depth>0){return this.depth--}};MatrixStack.prototype.loadModelMatrix=function(other){this.valid.inverseModel[this.depth]=false;this.valid.normal[this.depth]=false;this.valid.modelNormal[this.depth]=false;this.valid.modelView[this.depth]=false;this.valid.inverseModelView[this.depth]=false;this.valid.modelViewProjection[this.depth]=false;return mat4.copy(this.getModelMatrix(),other)};MatrixStack.prototype.loadViewMatrix=function(other){this.valid.inverseView[this.depth]=false;this.valid.viewNormal[this.depth]=false;this.valid.inverseViewNormal[this.depth]=false;this.valid.modelView[this.depth]=false;this.valid.inverseModelView[this.depth]=false;this.valid.modelViewProjection[this.depth]=false;return mat4.copy(this.getViewMatrix(),other)};MatrixStack.prototype.loadProjectionMatrix=function(other){this.valid.inverseProjection[this.depth]=false;this.valid.modelViewProjection[this.depth]=false;return mat4.copy(this.getProjectionMatrix(),other)};MatrixStack.prototype.multModelMatrix=function(other){this.valid.inverseModel[this.depth]=false;this.valid.normal[this.depth]=false;this.valid.modelNormal[this.depth]=false;this.valid.modelView[this.depth]=false;this.valid.inverseModelView[this.depth]=false;this.valid.modelViewProjection[this.depth]=false;return mat4.multiply(this.getModelMatrix(),this.getModelMatrix(),other)};MatrixStack.prototype.multViewMatrix=function(other){this.valid.inverseView[this.depth]=false;this.valid.viewNormal[this.depth]=false;this.valid.inverseViewNormal[this.depth]=false;this.valid.modelView[this.depth]=false;this.valid.inverseModelView[this.depth]=false;this.valid.modelViewProjection[this.depth]=false;return mat4.multiply(this.getViewMatrix(),this.getViewMatrix(),other)};MatrixStack.prototype.multProjectionMatrix=function(other){this.valid.inverseProjection[this.depth]=false;this.valid.modelViewProjection[this.depth]=false;return mat4.multiply(this.getProjectionMatrix(),this.getProjectionMatrix(),other)};MatrixStack.prototype.getModelMatrix=function(){return this.matrices.model[this.depth]};MatrixStack.prototype.getViewMatrix=function(){return this.matrices.view[this.depth]};MatrixStack.prototype.getProjectionMatrix=function(){return this.matrices.projection[this.depth]};MatrixStack.prototype.getModelViewMatrix=function(){if(this.valid.modelView[this.depth]){return this.matrices.modelView[this.depth]}else{this.valid.modelView[this.depth]=true;return mat4.multiply(this.matrices.modelView[this.depth],this.getViewMatrix(),this.getModelMatrix())}};MatrixStack.prototype.getInverseModelViewMatrix=function(){if(this.valid.inverseModelView[this.depth]){return this.matrices.inverseModelView[this.depth]}else{this.valid.inverseModelView[this.depth]=true;return mat4.invert(this.matrices.inverseModelView[this.depth],this.getModelViewMatrix())}};MatrixStack.prototype.getModelViewProjectionMatrix=function(){if(this.valid.modelViewProjection[this.depth]){return this.matrices.modelViewProjection[this.depth]}else{this.valid.modelViewProjection[this.depth]=true;return mat4.multiply(this.matrices.modelViewProjection[this.depth],this.getProjectionMatrix(),this.getModelViewMatrix())}};MatrixStack.prototype.getNormalMatrix=function(){if(this.valid.normal[this.depth]){return this.matrices.normal[this.depth]}else{this.valid.normal[this.depth]=true;if(!mat3.normalFromMat4(this.matrices.normal[this.depth],this.getModelViewMatrix())){console.log("Normal matrix could not be generated from:",this.getModelViewMatrix());throw new Error("Normal matrix could not be generated")}else{return this.matrices.normal[this.depth]}}};MatrixStack.prototype.getViewNormalMatrix=function(){if(this.valid.viewNormal[this.depth]){return this.matrices.viewNormal[this.depth]}else{this.valid.viewNormal[this.depth]=true;return mat3.normalFromMat4(this.matrices.viewNormal[this.depth],this.getViewMatrix())}};MatrixStack.prototype.getInverseViewNormalMatrix=function(){if(this.valid.inverseViewNormal[this.depth]){return this.matrices.inverseViewNormal[this.depth]}else{this.valid.inverseViewNormal[this.depth]=true;return mat3.normalFromMat4(this.matrices.inverseViewNormal[this.depth],this.getInverseViewMatrix())}};MatrixStack.prototype.getModelNormalMatrix=function(){if(this.valid.modelNormal[this.depth]){return this.matrices.modelNormal[this.depth]}else{this.valid.modelNormal[this.depth]=true;return mat3.normalFromMat4(this.matrices.modelNormal[this.depth],this.getModelMatrix())}};MatrixStack.prototype.getInverseModelMatrix=function(){if(this.valid.inverseModel[this.depth]){return this.matrices.inverseModel[this.depth]}else{this.valid.inverseModel[this.depth]=true;return mat4.invert(this.matrices.inverseModel[this.depth],this.getModelMatrix())}};MatrixStack.prototype.getInverseViewMatrix=function(){if(this.valid.inverseView[this.depth]){return this.matrices.inverseView[this.depth]}else{this.valid.inverseView[this.depth]=true;return mat4.invert(this.matrices.inverseView[this.depth],this.getViewMatrix())}};MatrixStack.prototype.getInverseProjectionMatrix=function(){if(this.valid.inverseProjection[this.depth]){return this.matrices.inverseProjection[this.depth]}else{this.valid.inverseProjection[this.depth]=true;return mat4.invert(this.matrices.inverseProjection[this.depth],this.getProjectionMatrix())}};return MatrixStack})()}).call(this);Jax.Util={crc:function(s){s=String(s);var polynomial=arguments.length<2?79764919:arguments[1],initialValue=arguments.length<3?4294967295:arguments[2],finalXORValue=arguments.length<4?4294967295:arguments[3],crc=initialValue,table=[],i,j,c;function reverse(x,n){var b=0;while(n){b=b*2+x%2;x/=2;x-=x%1;n--}return b}for(i=255;i>=0;i--){c=reverse(i,32);for(j=0;j<8;j++){c=((c*2)^(((c>>>31)%2)*polynomial))>>>0}table[i]=reverse(c,32)}for(i=0;i<s.length;i++){c=s.charCodeAt(i);if(c>255){throw new RangeError()}j=(crc%256)^c;crc=((crc/256)^table[j])>>>0}return(crc^finalXORValue)>>>0},isPowerOfTwo:function(s){return s&&(s&-s)==s},findMaterial:function(name_or_instance){if(typeof(name_or_instance)=="string"){return Jax.Material.find(name_or_instance)}else{if(name_or_instance instanceof Jax.Material){return name_or_instance}}throw new Error("Material must be an instance of Jax.Material, or a string representing a material in the Jax material registry")},hash:function(str){var hash=0;if(str.length==0){return hash}for(i=0;i<str.length;i++){var chr=str.charCodeAt(i);hash=((hash<<5)-hash)+chr;hash=hash&hash}return hash},scan:function(str,end,incr,decr,startIndex,singleLineComment,multiLineCommentStart,multiLineCommentEnd){end=end||")";incr=incr||"(";decr=decr||end;singleLineComment=singleLineComment||"//";multiLineCommentStart=multiLineCommentStart||"/*";multiLineCommentEnd=multiLineCommentEnd||"*/";startIndex=startIndex||0;var depth=0;var result="";var inComment=0;for(var i=startIndex;i<str.length;i++){var ch=str[i];switch(ch){case incr:if(!inComment){depth++}break;case decr:if(!inComment){depth--}break}if(depth<0){break}result+=ch;if(result.length>=singleLineComment.length&&result.substring(result.length-singleLineComment.length,result.length)===singleLineComment){inComment=1}if(inComment===1&&ch==="\n"){inComment=0}if(!inComment&&result.length>=multiLineCommentStart.length&&result.substring(result.length-multiLineCommentStart.length,result.length)===multiLineCommentStart){inComment=2}if(inComment===2&&result.length>=multiLineCommentEnd.length&&result.substring(result.length-multiLineCommentEnd.length,result.length)===multiLineCommentEnd){inComment=0}}return result},underscore:function(word){word=word.replace(/::/g,"/");word=word.replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2");word=word.replace(/([a-z\d])([A-Z])/g,"$1_$2");word=word.replace(/-/g,"_");return word.toLowerCase()},decodePickingColor:function(red,green,blue,alpha){if(blue==1){red*=255;green*=255}return red*256+green},vectorize:function(data){if(data){var res=[];if(typeof(data)=="string"){var components=data.split(/[,\s]+/);if(components.length>=2){for(var i=0;i<components.length;i++){res[i]=parseFloat(components[i])}}return res}if(data.length&&data.length>=3){return vec3.copy(res,data)}else{if(data.length==2){return[data[0],data[1]]}}if((res[0]=data.x)!=undefined&&(res[1]=data.y)!=undefined){if(data.z!=undefined){res[2]=data.z}return res}if((res[0]=data[0])!=undefined&&(res[1]=data[1])!=undefined){if(data[2]!=undefined){res[2]=data[2]}return res}}throw new Error("Input argument for Jax.Util.vectorize not recognized: "+JSON.stringify(data))},colorize:function(data){if(data){var res=vec4.create();if(data instanceof Jax.Color){return vec4.copy(res,data.toVec4())}if(typeof(data)=="string"){var components=data.split(/[,\s]+/);if(components.length>=3){for(var i=0;i<4;i++){if(components.length<=i){res[i]=1}else{res[i]=parseFloat(components[i])}}}return res}if(data.length&&data.length>=3){res[0]=data[0];res[1]=data[1];res[2]=data[2];if((res[3]=data[3])==undefined){res[3]=1}else{res[3]=1}return res}if((res[0]=data.r)!=undefined&&(res[1]=data.g)!=undefined&&(res[2]=data.b)!=undefined){if((res[3]=data.a)==undefined){res[3]=1}return res}if((res[0]=data.red)!=undefined&&(res[1]=data.green)!=undefined&&(res[2]=data.blue)!=undefined){if((res[3]=data.alpha)==undefined){res[3]=1}return res}if((res[0]=data[0])!=undefined&&(res[1]=data[1])!=undefined&&(res[2]=data[2])!=undefined){if((res[3]=data[3])==undefined){res[3]=1}return res}}throw new Error("Input argument for Jax.Util.colorize not recognized: "+JSON.stringify(data))},properties:function(object){var arr=[];for(var i in object){arr.push(i)}return arr},merge:function(src,dst){if(!src){return dst}return jQuery.extend(true,dst,src)},trimDuplicates:function(array){var contains,item,results,i,len;results=[];contains=function(haystack,needle){var match,straw,value,i,j,hLen,nLen;for(i=0,hLen=haystack.length;i<hLen;i++){straw=haystack[i];match=true;for(j=0,nLen=needle.length;j<nLen;j++){value=needle[j];if(straw[j]!==value){match=false}}if(match){return true}}return false};for(i=0,len=array.length;i<len;i++){item=array[i];if(!contains(results,item)){results.push(item)}}return results},sizeofFormat:function(glEnum){switch(glEnum){case GL_ALPHA:return 1;case GL_LUMINANCE:return 1;case GL_RGB:return 3;case GL_RGBA:return 4;case GL_LUMINANCE_ALPHA:return 2}throw new Error("Unrecognized format: "+Jax.Util.enumName(glEnum))},enumName:function(glEnum){var global=Jax.getGlobal();for(var i in global){if(i.indexOf("GL_")==0&&global[i]==glEnum){return i}}return"(unrecognized enum: "+glEnum+" [0x"+parseInt(glEnum).toString(16)+"])"}};(function(){var eachName;eachName=function(name,callback){var j,len,names;names=name.split(/[,\s]+/);for(j=0,len=names.length;j<len;j++){name=names[j];callback(name)}return true};Jax.Mixins.EventEmitter={getEventListeners:function(name){var base;this._eventListeners||(this._eventListeners={});return(base=this._eventListeners)[name]||(base[name]=[])},on:function(name,callback){eachName(name,(function(_this){return function(name){return _this.getEventListeners(name).push(callback)}})(this));return callback},off:function(name,callback){if(name){return eachName(name,(function(_this){return function(name){var i,j,len,listener,listeners;listeners=_this.getEventListeners(name);if(callback){for(i=j=0,len=listeners.length;j<len;i=++j){listener=listeners[i];if(callback===listener){return listeners.splice(i,1)}}return true}else{return listeners.splice(0,listeners.length)}}})(this))}else{return this._eventListeners={}}},trigger:function(name,event){var index,j,len,listener,ref;ref=this.getEventListeners(name);for(j=0,len=ref.length;j<len;j++){listener=ref[j];listener.call(this,event,name)}if((index=name.indexOf(":"))!==-1){name=name.substring(0,index);this.trigger(name,event)}return true}}}).call(this);(function(){Jax.Controller=(function(){function Controller(){}Controller.prototype.index=function(){};Controller.prototype.fireAction=function(actionName,context){var ref,ref1,viewKey;if(context){this.context=context;this.world=context!=null?context.world:void 0}this.activeCamera||(this.activeCamera=(ref=this.world)!=null?ref.cameras[0]:void 0);if(!this[actionName]){throw new Error("Action '"+actionName+"' not found")}this.actionName=actionName;this[actionName]();if(viewKey=(ref1=this.views)!=null?ref1[actionName]:void 0){this.view=Jax.views.find(viewKey)}return this};return Controller})();Jax.controllers=new (Jax.ControllerLibrary=(function(){ControllerLibrary.include(Jax.Mixins.EventEmitter);function ControllerLibrary(){this.index={}}ControllerLibrary.prototype.add=function(name,klass){this.index[name]=klass;return this.trigger("add",{name:name,"class":klass})};ControllerLibrary.prototype.remove=function(name){var klass;if(klass=this.index[name]){delete this.index[name];return this.trigger("remove",{name:name,"class":klass})}};ControllerLibrary.prototype.getNames=function(){var klass,name,ref,results;ref=this.index;results=[];for(name in ref){klass=ref[name];results.push(name)}return results};ControllerLibrary.prototype.get=function(name){return this.index[name]};return ControllerLibrary})())}).call(this);(function(){function initProperties(self,data){if(data&&data.mesh){self.mesh=data.mesh;delete data.mesh}data=Jax.Util.merge(data,{});var attribute;if(data){for(attribute in data){switch(attribute){case"position":self.camera.setPosition(Jax.Util.vectorize(data[attribute]));break;case"direction":self.camera.setDirection(Jax.Util.vectorize(data[attribute]));break;default:self[attribute]=data[attribute]}}}}Jax.Model=(function(){function Model(data){var self=this;this.__unique_id=Jax.guid();this.camera=new Jax.Camera();this.camera.on("change",function(){self.trigger("transformed")});initProperties(this,Jax.Model.default_properties);if(this._klass&&this._klass.resources){initProperties(this,this._klass.resources["default"])}initProperties(this,data);if(this.after_initialize){this.after_initialize()}}jQuery.extend(Model.prototype,{isShadowCaster:function(){return this.shadow_caster},isShadowcaster:function(){return this.shadow_caster},disableShadows:function(){var was=this.shadow_caster;this.shadow_caster=false;return was},render:function(context,material){if(this.mesh){if(!Jax.Model.__instances[this.__unique_id]){Jax.Model.__instances[this.__unique_id]=this}this.pushMatrices(context);this.mesh.render(context,this,material);this.popMatrices(context)}},pushMatrices:function(context){context.matrix_stack.push();context.matrix_stack.multModelMatrix(this.camera.get("matrix"))},popMatrices:function(context){context.matrix_stack.pop()},getBoundingCube:function(){if(!this.mesh){return{left:0,right:0,bottom:0,top:0,front:0,back:0,width:0,height:0,depth:0}}return this.mesh.bounds},getBoundingSphereRadius:function(){var b=this.getBoundingCube();return Math.max(b.width,Math.max(b.height,b.depth))},dispose:function(){if(this.mesh){this.mesh.dispose()}if(Jax.Model.__instances[this.__unique_id]){delete Jax.Model.__instances[this.__unique_id]}},isLit:function(){return this.lit},setColor:function(a,b,c,d){if(arguments.length>1){this.mesh.setColor(a,b,c,d)}else{this.mesh.setColor(a)}return this},inspect:function(){result={};for(var i in this){if(!Object.isFunction(this[i])&&i!="_klass"){result[i]=this[i]}}return JSON.stringify(result)}});return Model})();var model_class_methods={find:function(id){for(var resource_id in this.resources){if(id==resource_id){return new this(this.resources[id])}}throw new Error("Resource '"+id+"' not found!")},addResources:function(resources){this.resources=this.resources||{};for(var id in resources){if(this.resources[id]){throw new Error("Duplicate resource ID: "+id)}else{this.resources[id]=resources[id]}}},removeAllResources:function(){this.resources={}}};Jax.Model.default_properties={receiveShadow:true,castShadow:true,illuminated:true,cull:true};Object.defineProperty(Jax.Model.prototype,"position",{get:function(){return this.camera.get("position")},set:function(p){return this.camera.setPosition(p)}});Object.defineProperty(Jax.Model.prototype,"direction",{get:function(){return this.camera.get("direction")},set:function(p){return this.camera.setDirection(p)}});Jax.Model.create=function(superclass,inner){var klass;if(!inner){inner=superclass;superclass=Jax.Model}var klass=function(){superclass.apply(this,arguments);if(this.initialize){this.initialize.apply(this,arguments)}};klass.prototype=new superclass();jQuery.extend(klass.prototype,{_klass:klass});jQuery.extend(klass.prototype,inner);jQuery.extend(klass,model_class_methods);return klass};jQuery.extend(Jax.Model.prototype,Jax.Mixins.EventEmitter);Jax.Model.__instances={};jQuery.extend(Jax.Model,model_class_methods)})();Jax.ViewManager=(function(){function ViewManager(){this.views={}}jQuery.extend(ViewManager.prototype,{push:function(path,view){this.views[Jax.Util.underscore(path)]=view},find:function(path){if(this.views[Jax.Util.underscore(path)]){return this.views[Jax.Util.underscore(path)]}return null},remove:function(path){var result=this.views[Jax.Util.underscore(path)];delete this.views[Jax.Util.underscore(path)];return result},exists:function(path){return !!this.views[Jax.Util.underscore(path)]}});return ViewManager})();(function(){Jax.views=new Jax.ViewManager()}).call(this);(function(){var alphaHex,hex2dec,hexEncode,parseHexColor,slice=[].slice;alphaHex="0123456789abcdef";hex2dec=function(hex){var _n,n_;n_=alphaHex.indexOf(hex.slice(0,1));_n=alphaHex.indexOf(hex.slice(1,2));return(n_*16+_n)/255};parseHexColor=function(hex,color){var a,b,g,r,ref;switch(hex.length){case 3:return parseHexColor(hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2]+"ff",color);case 4:return parseHexColor(hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2]+hex[3]+hex[3],color);case 6:return parseHexColor(hex+"ff",color);case 8:hex=hex.toLowerCase();ref=[hex2dec(hex.slice(0,2)),hex2dec(hex.slice(2,4)),hex2dec(hex.slice(4,6)),hex2dec(hex.slice(6,8))],r=ref[0],g=ref[1],b=ref[2],a=ref[3];return color.set(r,g,b,a);default:throw new Error("Hex color #"+hex+" is invalid: must be 3, 4, 6, or 8 characters")}};hexEncode=function(flt,precision){var dec,result;dec=parseInt(flt*255);return result=(function(){switch(precision){case 1:return parseInt(dec/16).toString(16);case 2:result=dec.toString(16);if(result.length===1){return"0"+result}else{return result}break;default:throw new Error("invalid precision")}})()};Jax.Color=(function(){Color.include(Jax.Mixins.EventEmitter);function Color(r,g,b,a){if(r==null){r=1}if(g==null){g=1}if(b==null){b=1}if(a==null){a=1}this._vec=vec4.create();this.set(r,g,b,a)}Color.prototype.toVec4=function(){return this._vec};Color.prototype.toString=function(channels){if(channels==null){channels=8}switch(channels){case 3:return"#"+(hexEncode(this.red,1))+(hexEncode(this.green,1))+(hexEncode(this.blue,1));case 4:return"#"+(hexEncode(this.red,1))+(hexEncode(this.green,1))+(hexEncode(this.blue,1))+(hexEncode(this.alpha,1));case 6:return"#"+(hexEncode(this.red,2))+(hexEncode(this.green,2))+(hexEncode(this.blue,2));case 8:return"#"+(hexEncode(this.red,2))+(hexEncode(this.green,2))+(hexEncode(this.blue,2))+(hexEncode(this.alpha,2));default:throw new Error("Channels must be 3, 4, 6, or 8")}};Color.prototype.set=function(_red,_green,_blue,_alpha){var ref;this._red=_red;this._green=_green;this._blue=_blue;this._alpha=_alpha;ref=[this._red,this._green,this._blue,this._alpha],this._vec=1<=ref.length?slice.call(ref,0):[];this.trigger("change");return this};Color.define("red",{get:function(){return this._red},set:function(_red){this._red=_red;this._vec[0]=this._red;return this.trigger("change")}});Color.define("green",{get:function(){return this._green},set:function(_green){this._green=_green;this._vec[1]=this._green;return this.trigger("change")}});Color.define("blue",{get:function(){return this._blue},set:function(_blue){this._blue=_blue;this._vec[2]=this._blue;return this.trigger("change")}});Color.define("alpha",{get:function(){return this._alpha},set:function(_alpha){this._alpha=_alpha;this._vec[3]=this._alpha;return this.trigger("change")}});Color.prototype.parse=function(value){var c,split,v;if(typeof value==="string"&&value[0]==="#"){return parseHexColor(value.slice(1),this)}else{if(typeof value==="string"&&(split=value.split(" ")).length!==0){return this.set.apply(this,(function(){var i,len,results;results=[];for(i=0,len=split.length;i<len;i++){c=split[i];results.push(parseFloat(c))}return results})())}else{if(value!=null?value.toVec4:void 0){v=value.toVec4();return this.set(v[0],v[1],v[2],v[3])}else{if(value!=null?value.length:void 0){return this.set(value[0],value[1],value[2],value[3])}else{v=Jax.Util.colorize(value);return this.set(v[0],v[1],v[2],v[3])}}}}};Color.parse=function(value){return new Jax.Color().parse(value)};return Color})()}).call(this);(function(){var Mesh,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,slice=[].slice;Mesh=(function(){var recalcNormal,recalcPosition;Mesh.include(Jax.Mixins.EventEmitter);function Mesh(options){var key,value;this.assigns={};this._valid=false;this.data=new Jax.Mesh.Data;this._bounds=new Jax.Mesh.Bounds;this._color=new Jax.Color;this._initialized=false;this.draw_mode||(this.draw_mode=GL_POINTS);if(options){if(options.init){this.init=options.init}if(options.draw_mode){this.draw_mode=options.draw_mode}this.material=options.material||Jax.default_material;if(options.color){this.color=options.color}delete options.init;delete options.draw_mode;delete options.material;delete options.color;for(key in options){value=options[key];this[key]=value}}else{this.material=Jax.default_material}}Mesh.define("material",{get:function(){if(!this._invalid){this.validate()}return this._material},set:function(material){if(!material){return this._material=null}if(material instanceof Jax.Material){this._material=material}else{this._material=Jax.Material.find(material)}return this._material.name}});Mesh.define("data",{get:function(){if(!this._valid){this.validate()}return this._data},set:function(d){this.invalidate();this._initialized=true;if(this._data){this._data.dispose()}this._data=d;this._data.on("colorChanged",(function(_this){return function(){return _this.trigger("colorChanged")}})(this));this._data.on("shouldRecalculateNormals",(function(_this){return function(){return _this.recalculateNormals()}})(this));this._data.on("shouldRecalculateTangents",(function(_this){return function(){return _this.recalculateTangents()}})(this));return this._data.on("shouldRecalculateBitangents",(function(_this){return function(){return _this.recalculateBitangents()}})(this))}});Mesh.define("color",{get:function(){return this._color},set:function(color){this._color=color;this._data.color=this._color;return this.trigger("colorChanged")}});Mesh.define("vertices",{get:function(){if(!this._valid){this.validate()}return this.data.vertexBuffer}});Mesh.define("indices",{get:function(){if(!this._valid){this.validate()}return this.data.indexBuffer}});Mesh.define("bounds",{get:function(){if(!this._valid){this.validate()}return this._bounds}});Mesh.define("submesh",{get:function(){if(!this._valid){this.validate()}return this._submesh},set:function(submesh){if(this._submesh){this._submesh.dispose()}return this._submesh=submesh}});Mesh.prototype.draw_mode=GL_POINTS;Mesh.prototype.toJSON=function(){var i;return{vertices:(function(){var j,len,ref,results;ref=this.data.vertexBuffer;results=[];for(j=0,len=ref.length;j<len;j++){i=ref[j];results.push(parseFloat(i.toFixed(6)))}return results}).call(this),colors:(function(){var j,len,ref,results;ref=this.data.colorBuffer;results=[];for(j=0,len=ref.length;j<len;j++){i=ref[j];results.push(parseFloat(i.toFixed(6)))}return results}).call(this),textureCoords:(function(){var j,len,ref,results;ref=this.data.textureCoordsBuffer;results=[];for(j=0,len=ref.length;j<len;j++){i=ref[j];results.push(parseFloat(i.toFixed(6)))}return results}).call(this),normals:(function(){var j,len,ref,results;ref=this.data.normalBuffer;results=[];for(j=0,len=ref.length;j<len;j++){i=ref[j];results.push(parseFloat(i.toFixed(6)))}return results}).call(this),tangents:(function(){var j,len,ref,results;ref=this.data.tangentBuffer;results=[];for(j=0,len=ref.length;j<len;j++){i=ref[j];results.push(parseFloat(i.toFixed(6)))}return results}).call(this),bitangents:(function(){var j,len,ref,results;ref=this.data.bitangentBuffer;results=[];for(j=0,len=ref.length;j<len;j++){i=ref[j];results.push(parseFloat(i.toFixed(6)))}return results}).call(this),indices:(function(){var j,len,ref,results;ref=this.data.indexBuffer;results=[];for(j=0,len=ref.length;j<len;j++){i=ref[j];results.push(i)}return results}).call(this)}};recalcNormal=vec3.create();Mesh.prototype.recalculateNormals=function(){var center,i,j,normals,ref,vertices;normals=this.data.normalBuffer;vertices=this.data.vertexBuffer;center=this.bounds.center;for(i=j=0,ref=vertices.length;j<ref;i=j+=3){recalcNormal[0]=vertices[i];recalcNormal[1]=vertices[i+1];recalcNormal[2]=vertices[i+2];vec3.subtract(recalcNormal,recalcNormal,center);vec3.normalize(recalcNormal,recalcNormal);normals[i]=recalcNormal[0];normals[i+1]=recalcNormal[1];normals[i+2]=recalcNormal[2]}return true};Mesh.prototype.recalculateTangents=function(){throw new Error("Can't calculate tangents for "+this.__proto__.constructor.name)};Mesh.prototype.recalculateBitangents=function(){throw new Error("Can't calculate bitangents for "+this.__proto__.constructor.name)};Mesh.prototype.render=function(context,model,material){if(!this._valid){this.validate()}if(material){if(!(material instanceof Jax.Material)){material=Jax.Material.find(material)}}else{material=this._material}return material.render(context,this,model)};Mesh.prototype.isValid=function(){return this._valid};Mesh.prototype.invalidate=function(forceRebuild){if(forceRebuild==null){forceRebuild=false}if(forceRebuild){this._initialized=false}return this._valid=false};Mesh.prototype.validate=function(){if(this._valid){return}if(this.__validating){throw new Error("Already validating -- look for recursion errors!")}this.__validating=true;if(!this._initialized){this.rebuild()}this._material||(this._material=Jax.Material.find("default"));this.recalculateBounds();if(this._data.indices_buf){this._data.indices_buf.dispose()}this._data.indices_buf=new Jax.Buffer(GL_ELEMENT_ARRAY_BUFFER,this._data.indexFormat,GL_STATIC_DRAW,this._data.indexBuffer,1);this.__validating=false;this._valid=true;this.trigger("validated");return this};Mesh.prototype.rebuild=function(){var bitangents,colors,indices,normals,ref,tangents,textures,vertices;if(!this.init){return}this.dispose();if(!this.__validating){return this.validate()}ref=[[],[],[],[],[],[],[]],vertices=ref[0],colors=ref[1],textures=ref[2],normals=ref[3],indices=ref[4],tangents=ref[5],bitangents=ref[6];this.init(vertices,colors,textures,normals,indices,tangents,bitangents);if(vertices.length>65535*3){this.submesh=this.split(vertices,colors,textures,normals,indices,tangents,bitangents)}this.data=new Jax.Mesh.Data(vertices,colors,textures,normals,indices,tangents,bitangents);this._data.color=this._color;this.trigger("rebuilt");this._initialized=true;return this};Mesh.prototype.split=function(vertices,colors,textures,normals,indices,tangents,bitangents){var _a,_b,_c,_i,_n,_t,_v,i,j,max,newMesh,ref;max=65535;if(vertices.length<=max*3){return null}_v=_c=_t=_n=null;_i=[];_v=vertices.splice(max*3,vertices.length);if(colors.length>=max*4){_c=colors.splice(max*4,colors.length)}if(textures.length>=max*2){_t=textures.splice(max*2,textures.length)}if(normals.length>=max*3){_n=normals.splice(max*3,normals.length)}if(tangents.length>=max*4){_a=tangents.splice(max*4,tangents.length)}if(bitangents.length>=max*3){_b=bitangents.splice(max*3,bitangents.length)}for(i=j=0,ref=indices.length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){if(indices[i]>max){_i.push(indices[i]);indices.splice(i,1);i--}}return newMesh=new this.__proto__.constructor({init:function(v,c,t,n,i){var __a,__b,__c,__i,__n,__t,__v,k,l,len,len1,len2,len3,len4,len5,len6,m,o,p,q,r,results;for(k=0,len=_v.length;k<len;k++){__v=_v[k];v.push(__v)}if(_c){for(l=0,len1=_c.length;l<len1;l++){__c=_c[l];c.push(__c)}}if(_t){for(m=0,len2=_t.length;m<len2;m++){__t=_t[m];t.push(__t)}}if(_n){for(o=0,len3=_n.length;o<len3;o++){__n=_n[o];n.push(__n)}}if(_a){for(p=0,len4=_a.length;p<len4;p++){__a=_a[p];n.push(__a)}}if(_b){for(q=0,len5=_b.length;q<len5;q++){__b=_b[q];n.push(__b)}}results=[];for(r=0,len6=_i.length;r<len6;r++){__i=_i[r];results.push(i.push(__i-65535))}return results}})};recalcPosition=vec3.create();Mesh.prototype.recalculateBounds=function(){var back,biggest,bottom,center,depth,front,height,i,j,left,length,position,ref,ref1,ref2,right,top,width;ref=[this._bounds.left,this._bounds.right,this._bounds.top,this._bounds.bottom,this._bounds.front,this._bounds.back],left=ref[0],right=ref[1],top=ref[2],bottom=ref[3],front=ref[4],back=ref[5];center=this._bounds.center;length=this._data.vertexBuffer.length;position=recalcPosition;biggest=0;for(i=j=0,ref1=length;j<ref1;i=j+=3){position[0]=this._data.vertexBuffer[i];position[1]=this._data.vertexBuffer[i+1];position[2]=this._data.vertexBuffer[i+2];if(i===0){vec3.copy(left,position);vec3.copy(right,position);vec3.copy(top,position);vec3.copy(bottom,position);vec3.copy(front,position);vec3.copy(back,position)}else{if(position[0]<left[0]){vec3.copy(left,position)}if(position[0]>right[0]){vec3.copy(right,position)}if(position[1]<bottom[1]){vec3.copy(bottom,position)}if(position[1]>top[1]){vec3.copy(top,position)}if(position[2]<back[2]){vec3.copy(back,position)}if(position[2]>front[2]){vec3.copy(front,position)}}}width=right[0]-left[0];height=top[1]-bottom[1];depth=front[2]-back[2];biggest=(width>height&&width>depth?width:height>depth?height:depth);center[0]=left[0]+width*0.5;center[1]=bottom[1]+height*0.5;center[2]=back[2]+depth*0.5;if(width<Math.EPSILON){width=0.0001}if(height<Math.EPSILON){height=0.0001}if(depth<Math.EPSILON){depth=0.0001}ref2=[width,height,depth],this._bounds.width=ref2[0],this._bounds.height=ref2[1],this._bounds.depth=ref2[2];this._bounds.radius=biggest/2;return this._bounds};Mesh.prototype.getIndexBuffer=function(){if(!this._valid){this.validate()}return this.data.indices_buf};Mesh.prototype.setColor=function(c){if(arguments.length>1){return this.color=arguments}else{return this.color=c}};Mesh.prototype.dispose=function(){if(this._data){this._data.dispose()}if(this._submesh){this._submesh.dispose()}this._initialized=false;return this.invalidate()};return Mesh})();Mesh.Deprecated=(function(superClass){extend(Deprecated,superClass);function Deprecated(){var args,deprecation_message;args=1<=arguments.length?slice.call(arguments,0):[];deprecation_message="Using Jax.Mesh directly has been deprecated. Please use Jax.Mesh.Triangles or a similar variant instead.";if(typeof console!=="undefined"){console.log(new Error(deprecation_message).stack)}else{throw new Error(deprecation_message)}Deprecated.__super__.constructor.apply(this,args)}return Deprecated})(Mesh);Jax.Mesh=Mesh.Deprecated;Jax.Mesh.Base=Mesh}).call(this);(function(){Jax.Mesh.Bounds=(function(){function Bounds(){this.left=vec3.create();this.right=vec3.create();this.top=vec3.create();this.bottom=vec3.create();this.front=vec3.create();this.back=vec3.create();this.center=vec3.create();this.width=0;this.height=0;this.depth=0}return Bounds})()}).call(this);(function(){var FloatBuffer;FloatBuffer=(function(){function FloatBuffer(buffer,itemSize){this.buffer=buffer;this.itemSize=itemSize;this.offset=buffer.byteOffset}FloatBuffer.prototype.bind=function(){};return FloatBuffer})();Jax.Mesh.Data=(function(){var calcByteLength,chooseIndexArrayFormat,tmpvec3;Data.include(Jax.Mixins.EventEmitter);Data.endpoints={};chooseIndexArrayFormat=function(length){if(length<256){return Uint8Array}else{if(length<65536){return Uint16Array}}return Uint32Array};calcByteLength=function(numVerts,numIndices,indexFormat){var length,multiple,name,ref,ref1,size,sizePerVertex;multiple=1;ref=Jax.Mesh.Data.endpoints;for(name in ref){size=ref[name];multiple=Math.lcm(multiple,size)}multiple=Math.lcm(multiple,Float32Array.BYTES_PER_ELEMENT);multiple=Math.lcm(multiple,indexFormat.BYTES_PER_ELEMENT);sizePerVertex=0;ref1=Jax.Mesh.Data.endpoints;for(name in ref1){size=ref1[name];sizePerVertex+=size}length=sizePerVertex*numVerts*Float32Array.BYTES_PER_ELEMENT+numVerts*9*Float32Array.BYTES_PER_ELEMENT+numVerts*2*Float32Array.BYTES_PER_ELEMENT+numVerts*8*Float32Array.BYTES_PER_ELEMENT+numIndices*indexFormat.BYTES_PER_ELEMENT;if(length%multiple!==0){length+=multiple-(length%multiple)}return length};function Data(vertices,colors,textures,normals,indices,tangents,bitangents){var i,j,k,ref,ref1;if(vertices==null){vertices=[]}if(colors==null){colors=[]}if(textures==null){textures=[]}if(normals==null){normals=[]}if(indices==null){indices=[]}if(tangents==null){tangents=[]}if(bitangents==null){bitangents=[]}if(typeof vertices==="number"){vertices=new Array(vertices)}if(vertices%3){throw new Error("Vertex data length must be given in multiples of 3")}this._offsets={};this._buffers={};this._wrappers={};this.allocateBuffers(vertices.length,indices.length||vertices.length/3);if(indices.length===0){for(i=j=0,ref=this.length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){indices.push(i)}}this.assignVertexData(vertices,colors,textures,normals,tangents,bitangents);this.freezeColors();for(i=k=0,ref1=indices.length;0<=ref1?k<ref1:k>ref1;i=0<=ref1?++k:--k){this.indexBuffer[i]=indices[i]}this.usage=GL_STATIC_DRAW;this.target=GL_ARRAY_BUFFER;this._glBuffers={};this._valid={}}Data.define("color",{get:function(){return this._color},set:function(color){var i,j,ref,results;this.trigger("colorChanged");this.invalidate();this._color=Jax.Color.parse(color);results=[];for(i=j=0,ref=this.colorBuffer.length;j<ref;i=j+=4){this.colorBuffer[i]=this.originalColors[i]*this._color.red;this.colorBuffer[i+1]=this.originalColors[i+1]*this._color.green;this.colorBuffer[i+2]=this.originalColors[i+2]*this._color.blue;results.push(this.colorBuffer[i+3]=this.originalColors[i+3]*this._color.alpha)}return results}});Data.define("context",{set:function(context){this._bound=false;return this._context=context}});Data.getter("tangentBuffer",function(){if(this.shouldRecalculateTangents()){this.recalculateTangents()}return this._tangentBuffer});Data.getter("bitangentBuffer",function(){if(this.shouldRecalculateBitangents()){this.recalculateBitangents()}return this._bitangentBuffer});Data.getter("normalBuffer",function(){if(this.shouldRecalculateNormals()){this.recalculateNormals()}return this._normalBuffer});Data.prototype.freezeColors=function(){var i,j,ref,results;this.originalColors||(this.originalColors=new Float32Array(this.colorBuffer.length));results=[];for(i=j=0,ref=this.colorBuffer.length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){results.push(this.originalColors[i]=this.colorBuffer[i])}return results};Data.prototype.invalidate=function(){var id;for(id in this._valid){this._valid[id]=false}return true};Data.prototype.dispose=function(){var descriptor,id,ref,results;ref=this._glBuffers;results=[];for(id in ref){descriptor=ref[id];results.push(delete this._glBuffers.id)}return results};Data.prototype.bind=function(context){var buffer,gl,id,ref;if(context){this.context=context}id=this._context.id;gl=this._context.renderer;if(!(buffer=(ref=this._glBuffers[id])!=null?ref.buffer:void 0)){this._glBuffers[id]={gl:gl,buffer:gl.createBuffer()};gl.bindBuffer(GL_ARRAY_BUFFER,this._glBuffers[id].buffer);gl.bufferData(GL_ARRAY_BUFFER,this._array_buffer,GL_STATIC_DRAW)}else{gl.bindBuffer(GL_ARRAY_BUFFER,buffer);if(!this._valid[id]){gl.bufferData(GL_ARRAY_BUFFER,this._array_buffer,GL_STATIC_DRAW)}}this._valid[id]=true;return this._bound=true};Data.prototype.set=function(vars,mapping){var key,results,target;if(!this._context){throw new Error("Jax context for this pass is not set")}if(mapping===void 0){throw new Error("Expected two arguments, mapping is undefined")}if(!this._bound){this.bind(this._context)}results=[];for(key in mapping){target=mapping[key];switch(key){case"vertices":results.push(vars[target]=this.vertexWrapper);break;case"colors":results.push(vars[target]=this.colorWrapper);break;case"textures":results.push(vars[target]=this.textureCoordsWrapper);break;case"normals":if(this.shouldRecalculateNormals()){this.recalculateNormals()}results.push(vars[target]=this.normalWrapper);break;case"tangents":if(this.shouldRecalculateTangents()){this.recalculateTangents()}results.push(vars[target]=this.tangentWrapper);break;case"bitangents":if(this.shouldRecalculateBitangents()){this.recalculateBitangents()}results.push(vars[target]=this.bitangentWrapper);break;default:if(this._wrappers[key]){results.push(vars[target]=this._wrappers[key])}else{throw new Error("Mapping key must be one of 'vertices', 'colors', "+("'textures', 'normals', 'tangents', 'bitangents' (got: "+key+")"))}}}return results};Data.prototype.recalculateNormals=function(){this._shouldRecalculateNormals=false;this.trigger("shouldRecalculateNormals");this.invalidate();return true};Data.prototype.recalculateTangents=function(){this._shouldRecalculateTangents=false;this.trigger("shouldRecalculateTangents");this.invalidate();return true};Data.prototype.recalculateBitangents=function(){this._shouldRecalculateBitangents=false;this.trigger("shouldRecalculateBitangents");this.invalidate();return true};Data.prototype.shouldRecalculateNormals=function(){return this._shouldRecalculateNormals};Data.prototype.shouldRecalculateTangents=function(){return this._shouldRecalculateTangents};Data.prototype.shouldRecalculateBitangents=function(){return this._shouldRecalculateBitangents};Data.prototype.allocateBuffers=function(numVertices,numIndices){var buffer,byteLength,getterFactory,name,offset,ref,size,wrapper;this.length=numVertices/3;this.indexFormat=chooseIndexArrayFormat(this.length);byteLength=calcByteLength(this.length,numIndices,this.indexFormat);this._array_buffer=new ArrayBuffer(byteLength);this.vertexBufferOffset=0;this.vertexBuffer=new Float32Array(this._array_buffer,this.vertexBufferOffset,this.length*3);this.vertexWrapper=new FloatBuffer(this.vertexBuffer,3);this.textureCoordsBufferOffset=this.vertexBufferOffset+Float32Array.BYTES_PER_ELEMENT*this.vertexBuffer.length;this.textureCoordsBuffer=new Float32Array(this._array_buffer,this.textureCoordsBufferOffset,this.length*2);this.textureCoordsWrapper=new FloatBuffer(this.textureCoordsBuffer,2);this.normalBufferOffset=this.textureCoordsBufferOffset+Float32Array.BYTES_PER_ELEMENT*this.textureCoordsBuffer.length;this._normalBuffer=new Float32Array(this._array_buffer,this.normalBufferOffset,this.length*3);this.normalWrapper=new FloatBuffer(this._normalBuffer,3);this.colorBufferOffset=this.normalBufferOffset+Float32Array.BYTES_PER_ELEMENT*this._normalBuffer.length;this.colorBuffer=new Float32Array(this._array_buffer,this.colorBufferOffset,this.length*4);this.colorWrapper=new FloatBuffer(this.colorBuffer,4);this.tangentBufferOffset=this.colorBufferOffset+Float32Array.BYTES_PER_ELEMENT*this.colorBuffer.length;this._tangentBuffer=new Float32Array(this._array_buffer,this.tangentBufferOffset,this.length*4);this.tangentWrapper=new FloatBuffer(this._tangentBuffer,4);this.bitangentBufferOffset=this.tangentBufferOffset+Float32Array.BYTES_PER_ELEMENT*this.tangentBuffer.length;this._bitangentBuffer=new Float32Array(this._array_buffer,this.bitangentBufferOffset,this.length*3);this.bitangentWrapper=new FloatBuffer(this._bitangentBuffer,3);offset=this.bitangentBufferOffset+Float32Array.BYTES_PER_ELEMENT*this.bitangentBuffer.length;getterFactory=function(name){return function(){return this._buffers[name]}};ref=Jax.Mesh.Data.endpoints;for(name in ref){size=ref[name];buffer=new Float32Array(this._array_buffer,offset,this.length*size);wrapper=new FloatBuffer(buffer,size);this._offsets[name]=offset;this._buffers[name]=buffer;this._wrappers[name]=wrapper;offset+=buffer.length*Float32Array.BYTES_PER_ELEMENT;Object.defineProperty(this,name,{get:getterFactory(name)})}this.indexBufferOffset=offset;return this.indexBuffer=new this.indexFormat(this._array_buffer,this.indexBufferOffset,numIndices)};tmpvec3=vec3.create();Data.prototype.assignVertexData=function(vertices,colors,textures,normals,tangents,bitangents){var _btan,_cbuf,_nbuf,_tans,_tbuf,_vbuf,j,length,ofs,ofs2,ofs3,ofs4,ref,ref1,ref2,results;ref=[this.vertexBuffer,this._normalBuffer,this.colorBuffer,this.textureCoordsBuffer,this._tangentBuffer,this._bitangentBuffer],_vbuf=ref[0],_nbuf=ref[1],_cbuf=ref[2],_tbuf=ref[3],_tans=ref[4],_btan=ref[5];length=this.length;this._shouldRecalculateNormals=normals.length===0;this._shouldRecalculateTangents=tangents.length===0;this._shouldRecalculateBitangents=bitangents.length===0;results=[];for(ofs=j=0,ref1=length;0<=ref1?j<ref1:j>ref1;ofs=0<=ref1?++j:--j){ref2=[ofs*2,ofs*3,ofs*4],ofs2=ref2[0],ofs3=ref2[1],ofs4=ref2[2];_vbuf[ofs3]=vertices[ofs3];_vbuf[ofs3+1]=vertices[ofs3+1];_vbuf[ofs3+2]=vertices[ofs3+2];_nbuf[ofs3]=normals[ofs3];_nbuf[ofs3+1]=normals[ofs3+1];_nbuf[ofs3+2]=normals[ofs3+2];_tans[ofs4]=tangents[ofs4];_tans[ofs4+1]=tangents[ofs4+1];_tans[ofs4+2]=tangents[ofs4+2];_tans[ofs4+3]=tangents[ofs4+3];_btan[ofs4]=bitangents[ofs3];_btan[ofs4+1]=bitangents[ofs3+1];_btan[ofs4+2]=bitangents[ofs3+2];_tbuf[ofs2]=textures[ofs2]||0;_tbuf[ofs2+1]=textures[ofs2+1]||0;if(colors.length<=ofs4){results.push(_cbuf[ofs4]=_cbuf[ofs4+1]=_cbuf[ofs4+2]=_cbuf[ofs4+3]=1)}else{_cbuf[ofs4]=colors[ofs4];_cbuf[ofs4+1]=colors[ofs4+1];_cbuf[ofs4+2]=colors[ofs4+2];results.push(_cbuf[ofs4+3]=colors[ofs4+3])}}return results};return Data})()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,slice=[].slice;Jax.Mesh.Lines=(function(superClass){extend(Lines,superClass);function Lines(){var args;args=1<=arguments.length?slice.call(arguments,0):[];this.draw_mode||(this.draw_mode=GL_LINES);Lines.__super__.constructor.apply(this,args)}return Lines})(Jax.Mesh.Base)}).call(this);Jax.Geometry={DISJOINT:0,COINCIDE:1,INTERSECT:2};Jax.Geometry.Line=(function(){var bufs={};function Line(a,b){this.a=vec3.create();this.b=vec3.create();this.normal=vec3.create();this.length=0;if(arguments.length){this.set(a,b)}}jQuery.extend(Line.prototype,{set:function(a,b){vec3.copy(this.a,a);vec3.copy(this.b,b);vec3.subtract(this.normal,b,a);this.length=vec3.length(this.normal);vec3.normalize(this.normal,this.normal);return this},contains:function(point){var ba=vec3.subtract(bufs.ba||(bufs.ba=vec3.create()),this.b,this.a);var pa=vec3.subtract(bufs.pa||(bufs.pa=vec3.create()),point,this.a);var ab=vec3.subtract(bufs.ab||(bufs.ab=vec3.create()),this.a,this.b);var pb=vec3.subtract(bufs.pb||(bufs.pb=vec3.create()),point,this.b);vec3.normalize(ba,ba);vec3.normalize(pa,pa);vec3.normalize(ab,ab);vec3.normalize(pb,pb);return Math.equalish(ba,pa)&&Math.equalish(ab,pb)},intersectLineSegment:function(line,dest){var u=vec3.subtract(vec3.create(),this.b,this.a);var v=vec3.subtract(vec3.create(),line.b,line.a);var w=vec3.subtract(vec3.create(),this.a,line.a);var D=(u[0]*v[1]-u[1]*v[0]);var isVec3=dest&&!(dest instanceof Jax.Geometry.Line);if(Math.abs(D)<Math.EPSILON){if((u[0]*w[1]-u[1]*w[0])!=0||(v[0]*w[1]-v[1]*w[0])!=0){return Jax.Geometry.DISJOINT}var du=vec3.dot(u,u);var dv=vec3.dot(v,v);if(du==0&&dv==0){if(!Math.equalish(this.a,line.a)){return Jax.Geometry.DISJOINT}if(dest){if(isVec3){vec3.copy(dest,line.a)}else{vec3.copy(dest.a,line.a)}}return Jax.Geometry.INTERSECT}if(du==0){if(!line.contains(this.a)){return Jax.Geometry.DISJOINT}if(dest){if(isVec3){vec3.copy(dest,this.a)}else{vec3.copy(dest.a,this.a)}}return Jax.Geometry.INTERSECT}if(dv==0){if(!this.contains(line.a)){return Jax.Geometry.DISJOINT}if(dest){if(isVec3){vec3.set(dest,line.a)}else{vec3.set(dest.a,line.a)}}return Jax.Geometry.INTERSECT}var t0,t1;var w2=vec3.subtract(vec3.create(),this.a,line.a);if(v[0]!=0){t0=w[0]/v[0];t1=w2[0]/v[0]}else{t0=w[1]/v[1];t1=w2[1]/v[1]}if(t0>t1){var t=t0;t0=t1;t1=t}if(t0>1||t1<0){return Jax.Geometry.DISJOINT}t0=t0<0?0:t0;t1=t1>1?1:t1;if(t0==t1){if(line){if(dest){var dest_a=isVec3?dest:dest.a;vec3.add(dest_a,line.a,vec3.scale(dest_a,v,t0))}return Jax.Geometry.INTERSECT}}if(dest){if(isVec3){var tmp=bufs.tmp||(bufs.tmp=vec3.create());vec3.add(dest,line.a,vec3.scale(dest,v,t0));vec3.add(tmp,line.b,vec3.scale(tmp,v,t1));vec3.scale(dest,dest,0.5)}else{vec3.add(dest.a,line.a,vec3.scale(dest.a,v,t0));vec3.add(dest.b,line.b,vec3.scale(dest.b,v,t1))}}return Jax.Geometry.COINCIDENT}var sI=(v[0]*w[1]-v[1]*w[0])/D;if(sI<0||sI>1){return Jax.Geometry.DISJOINT}var tI=(u[0]*w[1]-u[1]*w[0])/D;if(tI<0||tI>1){return Jax.Geometry.DISJOINT}if(dest){vec3.add(dest,this.a,vec3.scale(dest,u,sI))}return Jax.Geometry.INTERSECT},toString:function(){return"[Line a:"+this.a+", b:"+this.b+"]"}});Object.defineProperty(Line.prototype,0,{get:function(){return this.a},set:function(v){return this.a=v},enumerable:false,configurable:false});Object.defineProperty(Line.prototype,1,{get:function(){return this.b},set:function(v){return this.b=v},enumerable:false,configurable:false});return Line})();Jax.Geometry.Plane=(function(){var bufs={};function innerProduct(a,x,y,z){return(a[0]*x+a[1]*y+a[2]*z)}function Plane(points){this.point=vec3.create();this.normal=vec3.clone([0,1,0]);this.d=0;if(arguments.length){this.set.apply(this,arguments)}}jQuery.extend(Plane.prototype,{toString:function(){return"[Plane normal:"+vec3.str(this.normal)+"; D:"+this.d+"]"},intersectTriangle:function(t,line){var ad=this.classifyVec3(t.a),bd=this.classifyVec3(t.b),cd=this.classifyVec3(t.c);var sideAB=ad*bd,sideBC=bd*cd;if(sideAB>0&&sideBC>0){return false}if(!line){return true}var otherSide,sameSide1,sameSide2;if(sideAB>0){sameSide1=t.a;sameSide2=t.b;otherSide=t.c}else{if(sideBC>0){otherSide=t.a;sameSide1=t.b;sameSide2=t.c}else{sameSide1=t.a;otherSide=t.b;sameSide2=t.c}}var seg1=bufs.tri_seg1=bufs.tri_seg1||new Jax.Geometry.Line();var seg2=bufs.tri_seg2=bufs.tri_seg2||new Jax.Geometry.Line();seg1.set(otherSide,sameSide1);seg2.set(otherSide,sameSide2);var p1=bufs.tri_p1=bufs.tri_p1||vec3.create(),p2=bufs.tri_p2=bufs.tri_p2||vec3.create();this.intersectLineSegment(seg1,p1);this.intersectLineSegment(seg2,p2);return line.set(p1,p2)},intersectLineSegment:function(line,point){var u=vec3.subtract((bufs.lineseg_u=bufs.lineseg_u||vec3.create()),line.b,line.a);var w=vec3.subtract((bufs.lineseg_w=bufs.lineseg_w||vec3.create()),line.a,this.point);var D=vec3.dot(this.normal,u);var N=-vec3.dot(this.normal,w);if(Math.abs(D)<Math.EPSILON){if(N==0){return Jax.Geometry.COINCIDE}else{return Jax.Geometry.DISJOINT}}var sI=N/D;if(sI<0||sI>1){return Jax.Geometry.DISJOINT}if(point){vec3.add(point,line.a,vec3.scale(point,u,sI))}return Jax.Geometry.INTERSECT},intersectRay:function(origin,direction){var numer=vec3.dot(this.normal,origin)+this.d;var denom=vec3.dot(this.normal,direction);if(denom==0){return false}var result=-(numer/denom);return -(numer/denom)},intersectPlane:function(p,line){var d1=this.d,d2=p.d;var p1n=this.normal,p2n=p.normal;var u=bufs.u=bufs.u||vec3.create();vec3.cross(u,p1n,p2n);var ax=(u[0]>=0?u[0]:-u[0]);var ay=(u[1]>=0?u[1]:-u[1]);var az=(u[2]>=0?u[2]:-u[2]);if((ax+ay+az)<Math.EPSILON){if(Math.equalish(d1,d2)){return Jax.Geometry.COINCIDE}else{return Jax.Geometry.DISJOINT}}if(line){var maxc;if(ax>ay){if(ax>az){maxc=0}else{maxc=2}}else{if(ay>az){maxc=1}else{maxc=2}}var iP=bufs.iP=bufs.iP||vec3.create();switch(maxc){case 0:iP[0]=0;iP[1]=(d2*p1n[2]-d1*p2n[2])/u[0];iP[2]=(d1*p2n[1]-d2*p1n[1])/u[0];break;case 1:iP[0]=(d1*p2n[2]-d2*p1n[2])/u[1];iP[1]=0;iP[2]=(d2*p1n[0]-d1*p2n[0])/u[1];break;case 2:iP[0]=(d2*p1n[1]-d1*p2n[1])/u[2];iP[1]=(d1*p2n[0]-d2*p1n[0])/u[2];iP[2]=0;break}vec3.copy(line[0],iP);vec3.add(line[1],iP,u)}return Jax.Geometry.INTERSECT},classifyVec3:function(O){if(O.array){return vec3.dot(this.normal,O.array)+this.d}else{return vec3.dot(this.normal,O)+this.d}},classify:function(x,y,z){var n=this.normal;return n[0]*x+n[1]*y+n[2]*z+this.d},set:function(){if(arguments.length==2){vec3.copy(this.normal,arguments[1]);this.d=-vec3.dot(arguments[1],arguments[0])}else{var tmp1=this.normal,tmp2=bufs.settmp2||(bufs.settmp2=vec3.create());var points=arguments;if(arguments.length!=3){points=arguments[0]}if(typeof(points[0])=="object"&&points[0].array){vec3.subtract(tmp1,points[1].array,points[0].array);vec3.subtract(tmp2,points[2].array,points[0].array);vec3.normalize(this.normal,vec3.cross(this.normal,tmp1,tmp2));this.d=-vec3.dot(this.normal,points[0].array)}else{vec3.subtract(tmp1,points[1],points[0]);vec3.subtract(tmp2,points[2],points[0]);vec3.normalize(this.normal,vec3.cross(this.normal,tmp1,tmp2));this.d=-vec3.dot(this.normal,points[0])}}vec3.scale(this.point,this.normal,this.d);return this},setCoefficients:function(a,b,c,d){var len=Math.sqrt(a*a+b*b+c*c);this.normal[0]=a/len;this.normal[1]=b/len;this.normal[2]=c/len;this.d=d/len;return this},whereis:function(){var point;if(arguments.length==3){point=arguments}else{if(arguments[0].array){point=arguments[0].array}else{point=arguments[0]}}var d=this.distance(point);if(d>0){return Jax.Geometry.Plane.FRONT}if(d<0){return Jax.Geometry.Plane.BACK}return Jax.Geometry.Plane.INTERSECT}});Plane.prototype.distance=Plane.prototype.classifyVec3;return Plane})();Jax.Geometry.Plane.FRONT=1;Jax.Geometry.Plane.BACK=2;Jax.Geometry.Plane.INTERSECT=3;Jax.Geometry.Triangle=(function(){var bufs={cwV1:vec3.create(),cwV2:vec3.create(),cwV3:vec3.create(),pitV0:vec3.create(),pitV1:vec3.create(),pitV2:vec3.create()};function slow_tri_tri_intersect(t1,t2,dest){var line1=bufs.slowtri_line1=bufs.slowtri_line1||new Jax.Geometry.Line();var line2=bufs.slowtri_line2=bufs.slowtri_line2||new Jax.Geometry.Line();if(t1.plane.intersectTriangle(t2,line1)&&t2.plane.intersectTriangle(t1,line2)){line1.intersectLineSegment(line2,dest);return true}else{return false}}function Triangle(a,b,c){this.a=vec3.create();this.b=vec3.create();this.c=vec3.create();this.center=vec3.create();this.normal=vec3.create();if(arguments.length>0){this.set.apply(this,arguments)}}jQuery.extend(Triangle.prototype,{set:function(a,b,c){return this.assign(vec3.clone(a),vec3.clone(b),vec3.clone(c))},assign:function(a,b,c){this.a=a;this.b=b;this.c=c;this.recalculateCenter();this.recalculateNormal();this.updateDescription();return this},setComponents:function(ax,ay,az,bx,by,bz,cx,cy,cz){this.a[0]=ax;this.a[1]=ay;this.a[2]=az;this.b[0]=bx;this.b[1]=by;this.b[2]=bz;this.c[0]=cx;this.c[1]=cy;this.c[2]=cz;this.recalculateCenter();this.recalculateNormal();this.updateDescription();return this},isClockwise:function(xform){var v1=bufs.cwV1,v2=bufs.cwV2,v3=bufs.cwV3;var a,b,c;if(xform){vec3.transformMat4(v1,this.a,xform);vec3.transformMat4(v2,this.b,xform);vec3.transformMat4(v3,this.c,xform);a=v1;b=v2;c=v3}else{a=this.a;b=this.b;c=this.c}vec3.subtract(v1,b,a);vec3.subtract(v2,c,a);return v1[0]*v2[1]-v1[1]*v2[0]>0},isCounterClockwise:function(xform){return !this.isClockwise(xform)},recalculateCenter:function(){vec3.add(this.center,this.a,this.b);vec3.add(this.center,this.c,this.center);vec3.scale(this.center,this.center,1/3);return this.center},recalculateNormal:function(){var tmp=bufs.tmp=bufs.tmp||vec3.create();vec3.subtract(this.normal,this.b,this.a);vec3.subtract(tmp,this.c,this.a);vec3.cross(this.normal,this.normal,tmp);vec3.normalize(this.normal,this.normal);return this.normal},getNormal:function(){return this.normal},toString:function(){return"Triangle: "+vec3.str(this.a)+"; "+vec3.str(this.b)+"; "+vec3.str(this.c)},intersectRay:function(O,D,cp,segmax){var p=this._p=this._p||new Jax.Geometry.Plane();p.set(this.a,this.b,this.c);var denom=vec3.dot(p.normal,D);if(Math.abs(denom)<Math.EPSILON){return false}var t=-(p.d+vec3.dot(p.normal,O))/denom;if(t<=0){return false}if(segmax!=undefined&&t>segmax){return false}vec3.copy(cp,D);vec3.scale(cp,cp,t);vec3.add(cp,O,cp);if(this.pointInTri(cp)){cp[3]=t;return true}return false},intersectSphere:function(O,radius,cp){var p=this._p=this._p||new Jax.Geometry.Plane();p.set(this.a,this.b,this.c);var dist=p.classify(O);if(Math.abs(dist)>radius){return false}var point=this._point=this._point||vec3.create();vec3.scale(point,p.normal,dist);vec3.subtract(point,O,point);if(this.pointInTri(point)){if(cp){vec3.copy(cp,point)}return true}var v=bufs.v=bufs.v||[];var u=bufs.u=bufs.u||vec3.create();var pa=bufs.pa=bufs.pa||vec3.create();var tmp=bufs.tmp=bufs.tmp||vec3.create();var radsquared=radius*radius;v[0]=this.a;v[1]=this.b;v[2]=this.c;v[3]=this.a;for(var i=0;i<3;i++){vec3.subtract(u,v[i+1],v[i]);vec3.subtract(pa,O,v[i]);var s=vec3.dot(u,pa)/vec3.dot(u,u);if(s<0){vec3.copy(tmp,v[i])}else{if(s>1){vec3.copy(tmp,v[i+1])}else{vec3.scale(tmp,u,s);vec3.add(tmp,v[i],tmp)}}if(cp){vec3.copy(cp,tmp)}vec3.subtract(tmp,O,tmp);var sq_dist=vec3.dot(tmp,tmp);if(sq_dist<=radsquared){return true}}return false},intersectTriangle:function(t,dest){if(dest){return slow_tri_tri_intersect(this,t,dest)}else{return Jax.Geometry.Triangle.tri_tri_intersect(this.a,this.b,this.c,t.a,t.b,t.c)}},updateDescription:function(){var p=this.plane=this.plane||new Jax.Geometry.Plane(this.a,this.b,this.c);var n=p.normal;var a=[Math.abs(n.x),Math.abs(n.y),Math.abs(n.z)];if(a[0]>a[1]){if(a[0]>a[2]){this._i1=1;this._i2=2}else{this._i1=0;this._i2=1}}else{if(a[1]>a[2]){this._i1=0;this._i2=2}else{this._i1=0;this._i2=1}}return this},pointInTri:function(P){var a=this.a,b=this.b,c=this.c;var v0=bufs.pitV0,v1=bufs.pitV1,v2=bufs.pitV2;vec3.subtract(v0,c,a);vec3.subtract(v1,b,a);vec3.subtract(v2,P,a);var dot00=vec3.dot(v0,v0),dot01=vec3.dot(v0,v1),dot02=vec3.dot(v0,v2),dot11=vec3.dot(v1,v1),dot12=vec3.dot(v1,v2);var invDenom=1/(dot00*dot11-dot01*dot01),u=(dot11*dot02-dot01*dot12)*invDenom,v=(dot00*dot12-dot01*dot02)*invDenom;return(u>=0)&&(v>=0)&&(u+v<1)}});Object.defineProperty(Triangle.prototype,0,{get:function(){return this.a},set:function(v){return this.a=v},enumerable:false,configurable:false});Object.defineProperty(Triangle.prototype,1,{get:function(){return this.b},set:function(v){return this.b=v},enumerable:false,configurable:false});Object.defineProperty(Triangle.prototype,2,{get:function(){return this.c},set:function(v){return this.c=v},enumerable:false,configurable:false});return Triangle})();(function(){var bufs;if(typeof(bufs)=="undefined"){bufs={}}function coplanar_tri_tri(N,V0,V1,V2,U0,U1,U2){var A=bufs.tritri_A=bufs.tritri_A||vec3.create();var i0,i1;A[0]=Math.abs(N[0]);A[1]=Math.abs(N[1]);A[2]=Math.abs(N[2]);if(A[0]>A[1]){if(A[0]>A[2]){i0=1;i1=2}else{i0=0;i1=1}}else{if(A[2]>A[1]){i0=0;i1=1}else{i0=0;i1=2}}var Ax,Ay,Bx,By,Cx,Cy,e,d,f;Ax=V1[i0]-V0[i0];Ay=V1[i1]-V0[i1];Bx=U0[i0]-U1[i0];By=U0[i1]-U1[i1];Cx=V0[i0]-U0[i0];Cy=V0[i1]-U0[i1];f=Ay*Bx-Ax*By;d=By*Cx-Bx*Cy;if((f>0&&d>=0&&d<=f)||(f<0&&d<=0&&d>=f)){e=Ax*Cy-Ay*Cx;if(f>0){if(e>=0&&e<=f){return true}}else{if(e<=0&&e>=f){return true}}}Bx=U1[i0]-U2[i0];By=U1[i1]-U2[i1];Cx=V0[i0]-U1[i0];Cy=V0[i1]-U1[i1];f=Ay*Bx-Ax*By;d=By*Cx-Bx*Cy;if((f>0&&d>=0&&d<=f)||(f<0&&d<=0&&d>=f)){e=Ax*Cy-Ay*Cx;if(f>0){if(e>=0&&e<=f){return true}}else{if(e<=0&&e>=f){return true}}}Bx=U2[i0]-U0[i0];By=U2[i1]-U0[i1];Cx=V0[i0]-U2[i0];Cy=V0[i1]-U2[i1];f=Ay*Bx-Ax*By;d=By*Cx-Bx*Cy;if((f>0&&d>=0&&d<=f)||(f<0&&d<=0&&d>=f)){e=Ax*Cy-Ay*Cx;if(f>0){if(e>=0&&e<=f){return true}}else{if(e<=0&&e>=f){return true}}}var Ax,Ay,Bx,By,Cx,Cy,e,d,f;Ax=V2[i0]-V1[i0];Ay=V2[i1]-V1[i1];Bx=U0[i0]-U1[i0];By=U0[i1]-U1[i1];Cx=V1[i0]-U0[i0];Cy=V1[i1]-U0[i1];f=Ay*Bx-Ax*By;d=By*Cx-Bx*Cy;if((f>0&&d>=0&&d<=f)||(f<0&&d<=0&&d>=f)){e=Ax*Cy-Ay*Cx;if(f>0){if(e>=0&&e<=f){return true}}else{if(e<=0&&e>=f){return true}}}Bx=U1[i0]-U2[i0];By=U1[i1]-U2[i1];Cx=V1[i0]-U1[i0];Cy=V1[i1]-U1[i1];f=Ay*Bx-Ax*By;d=By*Cx-Bx*Cy;if((f>0&&d>=0&&d<=f)||(f<0&&d<=0&&d>=f)){e=Ax*Cy-Ay*Cx;if(f>0){if(e>=0&&e<=f){return true}}else{if(e<=0&&e>=f){return true}}}Bx=U2[i0]-U0[i0];By=U2[i1]-U0[i1];Cx=V1[i0]-U2[i0];Cy=V1[i1]-U2[i1];f=Ay*Bx-Ax*By;d=By*Cx-Bx*Cy;if((f>0&&d>=0&&d<=f)||(f<0&&d<=0&&d>=f)){e=Ax*Cy-Ay*Cx;if(f>0){if(e>=0&&e<=f){return true}}else{if(e<=0&&e>=f){return true}}}var Ax,Ay,Bx,By,Cx,Cy,e,d,f;Ax=V0[i0]-V2[i0];Ay=V0[i1]-V2[i1];Bx=U0[i0]-U1[i0];By=U0[i1]-U1[i1];Cx=V2[i0]-U0[i0];Cy=V2[i1]-U0[i1];f=Ay*Bx-Ax*By;d=By*Cx-Bx*Cy;if((f>0&&d>=0&&d<=f)||(f<0&&d<=0&&d>=f)){e=Ax*Cy-Ay*Cx;if(f>0){if(e>=0&&e<=f){return true}}else{if(e<=0&&e>=f){return true}}}Bx=U1[i0]-U2[i0];By=U1[i1]-U2[i1];Cx=V2[i0]-U1[i0];Cy=V2[i1]-U1[i1];f=Ay*Bx-Ax*By;d=By*Cx-Bx*Cy;if((f>0&&d>=0&&d<=f)||(f<0&&d<=0&&d>=f)){e=Ax*Cy-Ay*Cx;if(f>0){if(e>=0&&e<=f){return true}}else{if(e<=0&&e>=f){return true}}}Bx=U2[i0]-U0[i0];By=U2[i1]-U0[i1];Cx=V2[i0]-U2[i0];Cy=V2[i1]-U2[i1];f=Ay*Bx-Ax*By;d=By*Cx-Bx*Cy;if((f>0&&d>=0&&d<=f)||(f<0&&d<=0&&d>=f)){e=Ax*Cy-Ay*Cx;if(f>0){if(e>=0&&e<=f){return true}}else{if(e<=0&&e>=f){return true}}}var a,b,c,d0,d1,d2;a=U1[i1]-U0[i1];b=-(U1[i0]-U0[i0]);c=-a*U0[i0]-b*U0[i1];d0=a*V0[i0]+b*V0[i1]+c;a=U2[i1]-U1[i1];b=-(U2[i0]-U1[i0]);c=-a*U1[i0]-b*U1[i1];d1=a*V0[i0]+b*V0[i1]+c;a=U0[i1]-U2[i1];b=-(U0[i0]-U2[i0]);c=-a*U2[i0]-b*U2[i1];d2=a*V0[i0]+b*V0[i1]+c;if(d0*d1>0){if(d0*d2>0){return true}}var a,b,c,d0,d1,d2;a=V1[i1]-V0[i1];b=-(V1[i0]-V0[i0]);c=-a*V0[i0]-b*V0[i1];d0=a*U0[i0]+b*U0[i1]+c;a=V2[i1]-V1[i1];b=-(V2[i0]-V1[i0]);c=-a*V1[i0]-b*V1[i1];d1=a*U0[i0]+b*U0[i1]+c;a=V0[i1]-V2[i1];b=-(V0[i0]-V2[i0]);c=-a*V2[i0]-b*V2[i1];d2=a*U0[i0]+b*U0[i1]+c;if(d0*d1>0){if(d0*d2>0){return true}}return false}Jax.Geometry.Triangle.tri_tri_intersect=function(V0,V1,V2,U0,U1,U2){var E1=bufs.tritri_E1=bufs.tritri_E1||vec3.create(),E2=bufs.tritri_E2=bufs.tritri_E2||vec3.create(),N1=bufs.tritri_N1=bufs.tritri_N1||vec3.create(),N2=bufs.tritri_N2=bufs.tritri_N2||vec3.create(),D=bufs.tritri_D=bufs.tritri_D||vec3.create(),isect1=bufs.tritri_isect1=bufs.tritri_isect1||vec2.create(),isect2=bufs.tritri_isect2=bufs.tritri_isect2||vec2.create();var d1,d2;var du0,du1,du2,dv0,dv1,dv2;var du0du1,du0du2,dv0dv1,dv0dv2;var index;var vp0,vp1,vp2;var up0,up1,up2;var b,c,max;vec3.subtract(E1,V1,V0);vec3.subtract(E2,V2,V0);vec3.cross(N1,E1,E2);d1=-vec3.dot(N1,V0);du0=vec3.dot(N1,U0)+d1;du1=vec3.dot(N1,U1)+d1;du2=vec3.dot(N1,U2)+d1;if(Math.abs(du0)<Math.EPSILON){du0=0}if(Math.abs(du1)<Math.EPSILON){du1=0}if(Math.abs(du2)<Math.EPSILON){du2=0}du0du1=du0*du1;du0du2=du0*du2;if(du0du1>0&&du0du2>0){return false}vec3.subtract(E1,U1,U0);vec3.subtract(E2,U2,U0);vec3.cross(N2,E1,E2);d2=-vec3.dot(N2,U0);dv0=vec3.dot(N2,V0)+d2;dv1=vec3.dot(N2,V1)+d2;dv2=vec3.dot(N2,V2)+d2;if(Math.abs(dv0)<Math.EPSILON){dv0=0}if(Math.abs(dv1)<Math.EPSILON){dv1=0}if(Math.abs(dv2)<Math.EPSILON){dv2=0}dv0dv1=dv0*dv1;dv0dv2=dv0*dv2;if(dv0dv1>0&&dv0dv2>0){return false}vec3.cross(D,N1,N2);max=Math.abs(D[0]);index=0;b=Math.abs(D[1]);c=Math.abs(D[2]);if(b>max){max=b;index=1}if(c>max){max=c;index=2}vp0=V0[index];vp1=V1[index];vp2=V2[index];up0=U0[index];up1=U1[index];up2=U2[index];try{if(dv0dv1>0){isect1[0]=vp2+(vp0-vp2)*dv2/(dv2-dv0);isect1[1]=vp2+(vp1-vp2)*dv2/(dv2-dv1)}else{if(dv0dv2>0){isect1[0]=vp1+(vp0-vp1)*dv1/(dv1-dv0);isect1[1]=vp1+(vp2-vp1)*dv1/(dv1-dv2)}else{if(dv1*dv2>0||dv0!=0){isect1[0]=vp0+(vp1-vp0)*dv0/(dv0-dv1);isect1[1]=vp0+(vp2-vp0)*dv0/(dv0-dv2)}else{if(dv1!=0){isect1[0]=vp1+(vp0-vp1)*dv1/(dv1-dv0);isect1[1]=vp1+(vp2-vp1)*dv1/(dv1-dv2)}else{if(dv2!=0){isect1[0]=vp2+(vp0-vp2)*dv2/(dv2-dv0);isect1[1]=vp2+(vp1-vp2)*dv2/(dv2-dv1)}else{return coplanar_tri_tri(N1,V0,V1,V2,U0,U1,U2)}}}}}if(du0du1>0){isect2[0]=up2+(up0-up2)*du2/(du2-du0);isect2[1]=up2+(up1-up2)*du2/(du2-du1)}else{if(du0du2>0){isect2[0]=up1+(up0-up1)*du1/(du1-du0);isect2[1]=up1+(up2-up1)*du1/(du1-du2)}else{if(du1*du2>0||du0!=0){isect2[0]=up0+(up1-up0)*du0/(du0-du1);isect2[1]=up0+(up2-up0)*du0/(du0-du2)}else{if(du1!=0){isect2[0]=up1+(up0-up1)*du1/(du1-du0);isect2[1]=up1+(up2-up1)*du1/(du1-du2)}else{if(du2!=0){isect2[0]=up2+(up0-up2)*du2/(du2-du0);isect2[1]=up2+(up1-up2)*du2/(du2-du1)}else{return coplanar_tri_tri(N1,V0,V1,V2,U0,U1,U2)}}}}}}catch(e){if(e==1){return coplanar_tri_tri(N1,V0,V1,V2,U0,U1,U2)}throw e}if(isect1[0]>isect1[1]){var c;c=isect1[0];isect1[0]=isect1[1];isect1[1]=c}if(isect2[0]>isect1[1]){var c;c=isect2[0];isect2[0]=isect1[1];isect1[1]=c}if(isect1[1]<isect2[0]||isect2[1]<isect1[0]){return false}return true}})();(function(){var bufs;bufs={vec:vec3.create(),tri:new Jax.Geometry.Triangle()};Jax.Mesh.Normals={recalculateNormals:function(){var ai,ai3,avx,avy,avz,bi,bi3,bvx,bvy,bvz,ci,ci3,colors,cvx,cvy,cvz,data,i,i3,j,k,l,ni,normal,normals,numTris,recalcVec,recalcVecs,ref,ref1,ref2,ref3,ref4,ref5,ref6,ref7,ref8,ref9,results,rn,rnlen,textures,tri,triangleOrder,vertices,vx,vy,vz;recalcVec=bufs.vec;tri=bufs.tri;recalcVecs={};data=this.data;ref=[data.vertexBuffer,data.colorBuffer,data.textureCoordsBuffer,data.normalBuffer],vertices=ref[0],colors=ref[1],textures=ref[2],normals=ref[3];triangleOrder=this.triangleOrder;numTris=triangleOrder.length;for(i=j=0,ref1=numTris;j<ref1;i=j+=3){ref2=[triangleOrder[i],triangleOrder[i+1],triangleOrder[i+2]],ai=ref2[0],bi=ref2[1],ci=ref2[2];ref3=[ai*3,bi*3,ci*3],ai3=ref3[0],bi3=ref3[1],ci3=ref3[2];ref4=[vertices[ai3],vertices[ai3+1],vertices[ai3+2]],avx=ref4[0],avy=ref4[1],avz=ref4[2];ref5=[vertices[bi3],vertices[bi3+1],vertices[bi3+2]],bvx=ref5[0],bvy=ref5[1],bvz=ref5[2];ref6=[vertices[ci3],vertices[ci3+1],vertices[ci3+2]],cvx=ref6[0],cvy=ref6[1],cvz=ref6[2];tri.setComponents(avx,avy,avz,bvx,bvy,bvz,cvx,cvy,cvz);normal=tri.getNormal();rn=recalcVecs[ai]||(recalcVecs[ai]=[]);rn.push(normal[0],normal[1],normal[2]);rn=recalcVecs[bi]||(recalcVecs[bi]=[]);rn.push(normal[0],normal[1],normal[2]);rn=recalcVecs[ci]||(recalcVecs[ci]=[]);rn.push(normal[0],normal[1],normal[2])}results=[];for(i=k=0,ref7=data.length;0<=ref7?k<ref7:k>ref7;i=0<=ref7?++k:--k){i3=i*3;ref8=[vertices[i3],vertices[i3+1],vertices[i3+2]],vx=ref8[0],vy=ref8[1],vz=ref8[2];recalcVec[0]=recalcVec[1]=recalcVec[2]=0;rn=recalcVecs[i]||(recalcVecs[i]=[]);rnlen=rn.length;for(ni=l=0,ref9=rnlen;l<ref9;ni=l+=3){recalcVec[0]+=rn[ni];recalcVec[1]+=rn[ni+1];recalcVec[2]+=rn[ni+2]}vec3.scale(recalcVec,recalcVec,3/rnlen);data.normalBuffer[i3]=recalcVec[0];data.normalBuffer[i3+1]=recalcVec[1];results.push(data.normalBuffer[i3+2]=recalcVec[2])}return results}}}).call(this);(function(){var itertri,tangentBufs;tangentBufs={v1:vec3.create(),v2:vec3.create(),v3:vec3.create(),w1:vec2.create(),w2:vec2.create(),w3:vec2.create(),sdir:vec3.create(),tdir:vec3.create(),n:vec3.create(),t:vec3.create(),tan:vec3.create()};itertri=new Jax.Geometry.Triangle();Jax.Mesh.Tangents={eachTriangle:function(callback){var a,i1,i1x,i1y,i1z,i2,i2x,i2y,i2z,i3,i3x,i3y,i3z,j,numTris,ref,ref1,triangleOrder,triangleOrderLength,vbuf;vbuf=this.data.vertexBuffer;triangleOrder=this.triangleOrder;triangleOrderLength=triangleOrder.length;numTris=0;for(a=j=0,ref=triangleOrderLength;j<ref;a=j+=3){numTris+=1;ref1=[triangleOrder[a],triangleOrder[a+1],triangleOrder[a+2]],i1=ref1[0],i2=ref1[1],i3=ref1[2];i1x=i1*3;i1y=i1x*3+1;i1z=i1x*3+2;i2x=i2*3;i2y=i2x*3+1;i2z=i2x*3+2;i3x=i3*3;i3y=i3x*3+1;i3z=i3x*3+2;itertri.setComponents(vbuf[i1x],vbuf[i1y],vbuf[i1z],vbuf[i2x],vbuf[i2y],vbuf[i2z],vbuf[i3x],vbuf[i3y],vbuf[i3z]);if(callback(itertri)===false){return numTris}}return numTris},recalculateBitangents:function(){var bitangent,bitangents,data,i,i3,i4,j,len,normal,normals,ref,ref1,results,tangents;data=this.data;if(data.shouldRecalculateTangents()){this.recalculateTangents()}ref=[data.tangentBuffer,data.bitangentBuffer,data.normalBuffer],tangents=ref[0],bitangents=ref[1],normals=ref[2];len=data.length;bitangent=tangentBufs.tan;normal=tangentBufs.n;results=[];for(i=j=0,ref1=len;0<=ref1?j<ref1:j>ref1;i=0<=ref1?++j:--j){i3=i*3;i4=i*4;bitangent[0]=tangents[i4];bitangent[1]=tangents[i4+1];bitangent[2]=tangents[i4+2];normal[0]=normals[i3];normal[1]=normals[i3+1];normal[2]=normals[i3+2];vec3.cross(bitangent,normal,bitangent);vec3.scale(tangents[i4+3],bitangent);bitangents[i3]=bitangent[0];bitangents[i3+1]=bitangent[1];results.push(bitangents[i3+2]=bitangent[2])}return results},recalculateTangents:function(){var a,a3,a4,buf,data,dot,i1,i13,i2,i23,i3,i33,j,k,n,normalize,num,numTangents,r,ref,ref1,ref2,ref3,ref4,ref5,ref6,ref7,results,s1,s2,sdir,set,t,t1,t2,tan,tan1,tan2,tdir,triangleOrder,triangleOrderLength,v1,v2,v3,w1,w2,w3,x,x1,x2,y,y1,y2,z,z1,z2;if(this.data.shouldRecalculateNormals()){this.recalculateNormals()}data=this.data;numTangents=3*data.length;buf=new ArrayBuffer(numTangents*Float32Array.BYTES_PER_ELEMENT*2);tan1=new Float32Array(buf,0,numTangents);tan2=new Float32Array(buf,numTangents*Float32Array.BYTES_PER_ELEMENT,numTangents);ref=[tangentBufs.v1,tangentBufs.v2,tangentBufs.v3],v1=ref[0],v2=ref[1],v3=ref[2];ref1=[tangentBufs.w1,tangentBufs.w2,tangentBufs.w3],w1=ref1[0],w2=ref1[1],w3=ref1[2];ref2=[tangentBufs.sdir,tangentBufs.tdir],sdir=ref2[0],tdir=ref2[1];ref3=[tangentBufs.n,tangentBufs.t,tangentBufs.tan],n=ref3[0],t=ref3[1],tan=ref3[2];set=function(v,w,i,i3){v[0]=data.vertexBuffer[i3];v[1]=data.vertexBuffer[i3+1];v[2]=data.vertexBuffer[i3+2];w[0]=data.textureCoordsBuffer[i*2];return w[1]=data.textureCoordsBuffer[i*2+1]};triangleOrder=this.triangleOrder;triangleOrderLength=triangleOrder.length;for(a=j=0,ref4=triangleOrderLength;j<ref4;a=j+=3){ref5=[triangleOrder[a],triangleOrder[a+1],triangleOrder[a+2]],i1=ref5[0],i2=ref5[1],i3=ref5[2];ref6=[i1*3,i2*3,i3*3],i13=ref6[0],i23=ref6[1],i33=ref6[2];set(v1,w1,i1,i13);set(v2,w2,i2,i23);set(v3,w3,i3,i33);x1=v2[0]-v1[0];x2=v3[0]-v1[0];y1=v2[1]-v1[1];y2=v3[1]-v1[1];z1=v2[2]-v1[2];z2=v3[2]-v1[2];s1=w2[0]-w1[0];s2=w3[0]-w1[0];t1=w2[1]-w1[1];t2=w3[1]-w1[1];r=1/(s1*t2-s2*t1);if(r===(1/0)){r=0}sdir[0]=(t2*x1-t1*x2)*r;sdir[1]=(t2*y1-t1*y2)*r;sdir[2]=(t2*z1-t1*z2)*r;tdir[0]=(s1*x2-s2*x1)*r;tdir[1]=(s1*y2-s2*y1)*r;tdir[2]=(s1*z2-s2*z1)*r;tan1[i13]+=sdir[0];tan1[i13+1]+=sdir[1];tan1[i13+2]+=sdir[2];tan1[i23]+=sdir[0];tan1[i23+1]+=sdir[1];tan1[i23+2]+=sdir[2];tan1[i33]+=sdir[0];tan1[i33+1]+=sdir[1];tan1[i33+2]+=sdir[2];tan2[i13]+=tdir[0];tan2[i13+1]+=tdir[1];tan2[i13+2]+=tdir[2];tan2[i23]+=tdir[0];tan2[i23+1]+=tdir[1];tan2[i23+2]+=tdir[2];tan2[i33]+=tdir[0];tan2[i33+1]+=tdir[1];tan2[i33+2]+=tdir[2]}num=data.tangentBuffer.length/4;results=[];for(a=k=0,ref7=num;0<=ref7?k<ref7:k>ref7;a=0<=ref7?++k:--k){a3=a*3;a4=a*4;n[0]=data.normalBuffer[a3];n[1]=data.normalBuffer[a3+1];n[2]=data.normalBuffer[a3+2];t[0]=tan1[a3];t[1]=tan1[a3+1];t[2]=tan1[a3+2];dot=vec3.dot(n,t);x=t[0]-n[0]*dot;y=t[1]-n[1]*dot;z=t[2]-n[2]*dot;normalize=1/Math.sqrt(x*x+y*y+z*z);data.tangentBuffer[a4]=x*normalize;data.tangentBuffer[a4+1]=y*normalize;data.tangentBuffer[a4+2]=z*normalize;tan[0]=tan2[a3];tan[1]=tan2[a3+1];tan[2]=tan2[a3+2];results.push(data.tangentBuffer[a4+3]=(vec3.dot(vec3.cross(n,n,t),tan)<0?-1:1))}return results}}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,slice=[].slice;Jax.Mesh.TriangleFan=(function(superClass){extend(TriangleFan,superClass);TriangleFan.include(Jax.Mesh.Tangents);TriangleFan.include(Jax.Mesh.Normals);function TriangleFan(){var args;args=1<=arguments.length?slice.call(arguments,0):[];this.draw_mode||(this.draw_mode=GL_TRIANGLE_FAN);TriangleFan.__super__.constructor.apply(this,args);this.triangleOrder=[];this.on("validated",(function(_this){return function(){return _this.updateTriangleOrder()}})(this))}TriangleFan.prototype.updateTriangleOrder=function(){var i,indices,j,numIndices,ref,results,triangleOrder;triangleOrder=this.triangleOrder;indices=this.data.indexBuffer;numIndices=indices.length;triangleOrder.splice(0,triangleOrder.length);results=[];for(i=j=2,ref=numIndices;2<=ref?j<ref:j>ref;i=2<=ref?++j:--j){results.push(triangleOrder.push(indices[0],indices[i-1],indices[i]))}return results};return TriangleFan})(Jax.Mesh.Base)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,slice=[].slice;Jax.Mesh.TriangleStrip=(function(superClass){extend(TriangleStrip,superClass);TriangleStrip.include(Jax.Mesh.Tangents);TriangleStrip.include(Jax.Mesh.Normals);function TriangleStrip(){var args;args=1<=arguments.length?slice.call(arguments,0):[];this.draw_mode||(this.draw_mode=GL_TRIANGLE_STRIP);TriangleStrip.__super__.constructor.apply(this,args);this.triangleOrder=[];this.on("validated",(function(_this){return function(){return _this.updateTriangleOrder()}})(this))}TriangleStrip.prototype.updateTriangleOrder=function(){var i,indices,j,numIndices,ref,results,triangleOrder;triangleOrder=this.triangleOrder;indices=this.data.indexBuffer;numIndices=indices.length;triangleOrder.splice(0,triangleOrder.length);results=[];for(i=j=2,ref=numIndices;j<ref;i=j+=2){triangleOrder.push(indices[i-2],indices[i-1],indices[i]);if(i<numIndices-1){results.push(triangleOrder.push(indices[i],indices[i-1],indices[i+1]))}else{results.push(void 0)}}return results};return TriangleStrip})(Jax.Mesh.Base)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,slice=[].slice;Jax.Mesh.Triangles=(function(superClass){var PRECISION;extend(Triangles,superClass);Triangles.include(Jax.Mesh.Tangents);Triangles.include(Jax.Mesh.Normals);PRECISION=6;function Triangles(){var args;args=1<=arguments.length?slice.call(arguments,0):[];this.draw_mode||(this.draw_mode=GL_TRIANGLES);Triangles.__super__.constructor.apply(this,args);this.triangleOrder=[];this.on("validated",(function(_this){return function(){return _this.updateTriangleOrder()}})(this))}Triangles.prototype.updateTriangleOrder=function(){var i,indices,j,numIndices,ref,results,triangleOrder;triangleOrder=this.triangleOrder;indices=this.data.indexBuffer;numIndices=indices.length;triangleOrder.splice(0,triangleOrder.length);results=[];for(i=j=0,ref=numIndices;j<ref;i=j+=3){results.push(triangleOrder.push(indices[i],indices[i+1],indices[i+2]))}return results};Triangles.prototype.hash=function(vx,vy,vz,cr,cg,cb,ca,ts,tt,nx,ny,nz,ax,ay,az,aw,bx,bY,bz){if(cr==null){cr=0}if(cg==null){cg=0}if(cb==null){cb=0}if(ca==null){ca=0}if(ts==null){ts=0}if(tt==null){tt=0}if(nx==null){nx=0}if(ny==null){ny=0}if(nz==null){nz=0}if(ax==null){ax=0}if(ay==null){ay=0}if(az==null){az=0}if(aw==null){aw=0}if(bx==null){bx=0}if(bY==null){bY=0}if(bz==null){bz=0}return((vx.toFixed(PRECISION))+","+(vy.toFixed(PRECISION))+","+(vz.toFixed(PRECISION))+",")+((cr.toFixed(PRECISION))+","+(cg.toFixed(PRECISION))+","+(cb.toFixed(PRECISION))+",")+((ca.toFixed(PRECISION))+","+(ts.toFixed(PRECISION))+","+(tt.toFixed(PRECISION))+",")+((nx.toFixed(PRECISION))+","+(ny.toFixed(PRECISION))+","+(nz.toFixed(PRECISION))+",")+((ax.toFixed(PRECISION))+","+(ay.toFixed(PRECISION))+","+(az.toFixed(PRECISION))+",")+((aw.toFixed(PRECISION))+","+(bx.toFixed(PRECISION))+","+(bY.toFixed(PRECISION))+",")+(""+(bz.toFixed(PRECISION)))};Triangles.prototype.split=function(vertices,colors,textures,normals,indices,tangents,bitangents){var _a,_b,_c,_h,_i,_n,_t,_v,aw,ax,ay,az,bY,bx,bz,ca,cb,cg,cr,i,i1,i2,i3,j,max,newMesh,nx,ny,nz,ref,ref1,ref10,ref11,ref12,ref13,ref14,ref15,ref16,ref17,ref18,ref2,ref3,ref4,ref5,ref6,ref7,ref8,ref9,tracker,ts,tt,vx,vy,vz;max=65535;if(vertices.length<=max*3){return null}_c=[];_t=[];_n=[];_v=[];_i=[];_a=[];_b=[];tracker={};if(indices.length===0){indices=(function(){var j,ref,results;results=[];for(i=j=0,ref=vertices.length;j<ref;i=j+=3){results.push(i/3)}return results})()}for(i=j=0,ref=indices.length;j<ref;i=j+=3){i1=indices[i];i2=indices[i+1];i3=indices[i+2];if(i1>max||i2>max||i3>max){ref1=[vertices[i1*3],vertices[i1*3+1],vertices[i1*3+2]],vx=ref1[0],vy=ref1[1],vz=ref1[2];ref2=[normals[i1*3],normals[i1*3+1],normals[i1*3+2]],nx=ref2[0],ny=ref2[1],nz=ref2[2];ref3=[textures[i1*2],textures[i1*2+1]],ts=ref3[0],tt=ref3[1];ref4=[colors[i1*4],colors[i1*4+1],colors[i1*4+2],colors[i1*4+3]],cr=ref4[0],cg=ref4[1],cb=ref4[2],ca=ref4[3];ref5=[tangents[i1*4],tangents[i1*4+1],tangents[i1*4+2],tangents[i1*4+3]],ax=ref5[0],ay=ref5[1],az=ref5[2],aw=ref5[3];ref6=[bitangents[i1*3],bitangents[i1*3+1],bitangents[i1*3+2]],bx=ref6[0],bY=ref6[1],bz=ref6[2];_h=this.hash(vx,vy,vz,nx,ny,nz,ts,tt,cr,cg,cb,ca,ax,ay,az,aw,bx,bY,bz);if(tracker[_h]){_i.push(tracker[_h])}else{_i.push(tracker[_h]=_v.length/3);_v.push(vx,vy,vz);if(colors.length){_c.push(cr,cg,cb,ca)}if(textures.length){_t.push(ts,tt)}if(normals.length){_n.push(nx,ny,nz)}if(tangents.length){_a.push(ax,ay,az,aw)}if(bitangents.length){_b.push(bx,bY,bz)}}ref7=[vertices[i2*3],vertices[i2*3+1],vertices[i2*3+2]],vx=ref7[0],vy=ref7[1],vz=ref7[2];ref8=[normals[i2*3],normals[i2*3+1],normals[i2*3+2]],nx=ref8[0],ny=ref8[1],nz=ref8[2];ref9=[textures[i2*2],textures[i2*2+1]],ts=ref9[0],tt=ref9[1];ref10=[colors[i2*4],colors[i2*4+1],colors[i2*4+2],colors[i2*4+3]],cr=ref10[0],cg=ref10[1],cb=ref10[2],ca=ref10[3];ref11=[tangents[i2*4],tangents[i2*4+1],tangents[i2*4+2],tangents[i2*4+3]],ax=ref11[0],ay=ref11[1],az=ref11[2],aw=ref11[3];ref12=[bitangents[i2*3],bitangents[i2*3+1],bitangents[i2*3+2]],bx=ref12[0],bY=ref12[1],bz=ref12[2];_h=this.hash(vx,vy,vz,nx,ny,nz,ts,tt,cr,cg,cb,ca,ax,ay,az,aw,bx,bY,bz);if(tracker[_h]){_i.push(tracker[_h])}else{_i.push(tracker[_h]=_v.length/3);_v.push(vx,vy,vz);if(colors.length){_c.push(cr,cg,cb,ca)}if(textures.length){_t.push(ts,tt)}if(normals.length){_n.push(nx,ny,nz)}if(tangents.length){_a.push(ax,ay,az,aw)}if(bitangents.length){_b.push(bx,bY,bz)}}ref13=[vertices[i3*3],vertices[i3*3+1],vertices[i3*3+2]],vx=ref13[0],vy=ref13[1],vz=ref13[2];ref14=[normals[i3*3],normals[i3*3+1],normals[i3*3+2]],nx=ref14[0],ny=ref14[1],nz=ref14[2];ref15=[textures[i3*2],textures[i3*2+1]],ts=ref15[0],tt=ref15[1];ref16=[colors[i3*4],colors[i3*4+1],colors[i3*4+2],colors[i3*4+3]],cr=ref16[0],cg=ref16[1],cb=ref16[2],ca=ref16[3];ref17=[tangents[i3*4],tangents[i3*4+1],tangents[i3*4+2],tangents[i3*4+3]],ax=ref17[0],ay=ref17[1],az=ref17[2],aw=ref17[3];ref18=[bitangents[i3*3],bitangents[i3*3+1],bitangents[i3*3+2]],bx=ref18[0],bY=ref18[1],bz=ref18[2];_h=this.hash(vx,vy,vz,nx,ny,nz,ts,tt,cr,cg,cb,ca,ax,ay,az,aw,bx,bY,bz);if(tracker[_h]){_i.push(tracker[_h])}else{_i.push(tracker[_h]=_v.length/3);_v.push(vx,vy,vz);if(colors.length){_c.push(cr,cg,cb,ca)}if(textures.length){_t.push(ts,tt)}if(normals.length){_n.push(nx,ny,nz)}if(tangents.length){_a.push(ax,ay,az,aw)}if(bitangents.length){_b.push(bx,bY,bz)}}indices.splice(i,3);i-=3}}vertices.splice(max*3,vertices.length);if(colors.length){colors.splice(max*4,colors.length)}if(textures.length){textures.splice(max*2,textures.length)}if(normals.length){normals.splice(max*3,normals.length)}if(tangents.length){tangents.splice(max*4,tangents.length)}if(tangents.length){bitangents.splice(max*3,tangents.length)}return newMesh=new this.__proto__.constructor({init:function(v,c,t,n,i){var __a,__b,__c,__i,__n,__t,__v,k,l,len,len1,len2,len3,len4,len5,len6,m,o,p,q,r,results;for(k=0,len=_v.length;k<len;k++){__v=_v[k];v.push(__v)}if(_c){for(l=0,len1=_c.length;l<len1;l++){__c=_c[l];c.push(__c)}}if(_t){for(m=0,len2=_t.length;m<len2;m++){__t=_t[m];t.push(__t)}}if(_n){for(o=0,len3=_n.length;o<len3;o++){__n=_n[o];n.push(__n)}}if(_a){for(p=0,len4=_a.length;p<len4;p++){__a=_a[p];a.push(__a)}}if(_b){for(q=0,len5=_b.length;q<len5;q++){__b=_b[q];b.push(__b)}}results=[];for(r=0,len6=_i.length;r<len6;r++){__i=_i[r];results.push(i.push(__i))}return results}})};return Triangles})(Jax.Mesh.Base)}).call(this);(function(){Jax.Renderer=(function(){function Renderer(){}Renderer.registeredOrder=[];Renderer.register=function(klass){return this.registeredOrder.push(klass)};Renderer.attemptThese=function(canvas,renderers,contextOptions){var Renderer,e,errors,i,len,name,renderer;errors=[];for(i=0,len=renderers.length;i<len;i++){Renderer=renderers[i];name=null;try{if(Renderer instanceof Function){name=Renderer.name}else{name=Renderer;Renderer=Jax.Renderer[Renderer]}if(Renderer){renderer=new Renderer(canvas,contextOptions);renderer.initialize();return renderer}else{console.log("Warning: renderer '"+name+"' not found!")}}catch(error){e=error;null}}throw new Error("Could not find a compatible renderer.")};return Renderer})()}).call(this);(function(){Jax.Context=(function(){Context.include(Jax.Mixins.EventEmitter);function Context(canvas1,options){var canvas;this.canvas=canvas1;if(this.canvas&&arguments.length===1){if(!(this.canvas instanceof HTMLElement||(typeof this.canvas)==="string")){options=this.canvas;this.canvas=options.canvas;delete options.canvas}}if(typeof this.canvas==="string"){canvas=document.getElementById(this.canvas);if(!canvas){throw new Error("Could not locate canvas element with ID '"+this.canvas+"'")}this.canvas=canvas}options||(options={});if(!this.canvas&&this.canvas!==void 0){throw new Error("Received `"+this.canvas+"` where a canvas was expected! If you meant to initialize Jax without a canvas, don't pass any value at all for one.")}this.clampTimechange=0.25;this._isDisposed=false;this._isRendering=false;this._isUpdating=false;this._renderHandle=this._updateHandle=null;this._framesPerSecond=0;this._renderStartTime=null;this.inputDevices=[];this._renderFunc=(function(_this){return function(time){var renderStartTime,timechange;time*=0.001;renderStartTime=_this._renderStartTime||(_this._renderStartTime=time);_this._lastUptime=_this.uptime||renderStartTime;_this.uptime=time-renderStartTime;if(_this._calculateFrameRate){_this.calculateFramerate()}if(_this.isUpdating()){timechange=_this.getTimePassed();_this.update(timechange)}_this.render();if(_this.isRendering()){return _this.requestRenderFrame()}}})(this);this.id=Jax.guid();this.world=new Jax.World(this);this.uptime=0;this.matrix_stack=new Jax.MatrixStack();this.framerateSampleRatio=0.9;this.setupRenderer(options);this.setupCamera();this.setupInputDevices(options.focus);this.startUpdating();if(options.root){this.redirect(options.root)}}Context.getter("player",function(){console.log(new Error("Jax.Context#player is deprecated; it only contained `camera`, so you should use Jax.Controller#activeCamera instead.").stack);return{camera:this.activeCamera}});Context.define("activeCamera",{set:function(c){var ref;return(ref=this.controller)!=null?ref.activeCamera=c:void 0},get:function(){if(this.controller){return this.controller.activeCamera}else{return this.world.cameras[0]}}});Context.prototype.isDisposed=function(){return this._isDisposed};Context.prototype.isRendering=function(){return this._isRendering};Context.prototype.isUpdating=function(){return this._isUpdating};Context.prototype.reloadMatrices=function(){var camera;camera=this.activeCamera;this.matrix_stack.reset();this.matrix_stack.loadModelMatrix(mat4.IDENTITY);this.matrix_stack.loadViewMatrix(camera.get("inverseMatrix"));this.matrix_stack.loadProjectionMatrix(camera.get("projection").matrix);return this.matrix_stack};Context.prototype.update=function(timechange){var device,i,len,ref,ref1;ref=this.inputDevices;for(i=0,len=ref.length;i<len;i++){device=ref[i];device.update(timechange)}if((ref1=this.controller)!=null){if(typeof ref1.update==="function"){ref1.update(timechange)}}this.world.update(timechange);return this.activeCamera.update(timechange)};Context.prototype.isViewportStale=function(){var camera;camera=this.activeCamera;if(camera.get("projection").type==="identity"){return true}if(this._realViewportWidth!==this.canvas.clientWidth){return true}if(this._realViewportHeight!==this.canvas.clientHeight){return true}return false};Context.prototype.prepare=function(){if(this.isViewportStale()){this.setupCamera()}this.reloadMatrices();return this.renderer.prepare()};Context.prototype.viewport=function(){return this.renderer.viewport()};Context.prototype.render=function(){var ref;this.prepare();if((ref=this.controller)!=null?ref.view:void 0){return this.controller.view()}else{this.renderer.clear();return this.world.render()}};Context.prototype.getTimePassed=function(){var clampValue,timechange,uptime;uptime=this.uptime;timechange=uptime-this._lastUptime;if(timechange<0){timechange=0}if(clampValue=this.clampTimechange){return Math.min(timechange,clampValue)}else{return timechange}};Context.prototype.calculateFramerate=function(){var currentRenderStart,sampleRatio,timeToRenderThisFrame,uptime;uptime=this.uptime;currentRenderStart=uptime;sampleRatio=this.framerateSampleRatio;this._lastRenderStart||(this._lastRenderStart=uptime);timeToRenderThisFrame=currentRenderStart-this._lastRenderStart;this._timeToRender=(this._timeToRender||0)*sampleRatio+timeToRenderThisFrame*(1-sampleRatio);this._framesPerSecond=1/this._timeToRender;return this._lastRenderStart=currentRenderStart};Context.prototype.startUpdating=function(){if(this.isUpdating()||this.isDisposed()){return}return this._isUpdating=true};Context.prototype.startRendering=function(){if(this.isRendering()||this.isDisposed()){return}this._isRendering=true;return this.requestRenderFrame()};Context.prototype.stopUpdating=function(){if(!this.isUpdating()){return}return this._isUpdating=false};Context.prototype.stopRendering=function(){if(!this.isRendering()){return}if(this._renderHandle!==null){this.abortRenderFrame()}this._renderStartTime=null;return this._isRendering=false};Context.prototype.restart=function(){this.stopRendering();this.stopUpdating();this.startRendering();return this.startUpdating()};Context.prototype.requestRenderFrame=function(){var currTime,timeToCall;if(Jax.useRequestAnimFrame&&this.useRequestAnimFrame){this._requestedAnimFrame=true;return this._renderHandle=requestAnimationFrame(this._renderFunc,this.canvas)}else{this._requestedAnimFrame=false;currTime=new Date().getTime();timeToCall=Math.max(0,16-(currTime-(this._requestFrameLastTime||0)));this._renderHandle=setTimeout(((function(_this){return function(){return _this._renderFunc(currTime+timeToCall)}})(this)),timeToCall);return this._requestFrameLastTime=currTime+timeToCall}};Context.prototype.abortRenderFrame=function(){if(this._requestedAnimFrame){cancelAnimationFrame(this._renderHandle)}else{clearTimeout(this._renderHandle)}return this._renderHandle=null};Context.prototype.setupRenderer=function(options){var renderers;if(!this.canvas){return}options||(options={});renderers=options.renderers||Jax.Renderer.registeredOrder;if(renderers.length){this.renderer=Jax.Renderer.attemptThese(this.canvas,renderers,options);return this.gl=this.renderer.context}};Context.prototype.setupInputDevices=function(focusCanvas){var Device,device,i,len,ref,results;if(focusCanvas==null){focusCanvas=true}if(this.canvas){ref=Jax.Input.devices;results=[];for(i=0,len=ref.length;i<len;i++){Device=ref[i];device=new Device(this.canvas,{focus:focusCanvas});if(device.alias){this[device.alias]=device}results.push(this.inputDevices.push(device))}return results}};Context.prototype.redirect=function(controller,action){var ref;if(action==null){action="index"}this.unregisterListeners();this.stopUpdating();this.stopRendering();if(typeof controller==="string"){ref=[this.controller,controller],controller=ref[0],action=ref[1]}if(controller!==this.controller||action==="index"){this.unloadScene()}this.controller=controller;controller.fireAction(action,this);this.registerListeners();this.startRendering();this.startUpdating();return this.controller};Context.prototype.unloadScene=function(){this.world.dispose();this.world.cameras=1;this.world.cameras[0].reset();this.setupCamera();return delete this._player};Context.prototype.setupCamera=function(){if(this.world&&this.canvas){this._realViewportWidth=this.canvas.clientWidth;this._realViewportHeight=this.canvas.clientHeight;return this.activeCamera.perspective({width:this.canvas.clientWidth||this.canvas.width||320,height:this.canvas.clientHeight||this.canvas.height||200})}};Context.prototype.dispose=function(){this.stopUpdating();this.stopRendering();this.world.dispose();this.unregisterListeners();return this._isDisposed=true};Context.prototype.registerListeners=function(){var device,i,len,ref;if(!this.controller){return}ref=this.inputDevices;for(i=0,len=ref.length;i<len;i++){device=ref[i];device.register(this.controller)}return true};Context.prototype.unregisterListeners=function(){var device,i,len,ref;ref=this.inputDevices;for(i=0,len=ref.length;i<len;i++){device=ref[i];device.stopListening()}return true};Context.prototype.getFramesPerSecond=function(){this._calculateFrameRate=true;return this._framesPerSecond};Context.prototype.disableFrameSpeedCalculations=function(){return this._calculateFrameRate=false};return Context})()}).call(this);(function(){Jax.Renderer.register(Jax.Renderer.WebGL=(function(){WebGL.define("backgroundColor",{get:function(){return this._backgroundColor},set:function(v){var ref;vec4.copy(this._backgroundColor,v);return(ref=this.context).clearColor.apply(ref,this._backgroundColor)}});function WebGL(canvas,options){this.canvas=canvas;this.options=options}WebGL.prototype.initialize=function(){if(!this.canvas.getContext){throw new Error("WebGL not supported!")}this.context=this.canvas.getContext("experimental-webgl",this.options);if(!this.context){throw new Error("WebGL not supported!")}this.state={};this._backgroundColor||(this._backgroundColor=vec4.fromValues(0,0,0,0));this.backgroundColor=[0,0,0,0];this.context.clearDepth(1);this.context.enable(GL_DEPTH_TEST);this.context.depthFunc(GL_LESS);this.context.enable(GL_BLEND);this.context.blendFunc(GL_SRC_ALPHA,GL_ONE_MINUS_SRC_ALPHA);return this.context.enable(GL_CULL_FACE)};WebGL.prototype.clear=function(){return this.context.clear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT|GL_STENCIL_BUFFER_BIT)};WebGL.prototype.prepare=function(){return this.viewport()};WebGL.prototype.viewport=function(x,y,w,h){var canvasHeight,canvasWidth;if(x!==void 0){return this.context.viewport(x,y,w,h)}else{canvasWidth=this.context.canvas.width;canvasHeight=this.context.canvas.height;return this.context.viewport(0,0,canvasWidth,canvasHeight)}};WebGL.prototype.createTexture=function(){return this.context.createTexture()};WebGL.prototype.bindTexture=function(target,handle){return this.context.bindTexture(target,handle)};WebGL.prototype.texImage2D=function(){return this.context.texImage2D.apply(this.context,arguments)};WebGL.prototype.texParameteri=function(target,type,value){return this.context.texParameteri(target,type,value)};WebGL.prototype.pixelStorei=function(type,value){return this.context.pixelStorei(type,value)};WebGL.prototype.hint=function(n){return this.context.hint(n)};WebGL.prototype.generateMipmap=function(target){return this.context.generateMipmap(target)};WebGL.prototype.deleteTexture=function(texture){return this.context.deleteTexture(texture)};WebGL.prototype.checkFramebufferStatus=function(glEnum){return this.context.checkFramebufferStatus(glEnum)};WebGL.prototype.framebufferTexture2D=function(glEnum,attachment,target,handle,num){return this.context.framebufferTexture2D(glEnum,attachment,target,handle,num)};WebGL.prototype.framebufferRenderbuffer=function(glEnum,attachment,target,handle){return this.context.framebufferRenderbuffer(glEnum,attachment,target,handle)};WebGL.prototype.renderbufferStorage=function(glEnum,target,w,h){return this.context.renderbufferStorage(glEnum,target,w,h)};WebGL.prototype.bindRenderbuffer=function(target,handle){return this.context.bindRenderbuffer(target,handle)};WebGL.prototype.createRenderbuffer=function(){return this.context.createRenderbuffer()};WebGL.prototype.createFramebuffer=function(){return this.context.createFramebuffer()};WebGL.prototype.bindFramebuffer=function(target,handle){return this.context.bindFramebuffer(target,handle)};WebGL.prototype.vertexAttribPointer=function(indx,size,type,normalized,stride,offset){return this.context.vertexAttribPointer(indx,size,type,normalized,stride,offset)};WebGL.prototype.clearColor=function(r,g,b,a){return this.context.clearColor(r,g,b,a)};WebGL.prototype.uniform1f=function(l,v){return this.context.uniform1f(l,v)};WebGL.prototype.uniform1i=function(l,v){return this.context.uniform1i(l,v)};WebGL.prototype.uniform2fv=function(l,v){return this.context.uniform2fv(l,v)};WebGL.prototype.uniform3fv=function(l,v){return this.context.uniform3fv(l,v)};WebGL.prototype.uniform4fv=function(l,v){return this.context.uniform4fv(l,v)};WebGL.prototype.uniform2iv=function(l,v){return this.context.uniform2iv(l,v)};WebGL.prototype.uniform3iv=function(l,v){return this.context.uniform3iv(l,v)};WebGL.prototype.uniform4iv=function(l,v){return this.context.uniform4iv(l,v)};WebGL.prototype.uniformMatrix2fv=function(l,t,v){return this.context.uniformMatrix2fv(l,t,v)};WebGL.prototype.uniformMatrix3fv=function(l,t,v){return this.context.uniformMatrix3fv(l,t,v)};WebGL.prototype.uniformMatrix4fv=function(l,t,v){return this.context.uniformMatrix4fv(l,t,v)};WebGL.prototype.activeTexture=function(t){return this.context.activeTexture(t)};WebGL.prototype.bindAttribLocation=function(p,i,n){return this.context.bindAttribLocation(p,i,n)};WebGL.prototype.enableVertexAttribArray=function(i){return this.context.enableVertexAttribArray(i)};WebGL.prototype.disableVertexAttribArray=function(i){return this.context.disableVertexAttribArray(i)};WebGL.prototype.linkProgram=function(p){return this.context.linkProgram(p)};WebGL.prototype.shaderSource=function(shader,source){return this.context.shaderSource(shader,source)};WebGL.prototype.compileShader=function(sh){return this.context.compileShader(sh)};WebGL.prototype.getShaderParameter=function(sh,en){return this.context.getShaderParameter(sh,en)};WebGL.prototype.attachShader=function(p,s){return this.context.attachShader(p,s)};WebGL.prototype.getProgramParameter=function(p,n){return this.context.getProgramParameter(p,n)};WebGL.prototype.getProgramInfoLog=function(p){return this.context.getProgramInfoLog(p)};WebGL.prototype.useProgram=function(p){return this.context.useProgram(p)};WebGL.prototype.getParameter=function(p){return this.context.getParameter(p)};WebGL.prototype.getShaderInfoLog=function(s){return this.context.getShaderInfoLog(s)};WebGL.prototype.drawElements=function(mode,count,type,offset){return this.context.drawElements(mode,count,type,offset)};WebGL.prototype.drawArrays=function(mode,first,count){return this.context.drawArrays(mode,first,count)};WebGL.prototype.depthFunc=function(f){return this.context.depthFunc(f)};WebGL.prototype.blendFunc=function(s,d){return this.context.blendFunc(s,d)};WebGL.prototype.createProgram=function(){return this.context.createProgram()};WebGL.prototype.createShader=function(t){return this.context.createShader(t)};WebGL.prototype.createBuffer=function(){return this.context.createBuffer()};WebGL.prototype.bindBuffer=function(t,b){return this.context.bindBuffer(t,b)};WebGL.prototype.bufferData=function(t,s,u){return this.context.bufferData(t,s,u)};WebGL.prototype.getUniformLocation=function(p,n){return this.context.getUniformLocation(p,n)};WebGL.prototype.disable=function(e){return this.context.disable(e)};WebGL.prototype.enable=function(e){return this.context.enable(e)};WebGL.prototype.cullFace=function(mode){return this.context.cullFace(mode)};WebGL.prototype.polygonOffset=function(factor,units){return this.context.polygonOffset(factor,units)};WebGL.prototype.readPixels=function(x,y,width,height,format,type,pixels){return this.context.readPixels(x,y,width,height,format,type,pixels)};WebGL.prototype.deleteRenderbuffer=function(r){return this.context.deleteRenderbuffer(r)};WebGL.prototype.deleteFramebuffer=function(f){return this.context.deleteFramebuffer(f)};WebGL.prototype.deleteTexture=function(t){return this.context.deleteTexture(t)};return WebGL})())}).call(this);(function(){Jax.Input=(function(){Input.include(Jax.Mixins.EventEmitter);Input.devices=[];function Input(receiver,options){this.receiver=receiver;this.options=options!=null?options:{};this.receiver=$(this.receiver);this._attached={};this._pendingEvents={}}Input.prototype.register=function(controller){throw new Error("Input device must register listeners")};Input.prototype.processEvent=function(type,event){return event};Input.prototype.update=function(timechange){var event,ref,type;ref=this._pendingEvents;for(type in ref){event=ref[type];this.trigger(type,event);delete this._pendingEvents[type]}return true};Input.prototype.enqueue=function(type,event){this._lastEnqueuedEventType=type;return this._pendingEvents[type]=event};Input.prototype.enqueued=function(type){return this._pendingEvents[type]};Input.prototype.getLastEnqueuedEventType=function(){return this._lastEnqueuedEventType};Input.prototype.getLastEnqueuedEvent=function(){return this.enqueued(this.getLastEnqueuedEventType())};Input.prototype.attach=function(eventType,callback){var attached,attachedCallback,base,i,len;attached=(base=this._attached)[eventType]||(base[eventType]=[]);for(i=0,len=attached.length;i<len;i++){attachedCallback=attached[i];if(callback===attachedCallback){return}}attached.push(callback);return this.receiver.on(eventType,(function(_this){return function(event){return callback(_this.processEvent(eventType,event))}})(this))};Input.prototype.stopListening=function(){this.off();this.receiver.off();return this._pendingEvents={}};return Input})()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Input.Keyboard=(function(superClass){extend(Keyboard,superClass);Jax.Input.devices.push(Keyboard);Keyboard.prototype.alias="keyboard";Keyboard.prototype.register=function(controller){if(controller.key_pressed){this.attach("keydown",this.press);this.on("press",function(event){return controller.key_pressed(event)})}if(controller.key_released){this.attach("keyup",this.release);this.on("release",function(event){return controller.key_released(event)})}if(controller.key_typed){this.attach("keypress",this.type);return this.on("type",function(event){return controller.key_typed(event)})}};function Keyboard(element,options){var shouldFocus;if(options==null){options={}}this.type=bind(this.type,this);this.release=bind(this.release,this);this.press=bind(this.press,this);Keyboard.__super__.constructor.call(this,element,options);shouldFocus=false;if(!this.receiver.attr("tabindex")){shouldFocus=true;this.receiver.attr("tabindex","0")}if(options.focus===void 0||options.focus){if(shouldFocus){this.receiver.focus()}}this.receiver.on("mouseover",this._captureFocus=function(e){return this.focus()})}Keyboard.prototype.press=function(e){return this.enqueue("press",e)};Keyboard.prototype.release=function(e){return this.enqueue("release",e)};Keyboard.prototype.type=function(e){return this.enqueue("type",e)};return Keyboard})(Jax.Input)}).call(this);(function(){var _Leap,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Input.Leap=_Leap=(function(superClass){extend(_Leap,superClass);Jax.Input.devices.push(_Leap);_Leap.prototype.alias="leap";_Leap.prototype._reset=function(){this._captures=[];return this._hands={}};_Leap.prototype._clearDuplicateCaptures=function(){var capture,i,lastIndex,len,ref;ref=this._captures;for(i=0,len=ref.length;i<len;i++){capture=ref[i];lastIndex=this._captures.lastIndexOf(capture);if(this._captures.indexOf(capture)!==lastIndex){this._captures.splice(lastIndex,1);return this._clearDuplicateCaptures()}}return true};function _Leap(){_Leap.__super__.constructor.apply(this,arguments);this._frameRotatedEvent={};this._frameScaledEvent={};this._frameTranslatedEvent={};this._handAddedEvent={};this._handRemovedEvent={};this._frameEvent={};this._handUpdatedEvent={};this._handRotatedEvents=[];this._handScaledEvents=[];this._handTranslatedEvents=[];this._gestureCircledEvents=[];this._gestureSwipedEvents=[];this._gestureScreenTappedEvents=[];this._gestureKeyTappedEvents=[];this._reset()}_Leap.prototype.update=function(timechange){_Leap.__super__.update.call(this,timechange);return this.lastFrame=this.currentFrame};_Leap.prototype.startLooping=function(){if(this.looping){return}if(typeof Leap==="undefined"){console.log("Your controller is listening for Leap Motion actions, but Leap could not be found.");console.log("  Did you include leap.js?")}else{Leap.loop({enableGestures:true},(function(_this){return function(data){return _this.loop(data)}})(this))}return this.looping=true};_Leap.prototype.stopListening=function(){_Leap.__super__.stopListening.call(this);return this._reset()};_Leap.prototype.register=function(controller){this.registerLeapFrame(controller);this.registerFrameRotated(controller);this.registerFrameScaled(controller);this.registerFrameTranslated(controller);this.registerHandAdded(controller);this.registerHandRemoved(controller);this.registerHandsUpdated(controller);this.registerHandRotated(controller);this.registerHandScaled(controller);this.registerHandTranslated(controller);this.registerGestureCircled(controller);this.registerGestureSwiped(controller);this.registerGestureKeyTapped(controller);this.registerGestureScreenTapped(controller);return this._clearDuplicateCaptures()};_Leap.prototype.registerLeapFrame=function(controller){if(controller.on_leap_frame){this.startLooping();this._captures.push("captureFrame");return this.on("frame",(function(_this){return function(data){return controller.on_leap_frame(data)}})(this))}};_Leap.prototype.registerFrameRotated=function(controller){if(controller.leap_frame_rotated){this.startLooping();this._captures.push("captureFrameRotation");return this.on("frameRotate",function(data){return controller.leap_frame_rotated(data)})}};_Leap.prototype.registerFrameScaled=function(controller){if(controller.leap_frame_scaled){this.startLooping();this._captures.push("captureFrameScale");return this.on("frameScale",function(data){return controller.leap_frame_scaled(data)})}};_Leap.prototype.registerFrameTranslated=function(controller){if(controller.leap_frame_translated||controller.leap_frame_moved){this.startLooping();this._captures.push("captureFrameTranslate");return this.on("frameTranslate",function(data){return(controller.leap_frame_translated||controller.leap_frame_moved)(data)})}};_Leap.prototype.registerHandAdded=function(controller){if(controller.leap_hand_added){this.startLooping();this._captures.push("captureHandAdd");return this.on("handAdd",function(data){return controller.leap_hand_added(data)})}};_Leap.prototype.registerHandRemoved=function(controller){if(controller.leap_hand_removed){this.startLooping();this._captures.push("captureHandAdd");this._captures.push("captureHandRemove");return this.on("handRemove",function(data){return controller.leap_hand_removed(data)})}};_Leap.prototype.registerHandsUpdated=function(controller){if(controller.leap_hands_updated){this.startLooping();this._captures.push("captureHandAdd");this._captures.push("captureHandRemove");this._captures.push("captureHandUpdate");return this.on("handUpdate",function(data){return controller.leap_hands_updated(data)})}};_Leap.prototype.registerHandRotated=function(controller){if(controller.leap_hand_rotated){this.startLooping();this._captures.push("captureHandRotate");return this.on("handRotate",function(events){var event,i,len;for(i=0,len=events.length;i<len;i++){event=events[i];controller.leap_hand_rotated(event)}return true})}};_Leap.prototype.registerHandScaled=function(controller){if(controller.leap_hand_scaled){this.startLooping();this._captures.push("captureHandScale");return this.on("handScale",function(events){var event,i,len;for(i=0,len=events.length;i<len;i++){event=events[i];controller.leap_hand_scaled(event)}return true})}};_Leap.prototype.registerHandTranslated=function(controller){if(controller.leap_hand_translated||controller.leap_hand_moved){this.startLooping();this._captures.push("captureHandTranslate");return this.on("handTranslate",function(events){var event,i,len;for(i=0,len=events.length;i<len;i++){event=events[i];(controller.leap_hand_translated||controller.leap_hand_moved)(event)}return true})}};_Leap.prototype.registerGestureCircled=function(controller){if(controller.leap_gesture_circled){this.startLooping();this._captures.push("captureGestures");return this.on("gestureCircle",function(events){var event,i,len;for(i=0,len=events.length;i<len;i++){event=events[i];controller.leap_gesture_circled(event)}return true})}};_Leap.prototype.registerGestureSwiped=function(controller){if(controller.leap_gesture_swiped){this.startLooping();this._captures.push("captureGestures");return this.on("gestureSwipe",function(events){var event,i,len;for(i=0,len=events.length;i<len;i++){event=events[i];controller.leap_gesture_swiped(event)}return true})}};_Leap.prototype.registerGestureKeyTapped=function(controller){if(controller.leap_gesture_key_tapped){this.startLooping();this._captures.push("captureGestures");return this.on("gestureKeyTap",function(events){var event,i,len;for(i=0,len=events.length;i<len;i++){event=events[i];controller.leap_gesture_key_tapped(event)}return true})}};_Leap.prototype.registerGestureScreenTapped=function(controller){if(controller.leap_gesture_screen_tapped){this.startLooping();this._captures.push("captureGestures");return this.on("gestureScreenTap",function(events){var event,i,len;for(i=0,len=events.length;i<len;i++){event=events[i];controller.leap_gesture_screen_tapped(event)}return true})}};_Leap.prototype.loop=function(frame){var capture,i,len,ref;this.currentFrame=frame;ref=this._captures;for(i=0,len=ref.length;i<len;i++){capture=ref[i];this[capture](frame)}return true};_Leap.prototype.captureGestures=function(frame){var circleIndex,event,gesture,gestureCircledEvents,gestureKeyTappedEvents,gestureScreenTappedEvents,gestureSwipedEvents,i,keyIndex,lastFrame,len,name,name1,name2,name3,ref,screenIndex,swipeIndex;lastFrame=this.lastFrame;gestureCircledEvents=this._gestureCircledEvents;gestureSwipedEvents=this._gestureSwipedEvents;gestureScreenTappedEvents=this._gestureScreenTappedEvents;gestureKeyTappedEvents=this._gestureKeyTappedEvents;circleIndex=swipeIndex=screenIndex=keyIndex=0;ref=frame.gestures;for(i=0,len=ref.length;i<len;i++){gesture=ref[i];switch(gesture.type){case"circle":event=gestureCircledEvents[name=circleIndex++]||(gestureCircledEvents[name]={});break;case"swipe":event=gestureSwipedEvents[name1=swipeIndex++]||(gestureSwipedEvents[name1]={});break;case"keyTap":event=gestureKeyTappedEvents[name2=keyIndex++]||(gestureKeyTappedEvents[name2]={});break;case"screenTap":event=gestureScreenTappedEvents[name3=screenIndex++]||(gestureScreenTappedEvents[name3]={});break;default:throw new Error("Unexpected gesture type: "+gesture.type)}event.current=frame;event.previous=lastFrame;event.gesture=gesture}if(circleIndex){gestureCircledEvents.splice(circleIndex,gestureCircledEvents.length);this.enqueue("gestureCircle",gestureCircledEvents)}if(swipeIndex){gestureSwipedEvents.splice(swipeIndex,gestureSwipedEvents.length);this.enqueue("gestureSwipe",gestureSwipedEvents)}if(keyIndex){gestureKeyTappedEvents.splice(keyIndex,gestureKeyTappedEvents.length);this.enqueue("gestureKeyTap",gestureKeyTappedEvents)}if(screenIndex){gestureScreenTappedEvents.splice(screenIndex,gestureScreenTappedEvents.length);this.enqueue("gestureScreenTap",gestureScreenTappedEvents)}return true};_Leap.prototype.captureHandTranslate=function(frame){var distance,event,eventIndex,hand,handTranslatedEvents,i,lastFrame,len,name,ref,translation;if(!(lastFrame=this.lastFrame)){return}handTranslatedEvents=this._handTranslatedEvents;eventIndex=0;ref=frame.hands;for(i=0,len=ref.length;i<len;i++){hand=ref[i];translation=hand.translation(lastFrame);distance=vec3.length(translation);if(Math.abs(distance)>Math.EPSILON){event=handTranslatedEvents[name=eventIndex++]||(handTranslatedEvents[name]={});event.current=frame;event.previous=lastFrame;event.hand=hand;event.distance=distance;event.translation=translation}}if(eventIndex){handTranslatedEvents.splice(eventIndex,handTranslatedEvents.length);return this.enqueue("handTranslate",handTranslatedEvents)}};_Leap.prototype.captureHandScale=function(frame){var event,eventIndex,hand,handScaledEvents,i,lastFrame,len,name,ref,scale;if(!(lastFrame=this.lastFrame)){return}handScaledEvents=this._handScaledEvents;eventIndex=0;ref=frame.hands;for(i=0,len=ref.length;i<len;i++){hand=ref[i];if(Math.abs(scale=hand.scaleFactor(lastFrame))>Math.EPSILON){event=handScaledEvents[name=eventIndex++]||(handScaledEvents[name]={});event.current=frame;event.previous=lastFrame;event.hand=hand;event.scale=scale}}if(eventIndex){handScaledEvents.splice(eventIndex,handScaledEvents.length);return this.enqueue("handScale",handScaledEvents)}};_Leap.prototype.captureHandRotate=function(frame){var angle,event,eventIndex,hand,handRotatedEvents,i,lastFrame,len,name,ref;if(!(lastFrame=this.lastFrame)){return}eventIndex=0;handRotatedEvents=this._handRotatedEvents;ref=frame.hands;for(i=0,len=ref.length;i<len;i++){hand=ref[i];if(Math.abs(angle=hand.rotationAngle(lastFrame))>Math.EPSILON){event=handRotatedEvents[name=eventIndex++]||(handRotatedEvents[name]={});event.current=frame;event.previous=lastFrame;event.hand=hand;event.angle=angle}}if(eventIndex){handRotatedEvents.splice(eventIndex,handRotatedEvents.length);return this.enqueue("handRotate",handRotatedEvents)}};_Leap.prototype.captureHandUpdate=function(frame){var event,lastFrame;if(!(lastFrame=this.lastFrame)){return}if(frame.hands.length){event=this._handUpdatedEvent;event.current=frame;event.previous=lastFrame;return this.enqueue("handUpdate",event)}};_Leap.prototype.captureFrame=function(frame){var event;event=this._frameEvent;event.current=frame;event.previous=this.lastFrame;return this.enqueue("frame",event)};_Leap.prototype.captureHandAdd=function(frame){var event,hand,i,len,ref;ref=frame.hands;for(i=0,len=ref.length;i<len;i++){hand=ref[i];if(!this._hands[hand.id]){this._hands[hand.id]=hand;event=this._handAddedEvent;event.current=frame;event.previous=this.lastFrame;event.hand=hand;return this.enqueue("handAdd",event)}}return true};_Leap.prototype.captureHandRemove=function(frame){var event,hand,id,ids,lastFrame,ref;if(!(lastFrame=this.lastFrame)){return}ids=(function(){var i,len,ref,results;ref=frame.hands;results=[];for(i=0,len=ref.length;i<len;i++){hand=ref[i];results.push(""+hand.id)}return results})();ref=this._hands;for(id in ref){hand=ref[id];if(ids.indexOf(id)===-1){event=this._handRemovedEvent;event.current=frame;event.previous=lastFrame;event.hand=hand;delete this._hands[id];return this.enqueue("handRemove",event)}}return true};_Leap.prototype.captureFrameRotation=function(frame){var angle,event,lastFrame;if(!(lastFrame=this.lastFrame)){return}if(Math.abs(angle=frame.rotationAngle(lastFrame))>Math.EPSILON){event=this._frameRotatedEvent;event.current=frame;event.previous=lastFrame;event.angle=angle;return this.enqueue("frameRotate",event)}};_Leap.prototype.captureFrameScale=function(frame){var event,lastFrame,scale;if(!(lastFrame=this.lastFrame)){return}if(Math.abs(1-(scale=frame.scaleFactor(lastFrame)))>Math.EPSILON){event=this._frameScaledEvent;event.current=frame;event.previous=lastFrame;event.scale=scale;return this.enqueue("frameScale",event)}};_Leap.prototype.captureFrameTranslate=function(frame){var distance,event,lastFrame,translation;if(!(lastFrame=this.lastFrame)){return}translation=frame.translation(lastFrame);distance=vec3.length(translation);if(Math.abs(distance)>Math.EPSILON){event=this._frameTranslatedEvent;event.current=frame;event.previous=lastFrame;event.translation=translation;event.distance=distance;return this.enqueue("frameTranslate",event)}};return _Leap})(Jax.Input)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Input.Mouse=(function(superClass){extend(Mouse,superClass);Jax.Input.devices.push(Mouse);Mouse.prototype.alias="mouse";Mouse.prototype.register=function(controller){if(controller.mouse_pressed){this.attach("mousedown",this.press);this.on("press",function(event){return controller.mouse_pressed(event)})}if(controller.mouse_released){this.attach("mouseup",this.release);this.on("release",function(event){return controller.mouse_released(event)})}if(controller.mouse_clicked){this.attach("mousedown",this.press);this.attach("mouseup",this.release);this.attach("mousemove",this.move);this.on("click",function(event){return controller.mouse_clicked(event)})}if(controller.mouse_moved){this.attach("mousedown",this.press);this.attach("mouseup",this.release);this.attach("mousemove",this.move);this.attach("mouseout",this.exit);this.on("move",function(event){return controller.mouse_moved(event)})}if(controller.mouse_entered){this.attach("mouseover",this.over);this.attach("mouseout",this.exit);this.on("enter",function(event){return controller.mouse_entered(event)})}if(controller.mouse_exited){this.attach("mouseout",this.exit);this.on("exit",function(event){return controller.mouse_exited(event)})}if(controller.mouse_dragged){this.attach("mousemove",this.move);this.attach("mousedown",this.press);this.attach("mouseup",this.release);this.attach("mouseout",this.exit);this.on("drag",function(event){return controller.mouse_dragged(event)})}if(controller.mouse_scrolled){this.attach("mousewheel",this.wheel);this.attach("DOMMouseScroll",this.wheel);this.on("wheel",function(event){return controller.mouse_scrolled(event)})}if(controller.mouse_over){this.attach("mouseover",this.over);return this.on("over",function(event){return controller.mouse_over(event)})}};Mouse.define("clickSpeed",{get:function(){return this._clickSpeed||(this._clickSpeed=0.25)},set:function(speed){return this._clickSpeed=speed}});function Mouse(element){this.exit=bind(this.exit,this);this.wheel=bind(this.wheel,this);this.over=bind(this.over,this);this.move=bind(this.move,this);this.release=bind(this.release,this);this.press=bind(this.press,this);Mouse.__super__.constructor.call(this,element);this._pendingClicks={};this._clickCount={};this._buttonState={}}Mouse.prototype.processEvent=function(type,evt){evt=this.normalizeEvent(evt);return Mouse.__super__.processEvent.call(this,type,evt)};Mouse.prototype.normalizeEvent=function(evt){var offset,ref,ref1;offset=this.receiver.offset();evt.x=(evt.pageX-offset.left)*this.receiver[0].width/this.receiver.width();evt.y=(evt.pageY-offset.top)*this.receiver[0].height/this.receiver.height();if(this._lastx===void 0){evt.diffx=evt.diffy=0}else{ref=[evt.x-this._lastx,evt.y-this._lasty],evt.diffx=ref[0],evt.diffy=ref[1]}ref1=[evt.x,evt.y],this._tmplastx=ref1[0],this._tmplasty=ref1[1];return evt};Mouse.prototype.update=function(timechange){var button,ref;Mouse.__super__.update.call(this,timechange);ref=[this._tmplastx,this._tmplasty],this._lastx=ref[0],this._lasty=ref[1];for(button in this._pendingClicks){this._pendingClicks[button]+=timechange;if(this._pendingClicks[button]>=this.clickSpeed){this.clearClick(button)}}return true};Mouse.prototype.logClickStart=function(button){this._pendingClicks[button]=0;return this._clickCount[button]=(this._clickCount[button]||0)+1};Mouse.prototype.clearClick=function(button){delete this._pendingClicks[button];return delete this._clickCount[button]};Mouse.prototype.press=function(e){this.enqueue("press",e);this.logClickStart(e.button);return this._buttonState[e.button]=true};Mouse.prototype.release=function(e){this.enqueue("release",e);this._buttonState[e.button]=false;if(this._pendingClicks[e.button]!==void 0){e.clickCount=this._clickCount[e.button];return this.enqueue("click",e)}};Mouse.prototype.move=function(e){var button;if(this._buttonState[e.button]){for(button in this._pendingClicks){this.clearClick(button)}return this.enqueue("drag",e)}else{return this.enqueue("move",e)}};Mouse.prototype.over=function(e){this.enqueue("over",e);if(!this._entered){this._entered=true;return this.enqueue("enter",e)}};Mouse.prototype.wheel=function(e){return this.enqueue("wheel",e)};Mouse.prototype.exit=function(e){var button;this._entered=false;for(button in this._buttonState){delete this._buttonState[button]}return this.enqueue("exit",e)};return Mouse})(Jax.Input)}).call(this);(function(){Jax.Mixins.Attributes={initializeAttributes:function(){this.attributes={};return this.previousAttributes={}},set:function(name,value){this.previousAttributes[name]=this.attributes[name];this.attributes[name]=value;if(typeof this.trigger==="function"){this.trigger("change:"+name,this)}return value},get:function(name){return this.attributes[name]},getPrevious:function(name){return this.previousAttributes[name]}}}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Jax.Texture=(function(){Texture.include(Jax.Mixins.Attributes);Texture.include(Jax.Mixins.EventEmitter);function Texture(options){var option,value;if(options==null){options={}}this.sizeChanged=bind(this.sizeChanged,this);this.texParamChanged=bind(this.texParamChanged,this);this.initializeAttributes();if(options.upload!==void 0){this.upload=options.upload}this.on("change:width change:height",this.sizeChanged);this.on("change:min_filter              change:mag_filter change:generate_mipmap         change:mipmap_hint change:format                  change:target change:date_type               change:wrap_s change:wrap_t change:flip_y    change:premultiply_alpha change:colorspace_conversion   change:data",this.texParamChanged);this.set("handles",{});this.set("min_filter",GL_NEAREST_MIPMAP_LINEAR);this.set("mag_filter",GL_LINEAR);this.set("generate_mipmap",true);this.set("mipmap_hint",GL_DONT_CARE);this.set("format",GL_RGBA);this.set("target",GL_TEXTURE_2D);this.set("data_type",GL_UNSIGNED_BYTE);this.set("wrap_s",GL_REPEAT);this.set("wrap_t",GL_REPEAT);this.set("flip_y",false);this.set("premultiply_alpha",false);this.set("colorspace_conversion",true);this.set("width",1);this.set("height",1);for(option in options){value=options[option];this.set(option,value)}true}Texture.prototype.texParamChanged=function(self,evtName){return this.invalidate()};Texture.prototype.getHandle=function(context){var base,handle,name;return handle=(base=this.get("handles"))[name=context.id]||(base[name]=context.renderer.createTexture())};Texture.prototype.dispose=function(context){var handles;handles=this.get("handles");if(handles[context.id]){context.renderer.deleteTexture(handles[context.id])}return handles[context.id]=null};Texture.prototype.invalidate=function(param){return this.set("valid",false)};Texture.prototype.isValid=function(){return this.get("valid")};Texture.prototype.forceValid=function(){return this.set("valid",true)};Texture.prototype.upload=function(context,handle,textureData){return context.renderer.texImage2D(this.get("target"),0,this.get("format"),this.get("width"),this.get("height"),0,this.get("format"),this.get("data_type"),textureData)};Texture.prototype.isReady=function(){return true};Texture.prototype.validate=function(context){var attrs,conversion,gl,handle,target;if(!this.isReady()){return false}attrs=this.attributes;handle=this.getHandle(context);if(this.get("valid")){return handle}target=attrs.target;gl=context.renderer;gl.bindTexture(target,handle);gl.texParameteri(target,GL_TEXTURE_MAG_FILTER,attrs.mag_filter);gl.texParameteri(target,GL_TEXTURE_MIN_FILTER,attrs.min_filter);gl.texParameteri(target,GL_TEXTURE_WRAP_S,attrs.wrap_s);gl.texParameteri(target,GL_TEXTURE_WRAP_T,attrs.wrap_t);gl.pixelStorei(GL_UNPACK_FLIP_Y_WEBGL,attrs.flip_y);gl.pixelStorei(GL_UNPACK_PREMULTIPLY_ALPHA_WEBGL,attrs.premultiply_alpha);conversion=attrs.colorspace_conversion?GL_BROWSER_DEFAULT_WEBGL:GL_NONE;gl.pixelStorei(GL_UNPACK_COLORSPACE_CONVERSION_WEBGL,conversion);this.upload(context,handle,attrs.data);if(attrs.generate_mipmap){this.generateMipmap(gl,target,attrs.mipmap_hint)}this.forceValid();return handle};Texture.prototype.generateMipmap=function(renderer,target,hint){return renderer.generateMipmap(target)};Texture.prototype.sizeChanged=function(){var data,height,width;width=this.get("width")||1;height=this.get("height")||1;if(Jax.Util.isPowerOfTwo(width)&&Jax.Util.isPowerOfTwo(height)){this.isPoT=true}else{if(this.isPoT){this.set("min_filter",GL_LINEAR);this.set("mag_filter",GL_LINEAR);this.set("wrap_s",GL_CLAMP_TO_EDGE);this.set("wrap_t",GL_CLAMP_TO_EDGE);this.set("generate_mipmap",false)}this.isPoT=false}data=this.get("data");if(data===void 0||data instanceof Uint8Array){return this.resizeData(width*height*Jax.Util.sizeofFormat(this.get("format")))}};Texture.prototype.resizeData=function(newLength){var data,i,j,newData,ref;data=this.get("data");if((data!=null?data.length:void 0)===newLength){newData=data}else{newData=new Uint8Array(newLength);if(data){for(i=j=0,ref=newData.length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){if(i>=data.length){break}newData[i]=data[i]}}}return this.set("data",newData)};return Texture})()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Texture.Bitmap=(function(superClass){extend(Bitmap,superClass);function Bitmap(image,options){if(options==null){options=null}this.pathChanged=bind(this.pathChanged,this);this.on("change:path",this.pathChanged);this._isReady=true;if(options){options.data=image}else{options=image}Bitmap.__super__.constructor.call(this,options);if(!(options!=null?options.target:void 0)){this.set("target",GL_TEXTURE_2D)}}Bitmap.prototype.pathChanged=function(){var image;this._isReady=false;image=new window.Image;$(image).on("load",(function(_this){return function(){_this.set("width",image.width);_this.set("height",image.height);return _this._isReady=true}})(this));image.src=this.get("path");return this.set("data",image)};Bitmap.prototype.upload=function(context,handle,image){var dataType,e,format,target;dataType=this.get("data_type");format=this.get("format");target=this.get("target");try{return context.renderer.texImage2D(target,0,format,format,dataType,image)}catch(error){e=error;this._isReady=false;return $(image).on("load",(function(_this){return function(){_this.set("width",image.naturalWidth);_this.set("height",image.naturalHeight);_this.set("data",image);return _this._isReady=true}})(this))}};Bitmap.prototype.isReady=function(){return this._isReady};return Bitmap})(Jax.Texture)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Texture.CubeMap=(function(superClass){extend(CubeMap,superClass);function CubeMap(options){this.isReady=bind(this.isReady,this);this.upload=bind(this.upload,this);this.dirChanged=bind(this.dirChanged,this);this.on("change:left   change:right change:top change:bottom change:near  change:far",this.dirChanged);$.extend(options,{wrap_s:GL_CLAMP_TO_EDGE,wrap_t:GL_CLAMP_TO_EDGE,min_filter:GL_LINEAR,mag_filter:GL_LINEAR,target:GL_TEXTURE_CUBE_MAP});CubeMap.__super__.constructor.call(this,options)}CubeMap.prototype.dirChanged=function(self,eventName){var data,ref,ref1,ref2,ref3,ref4,ref5;data=this.get("data")||{};switch(eventName){case"change:left":data.left=this.get("left");if((ref=data.left)!=null){ref.set("target",GL_TEXTURE_CUBE_MAP_NEGATIVE_X)}break;case"change:right":data.right=this.get("right");if((ref1=data.right)!=null){ref1.set("target",GL_TEXTURE_CUBE_MAP_POSITIVE_X)}break;case"change:top":data.top=this.get("top");if((ref2=data.top)!=null){ref2.set("target",GL_TEXTURE_CUBE_MAP_POSITIVE_Y)}break;case"change:bottom":data.bottom=this.get("bottom");if((ref3=data.bottom)!=null){ref3.set("target",GL_TEXTURE_CUBE_MAP_NEGATIVE_Y)}break;case"change:near":data.near=this.get("near");if((ref4=data.near)!=null){ref4.set("target",GL_TEXTURE_CUBE_MAP_POSITIVE_Z)}break;case"change:far":data.far=this.get("far");if((ref5=data.far)!=null){ref5.set("target",GL_TEXTURE_CUBE_MAP_NEGATIVE_Z)}}return this.set("data",data)};CubeMap.prototype.upload=function(context,handle,data){var bottom,far,gl,i,left,len,near,ref,right,texture,top;left=data.left,right=data.right,top=data.top,bottom=data.bottom,near=data.near,far=data.far;gl=context.renderer;ref=[left,right,top,bottom,near,far];for(i=0,len=ref.length;i<len;i++){texture=ref[i];gl.texImage2D(texture.get("target"),0,texture.get("format"),texture.get("format"),texture.get("data_type"),texture.get("data"))}return this};CubeMap.prototype.isReady=function(){var data,ref,ref1,ref2,ref3,ref4,ref5;data=this.get("data");return data&&((ref=data.left)!=null?ref.isReady():void 0)&&((ref1=data.right)!=null?ref1.isReady():void 0)&&((ref2=data.top)!=null?ref2.isReady():void 0)&&((ref3=data.bottom)!=null?ref3.isReady():void 0)&&((ref4=data.near)!=null?ref4.isReady():void 0)&&((ref5=data.far)!=null?ref5.isReady():void 0)};return CubeMap})(Jax.Texture)}).call(this);(function(){Jax.Noise=(function(){var grad,grad_buf,initGradTexture,perm;perm=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];grad=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]];grad_buf=null;initGradTexture=function(){var gv,i,j,k,l,offset,pixels,tex,value;tex=new Jax.Texture({min_filter:GL_NEAREST,mag_filter:GL_NEAREST,width:256,height:256,upload:function(context,handle,textureData){return context.renderer.texImage2D(GL_TEXTURE_2D,0,GL_RGBA,256,256,0,GL_RGBA,GL_UNSIGNED_BYTE,textureData)}});if(!grad_buf){pixels=new Array(256*256*4);for(i=k=0;k<256;i=++k){for(j=l=0;l<256;j=++l){offset=(i*256+j)*4;value=perm[(j+perm[i])&255];gv=value&15;pixels[offset]=grad[gv][0]*64+128;pixels[offset+1]=grad[gv][1]*64+128;pixels[offset+2]=grad[gv][2]*64+grad[gv][3]*16+128;pixels[offset+3]=value}}grad_buf=new Uint8Array(pixels)}tex.set("data",grad_buf);return tex};function Noise(){this.grad=initGradTexture()}Noise.prototype.bind=function(context,uniforms){return uniforms.gradTexture=this.grad};return Noise})();Jax.noise=new Jax.Noise}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Mesh.Cone=(function(superClass){extend(Cone,superClass);function Cone(options){options||(options={});options.sides||(options.sides=8);options.size||(options.size=1);options.radius||(options.radius=options.size/2);options.height||(options.height=options.size);Cone.__super__.constructor.call(this,options);if(this.sides<3){throw new Error("Cone requires minimum 3 sides")}}Cone.prototype.init=function(vertices,colors,textures,normals){var delta,i,ref,results,side,x,z;vertices.push(0,this.height/2,0);textures.push(0,0);delta=Math.PI*2/this.sides;results=[];for(side=i=0,ref=-this.sides;0<=ref?i<=ref:i>=ref;side=0<=ref?++i:--i){x=Math.cos(side*delta);z=Math.sin(side*delta);vertices.push(x*this.radius,-this.height/2,z*this.radius);results.push(textures.push(x*0.5+0.5,z*0.5+0.5))}return results};return Cone})(Jax.Mesh.TriangleFan)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Mesh.Cube=(function(superClass){var SIDES,_tmpvec3;extend(Cube,superClass);SIDES=["front","back","left","right","top","bottom"];_tmpvec3=vec3.create();function Cube(options){var d,h,invalidate,ref,size,w;if(options==null){options={}}size=options.size||(options.size=1);options.width||(options.width=options.size);options.depth||(options.depth=options.size);options.height||(options.height=options.size);Cube.__super__.constructor.call(this,options);invalidate=(function(_this){return function(){return _this.invalidate(true)}})(this);ref=[options.width,options.height,options.depth],w=ref[0],h=ref[1],d=ref[2];this.left=new Jax.Model({mesh:new Jax.Mesh.Quad(d,h)});this.left.camera.lookAt([-w/2,0,0],[-w/2-1,0,0],[0,1,0]);this.left.mesh.on("colorChanged",invalidate);this.left.camera.on("updated",invalidate);Object.defineProperty(this.left,"color",{get:function(){return this.mesh.color},set:function(c){return this.mesh.color=c}});this.right=new Jax.Model({mesh:new Jax.Mesh.Quad(d,h)});this.right.camera.lookAt([w/2,0,0],[w/2+1,0,0],[0,1,0]);this.right.mesh.on("colorChanged",invalidate);this.right.camera.on("updated",invalidate);Object.defineProperty(this.right,"color",{get:function(){return this.mesh.color},set:function(c){return this.mesh.color=c}});this.front=new Jax.Model({mesh:new Jax.Mesh.Quad(d,h)});this.front.camera.lookAt([0,0,d/2],[0,0,d/2+1],[0,1,0]);this.front.mesh.on("colorChanged",invalidate);this.front.camera.on("updated",invalidate);Object.defineProperty(this.front,"color",{get:function(){return this.mesh.color},set:function(c){return this.mesh.color=c}});this.back=new Jax.Model({mesh:new Jax.Mesh.Quad(d,h)});this.back.camera.lookAt([0,0,-d/2],[0,0,-d/2-1],[0,1,0]);this.back.mesh.on("colorChanged",invalidate);this.back.camera.on("updated",invalidate);Object.defineProperty(this.back,"color",{get:function(){return this.mesh.color},set:function(c){return this.mesh.color=c}});this.top=new Jax.Model({mesh:new Jax.Mesh.Quad(d,h)});this.top.camera.lookAt([0,h/2,0],[0,h/2+1,0],[0,0,-1]);this.top.mesh.on("colorChanged",invalidate);this.top.camera.on("updated",invalidate);Object.defineProperty(this.top,"color",{get:function(){return this.mesh.color},set:function(c){return this.mesh.color=c}});this.bottom=new Jax.Model({mesh:new Jax.Mesh.Quad(d,h)});this.bottom.camera.lookAt([0,-h/2,0],[0,-h/2-1,0],[0,0,1]);this.bottom.mesh.on("colorChanged",invalidate);this.bottom.camera.on("updated",invalidate);Object.defineProperty(this.bottom,"color",{get:function(){return this.mesh.color},set:function(c){return this.mesh.color=c}})}Cube.prototype.init=function(verts,colors,texes,norms){var cofs,i,j,k,l,len,m,mvmatrix,nmatrix,ref,ref1,sdata,side,tofs,vofs;for(i=0,len=SIDES.length;i<len;i++){side=SIDES[i];side=this[side];sdata=side.mesh.data;mvmatrix=side.camera.get("matrix");nmatrix=side.camera.get("normalMatrix");for(j=l=0,ref=sdata.length;0<=ref?l<ref:l>ref;j=0<=ref?++l:--l){ref1=[j*3,j*2,j*4],vofs=ref1[0],tofs=ref1[1],cofs=ref1[2];_tmpvec3[0]=sdata.vertexBuffer[vofs];_tmpvec3[1]=sdata.vertexBuffer[vofs+1];_tmpvec3[2]=sdata.vertexBuffer[vofs+2];vec3.transformMat4(_tmpvec3,_tmpvec3,mvmatrix);verts.push(-_tmpvec3[0],-_tmpvec3[1],-_tmpvec3[2]);_tmpvec3[0]=sdata.normalBuffer[vofs];_tmpvec3[1]=sdata.normalBuffer[vofs+1];_tmpvec3[2]=sdata.normalBuffer[vofs+2];vec3.transformMat3(_tmpvec3,_tmpvec3,nmatrix);norms.push(_tmpvec3[0],_tmpvec3[1],_tmpvec3[2]);for(k=m=0;m<4;k=++m){colors.push(sdata.colorBuffer[cofs+k]);if(k<2){texes.push(sdata.textureCoordsBuffer[tofs+k])}}}}return true};return Cube})(Jax.Mesh.Triangles)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Mesh.GeodesicSphere=(function(superClass){var g;extend(GeodesicSphere,superClass);g=(1+Math.sqrt(5))/2;GeodesicSphere.prototype.icosahedron={vertices:[[-1,g,0],[1,g,0],[-1,-g,0],[1,-g,0],[0,-1,g],[0,1,g],[0,-1,-g],[0,1,-g],[g,0,-1],[g,0,1],[-g,0,-1],[-g,0,1]],faces:[[0,11,5],[0,5,1],[0,1,7],[7,1,8],[8,6,7],[10,7,6],[0,7,10],[0,10,11],[11,10,2],[6,2,10],[3,2,6],[3,6,8],[3,8,9],[3,9,4],[3,4,2],[2,4,11],[5,11,4],[4,9,5],[1,5,9],[9,8,1]],uvU:2/11,uvV:1/3,facesUVs:[[[1,1],[1/2,0],[0,1]],[[1,1],[0,1],[1/2,2]],[[1,1],[1/2,2],[3/2,2]],[[3/2,2],[1/2,2],[1,3]],[[2,3],[5/2,2],[3/2,2]],[[2,1],[3/2,2],[5/2,2]],[[1,1],[3/2,2],[2,1]],[[1,1],[2,1],[3/2,0]],[[5/2,0],[2,1],[3,1]],[[5/2,2],[3,1],[2,1]],[[7/2,2],[3,1],[5/2,2]],[[7/2,2],[5/2,2],[3,3]],[[7/2,2],[4,3],[9/2,2]],[[7/2,2],[9/2,2],[4,1]],[[7/2,2],[4,1],[3,1]],[[3,1],[4,1],[7/2,0]],[[5,1],[9/2,0],[4,1]],[[4,1],[9/2,2],[5,1]],[[11/2,2],[5,1],[9/2,2]],[[9/2,2],[5,3],[11/2,2]]]};function GeodesicSphere(options){if(options==null){options={}}this.size=1;this.subdivisions=0;if(options.subdivisions>5){console.warn("Geode subdivided > 5 times is NOT supported ATM. Use at your own risk !")}if(options.icosahedron){options.icosahedron=Jax.Util.merge(options.icosahedron,this.icosahedron)}GeodesicSphere.__super__.constructor.call(this,options)}GeodesicSphere.prototype.init=function(vertices,colors,textureCoords,vertexNormals,vertexIndices,tangents,bitangents){var _vA,_vB,_vC,face,faceUVs,i,j,len,len1,recursiveInit,recursiveInitUV,ref,ref1,size,u,v;size=this.size;_vA=vec3.create();_vB=vec3.create();_vC=vec3.create();recursiveInit=function(vA,vB,vC,detail){var midAB,midBC,midCA;if(detail<1){vec3.normalize(_vA,vA);vec3.normalize(_vB,vB);vec3.normalize(_vC,vC);vertexNormals.push(_vA[0],_vA[1],_vA[2],_vB[0],_vB[1],_vB[2],_vC[0],_vC[1],_vC[2]);vec3.scale(_vA,_vA,size);vec3.scale(_vB,_vB,size);vec3.scale(_vC,_vC,size);vertices.push(_vA[0],_vA[1],_vA[2],_vB[0],_vB[1],_vB[2],_vC[0],_vC[1],_vC[2])}else{detail--;midAB=vec3.create();midBC=vec3.create();midCA=vec3.create();vec3.scale(midAB,vec3.add(midAB,vA,vB),1/2);vec3.scale(midBC,vec3.add(midBC,vB,vC),1/2);vec3.scale(midCA,vec3.add(midCA,vC,vA),1/2);recursiveInit(vA,midAB,midCA,detail);recursiveInit(midAB,vB,midBC,detail);recursiveInit(midCA,midBC,vC,detail);recursiveInit(midAB,midBC,midCA,detail)}return true};u=this.icosahedron.uvU;v=this.icosahedron.uvV;recursiveInitUV=function(uvA,uvB,uvC,detail){var midAB,midBC,midCA;if(detail<1){textureCoords.push(uvA[0]*u,uvA[1]*v,uvB[0]*u,uvB[1]*v,uvC[0]*u,uvC[1]*v)}else{detail--;midAB=vec3.create();midBC=vec3.create();midCA=vec3.create();vec3.scale(midAB,vec3.add(midAB,uvA,uvB),1/2);vec3.scale(midBC,vec3.add(midBC,uvB,uvC),1/2);vec3.scale(midCA,vec3.add(midCA,uvC,uvA),1/2);recursiveInitUV(uvA,midAB,midCA,detail);recursiveInitUV(midAB,uvB,midBC,detail);recursiveInitUV(midCA,midBC,uvC,detail);recursiveInitUV(midAB,midBC,midCA,detail)}return true};ref=this.icosahedron.faces;for(i=0,len=ref.length;i<len;i++){face=ref[i];recursiveInit(vec3.clone(this.icosahedron.vertices[face[0]]),vec3.clone(this.icosahedron.vertices[face[1]]),vec3.clone(this.icosahedron.vertices[face[2]]),this.subdivisions)}ref1=this.icosahedron.facesUVs;for(j=0,len1=ref1.length;j<len1;j++){faceUVs=ref1[j];recursiveInitUV(vec2.clone(faceUVs[0]),vec2.clone(faceUVs[1]),vec2.clone(faceUVs[2]),this.subdivisions)}return true};return GeodesicSphere})(Jax.Mesh.Triangles)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,slice=[].slice;Jax.Mesh.GeodesicSphereDual=(function(superClass){extend(GeodesicSphereDual,superClass);function GeodesicSphereDual(options){if(options==null){options={}}if(options.subdivisions>3){console.warn("Dual Geode subdivided > 3 times is not supported")}this.pentagons=[];this.hexagons=[];GeodesicSphereDual.__super__.constructor.call(this,options)}GeodesicSphereDual.prototype.init=function(vertices,colors,textureCoords,vertexNormals,vertexIndices,tangents,bitangents){var a,b,c,centerVertices,closestVertices,currentVertexBufferIndex,geodeColors,geodeTextureCoords,geodeVertexNormals,geodeVertices,getClosestVertices,i,icosahedronVertices,isIn,j,k,l,len1,m,medianAltitude,n,o,p,ref,ref1,ref2,ref3,ref4,uniqueGeodeVertices,vertex;isIn=function(needleVertex,verticesHaystack){var j,len1,vertex;for(j=0,len1=verticesHaystack.length;j<len1;j++){vertex=verticesHaystack[j];if(vec3.distance(needleVertex,vertex)<Math.EPSILON){return true}}return false};getClosestVertices=function(vertex,vertices,howMuch){var _vA,_vB,closestVertices,i,j,ref,start;howMuch=Math.min(howMuch,vertices.length);vertices.sort(function(vA,vB){if(vA===vertex){return 1}if(vB===vertex){return -1}return vec3.dot(vertex,vB)-vec3.dot(vertex,vA)});closestVertices=[];for(i=j=0,ref=howMuch;j<ref;i=j+=1){closestVertices.push(vertices[i])}start=vec3.subtract([],closestVertices[0],vertex);vec3.normalize(start,start);_vA=vec3.create();_vB=vec3.create();closestVertices.sort(function(vA,vB){var a,b,dA,dB,dotA,dotB;dA=vec3.normalize(_vA,vec3.subtract(_vA,vA,vertex));dB=vec3.normalize(_vB,vec3.subtract(_vB,vB,vertex));a=vec3.dot(start,dA)+1;b=vec3.dot(start,dB)+1;dotA=vec3.dot(vertex,vec3.cross([],start,dA));dotB=vec3.dot(vertex,vec3.cross([],start,dB));if(dotA<0){a*=-1}if(dotB<0){b*=-1}return b-a});return closestVertices};ref=[[],[],[],[]],geodeVertices=ref[0],geodeColors=ref[1],geodeTextureCoords=ref[2],geodeVertexNormals=ref[3];GeodesicSphereDual.__super__.init.call(this,geodeVertices,geodeColors,geodeTextureCoords,geodeVertexNormals);uniqueGeodeVertices=[];centerVertices=[];for(i=j=0,ref1=geodeVertices.length;j<ref1;i=j+=9){a=[geodeVertices[i],geodeVertices[i+1],geodeVertices[i+2]];b=[geodeVertices[i+3],geodeVertices[i+4],geodeVertices[i+5]];c=[geodeVertices[i+6],geodeVertices[i+7],geodeVertices[i+8]];o=vec3.scale([],vec3.normalize([],vec3.add([],vec3.add([],a,b),c)),this.size);if(!isIn(a,uniqueGeodeVertices)){uniqueGeodeVertices.push(a)}if(!isIn(b,uniqueGeodeVertices)){uniqueGeodeVertices.push(b)}if(!isIn(c,uniqueGeodeVertices)){uniqueGeodeVertices.push(c)}centerVertices.push(o)}icosahedronVertices=this.icosahedron.vertices.slice(0);for(i=k=0,ref2=icosahedronVertices.length;k<ref2;i=k+=1){vec3.normalize(icosahedronVertices[i],icosahedronVertices[i]);vec3.scale(icosahedronVertices[i],icosahedronVertices[i],this.size)}currentVertexBufferIndex=0;for(l=0,len1=uniqueGeodeVertices.length;l<len1;l++){vertex=uniqueGeodeVertices[l];if(isIn(vertex,icosahedronVertices)){n=5;this._pushPentagonUV(textureCoords)}else{n=6;this._pushHexagonUV(textureCoords)}closestVertices=getClosestVertices(vertex,centerVertices,n);medianAltitude=[0,0,0];for(i=m=0,ref3=n;m<ref3;i=m+=1){vec3.add(medianAltitude,medianAltitude,closestVertices[i])}medianAltitude=vec3.length(medianAltitude)/n;vec3.normalize(vertex,vertex);vec3.scale(vertex,vertex,medianAltitude);for(i=p=0,ref4=n;p<ref4;i=p+=1){vertices.push(vertex[0],vertex[1],vertex[2]);vertices.push(closestVertices[i][0],closestVertices[i][1],closestVertices[i][2]);vertices.push(closestVertices[(i+1)%n][0],closestVertices[(i+1)%n][1],closestVertices[(i+1)%n][2])}currentVertexBufferIndex+=n*9}return true};GeodesicSphereDual.prototype._pushPentagonUV=function(intoUVs){var c1,c2,o,s1,s2,vertices;c1=(Math.sqrt(5)-1)/4;c2=(Math.sqrt(5)+1)/4;s1=(Math.sqrt(10+2*Math.sqrt(5)))/4;s2=(Math.sqrt(10-2*Math.sqrt(5)))/4;vertices=[[1/4,1/2],[1/4,0],[(-s1+1)/4,(-c1+1)/2],[(-s2+1)/4,(c2+1)/2],[(s2+1)/4,(c2+1)/2],[(s1+1)/4,(-c1+1)/2]];o=vertices.shift();this._pushTriangleFanUV(o,vertices,intoUVs);return void 0};GeodesicSphereDual.prototype._pushHexagonUV=function(intoUVs){var h,o,vertices;h=Math.sqrt(3)/2;vertices=[[3/4,1/2],[3/4,0],[(-h+3)/4,1/4],[(-h+3)/4,3/4],[3/4,1],[(h+3)/4,3/4],[(h+3)/4,1/4]];o=vertices.shift();this._pushTriangleFanUV(o,vertices,intoUVs);return void 0};GeodesicSphereDual.prototype._pushTriangleFanUV=function(centerVertex,fanVertices,intoUVs){var i,j,len,ref,v1,v2;len=fanVertices.length;for(i=j=0,ref=len;j<ref;i=j+=1){v1=fanVertices[(i+0)%len];v2=fanVertices[(i+1)%len];intoUVs.push.apply(intoUVs,slice.call(centerVertex).concat(slice.call(v1),slice.call(v2)))}return void 0};return GeodesicSphereDual})(Jax.Mesh.GeodesicSphere)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Mesh.Icosahedron=(function(superClass){extend(Icosahedron,superClass);function Icosahedron(options){if(options==null){options={}}options.subdivisions=0;Icosahedron.__super__.constructor.call(this,options)}return Icosahedron})(Jax.Mesh.GeodesicSphere)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Mesh.LineCube=(function(superClass){extend(LineCube,superClass);function LineCube(halfSize1,offset1){this.halfSize=halfSize1!=null?halfSize1:0.5;this.offset=offset1!=null?offset1:[0,0,0];if(typeof this.halfSize!=="number"){LineCube.__super__.constructor.call(this,this.halfSize);this.halfSize=this.size/2}else{LineCube.__super__.constructor.call(this)}}LineCube.prototype.init=function(vertices,colors,normals,textures,indices){var halfSize,offset,v;halfSize=this.halfSize;offset=this.offset;v=vec3.create();vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[-1,1,1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[-1,1,-1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[-1,1,-1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[-1,-1,-1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[-1,-1,-1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[-1,-1,1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[-1,-1,1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[-1,1,1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[1,1,1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[1,1,-1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[1,1,-1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[1,-1,-1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[1,-1,-1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[1,-1,1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[1,-1,1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[1,1,1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[-1,1,1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[1,1,1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[-1,-1,1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[1,-1,1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[-1,1,-1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[1,1,-1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[-1,-1,-1],halfSize),offset));vertices.push.apply(vertices,vec3.add(v,vec3.scale(v,[1,-1,-1],halfSize),offset));return true};return LineCube})(Jax.Mesh.Lines)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Mesh.OBJ=(function(superClass){extend(OBJ,superClass);function OBJ(pathOrOpts){var xhr;if(pathOrOpts==null){pathOrOpts={}}this.size=1;this.method="GET";if(typeof pathOrOpts==="string"){pathOrOpts={path:pathOrOpts}}OBJ.__super__.constructor.call(this,pathOrOpts);if(!this.parser){xhr=new XMLHttpRequest();xhr.onreadystatechange=(function(_this){return function(){if(xhr.readyState===xhr.DONE){if(xhr.status===200){_this.parser=new Jax.Mesh.OBJ.Parser(xhr.responseText);return _this.rebuild()}else{throw new Error("Request for "+_this.path+" returned status "+xhr.status)}}}})(this);xhr.open(this.method,this.path);xhr.send()}}OBJ.prototype.init=function(vertices,colors,textures,normals,indices){var dist,face,i,j,k,l,len,len1,len2,max,name,obj,ref,ref1,ref2,ref3,v;if(!this.parser){return}dist=vec3.create();max=0;ref=this.parser.objects;for(name in ref){obj=ref[name];ref1=obj.faces;for(j=0,len1=ref1.length;j<len1;j++){face=ref1[j];ref2=face.v;for(i=k=0,len2=ref2.length;k<len2;i=++k){v=ref2[i];vertices.push.apply(vertices,v);textures.push.apply(textures,face.t[i]);normals.push.apply(normals,face.n[i]);vec3.copy(dist,v);len=vec3.length(dist);if(max<len){max=len}}}}for(v=l=0,ref3=vertices.length;0<=ref3?l<ref3:l>ref3;v=0<=ref3?++l:--l){vertices[v]=vertices[v]/max*this.size}return null};return OBJ})(Jax.Mesh.Triangles)}).call(this);(function(){var slice=[].slice;Jax.Mesh.OBJ.Parser=(function(){function Parser(content){var args,cmd,curObj,i,len,line,lines,ref;this.objects={};this.vertices=[];this.textureCoords=[];this.normals=[];curObj=null;lines=[];ref=content.split(/\n/);for(i=0,len=ref.length;i<len;i++){line=ref[i];line=line.replace(/\#.*/,"").trim();if(line){args=line.split(/\s+/);switch(cmd=args.shift()){case"o":curObj=this.objects[args.shift()]={vertices:this.vertices,textureCoords:this.textureCoords,normals:this.normals,faces:[],aggregates:{},smooth:false};break;case"v":this.addVertex.apply(this,[curObj].concat(slice.call(args)));break;case"vt":this.addTexCoords.apply(this,[curObj].concat(slice.call(args)));break;case"vn":this.addNormal.apply(this,[curObj].concat(slice.call(args)));break;case"f":this.addFace.apply(this,[curObj].concat(slice.call(args)));break;case"s":this.setSmoothFaces.apply(this,[curObj].concat(slice.call(args)));break;default:console.warn("OBJ: command not understood:",cmd,args)}}}this.finalizeAggregates()}Parser.prototype.setSmoothFaces=function(obj,b){switch(b){case"1":case"on":case"true":return obj.smooth=true;default:return obj.smooth=false}};Parser.prototype.finalizeAggregates=function(){var i,len,n,name,normal,obj,ref,ref1,set,vi;ref=this.objects;for(name in ref){obj=ref[name];if(obj.aggregates){ref1=obj.aggregates;for(vi in ref1){set=ref1[vi];normal=[0,0,0];for(i=0,len=set.length;i<len;i++){n=set[i];vec3.add(normal,normal,n)}if(vec3.length(normal)){vec3.normalize(normal,normal)}else{normal[1]=1}set.splice(0,set.length);set.push.apply(set,normal)}}}return true};Parser.prototype.aggregate=function(obj,face,vi,ni){var base;if(obj.smooth){(base=obj.aggregates)[vi]||(base[vi]=[]);obj.aggregates[vi].push(obj.normals[ni-1]);return obj.aggregates[vi]}else{return obj.normals[ni-1]}};Parser.prototype.parseFace=function(obj,v1,v2,v3){var face,i,len,ni,ref,ref1,ti,v,vi;face={v:[],t:[],n:[]};ref=[v1,v2,v3];for(i=0,len=ref.length;i<len;i++){v=ref[i];ref1=slice.call(v.split(/\//)),vi=ref1[0],ti=ref1[1],ni=ref1[2];face.v.push(obj.vertices[vi-1]);face.t.push(obj.textureCoords[ti-1]);face.n.push(this.aggregate(obj,face,vi,ni))}return face};Parser.prototype.addFace=function(obj,v1,v2,v3,v4){if(v4==null){v4=null}obj.faces.push(this.parseFace(obj,v1,v2,v3));if(v4!==null){return obj.faces.push(this.parseFace(obj,v1,v3,v4))}};Parser.prototype.addVertex=function(obj,x,y,z,w){if(w==null){w=1}return obj.vertices.push([parseFloat(x),parseFloat(y),parseFloat(z)])};Parser.prototype.addTexCoords=function(obj,u,v,w){if(w==null){w=0}return obj.textureCoords.push([parseFloat(u),parseFloat(v)])};Parser.prototype.addNormal=function(obj,x,y,z){var normal;normal=[parseFloat(x),parseFloat(y),parseFloat(z)];vec3.normalize(normal,normal);return obj.normals.push(normal)};return Parser})()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Mesh.Plane=(function(superClass){extend(Plane,superClass);function Plane(options){this.fn=function(x,z){return 0};this.size=(options!=null?options.size:void 0)||500;this.segments=(options!=null?options.segments:void 0)||20;this.width=this.depth=this.size;this.xSegments=this.zSegments=this.segments;Plane.__super__.constructor.call(this,options)}Plane.prototype.init=function(verts,colors,texes,norms,indices){var d,hash,hashes,i,j,k,ref,ref1,ref2,ref3,ref4,w,x,xUnit,xs,z,zUnit,zs;hashes={};ref=[this.width,this.depth,this.xSegments,this.zSegments],w=ref[0],d=ref[1],xs=ref[2],zs=ref[3];ref1=[w/xs,d/zs],xUnit=ref1[0],zUnit=ref1[1];hash=(function(_this){return function(x,z){var index,key,vx,vy,vz;key=x+";"+z;if(hashes[key]!==void 0){return hashes[key]}else{vx=xUnit*x-w/2;vz=zUnit*z-d/2;vy=_this.fn(x,z);index=verts.length/3;verts.push(vx,vz,vy);texes.push(x/(xs-1),z/(zs-1));return hashes[key]=index}}})(this);for(x=i=1,ref2=xs;i<ref2;x=i+=2){for(z=j=0,ref3=zs;0<=ref3?j<ref3:j>ref3;z=0<=ref3?++j:--j){indices.push(hash(x,z));indices.push(hash(x-1,z))}x++;for(z=k=ref4=zs-1;ref4<=0?k<=0:k>=0;z=ref4<=0?++k:--k){indices.push(hash(x-1,z));indices.push(hash(x,z))}}return true};return Plane})(Jax.Mesh.TriangleStrip)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Mesh.PLY=(function(superClass){extend(PLY,superClass);function PLY(options){var xhr;if(options==null){options={}}if(typeof options==="string"){options={path:options}}this.size=1;this.method="GET";PLY.__super__.constructor.call(this,options);if(!this.parser){xhr=new XMLHttpRequest();xhr.responseType="arraybuffer";xhr.onreadystatechange=(function(_this){return function(){if(xhr.readyState===xhr.DONE){if(xhr.status===200){_this.parser=new Jax.Mesh.PLY.Parser(xhr.response);return _this.rebuild()}else{throw new Error("Request for "+_this.path+" returned status "+xhr.status)}}}})(this);xhr.open(this.method,this.path);xhr.send()}}PLY.prototype.init=function(vertices,colors,textures,normals,indices){var blue,dist,face,green,i,index,intensity,j,k,l,len,len1,len2,len3,max,red,ref,ref1,ref2,ref3,ref4,ref5,ref6,v,vertex;if(!this.parser){return}dist=vec3.create();max=0;ref=this.parser.vertex||this.parser.vertices;for(i=0,len1=ref.length;i<len1;i++){vertex=ref[i];vertices.push(vertex.x,vertex.y,vertex.z);ref1=[vertex.x,vertex.y,vertex.z],dist[0]=ref1[0],dist[1]=ref1[1],dist[2]=ref1[2];len=vec3.length(dist);if(max<len){max=len}if(vertex.nx!==void 0){normals.push(vertex.nx,vertex.ny,vertex.nz)}intensity=(vertex.intensity===void 0?1:vertex.intensity);if(vertex.red===void 0){ref2=[1,1,1],red=ref2[0],green=ref2[1],blue=ref2[2]}else{ref3=[vertex.red,vertex.green,vertex.blue],red=ref3[0],green=ref3[1],blue=ref3[2]}colors.push(red*intensity,green*intensity,blue*intensity,1)}for(v=j=0,ref4=vertices.length;0<=ref4?j<ref4:j>ref4;v=0<=ref4?++j:--j){vertices[v]=vertices[v]/max*this.size}ref5=this.parser.face;for(k=0,len2=ref5.length;k<len2;k++){face=ref5[k];ref6=face.vertex_index||face.vertex_indices;for(l=0,len3=ref6.length;l<len3;l++){index=ref6[l];indices.push(index);if((intensity=face.intensity)!==void 0){colors[index*4+0]*=intensity;colors[index*4+1]*=intensity;colors[index*4+2]*=intensity;colors[index*4+3]*=intensity}}}return null};return PLY})(Jax.Mesh.Triangles)}).call(this);(function(){Jax.Mesh.PLY.Parser=(function(){var BIG_ENDIAN,LITTLE_ENDIAN,arrayBuffers,arrayViews;BIG_ENDIAN=1;LITTLE_ENDIAN=2;Parser.prototype.sizeOf=function(type){switch(type){case"char":return Int8Array.BYTES_PER_ELEMENT;case"uchar":return Uint8Array.BYTES_PER_ELEMENT;case"short":return Int16Array.BYTES_PER_ELEMENT;case"ushort":return Uint16Array.BYTES_PER_ELEMENT;case"int":return Int32Array.BYTES_PER_ELEMENT;case"uint":return Uint32Array.BYTES_PER_ELEMENT;case"float":return Float32Array.BYTES_PER_ELEMENT;case"double":return Float64Array.BYTES_PER_ELEMENT;default:throw new Error("Unexpected data type: "+type)}};Parser.prototype.readType=function(bufferView,type,endianness,byteOffset){if(byteOffset==null){byteOffset=0}switch(type){case"char":return bufferView.getInt8(byteOffset);case"uchar":return bufferView.getUint8(byteOffset);case"short":return bufferView.getInt16(byteOffset,endianness===LITTLE_ENDIAN);case"ushort":return bufferView.getUint16(byteOffset,endianness===LITTLE_ENDIAN);case"int":return bufferView.getInt32(byteOffset,endianness===LITTLE_ENDIAN);case"uint":return bufferView.getUint32(byteOffset,endianness===LITTLE_ENDIAN);case"float":return bufferView.getFloat32(byteOffset,endianness===LITTLE_ENDIAN);case"double":return bufferView.getFloat64(byteOffset,endianness===LITTLE_ENDIAN);default:throw new Error("Unexpected data type: "+type)}};Parser.prototype.stringToBytes=function(str){var _char,i,k,ref,result,stack;result=[];for(i=k=0,ref=str.length;0<=ref?k<ref:k>ref;i=0<=ref?++k:--k){_char=str.charCodeAt(i);stack=[];stack.unshift(_char&255);_char=_char>>8;while(_char){stack.unshift(_char&255);_char=_char>>8}result=result.concat(stack)}return result};Parser.prototype.bytesToString=function(arr,beginOffset){var i,k,ref,ref1,result;if(beginOffset==null){beginOffset=0}result="";for(i=k=ref=beginOffset,ref1=arr.length;ref<=ref1?k<ref1:k>ref1;i=ref<=ref1?++k:--k){result+=String.fromCharCode(arr[i])}return result};function Parser(content){var bytes,elements,header;this.comments=[];if(typeof content==="string"){bytes=new Uint8Array(this.stringToBytes(content))}else{bytes=new Uint8Array(content)}header=this.parseHeader(bytes);elements=this.processHeader(header);bytes=new Uint8Array(bytes.buffer,header.length);switch(this.format){case"ascii":this.processASCII(elements,this.bytesToString(bytes).split(/\n/));break;case"binary_big_endian":this.processBinary(elements,bytes,BIG_ENDIAN);break;case"binary_little_endian":this.processBinary(elements,bytes,LITTLE_ENDIAN);break;default:throw new Error("format "+this.format+" ("+this.version+") is not supported")}}Parser.prototype.parseHeader=function(bytes){var _byte,header,k,len;header="";for(k=0,len=bytes.length;k<len;k++){_byte=bytes[k];header+=String.fromCharCode(_byte);if(header.indexOf("end_header\n")!==-1){break}}return header};Parser.prototype.processHeader=function(header){var element,elements,line,ref,tokens;header=header.trim().split(/\n/);if(header.shift()!=="ply"){throw new Error("Not a PLY!")}if(header.pop()!=="end_header"){throw new Error("Could not detect end of header!")}elements=[];while(header.length>0){line=header.shift();tokens=line.split(/\s+/);switch(tokens[0]){case"format":ref=[tokens[1],tokens[2]],this.format=ref[0],this.version=ref[1];break;case"comment":this.comments.push(tokens.slice(1).join(" "));break;case"element":elements.push(element={name:tokens[1],count:parseInt(tokens[2]),properties:[]});break;case"property":element.properties.push(tokens.slice(1))}if(line==="end_header"){break}}return elements};arrayBuffers={};arrayViews={};Parser.prototype.readBinaryValue=function(bytes,type,endianness,offset){var byteSize,k,ofs,ref;if(offset==null){offset=0}byteSize=this.sizeOf(type);arrayBuffers[byteSize]||(arrayBuffers[byteSize]=new ArrayBuffer(byteSize));arrayViews[byteSize]||(arrayViews[byteSize]=new DataView(arrayBuffers[byteSize]));for(ofs=k=0,ref=byteSize;0<=ref?k<ref:k>ref;ofs=0<=ref?++k:--k){arrayViews[byteSize].setUint8(ofs,bytes[offset+ofs])}return this.readType(arrayViews[byteSize],type)};Parser.prototype.processBinary=function(elements,bytes,endianness){var descriptor,element,elementSize,elementType,i,j,k,l,len,len1,listLength,m,n,offset,property,ref,ref1,ref2,value;offset=0;for(k=0,len=elements.length;k<len;k++){element=elements[k];this[element.name]=new Array(element.count);for(i=l=0,ref=element.count;0<=ref?l<ref:l>ref;i=0<=ref?++l:--l){this[element.name][i]=descriptor={};ref1=element.properties;for(m=0,len1=ref1.length;m<len1;m++){property=ref1[m];if(property[0]==="list"){listLength=this.readBinaryValue(bytes,property[1],endianness,offset);offset+=this.sizeOf(property[1]);elementType=property[2];elementSize=this.sizeOf(elementType);descriptor[property[3]]=new Array(listLength);for(j=n=0,ref2=listLength;0<=ref2?n<ref2:n>ref2;j=0<=ref2?++n:--n){descriptor[property[3]][j]=this.readBinaryValue(bytes,elementType,endianness,offset);offset+=elementSize}}else{value=this.readBinaryValue(bytes,property[0],endianness,offset);offset+=this.sizeOf(property[0]);descriptor[property[1]]=value}}}}return offset};Parser.prototype.processASCII=function(elements,lines){var descriptor,e,element,i,k,l,len,len1,listElementType,listLength,listLengthType,m,property,ref,ref1,tokens;for(k=0,len=elements.length;k<len;k++){element=elements[k];this[element.name]=new Array(element.count);for(i=l=0,ref=element.count;0<=ref?l<ref:l>ref;i=0<=ref?++l:--l){tokens=lines.shift().split(/\s+/);this[element.name][i]=descriptor={};ref1=element.properties;for(m=0,len1=ref1.length;m<len1;m++){property=ref1[m];switch(property[0]){case"float":descriptor[property[1]]=parseFloat(tokens.shift());break;case"list":listLengthType=property[1];listElementType=property[2];listLength=parseInt(tokens.shift());descriptor[property[3]]=(function(){var n,ref2,results;results=[];for(e=n=0,ref2=listLength;0<=ref2?n<ref2:n>ref2;e=0<=ref2?++n:--n){results.push(parseInt(tokens.shift()))}return results})();break;default:throw new Error("Unrecognized property: "+(JSON.stringify(property)))}}}}return true};return Parser})()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Mesh.Quad=(function(superClass){extend(Quad,superClass);function Quad(options){if(typeof options==="number"){options={size:options}}options||(options={});options.width||(options.width=options.size||1);options.height||(options.height=options.size||1);Quad.__super__.constructor.call(this,options)}Quad.define("width",{get:function(){return this._width},set:function(w){this._width=w;return this.invalidate()}});Quad.define("height",{get:function(){return this._height},set:function(h){this._height=h;return this.invalidate()}});Quad.prototype.init=function(verts,colors,textureCoords,normals,indices){var height,width;width=this._width/2;height=this._height/2;verts.push(-width,height,0);verts.push(-width,-height,0);verts.push(width,height,0);verts.push(width,height,0);verts.push(-width,-height,0);verts.push(width,-height,0);textureCoords.push(0,1);textureCoords.push(0,0);textureCoords.push(1,1);textureCoords.push(1,1);textureCoords.push(0,0);textureCoords.push(1,0);normals.push(0,0,1);normals.push(0,0,1);normals.push(0,0,1);normals.push(0,0,1);normals.push(0,0,1);return normals.push(0,0,1)};return Quad})(Jax.Mesh.Triangles)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Mesh.Sphere=(function(superClass){extend(Sphere,superClass);function Sphere(options){this.slices=30;this.stacks=30;this.radius=0.5;Sphere.__super__.constructor.call(this,options)}Sphere.prototype.init=function(vertices,colors,textureCoords,normals,indices){var _slices,cosph,costh,first,i,j,k,phi,radius,ref,ref1,ref2,ref3,results,second,sinph,sinth,slice,slices,stack,stacks,theta,u,v,x,y,z;ref=[this.slices,this.stacks,this.radius],slices=ref[0],stacks=ref[1],radius=ref[2];for(stack=i=0,ref1=stacks;0<=ref1?i<=ref1:i>=ref1;stack=0<=ref1?++i:--i){for(slice=j=0,ref2=slices;0<=ref2?j<=ref2:j>=ref2;slice=0<=ref2?++j:--j){theta=stack*Math.PI/stacks;phi=slice*2*Math.PI/slices;sinth=Math.sin(theta);sinph=Math.sin(phi);costh=Math.cos(theta);cosph=Math.cos(phi);x=cosph*sinth;y=sinph*sinth;z=costh;u=1-(stack/stacks);v=1-(slice/slices);if(Math.equalish(x,0)){x=0}if(Math.equalish(y,0)){y=0}if(Math.equalish(z,0)){z=0}vertices.push(x*radius,y*radius,z*radius);normals.push(x,y,z);textureCoords.push(u,v)}}_slices=slices+1;results=[];for(stack=k=0,ref3=stacks;0<=ref3?k<ref3:k>ref3;stack=0<=ref3?++k:--k){results.push((function(){var l,ref4,results1;results1=[];for(slice=l=0,ref4=slices;0<=ref4?l<=ref4:l>=ref4;slice=0<=ref4?++l:--l){first=(stack*_slices)+(slice%_slices);second=((stack+1)*_slices)+(slice%_slices);results1.push(indices.push(first,second))}return results1})())}return results};return Sphere})(Jax.Mesh.TriangleStrip)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Mesh.Teapot=(function(superClass){var teapot;extend(Teapot,superClass);teapot={vertices:[5.929688,4.125,0,5.387188,4.125,2.7475,5.2971,4.494141,2.70917,5.832031,4.494141,0,5.401602,4.617188,2.753633,5.945313,4.617188,0,5.614209,4.494141,2.844092,6.175781,4.494141,0,5.848437,4.125,2.94375,6.429688,4.125,0,3.899688,4.125,4.97,3.830352,4.494141,4.900664,3.910782,4.617188,4.981094,4.074414,4.494141,5.144727,4.254687,4.125,5.325,1.677188,4.125,6.4575,1.638858,4.494141,6.367412,1.68332,4.617188,6.471914,1.77378,4.494141,6.684522,1.873438,4.125,6.91875,-1.070312,4.125,7,-1.070312,4.494141,6.902344,-1.070312,4.617188,7.015625,-1.070312,4.494141,7.246094,-1.070312,4.125,7.5,-1.070312,4.125,7,-4.007656,4.125,6.4575,-3.859572,4.494141,6.367412,-1.070312,4.494141,6.902344,-3.847676,4.617188,6.471914,-1.070312,4.617188,7.015625,-3.917371,4.494141,6.684522,-1.070312,4.494141,7.246094,-4.014062,4.125,6.91875,-1.070312,4.125,7.5,-6.209063,4.125,4.97,-6.042168,4.494141,4.900664,-6.0725,4.617188,4.981094,-6.217675,4.494141,5.144727,-6.395312,4.125,5.325,-7.591093,4.125,2.7475,-7.464421,4.494141,2.70917,-7.550137,4.617188,2.753633,-7.755822,4.494141,2.844092,-7.989062,4.125,2.94375,-8.070313,4.125,0,-7.972656,4.494141,0,-8.085938,4.617188,0,-8.316406,4.494141,0,-8.570313,4.125,0,-8.070313,4.125,0,-7.527812,4.125,-2.7475,-7.437724,4.494141,-2.70917,-7.972656,4.494141,0,-7.542227,4.617188,-2.753633,-8.085938,4.617188,0,-7.754834,4.494141,-2.844092,-8.316406,4.494141,0,-7.989062,4.125,-2.94375,-8.570313,4.125,0,-6.040312,4.125,-4.97,-5.970977,4.494141,-4.900664,-6.051406,4.617188,-4.981094,-6.215039,4.494141,-5.144727,-6.395312,4.125,-5.325,-3.817812,4.125,-6.4575,-3.779482,4.494141,-6.367412,-3.823945,4.617188,-6.471914,-3.914404,4.494141,-6.684522,-4.014062,4.125,-6.91875,-1.070312,4.125,-7,-1.070312,4.494141,-6.902344,-1.070312,4.617188,-7.015625,-1.070312,4.494141,-7.246094,-1.070312,4.125,-7.5,-1.070312,4.125,-7,1.677188,4.125,-6.4575,1.638858,4.494141,-6.367412,-1.070312,4.494141,-6.902344,1.68332,4.617188,-6.471914,-1.070312,4.617188,-7.015625,1.77378,4.494141,-6.684522,-1.070312,4.494141,-7.246094,1.873438,4.125,-6.91875,-1.070312,4.125,-7.5,3.899688,4.125,-4.97,3.830352,4.494141,-4.900664,3.910782,4.617188,-4.981094,4.074414,4.494141,-5.144727,4.254687,4.125,-5.325,5.387188,4.125,-2.7475,5.2971,4.494141,-2.70917,5.401602,4.617188,-2.753633,5.614209,4.494141,-2.844092,5.848437,4.125,-2.94375,5.929688,4.125,0,5.832031,4.494141,0,5.945313,4.617188,0,6.175781,4.494141,0,6.429688,4.125,0,6.429688,4.125,0,5.848437,4.125,2.94375,6.695264,2.162109,3.304053,7.347656,2.162109,0,7.433985,0.234375,3.61836,8.148438,0.234375,0,7.956494,-1.623047,3.840674,8.714844,-1.623047,0,8.154688,-3.375,3.925,8.929688,-3.375,0,4.254687,4.125,5.325,4.906446,2.162109,5.976758,5.475,0.234375,6.545312,5.877149,-1.623047,6.947461,6.029688,-3.375,7.1,1.873438,4.125,6.91875,2.23374,2.162109,7.765576,2.548047,0.234375,8.504297,2.770362,-1.623047,9.026807,2.854688,-3.375,9.225,-1.070312,4.125,7.5,-1.070312,2.162109,8.417969,-1.070312,0.234375,9.21875,-1.070312,-1.623047,9.785156,-1.070312,-3.375,10,-1.070312,4.125,7.5,-4.014062,4.125,6.91875,-4.374365,2.162109,7.765576,-1.070312,2.162109,8.417969,-4.688672,0.234375,8.504297,-1.070312,0.234375,9.21875,-4.910986,-1.623047,9.026807,-1.070312,-1.623047,9.785156,-4.995313,-3.375,9.225,-1.070312,-3.375,10,-6.395312,4.125,5.325,-7.047071,2.162109,5.976758,-7.615624,0.234375,6.545312,-8.017773,-1.623047,6.947461,-8.170312,-3.375,7.1,-7.989062,4.125,2.94375,-8.835889,2.162109,3.304053,-9.57461,0.234375,3.61836,-10.097119,-1.623047,3.840674,-10.295313,-3.375,3.925,-8.570313,4.125,0,-9.488281,2.162109,0,-10.289063,0.234375,0,-10.855469,-1.623047,0,-11.070313,-3.375,0,-8.570313,4.125,0,-7.989062,4.125,-2.94375,-8.835889,2.162109,-3.304053,-9.488281,2.162109,0,-9.57461,0.234375,-3.61836,-10.289063,0.234375,0,-10.097119,-1.623047,-3.840674,-10.855469,-1.623047,0,-10.295313,-3.375,-3.925,-11.070313,-3.375,0,-6.395312,4.125,-5.325,-7.047071,2.162109,-5.976758,-7.615624,0.234375,-6.545312,-8.017773,-1.623047,-6.947461,-8.170312,-3.375,-7.1,-4.014062,4.125,-6.91875,-4.374365,2.162109,-7.765576,-4.688672,0.234375,-8.504297,-4.910986,-1.623047,-9.026807,-4.995313,-3.375,-9.225,-1.070312,4.125,-7.5,-1.070312,2.162109,-8.417969,-1.070312,0.234375,-9.21875,-1.070312,-1.623047,-9.785156,-1.070312,-3.375,-10,-1.070312,4.125,-7.5,1.873438,4.125,-6.91875,2.23374,2.162109,-7.765576,-1.070312,2.162109,-8.417969,2.548047,0.234375,-8.504297,-1.070312,0.234375,-9.21875,2.770362,-1.623047,-9.026807,-1.070312,-1.623047,-9.785156,2.854688,-3.375,-9.225,-1.070312,-3.375,-10,4.254687,4.125,-5.325,4.906446,2.162109,-5.976758,5.475,0.234375,-6.545312,5.877149,-1.623047,-6.947461,6.029688,-3.375,-7.1,5.848437,4.125,-2.94375,6.695264,2.162109,-3.304053,7.433985,0.234375,-3.61836,7.956494,-1.623047,-3.840674,8.154688,-3.375,-3.925,6.429688,4.125,0,7.347656,2.162109,0,8.148438,0.234375,0,8.714844,-1.623047,0,8.929688,-3.375,0,8.929688,-3.375,0,8.154688,-3.375,3.925,7.794336,-4.857422,3.77168,8.539063,-4.857422,0,7.001562,-5.953125,3.434375,7.679688,-5.953125,0,6.208789,-6.697266,3.09707,6.820313,-6.697266,0,5.848437,-7.125,2.94375,6.429688,-7.125,0,6.029688,-3.375,7.1,5.752343,-4.857422,6.822656,5.142187,-5.953125,6.2125,4.532031,-6.697266,5.602344,4.254687,-7.125,5.325,2.854688,-3.375,9.225,2.701367,-4.857422,8.864649,2.364063,-5.953125,8.071875,2.026758,-6.697266,7.279101,1.873438,-7.125,6.91875,-1.070312,-3.375,10,-1.070312,-4.857422,9.609375,-1.070312,-5.953125,8.75,-1.070312,-6.697266,7.890625,-1.070312,-7.125,7.5,-1.070312,-3.375,10,-4.995313,-3.375,9.225,-4.841992,-4.857422,8.864649,-1.070312,-4.857422,9.609375,-4.504687,-5.953125,8.071875,-1.070312,-5.953125,8.75,-4.167383,-6.697266,7.279101,-1.070312,-6.697266,7.890625,-4.014062,-7.125,6.91875,-1.070312,-7.125,7.5,-8.170312,-3.375,7.1,-7.892968,-4.857422,6.822656,-7.282812,-5.953125,6.2125,-6.672656,-6.697266,5.602344,-6.395312,-7.125,5.325,-10.295313,-3.375,3.925,-9.934961,-4.857422,3.77168,-9.142187,-5.953125,3.434375,-8.349414,-6.697266,3.09707,-7.989062,-7.125,2.94375,-11.070313,-3.375,0,-10.679688,-4.857422,0,-9.820313,-5.953125,0,-8.960938,-6.697266,0,-8.570313,-7.125,0,-11.070313,-3.375,0,-10.295313,-3.375,-3.925,-9.934961,-4.857422,-3.77168,-10.679688,-4.857422,0,-9.142187,-5.953125,-3.434375,-9.820313,-5.953125,0,-8.349414,-6.697266,-3.09707,-8.960938,-6.697266,0,-7.989062,-7.125,-2.94375,-8.570313,-7.125,0,-8.170312,-3.375,-7.1,-7.892968,-4.857422,-6.822656,-7.282812,-5.953125,-6.2125,-6.672656,-6.697266,-5.602344,-6.395312,-7.125,-5.325,-4.995313,-3.375,-9.225,-4.841992,-4.857422,-8.864649,-4.504687,-5.953125,-8.071875,-4.167383,-6.697266,-7.279101,-4.014062,-7.125,-6.91875,-1.070312,-3.375,-10,-1.070312,-4.857422,-9.609375,-1.070312,-5.953125,-8.75,-1.070312,-6.697266,-7.890625,-1.070312,-7.125,-7.5,-1.070312,-3.375,-10,2.854688,-3.375,-9.225,2.701367,-4.857422,-8.864649,-1.070312,-4.857422,-9.609375,2.364063,-5.953125,-8.071875,-1.070312,-5.953125,-8.75,2.026758,-6.697266,-7.279101,-1.070312,-6.697266,-7.890625,1.873438,-7.125,-6.91875,-1.070312,-7.125,-7.5,6.029688,-3.375,-7.1,5.752343,-4.857422,-6.822656,5.142187,-5.953125,-6.2125,4.532031,-6.697266,-5.602344,4.254687,-7.125,-5.325,8.154688,-3.375,-3.925,7.794336,-4.857422,-3.77168,7.001562,-5.953125,-3.434375,6.208789,-6.697266,-3.09707,5.848437,-7.125,-2.94375,8.929688,-3.375,0,8.539063,-4.857422,0,7.679688,-5.953125,0,6.820313,-6.697266,0,6.429688,-7.125,0,6.429688,-7.125,0,5.848437,-7.125,2.94375,5.691685,-7.400391,2.877056,6.259766,-7.400391,0,4.853868,-7.640625,2.520586,5.351563,-7.640625,0,2.783648,-7.810547,1.639761,3.107422,-7.810547,0,-1.070312,-7.875,0,4.254687,-7.125,5.325,4.134043,-7.400391,5.204355,3.489219,-7.640625,4.559531,1.895879,-7.810547,2.966191,-1.070312,-7.875,0,1.873438,-7.125,6.91875,1.806743,-7.400391,6.761997,1.450274,-7.640625,5.92418,0.569448,-7.810547,3.85396,-1.070312,-7.875,0,-1.070312,-7.125,7.5,-1.070312,-7.400391,7.330078,-1.070312,-7.640625,6.421875,-1.070312,-7.810547,4.177734,-1.070312,-7.875,0,-1.070312,-7.125,7.5,-4.014062,-7.125,6.91875,-3.947368,-7.400391,6.761997,-1.070312,-7.400391,7.330078,-3.590898,-7.640625,5.92418,-1.070312,-7.640625,6.421875,-2.710073,-7.810547,3.85396,-1.070312,-7.810547,4.177734,-1.070312,-7.875,0,-6.395312,-7.125,5.325,-6.274668,-7.400391,5.204355,-5.629844,-7.640625,4.559531,-4.036504,-7.810547,2.966191,-1.070312,-7.875,0,-7.989062,-7.125,2.94375,-7.832309,-7.400391,2.877056,-6.994492,-7.640625,2.520586,-4.924272,-7.810547,1.639761,-1.070312,-7.875,0,-8.570313,-7.125,0,-8.400391,-7.400391,0,-7.492188,-7.640625,0,-5.248047,-7.810547,0,-1.070312,-7.875,0,-8.570313,-7.125,0,-7.989062,-7.125,-2.94375,-7.832309,-7.400391,-2.877056,-8.400391,-7.400391,0,-6.994492,-7.640625,-2.520586,-7.492188,-7.640625,0,-4.924272,-7.810547,-1.639761,-5.248047,-7.810547,0,-1.070312,-7.875,0,-6.395312,-7.125,-5.325,-6.274668,-7.400391,-5.204355,-5.629844,-7.640625,-4.559531,-4.036504,-7.810547,-2.966191,-1.070312,-7.875,0,-4.014062,-7.125,-6.91875,-3.947368,-7.400391,-6.761997,-3.590898,-7.640625,-5.92418,-2.710073,-7.810547,-3.85396,-1.070312,-7.875,0,-1.070312,-7.125,-7.5,-1.070312,-7.400391,-7.330078,-1.070312,-7.640625,-6.421875,-1.070312,-7.810547,-4.177734,-1.070312,-7.875,0,-1.070312,-7.125,-7.5,1.873438,-7.125,-6.91875,1.806743,-7.400391,-6.761997,-1.070312,-7.400391,-7.330078,1.450274,-7.640625,-5.92418,-1.070312,-7.640625,-6.421875,0.569448,-7.810547,-3.85396,-1.070312,-7.810547,-4.177734,-1.070312,-7.875,0,4.254687,-7.125,-5.325,4.134043,-7.400391,-5.204355,3.489219,-7.640625,-4.559531,1.895879,-7.810547,-2.966191,-1.070312,-7.875,0,5.848437,-7.125,-2.94375,5.691685,-7.400391,-2.877056,4.853868,-7.640625,-2.520586,2.783648,-7.810547,-1.639761,-1.070312,-7.875,0,6.429688,-7.125,0,6.259766,-7.400391,0,5.351563,-7.640625,0,3.107422,-7.810547,0,-1.070312,-7.875,0,-9.070313,2.25,0,-8.992188,2.425781,0.84375,-11.47583,2.405457,0.84375,-11.40625,2.232422,0,-13.298828,2.263184,0.84375,-13.132813,2.109375,0,-14.421631,1.877014,0.84375,-14.203125,1.775391,0,-14.804688,1.125,0.84375,-14.570313,1.125,0,-8.820313,2.8125,1.125,-11.628906,2.786134,1.125,-13.664063,2.601563,1.125,-14.902344,2.100586,1.125,-15.320313,1.125,1.125,-8.648438,3.199219,0.84375,-11.781982,3.166809,0.84375,-14.029297,2.939941,0.84375,-15.383057,2.324158,0.84375,-15.835938,1.125,0.84375,-8.570313,3.375,0,-11.851563,3.339844,0,-14.195313,3.09375,0,-15.601563,2.425781,0,-16.070313,1.125,0,-8.570313,3.375,0,-8.648438,3.199219,-0.84375,-11.781982,3.166809,-0.84375,-11.851563,3.339844,0,-14.029297,2.939941,-0.84375,-14.195313,3.09375,0,-15.383057,2.324158,-0.84375,-15.601563,2.425781,0,-15.835938,1.125,-0.84375,-16.070313,1.125,0,-8.820313,2.8125,-1.125,-11.628906,2.786134,-1.125,-13.664063,2.601563,-1.125,-14.902344,2.100586,-1.125,-15.320313,1.125,-1.125,-8.992188,2.425781,-0.84375,-11.47583,2.405457,-0.84375,-13.298828,2.263184,-0.84375,-14.421631,1.877014,-0.84375,-14.804688,1.125,-0.84375,-9.070313,2.25,0,-11.40625,2.232422,0,-13.132813,2.109375,0,-14.203125,1.775391,0,-14.570313,1.125,0,-14.570313,1.125,0,-14.804688,1.125,0.84375,-14.588013,0.00705,0.84375,-14.375,0.105469,0,-13.90918,-1.275146,0.84375,-13.757813,-1.125,0,-12.724976,-2.540863,0.84375,-12.671875,-2.355469,0,-10.992188,-3.609375,0.84375,-11.070313,-3.375,0,-15.320313,1.125,1.125,-15.056641,-0.209473,1.125,-14.242188,-1.605469,1.125,-12.841797,-2.94873,1.125,-10.820313,-4.125,1.125,-15.835938,1.125,0.84375,-15.525269,-0.425995,0.84375,-14.575195,-1.935791,0.84375,-12.958618,-3.356598,0.84375,-10.648438,-4.640625,0.84375,-16.070313,1.125,0,-15.738281,-0.524414,0,-14.726563,-2.085938,0,-13.011719,-3.541992,0,-10.570313,-4.875,0,-16.070313,1.125,0,-15.835938,1.125,-0.84375,-15.525269,-0.425995,-0.84375,-15.738281,-0.524414,0,-14.575195,-1.935791,-0.84375,-14.726563,-2.085938,0,-12.958618,-3.356598,-0.84375,-13.011719,-3.541992,0,-10.648438,-4.640625,-0.84375,-10.570313,-4.875,0,-15.320313,1.125,-1.125,-15.056641,-0.209473,-1.125,-14.242188,-1.605469,-1.125,-12.841797,-2.94873,-1.125,-10.820313,-4.125,-1.125,-14.804688,1.125,-0.84375,-14.588013,0.00705,-0.84375,-13.90918,-1.275146,-0.84375,-12.724976,-2.540863,-0.84375,-10.992188,-3.609375,-0.84375,-14.570313,1.125,0,-14.375,0.105469,0,-13.757813,-1.125,0,-12.671875,-2.355469,0,-11.070313,-3.375,0,7.429688,-0.75,0,7.429688,-1.394531,1.85625,10.01123,-0.677124,1.676074,9.828125,-0.199219,0,11.101563,0.84668,1.279688,10.867188,1.125,0,11.723145,2.629761,0.883301,11.4375,2.730469,0,12.898438,4.125,0.703125,12.429688,4.125,0,7.429688,-2.8125,2.475,10.414063,-1.728516,2.234766,11.617188,0.234375,1.70625,12.351563,2.408203,1.177734,13.929688,4.125,0.9375,7.429688,-4.230469,1.85625,10.816895,-2.779907,1.676074,12.132813,-0.37793,1.279688,12.97998,2.186646,0.883301,14.960938,4.125,0.703125,7.429688,-4.875,0,11,-3.257813,0,12.367188,-0.65625,0,13.265625,2.085938,0,15.429688,4.125,0,7.429688,-4.875,0,7.429688,-4.230469,-1.85625,10.816895,-2.779907,-1.676074,11,-3.257813,0,12.132813,-0.37793,-1.279688,12.367188,-0.65625,0,12.97998,2.186646,-0.883301,13.265625,2.085938,0,14.960938,4.125,-0.703125,15.429688,4.125,0,7.429688,-2.8125,-2.475,10.414063,-1.728516,-2.234766,11.617188,0.234375,-1.70625,12.351563,2.408203,-1.177734,13.929688,4.125,-0.9375,7.429688,-1.394531,-1.85625,10.01123,-0.677124,-1.676074,11.101563,0.84668,-1.279688,11.723145,2.629761,-0.883301,12.898438,4.125,-0.703125,7.429688,-0.75,0,9.828125,-0.199219,0,10.867188,1.125,0,11.4375,2.730469,0,12.429688,4.125,0,12.429688,4.125,0,12.898438,4.125,0.703125,13.291077,4.346237,0.65918,12.789063,4.335938,0,13.525879,4.422729,0.5625,13.054688,4.40625,0,13.532898,4.350357,0.46582,13.132813,4.335938,0,13.242188,4.125,0.421875,12.929688,4.125,0,13.929688,4.125,0.9375,14.395508,4.368896,0.878906,14.5625,4.458984,0.75,14.413086,4.38208,0.621094,13.929688,4.125,0.5625,14.960938,4.125,0.703125,15.499939,4.391556,0.65918,15.599121,4.495239,0.5625,15.293274,4.413804,0.46582,14.617188,4.125,0.421875,15.429688,4.125,0,16.001953,4.401855,0,16.070313,4.511719,0,15.693359,4.428224,0,14.929688,4.125,0,15.429688,4.125,0,14.960938,4.125,-0.703125,15.499939,4.391556,-0.65918,16.001953,4.401855,0,15.599121,4.495239,-0.5625,16.070313,4.511719,0,15.293274,4.413804,-0.46582,15.693359,4.428224,0,14.617188,4.125,-0.421875,14.929688,4.125,0,13.929688,4.125,-0.9375,14.395508,4.368896,-0.878906,14.5625,4.458984,-0.75,14.413086,4.38208,-0.621094,13.929688,4.125,-0.5625,12.898438,4.125,-0.703125,13.291077,4.346237,-0.65918,13.525879,4.422729,-0.5625,13.532898,4.350357,-0.46582,13.242188,4.125,-0.421875,12.429688,4.125,0,12.789063,4.335938,0,13.054688,4.40625,0,13.132813,4.335938,0,12.929688,4.125,0,0.501414,7.628906,0.670256,0.632813,7.628906,0,-1.070312,7.875,0,0.429278,7.03125,0.639395,0.554688,7.03125,0,-0.162029,6.292969,0.38696,-0.085937,6.292969,0,-0.147812,5.625,0.3925,-0.070312,5.625,0,0.140489,7.628906,1.210801,-1.070312,7.875,0,0.084844,7.03125,1.155156,-0.370879,6.292969,0.699434,-0.360312,5.625,0.71,-0.400056,7.628906,1.571726,-1.070312,7.875,0,-0.430918,7.03125,1.49959,-0.683352,6.292969,0.908284,-0.677812,5.625,0.9225,-1.070312,7.628906,1.703125,-1.070312,7.875,0,-1.070312,7.03125,1.625,-1.070312,6.292969,0.984375,-1.070312,5.625,1,-1.740569,7.628906,1.571726,-1.070312,7.628906,1.703125,-1.070312,7.875,0,-1.709707,7.03125,1.49959,-1.070312,7.03125,1.625,-1.457273,6.292969,0.908284,-1.070312,6.292969,0.984375,-1.462812,5.625,0.9225,-1.070312,5.625,1,-2.281113,7.628906,1.210801,-1.070312,7.875,0,-2.225469,7.03125,1.155156,-1.769746,6.292969,0.699434,-1.780312,5.625,0.71,-2.642038,7.628906,0.670256,-1.070312,7.875,0,-2.569902,7.03125,0.639395,-1.978596,6.292969,0.38696,-1.992812,5.625,0.3925,-2.773438,7.628906,0,-1.070312,7.875,0,-2.695313,7.03125,0,-2.054687,6.292969,0,-2.070312,5.625,0,-2.642038,7.628906,-0.670256,-2.773438,7.628906,0,-1.070312,7.875,0,-2.569902,7.03125,-0.639395,-2.695313,7.03125,0,-1.978596,6.292969,-0.38696,-2.054687,6.292969,0,-1.992812,5.625,-0.3925,-2.070312,5.625,0,-2.281113,7.628906,-1.210801,-1.070312,7.875,0,-2.225469,7.03125,-1.155156,-1.769746,6.292969,-0.699434,-1.780312,5.625,-0.71,-1.740569,7.628906,-1.571726,-1.070312,7.875,0,-1.709707,7.03125,-1.49959,-1.457273,6.292969,-0.908284,-1.462812,5.625,-0.9225,-1.070312,7.628906,-1.703125,-1.070312,7.875,0,-1.070312,7.03125,-1.625,-1.070312,6.292969,-0.984375,-1.070312,5.625,-1,-0.400056,7.628906,-1.571726,-1.070312,7.628906,-1.703125,-1.070312,7.875,0,-0.430918,7.03125,-1.49959,-1.070312,7.03125,-1.625,-0.683352,6.292969,-0.908284,-1.070312,6.292969,-0.984375,-0.677812,5.625,-0.9225,-1.070312,5.625,-1,0.140489,7.628906,-1.210801,-1.070312,7.875,0,0.084844,7.03125,-1.155156,-0.370879,6.292969,-0.699434,-0.360312,5.625,-0.71,0.501414,7.628906,-0.670256,-1.070312,7.875,0,0.429278,7.03125,-0.639395,-0.162029,6.292969,-0.38696,-0.147812,5.625,-0.3925,0.632813,7.628906,0,-1.070312,7.875,0,0.554688,7.03125,0,-0.085937,6.292969,0,-0.070312,5.625,0,-0.070312,5.625,0,-0.147812,5.625,0.3925,1.034141,5.179688,0.895391,1.210938,5.179688,0,2.735,4.875,1.619062,3.054688,4.875,0,4.262891,4.570313,2.26914,4.710938,4.570313,0,4.925938,4.125,2.55125,5.429688,4.125,0,-0.360312,5.625,0.71,0.549375,5.179688,1.619688,1.858438,4.875,2.92875,3.034375,4.570313,4.104687,3.544688,4.125,4.615,-0.677812,5.625,0.9225,-0.174922,5.179688,2.104453,0.54875,4.875,3.805313,1.198828,4.570313,5.333203,1.480938,4.125,5.99625,-1.070312,5.625,1,-1.070312,5.179688,2.28125,-1.070312,4.875,4.125,-1.070312,4.570313,5.78125,-1.070312,4.125,6.5,-1.070312,5.625,1,-1.462812,5.625,0.9225,-1.965703,5.179688,2.104453,-1.070312,5.179688,2.28125,-2.689375,4.875,3.805313,-1.070312,4.875,4.125,-3.339453,4.570313,5.333203,-1.070312,4.570313,5.78125,-3.621562,4.125,5.99625,-1.070312,4.125,6.5,-1.780312,5.625,0.71,-2.69,5.179688,1.619688,-3.999062,4.875,2.92875,-5.174999,4.570313,4.104687,-5.685312,4.125,4.615,-1.992812,5.625,0.3925,-3.174765,5.179688,0.895391,-4.875625,4.875,1.619062,-6.403516,4.570313,2.26914,-7.066563,4.125,2.55125,-2.070312,5.625,0,-3.351562,5.179688,0,-5.195313,4.875,0,-6.851563,4.570313,0,-7.570313,4.125,0,-2.070312,5.625,0,-1.992812,5.625,-0.3925,-3.174765,5.179688,-0.895391,-3.351562,5.179688,0,-4.875625,4.875,-1.619062,-5.195313,4.875,0,-6.403516,4.570313,-2.26914,-6.851563,4.570313,0,-7.066563,4.125,-2.55125,-7.570313,4.125,0,-1.780312,5.625,-0.71,-2.69,5.179688,-1.619688,-3.999062,4.875,-2.92875,-5.174999,4.570313,-4.104687,-5.685312,4.125,-4.615,-1.462812,5.625,-0.9225,-1.965703,5.179688,-2.104453,-2.689375,4.875,-3.805313,-3.339453,4.570313,-5.333203,-3.621562,4.125,-5.99625,-1.070312,5.625,-1,-1.070312,5.179688,-2.28125,-1.070312,4.875,-4.125,-1.070312,4.570313,-5.78125,-1.070312,4.125,-6.5,-1.070312,5.625,-1,-0.677812,5.625,-0.9225,-0.174922,5.179688,-2.104453,-1.070312,5.179688,-2.28125,0.54875,4.875,-3.805313,-1.070312,4.875,-4.125,1.198828,4.570313,-5.333203,-1.070312,4.570313,-5.78125,1.480938,4.125,-5.99625,-1.070312,4.125,-6.5,-0.360312,5.625,-0.71,0.549375,5.179688,-1.619688,1.858438,4.875,-2.92875,3.034375,4.570313,-4.104687,3.544688,4.125,-4.615,-0.147812,5.625,-0.3925,1.034141,5.179688,-0.895391,2.735,4.875,-1.619062,4.262891,4.570313,-2.26914,4.925938,4.125,-2.55125,-0.070312,5.625,0,1.210938,5.179688,0,3.054688,4.875,0,4.710938,4.570313,0,5.429688,4.125,0],normals:[-0.966742,-0.255752,0,-0.893014,-0.256345,-0.369882,-0.893437,0.255996,-0.369102,-0.966824,0.255443,0,-0.083877,0.995843,-0.035507,-0.092052,0.995754,0,0.629724,0.73186,0.260439,0.68205,0.731305,0,0.803725,0.49337,0.332584,0.870301,0.492521,0,-0.683407,-0.256728,-0.683407,-0.683531,0.256068,-0.683531,-0.064925,0.995776,-0.064925,0.481399,0.732469,0.481399,0.614804,0.493997,0.614804,-0.369882,-0.256345,-0.893014,-0.369102,0.255996,-0.893437,-0.035507,0.995843,-0.083877,0.260439,0.73186,0.629724,0.332584,0.493369,0.803725,-0.002848,-0.257863,-0.966177,-0.001923,0.254736,-0.967009,-0.000266,0.995734,-0.09227,0.000024,0.731295,0.682061,0,0.492521,0.870301,-0.002848,-0.257863,-0.966177,0.379058,-0.3593,-0.852771,0.37711,0.149085,-0.914091,-0.001923,0.254736,-0.967009,0.027502,0.992081,-0.122552,-0.000266,0.995734,-0.09227,-0.26101,0.726762,0.635367,0.000024,0.731295,0.682061,-0.332485,0.492546,0.804271,0,0.492521,0.870301,0.663548,-0.41079,-0.625264,0.712664,0.073722,-0.697621,0.099726,0.987509,-0.121983,-0.48732,0.723754,0.488569,-0.615242,0.492602,0.615484,0.880028,-0.332906,-0.338709,0.917276,0.167113,-0.361493,0.113584,0.992365,-0.04807,-0.63415,0.727508,0.261889,-0.804126,0.492634,0.332705,0.96669,-0.255738,0.010454,0.967442,0.252962,0.008103,0.093436,0.995624,0.001281,-0.682167,0.731196,-0.000343,-0.870322,0.492483,-0.000054,0.96669,-0.255738,0.010454,0.893014,-0.256345,0.369882,0.893437,0.255996,0.369102,0.967442,0.252962,0.008103,0.083877,0.995843,0.035507,0.093436,0.995624,0.001281,-0.629724,0.73186,-0.260439,-0.682167,0.731196,-0.000343,-0.803725,0.49337,-0.332584,-0.870322,0.492483,-0.000054,0.683407,-0.256728,0.683407,0.683531,0.256068,0.683531,0.064925,0.995776,0.064925,-0.481399,0.732469,-0.481399,-0.614804,0.493997,-0.614804,0.369882,-0.256345,0.893014,0.369102,0.255996,0.893437,0.035507,0.995843,0.083877,-0.260439,0.73186,-0.629724,-0.332584,0.493369,-0.803725,0,-0.255752,0.966742,0,0.255443,0.966824,0,0.995754,0.092052,0,0.731305,-0.68205,0,0.492521,-0.870301,0,-0.255752,0.966742,-0.369882,-0.256345,0.893014,-0.369102,0.255996,0.893437,0,0.255443,0.966824,-0.035507,0.995843,0.083877,0,0.995754,0.092052,0.260439,0.73186,-0.629724,0,0.731305,-0.68205,0.332584,0.49337,-0.803725,0,0.492521,-0.870301,-0.683407,-0.256728,0.683407,-0.683531,0.256068,0.683531,-0.064925,0.995776,0.064925,0.481399,0.732469,-0.481399,0.614804,0.493997,-0.614804,-0.893014,-0.256345,0.369882,-0.893437,0.255996,0.369102,-0.083877,0.995843,0.035507,0.629724,0.73186,-0.260439,0.803725,0.493369,-0.332584,-0.966742,-0.255752,0,-0.966824,0.255443,0,-0.092052,0.995754,0,0.68205,0.731305,0,0.870301,0.492521,0,0.870301,0.492521,0,0.803725,0.49337,0.332584,0.845438,0.403546,0.349835,0.915321,0.402725,0,0.869996,0.336859,0.360047,0.941808,0.336151,0,0.904193,0.205791,0.37428,0.97869,0.205342,0,0.921879,-0.06637,0.381752,0.997804,-0.06624,0,0.614804,0.493997,0.614804,0.646802,0.404096,0.646802,0.665655,0.337351,0.665655,0.691923,0.20612,0.691923,0.705543,-0.06648,0.705542,0.332584,0.493369,0.803725,0.349835,0.403546,0.845438,0.360047,0.336859,0.869996,0.37428,0.205791,0.904193,0.381752,-0.066369,0.921879,0,0.492521,0.870301,0,0.402725,0.915321,0,0.336151,0.941808,0,0.205342,0.97869,0,-0.06624,0.997804,0,0.492521,0.870301,-0.332485,0.492546,0.804271,-0.349835,0.403546,0.845438,0,0.402725,0.915321,-0.360047,0.336859,0.869996,0,0.336151,0.941808,-0.37428,0.205791,0.904193,0,0.205342,0.97869,-0.381752,-0.06637,0.921879,0,-0.06624,0.997804,-0.615242,0.492602,0.615484,-0.646802,0.404096,0.646802,-0.665655,0.337351,0.665655,-0.691923,0.20612,0.691923,-0.705542,-0.06648,0.705543,-0.804126,0.492634,0.332705,-0.845438,0.403546,0.349835,-0.869996,0.336859,0.360047,-0.904193,0.205791,0.37428,-0.921879,-0.066369,0.381752,-0.870322,0.492483,-0.000054,-0.915321,0.402725,0,-0.941808,0.336151,0,-0.97869,0.205342,0,-0.997804,-0.06624,0,-0.870322,0.492483,-0.000054,-0.803725,0.49337,-0.332584,-0.845438,0.403546,-0.349835,-0.915321,0.402725,0,-0.869996,0.336859,-0.360047,-0.941808,0.336151,0,-0.904193,0.205791,-0.37428,-0.97869,0.205342,0,-0.921879,-0.06637,-0.381752,-0.997804,-0.06624,0,-0.614804,0.493997,-0.614804,-0.646802,0.404096,-0.646802,-0.665655,0.337351,-0.665655,-0.691923,0.20612,-0.691923,-0.705543,-0.06648,-0.705542,-0.332584,0.493369,-0.803725,-0.349835,0.403546,-0.845438,-0.360047,0.336859,-0.869996,-0.37428,0.205791,-0.904193,-0.381752,-0.066369,-0.921879,0,0.492521,-0.870301,0,0.402725,-0.915321,0,0.336151,-0.941808,0,0.205342,-0.97869,0,-0.06624,-0.997804,0,0.492521,-0.870301,0.332584,0.49337,-0.803725,0.349835,0.403546,-0.845438,0,0.402725,-0.915321,0.360047,0.336859,-0.869996,0,0.336151,-0.941808,0.37428,0.205791,-0.904193,0,0.205342,-0.97869,0.381752,-0.06637,-0.921879,0,-0.06624,-0.997804,0.614804,0.493997,-0.614804,0.646802,0.404096,-0.646802,0.665655,0.337351,-0.665655,0.691923,0.20612,-0.691923,0.705542,-0.06648,-0.705543,0.803725,0.493369,-0.332584,0.845438,0.403546,-0.349835,0.869996,0.336859,-0.360047,0.904193,0.205791,-0.37428,0.921879,-0.066369,-0.381752,0.870301,0.492521,0,0.915321,0.402725,0,0.941808,0.336151,0,0.97869,0.205342,0,0.997804,-0.06624,0,0.997804,-0.06624,0,0.921879,-0.06637,0.381752,0.831437,-0.43618,0.344179,0.900182,-0.435513,0,0.673512,-0.684666,0.278594,0.729611,-0.683863,0,0.640399,-0.720924,0.264874,0.693951,-0.720022,0,0.732949,-0.608995,0.303167,0.79395,-0.607983,0,0.705543,-0.06648,0.705542,0.636092,-0.436778,0.636092,0.514965,-0.68529,0.514965,0.489651,-0.721446,0.489651,0.560555,-0.609554,0.560555,0.381752,-0.066369,0.921879,0.344179,-0.43618,0.831437,0.278595,-0.684666,0.673512,0.264874,-0.720924,0.640399,0.303167,-0.608995,0.732949,0,-0.06624,0.997804,0,-0.435513,0.900182,0,-0.683863,0.729611,0,-0.720022,0.693951,0,-0.607983,0.79395,0,-0.06624,0.997804,-0.381752,-0.06637,0.921879,-0.344179,-0.43618,0.831437,0,-0.435513,0.900182,-0.278594,-0.684666,0.673512,0,-0.683863,0.729611,-0.264874,-0.720924,0.640399,0,-0.720022,0.693951,-0.303167,-0.608995,0.732949,0,-0.607983,0.79395,-0.705542,-0.06648,0.705543,-0.636092,-0.436778,0.636092,-0.514965,-0.68529,0.514965,-0.489651,-0.721446,0.489651,-0.560555,-0.609554,0.560555,-0.921879,-0.066369,0.381752,-0.831437,-0.43618,0.344179,-0.673512,-0.684666,0.278595,-0.640399,-0.720924,0.264874,-0.732949,-0.608995,0.303167,-0.997804,-0.06624,0,-0.900182,-0.435513,0,-0.729611,-0.683863,0,-0.693951,-0.720022,0,-0.79395,-0.607983,0,-0.997804,-0.06624,0,-0.921879,-0.06637,-0.381752,-0.831437,-0.43618,-0.344179,-0.900182,-0.435513,0,-0.673512,-0.684666,-0.278594,-0.729611,-0.683863,0,-0.640399,-0.720924,-0.264874,-0.693951,-0.720022,0,-0.732949,-0.608995,-0.303167,-0.79395,-0.607983,0,-0.705543,-0.06648,-0.705542,-0.636092,-0.436778,-0.636092,-0.514965,-0.68529,-0.514965,-0.489651,-0.721446,-0.489651,-0.560555,-0.609554,-0.560555,-0.381752,-0.066369,-0.921879,-0.344179,-0.43618,-0.831437,-0.278595,-0.684666,-0.673512,-0.264874,-0.720924,-0.640399,-0.303167,-0.608995,-0.732949,0,-0.06624,-0.997804,0,-0.435513,-0.900182,0,-0.683863,-0.729611,0,-0.720022,-0.693951,0,-0.607983,-0.79395,0,-0.06624,-0.997804,0.381752,-0.06637,-0.921879,0.344179,-0.43618,-0.831437,0,-0.435513,-0.900182,0.278594,-0.684666,-0.673512,0,-0.683863,-0.729611,0.264874,-0.720924,-0.640399,0,-0.720022,-0.693951,0.303167,-0.608995,-0.732949,0,-0.607983,-0.79395,0.705542,-0.06648,-0.705543,0.636092,-0.436778,-0.636092,0.514965,-0.68529,-0.514965,0.489651,-0.721446,-0.489651,0.560555,-0.609554,-0.560555,0.921879,-0.066369,-0.381752,0.831437,-0.43618,-0.344179,0.673512,-0.684666,-0.278595,0.640399,-0.720924,-0.264874,0.732949,-0.608995,-0.303167,0.997804,-0.06624,0,0.900182,-0.435513,0,0.729611,-0.683863,0,0.693951,-0.720022,0,0.79395,-0.607983,0,0.79395,-0.607983,0,0.732949,-0.608995,0.303167,0.57623,-0.781801,0.238217,0.62386,-0.781536,0,0.163628,-0.984208,0.067527,0.177291,-0.984159,0,0.045422,-0.998792,0.018736,0.049207,-0.998789,0,0,-1,0,0.560555,-0.609554,0.560555,0.440416,-0.782348,0.440416,0.124903,-0.984276,0.124903,0.034662,-0.998798,0.034662,0,-1,0,0.303167,-0.608995,0.732949,0.238217,-0.781801,0.57623,0.067527,-0.984208,0.163628,0.018736,-0.998792,0.045422,0,-1,0,0,-0.607983,0.79395,0,-0.781536,0.62386,0,-0.984159,0.177291,0,-0.998789,0.049207,0,-1,0,0,-0.607983,0.79395,-0.303167,-0.608995,0.732949,-0.238217,-0.781801,0.57623,0,-0.781536,0.62386,-0.067527,-0.984208,0.163628,0,-0.984159,0.177291,-0.018736,-0.998792,0.045422,0,-0.998789,0.049207,0,-1,0,-0.560555,-0.609554,0.560555,-0.440416,-0.782348,0.440416,-0.124903,-0.984276,0.124903,-0.034662,-0.998798,0.034662,0,-1,0,-0.732949,-0.608995,0.303167,-0.57623,-0.781801,0.238217,-0.163628,-0.984208,0.067527,-0.045422,-0.998792,0.018736,0,-1,0,-0.79395,-0.607983,0,-0.62386,-0.781536,0,-0.177291,-0.984159,0,-0.049207,-0.998789,0,0,-1,0,-0.79395,-0.607983,0,-0.732949,-0.608995,-0.303167,-0.57623,-0.781801,-0.238217,-0.62386,-0.781536,0,-0.163628,-0.984208,-0.067527,-0.177291,-0.984159,0,-0.045422,-0.998792,-0.018736,-0.049207,-0.998789,0,0,-1,0,-0.560555,-0.609554,-0.560555,-0.440416,-0.782348,-0.440416,-0.124903,-0.984276,-0.124903,-0.034662,-0.998798,-0.034662,0,-1,0,-0.303167,-0.608995,-0.732949,-0.238217,-0.781801,-0.57623,-0.067527,-0.984208,-0.163628,-0.018736,-0.998792,-0.045422,0,-1,0,0,-0.607983,-0.79395,0,-0.781536,-0.62386,0,-0.984159,-0.177291,0,-0.998789,-0.049207,0,-1,0,0,-0.607983,-0.79395,0.303167,-0.608995,-0.732949,0.238217,-0.781801,-0.57623,0,-0.781536,-0.62386,0.067527,-0.984208,-0.163628,0,-0.984159,-0.177291,0.018736,-0.998792,-0.045422,0,-0.998789,-0.049207,0,-1,0,0.560555,-0.609554,-0.560555,0.440416,-0.782348,-0.440416,0.124903,-0.984276,-0.124903,0.034662,-0.998798,-0.034662,0,-1,0,0.732949,-0.608995,-0.303167,0.57623,-0.781801,-0.238217,0.163628,-0.984208,-0.067527,0.045422,-0.998792,-0.018736,0,-1,0,0.79395,-0.607983,0,0.62386,-0.781536,0,0.177291,-0.984159,0,0.049207,-0.998789,0,0,-1,0,0.007786,-0.99997,-0.000216,0.007039,-0.812495,0.582926,0.036127,-0.837257,0.545614,0.039138,-0.999233,-0.000989,0.161846,-0.810421,0.563048,0.179512,-0.983746,-0.004369,0.482365,-0.595148,0.642746,0.612299,-0.790557,-0.01046,0.73872,-0.114594,0.664199,0.986152,-0.165708,-0.00667,-0.001909,0.162121,0.986769,0.002762,0.017107,0.99985,0.010533,0.073398,0.997247,-0.066041,0.13007,0.989303,-0.094427,0.016594,0.995393,-0.009203,0.871509,0.490293,-0.048606,0.840609,0.539457,-0.223298,0.80288,0.552739,-0.596365,0.559971,0.575135,-0.803337,0.068236,0.591603,-0.010561,0.999944,0.000103,-0.058798,0.99827,0.00071,-0.28071,0.959787,0.003269,-0.749723,0.661738,0.004268,-0.997351,0.072714,0.002059,-0.010561,0.999944,0.000103,-0.008792,0.871493,-0.49033,-0.046494,0.841178,-0.538756,-0.058798,0.99827,0.00071,-0.217909,0.806807,-0.549161,-0.28071,0.959787,0.003269,-0.597291,0.560026,-0.574121,-0.749723,0.661738,0.004268,-0.804,0.062913,-0.591292,-0.997351,0.072714,0.002059,-0.001806,0.161691,-0.98684,0.002031,0.014555,-0.999892,0.009215,0.060069,-0.998152,-0.059334,0.113865,-0.991723,-0.086899,0.01229,-0.996141,0.006418,-0.812379,-0.583095,0.033783,-0.837512,-0.545373,0.157113,-0.811947,-0.56219,0.484406,-0.589366,-0.646528,0.73887,-0.10132,-0.666187,0.007786,-0.99997,-0.000216,0.039138,-0.999233,-0.000989,0.179512,-0.983746,-0.004369,0.612299,-0.790557,-0.01046,0.986152,-0.165708,-0.00667,0.986152,-0.165708,-0.00667,0.73872,-0.114594,0.664199,0.725608,0.259351,0.637361,0.946512,0.32265,-0.003357,0.645945,0.461988,0.607719,0.82583,0.56387,-0.007452,0.531615,0.63666,0.558614,0.650011,0.759893,-0.006937,0.424964,0.681717,0.59554,0.532429,0.846459,-0.005245,-0.094427,0.016594,0.995393,-0.049562,-0.019755,0.998576,-0.037816,-0.035624,0.99865,-0.037914,-0.036512,0.998614,-0.168854,-0.297945,0.93953,-0.803337,0.068236,0.591603,-0.742342,-0.299166,0.599523,-0.619602,-0.529406,0.579502,-0.483708,-0.68576,0.543837,-0.445293,-0.794355,0.413177,-0.997351,0.072714,0.002059,-0.926513,-0.376258,0.001996,-0.75392,-0.656952,0.004317,-0.566224,-0.824244,0.003461,-0.481804,-0.876277,0.00185,-0.997351,0.072714,0.002059,-0.804,0.062913,-0.591292,-0.744675,-0.294425,-0.598977,-0.926513,-0.376258,0.001996,-0.621949,-0.528114,-0.578165,-0.75392,-0.656952,0.004317,-0.481171,-0.68834,-0.542828,-0.566224,-0.824244,0.003461,-0.438055,-0.797035,-0.415744,-0.481804,-0.876277,0.00185,-0.086899,0.01229,-0.996141,-0.044337,-0.017056,-0.998871,-0.026176,-0.028166,-0.99926,-0.025294,-0.028332,-0.999278,-0.157482,-0.289392,-0.944167,0.73887,-0.10132,-0.666187,0.728244,0.25241,-0.637142,0.647055,0.459725,-0.608254,0.522994,0.640657,-0.56217,0.409978,0.682857,-0.604669,0.986152,-0.165708,-0.00667,0.946512,0.32265,-0.003357,0.82583,0.56387,-0.007452,0.650011,0.759893,-0.006937,0.532429,0.846459,-0.005245,-0.230787,0.972982,-0.006523,-0.152877,0.687211,0.71019,-0.316721,0.63775,0.702113,-0.548936,0.835863,-0.001511,-0.601067,0.471452,0.64533,-0.875671,0.482806,0.009893,-0.635889,0.44609,0.629801,-0.877554,0.479097,0.019092,-0.435746,0.601008,0.670011,-0.69619,0.717439,0.024497,0.111113,-0.08507,0.99016,0.22331,0.00654,0.974726,0.190097,0.154964,0.969458,0.005271,0.189482,0.98187,-0.011752,0.246688,0.969024,0.343906,-0.722796,0.599412,0.572489,-0.567656,0.591627,0.787436,-0.256459,0.560512,0.647097,-0.306374,0.698141,0.427528,-0.499343,0.753576,0.410926,-0.911668,0.001284,0.67152,-0.740986,-0.000899,0.922026,-0.38706,-0.007253,0.84691,-0.531556,-0.013854,0.535924,-0.844201,-0.010505,0.410926,-0.911668,0.001284,0.341188,-0.722823,-0.600931,0.578664,-0.561139,-0.591838,0.67152,-0.740986,-0.000899,0.784869,-0.25102,-0.566542,0.922026,-0.38706,-0.007253,0.642681,-0.302257,-0.70399,0.84691,-0.531556,-0.013854,0.418589,-0.500042,-0.758117,0.535924,-0.844201,-0.010505,0.115806,-0.079139,-0.990114,0.232811,0.012565,-0.972441,0.206662,0.153601,-0.96628,0.0245,0.161443,-0.986578,0.003382,0.211115,-0.977455,-0.134912,0.687491,-0.713551,-0.31954,0.633073,-0.705063,-0.603902,0.461442,-0.649903,-0.631815,0.437169,-0.640072,-0.424306,0.612706,-0.66675,-0.230787,0.972982,-0.006523,-0.548936,0.835863,-0.001511,-0.875671,0.482806,0.009893,-0.877554,0.479097,0.019092,-0.69619,0.717439,0.024497,-0.69619,0.717439,0.024497,-0.435746,0.601008,0.670011,-0.259858,0.791937,0.552548,-0.425801,0.904753,0.010805,0.009539,0.99972,-0.021674,0.022046,0.999756,0.001623,0.410157,0.332912,-0.849082,0.999598,0.025875,0.011556,0.541523,-0.548619,-0.637001,0.709587,-0.704552,0.009672,-0.011752,0.246688,0.969024,0.046311,0.455223,0.889172,-0.010688,0.988794,0.1489,-0.044376,0.682946,-0.72912,0.122824,0.009233,-0.992385,0.427528,-0.499343,0.753576,0.481839,-0.18044,0.85748,0.455272,0.736752,0.499925,-0.220542,0.907193,-0.358277,-0.235919,0.65725,-0.715797,0.535924,-0.844201,-0.010505,0.728094,-0.6853,-0.015585,0.888738,0.458112,-0.016679,-0.260098,0.965582,0.0008,-0.371611,0.928378,-0.004418,0.535924,-0.844201,-0.010505,0.418589,-0.500042,-0.758117,0.480165,-0.178362,-0.858853,0.728094,-0.6853,-0.015585,0.488102,0.716802,-0.497947,0.888738,0.458112,-0.016679,-0.222004,0.905399,0.361892,-0.260098,0.965582,0.0008,-0.235405,0.66318,0.710477,-0.371611,0.928378,-0.004418,0.003382,0.211115,-0.977455,0.05872,0.437702,-0.8972,0.001326,0.986459,-0.164002,-0.04419,0.681675,0.730319,0.138801,-0.034188,0.98973,-0.424306,0.612706,-0.66675,-0.25889,0.797206,-0.54538,0.01227,0.999739,0.019287,0.398632,0.35489,0.845663,0.537564,-0.581398,0.610738,-0.69619,0.717439,0.024497,-0.425801,0.904753,0.010805,0.022046,0.999756,0.001623,0.999598,0.025875,0.011556,0.709587,-0.704552,0.009672,0.76264,0.565035,0.314825,0.82454,0.565804,0.000017,0,1,0,0.847982,-0.397998,0.350034,0.917701,-0.397272,0.000034,0.864141,-0.355261,0.356441,0.935269,-0.353939,0.000113,0.720992,0.625625,0.297933,0.780712,0.62489,0.000075,0.583357,0.565165,0.583338,0,1,0,0.648485,-0.398726,0.648448,0.660872,-0.355894,0.660748,0.551862,0.62529,0.55178,0.314824,0.565051,0.762629,0,1,0,0.350045,-0.397976,0.847988,0.356474,-0.355199,0.864153,0.297983,0.625515,0.721067,-0.000017,0.565804,0.82454,0,1,0,-0.000034,-0.397272,0.917701,-0.000113,-0.353939,0.935269,-0.000075,0.62489,0.780712,-0.314825,0.565035,0.76264,-0.000017,0.565804,0.82454,0,1,0,-0.350034,-0.397998,0.847982,-0.000034,-0.397272,0.917701,-0.356441,-0.355261,0.864141,-0.000113,-0.353939,0.935269,-0.297933,0.625625,0.720992,-0.000075,0.62489,0.780712,-0.583338,0.565165,0.583357,0,1,0,-0.648448,-0.398726,0.648485,-0.660748,-0.355894,0.660872,-0.55178,0.62529,0.551862,-0.762629,0.565051,0.314824,0,1,0,-0.847988,-0.397976,0.350045,-0.864153,-0.355199,0.356474,-0.721067,0.625515,0.297983,-0.82454,0.565804,-0.000017,0,1,0,-0.917701,-0.397272,-0.000034,-0.935269,-0.353939,-0.000113,-0.780712,0.62489,-0.000075,-0.76264,0.565035,-0.314825,-0.82454,0.565804,-0.000017,0,1,0,-0.847982,-0.397998,-0.350034,-0.917701,-0.397272,-0.000034,-0.864141,-0.355261,-0.356441,-0.935269,-0.353939,-0.000113,-0.720992,0.625625,-0.297933,-0.780712,0.62489,-0.000075,-0.583357,0.565165,-0.583338,0,1,0,-0.648485,-0.398726,-0.648448,-0.660872,-0.355894,-0.660748,-0.551862,0.62529,-0.55178,-0.314824,0.565051,-0.762629,0,1,0,-0.350045,-0.397976,-0.847988,-0.356474,-0.355199,-0.864153,-0.297983,0.625515,-0.721067,0.000017,0.565804,-0.82454,0,1,0,0.000034,-0.397272,-0.917701,0.000113,-0.353939,-0.935269,0.000075,0.62489,-0.780712,0.314825,0.565035,-0.76264,0.000017,0.565804,-0.82454,0,1,0,0.350034,-0.397998,-0.847982,0.000034,-0.397272,-0.917701,0.356441,-0.355261,-0.864141,0.000113,-0.353939,-0.935269,0.297933,0.625625,-0.720992,0.000075,0.62489,-0.780712,0.583338,0.565165,-0.583357,0,1,0,0.648448,-0.398726,-0.648485,0.660748,-0.355894,-0.660872,0.55178,0.62529,-0.551862,0.762629,0.565051,-0.314824,0,1,0,0.847988,-0.397976,-0.350045,0.864153,-0.355199,-0.356474,0.721067,0.625515,-0.297983,0.82454,0.565804,0.000017,0,1,0,0.917701,-0.397272,0.000034,0.935269,-0.353939,0.000113,0.780712,0.62489,0.000075,0.780712,0.62489,0.000075,0.720992,0.625625,0.297933,0.217978,0.971775,0.090216,0.236583,0.971611,0,0.159589,0.984977,0.065961,0.173084,0.984907,0,0.350498,0.925311,0.14474,0.379703,0.925108,0,0.48559,0.850653,0.201474,0.526673,0.850068,0,0.551862,0.62529,0.55178,0.166631,0.971838,0.166631,0.121908,0.985026,0.121908,0.267668,0.925585,0.267668,0.371315,0.851029,0.371315,0.297983,0.625515,0.721067,0.090216,0.971775,0.217978,0.065961,0.984977,0.159589,0.14474,0.925311,0.350498,0.201475,0.850653,0.48559,-0.000075,0.62489,0.780712,0,0.971611,0.236583,0,0.984907,0.173084,0,0.925108,0.379703,0,0.850068,0.526673,-0.000075,0.62489,0.780712,-0.297933,0.625625,0.720992,-0.090216,0.971775,0.217978,0,0.971611,0.236583,-0.065961,0.984977,0.159589,0,0.984907,0.173084,-0.14474,0.925311,0.350498,0,0.925108,0.379703,-0.201474,0.850653,0.48559,0,0.850068,0.526673,-0.55178,0.62529,0.551862,-0.166631,0.971838,0.166631,-0.121908,0.985026,0.121908,-0.267668,0.925585,0.267668,-0.371315,0.851029,0.371315,-0.721067,0.625515,0.297983,-0.217978,0.971775,0.090216,-0.159589,0.984977,0.065961,-0.350498,0.925311,0.14474,-0.48559,0.850653,0.201475,-0.780712,0.62489,-0.000075,-0.236583,0.971611,0,-0.173084,0.984907,0,-0.379703,0.925108,0,-0.526673,0.850068,0,-0.780712,0.62489,-0.000075,-0.720992,0.625625,-0.297933,-0.217978,0.971775,-0.090216,-0.236583,0.971611,0,-0.159589,0.984977,-0.065961,-0.173084,0.984907,0,-0.350498,0.925311,-0.14474,-0.379703,0.925108,0,-0.48559,0.850653,-0.201474,-0.526673,0.850068,0,-0.551862,0.62529,-0.55178,-0.166631,0.971838,-0.166631,-0.121908,0.985026,-0.121908,-0.267668,0.925585,-0.267668,-0.371315,0.851029,-0.371315,-0.297983,0.625515,-0.721067,-0.090216,0.971775,-0.217978,-0.065961,0.984977,-0.159589,-0.14474,0.925311,-0.350498,-0.201475,0.850653,-0.48559,0.000075,0.62489,-0.780712,0,0.971611,-0.236583,0,0.984907,-0.173084,0,0.925108,-0.379703,0,0.850068,-0.526673,0.000075,0.62489,-0.780712,0.297933,0.625625,-0.720992,0.090216,0.971775,-0.217978,0,0.971611,-0.236583,0.065961,0.984977,-0.159589,0,0.984907,-0.173084,0.14474,0.925311,-0.350498,0,0.925108,-0.379703,0.201474,0.850653,-0.48559,0,0.850068,-0.526673,0.55178,0.62529,-0.551862,0.166631,0.971838,-0.166631,0.121908,0.985026,-0.121908,0.267668,0.925585,-0.267668,0.371315,0.851029,-0.371315,0.721067,0.625515,-0.297983,0.217978,0.971775,-0.090216,0.159589,0.984977,-0.065961,0.350498,0.925311,-0.14474,0.48559,0.850653,-0.201475,0.780712,0.62489,0.000075,0.236583,0.971611,0,0.173084,0.984907,0,0.379703,0.925108,0,0.526673,0.850068,0],textureCoords:[2,2,1.75,2,1.75,1.975,2,1.975,1.75,1.95,2,1.95,1.75,1.925,2,1.925,1.75,1.9,2,1.9,1.5,2,1.5,1.975,1.5,1.95,1.5,1.925,1.5,1.9,1.25,2,1.25,1.975,1.25,1.95,1.25,1.925,1.25,1.9,1,2,1,1.975,1,1.95,1,1.925,1,1.9,1,2,0.75,2,0.75,1.975,1,1.975,0.75,1.95,1,1.95,0.75,1.925,1,1.925,0.75,1.9,1,1.9,0.5,2,0.5,1.975,0.5,1.95,0.5,1.925,0.5,1.9,0.25,2,0.25,1.975,0.25,1.95,0.25,1.925,0.25,1.9,0,2,0,1.975,0,1.95,0,1.925,0,1.9,2,2,1.75,2,1.75,1.975,2,1.975,1.75,1.95,2,1.95,1.75,1.925,2,1.925,1.75,1.9,2,1.9,1.5,2,1.5,1.975,1.5,1.95,1.5,1.925,1.5,1.9,1.25,2,1.25,1.975,1.25,1.95,1.25,1.925,1.25,1.9,1,2,1,1.975,1,1.95,1,1.925,1,1.9,1,2,0.75,2,0.75,1.975,1,1.975,0.75,1.95,1,1.95,0.75,1.925,1,1.925,0.75,1.9,1,1.9,0.5,2,0.5,1.975,0.5,1.95,0.5,1.925,0.5,1.9,0.25,2,0.25,1.975,0.25,1.95,0.25,1.925,0.25,1.9,0,2,0,1.975,0,1.95,0,1.925,0,1.9,2,1.9,1.75,1.9,1.75,1.675,2,1.675,1.75,1.45,2,1.45,1.75,1.225,2,1.225,1.75,1,2,1,1.5,1.9,1.5,1.675,1.5,1.45,1.5,1.225,1.5,1,1.25,1.9,1.25,1.675,1.25,1.45,1.25,1.225,1.25,1,1,1.9,1,1.675,1,1.45,1,1.225,1,1,1,1.9,0.75,1.9,0.75,1.675,1,1.675,0.75,1.45,1,1.45,0.75,1.225,1,1.225,0.75,1,1,1,0.5,1.9,0.5,1.675,0.5,1.45,0.5,1.225,0.5,1,0.25,1.9,0.25,1.675,0.25,1.45,0.25,1.225,0.25,1,0,1.9,0,1.675,0,1.45,0,1.225,0,1,2,1.9,1.75,1.9,1.75,1.675,2,1.675,1.75,1.45,2,1.45,1.75,1.225,2,1.225,1.75,1,2,1,1.5,1.9,1.5,1.675,1.5,1.45,1.5,1.225,1.5,1,1.25,1.9,1.25,1.675,1.25,1.45,1.25,1.225,1.25,1,1,1.9,1,1.675,1,1.45,1,1.225,1,1,1,1.9,0.75,1.9,0.75,1.675,1,1.675,0.75,1.45,1,1.45,0.75,1.225,1,1.225,0.75,1,1,1,0.5,1.9,0.5,1.675,0.5,1.45,0.5,1.225,0.5,1,0.25,1.9,0.25,1.675,0.25,1.45,0.25,1.225,0.25,1,0,1.9,0,1.675,0,1.45,0,1.225,0,1,2,1,1.75,1,1.75,0.85,2,0.85,1.75,0.7,2,0.7,1.75,0.55,2,0.55,1.75,0.4,2,0.4,1.5,1,1.5,0.85,1.5,0.7,1.5,0.55,1.5,0.4,1.25,1,1.25,0.85,1.25,0.7,1.25,0.55,1.25,0.4,1,1,1,0.85,1,0.7,1,0.55,1,0.4,1,1,0.75,1,0.75,0.85,1,0.85,0.75,0.7,1,0.7,0.75,0.55,1,0.55,0.75,0.4,1,0.4,0.5,1,0.5,0.85,0.5,0.7,0.5,0.55,0.5,0.4,0.25,1,0.25,0.85,0.25,0.7,0.25,0.55,0.25,0.4,0,1,0,0.85,0,0.7,0,0.55,0,0.4,2,1,1.75,1,1.75,0.85,2,0.85,1.75,0.7,2,0.7,1.75,0.55,2,0.55,1.75,0.4,2,0.4,1.5,1,1.5,0.85,1.5,0.7,1.5,0.55,1.5,0.4,1.25,1,1.25,0.85,1.25,0.7,1.25,0.55,1.25,0.4,1,1,1,0.85,1,0.7,1,0.55,1,0.4,1,1,0.75,1,0.75,0.85,1,0.85,0.75,0.7,1,0.7,0.75,0.55,1,0.55,0.75,0.4,1,0.4,0.5,1,0.5,0.85,0.5,0.7,0.5,0.55,0.5,0.4,0.25,1,0.25,0.85,0.25,0.7,0.25,0.55,0.25,0.4,0,1,0,0.85,0,0.7,0,0.55,0,0.4,2,0.4,1.75,0.4,1.75,0.3,2,0.3,1.75,0.2,2,0.2,1.75,0.1,2,0.1,1.75,0,1.5,0.4,1.5,0.3,1.5,0.2,1.5,0.1,1.5,0,1.25,0.4,1.25,0.3,1.25,0.2,1.25,0.1,1.25,0,1,0.4,1,0.3,1,0.2,1,0.1,1,0,1,0.4,0.75,0.4,0.75,0.3,1,0.3,0.75,0.2,1,0.2,0.75,0.1,1,0.1,0.75,0,0.5,0.4,0.5,0.3,0.5,0.2,0.5,0.1,0.5,0,0.25,0.4,0.25,0.3,0.25,0.2,0.25,0.1,0.25,0,0,0.4,0,0.3,0,0.2,0,0.1,0,0,2,0.4,1.75,0.4,1.75,0.3,2,0.3,1.75,0.2,2,0.2,1.75,0.1,2,0.1,1.75,0,1.5,0.4,1.5,0.3,1.5,0.2,1.5,0.1,1.5,0,1.25,0.4,1.25,0.3,1.25,0.2,1.25,0.1,1.25,0,1,0.4,1,0.3,1,0.2,1,0.1,1,0,1,0.4,0.75,0.4,0.75,0.3,1,0.3,0.75,0.2,1,0.2,0.75,0.1,1,0.1,0.75,0,0.5,0.4,0.5,0.3,0.5,0.2,0.5,0.1,0.5,0,0.25,0.4,0.25,0.3,0.25,0.2,0.25,0.1,0.25,0,0,0.4,0,0.3,0,0.2,0,0.1,0,0,1,1,0.875,1,0.875,0.875,1,0.875,0.875,0.75,1,0.75,0.875,0.625,1,0.625,0.875,0.5,1,0.5,0.75,1,0.75,0.875,0.75,0.75,0.75,0.625,0.75,0.5,0.625,1,0.625,0.875,0.625,0.75,0.625,0.625,0.625,0.5,0.5,1,0.5,0.875,0.5,0.75,0.5,0.625,0.5,0.5,0.5,1,0.375,1,0.375,0.875,0.5,0.875,0.375,0.75,0.5,0.75,0.375,0.625,0.5,0.625,0.375,0.5,0.5,0.5,0.25,1,0.25,0.875,0.25,0.75,0.25,0.625,0.25,0.5,0.125,1,0.125,0.875,0.125,0.75,0.125,0.625,0.125,0.5,0,1,0,0.875,0,0.75,0,0.625,0,0.5,1,0.5,0.875,0.5,0.875,0.375,1,0.375,0.875,0.25,1,0.25,0.875,0.125,1,0.125,0.875,0,1,0,0.75,0.5,0.75,0.375,0.75,0.25,0.75,0.125,0.75,0,0.625,0.5,0.625,0.375,0.625,0.25,0.625,0.125,0.625,0,0.5,0.5,0.5,0.375,0.5,0.25,0.5,0.125,0.5,0,0.5,0.5,0.375,0.5,0.375,0.375,0.5,0.375,0.375,0.25,0.5,0.25,0.375,0.125,0.5,0.125,0.375,0,0.5,0,0.25,0.5,0.25,0.375,0.25,0.25,0.25,0.125,0.25,0,0.125,0.5,0.125,0.375,0.125,0.25,0.125,0.125,0.125,0,0,0.5,0,0.375,0,0.25,0,0.125,0,0,0.5,0,0.625,0,0.625,0.225,0.5,0.225,0.625,0.45,0.5,0.45,0.625,0.675,0.5,0.675,0.625,0.9,0.5,0.9,0.75,0,0.75,0.225,0.75,0.45,0.75,0.675,0.75,0.9,0.875,0,0.875,0.225,0.875,0.45,0.875,0.675,0.875,0.9,1,0,1,0.225,1,0.45,1,0.675,1,0.9,0,0,0.125,0,0.125,0.225,0,0.225,0.125,0.45,0,0.45,0.125,0.675,0,0.675,0.125,0.9,0,0.9,0.25,0,0.25,0.225,0.25,0.45,0.25,0.675,0.25,0.9,0.375,0,0.375,0.225,0.375,0.45,0.375,0.675,0.375,0.9,0.5,0,0.5,0.225,0.5,0.45,0.5,0.675,0.5,0.9,0.5,0.9,0.625,0.9,0.625,0.925,0.5,0.925,0.625,0.95,0.5,0.95,0.625,0.975,0.5,0.975,0.625,1,0.5,1,0.75,0.9,0.75,0.925,0.75,0.95,0.75,0.975,0.75,1,0.875,0.9,0.875,0.925,0.875,0.95,0.875,0.975,0.875,1,1,0.9,1,0.925,1,0.95,1,0.975,1,1,0,0.9,0.125,0.9,0.125,0.925,0,0.925,0.125,0.95,0,0.95,0.125,0.975,0,0.975,0.125,1,0,1,0.25,0.9,0.25,0.925,0.25,0.95,0.25,0.975,0.25,1,0.375,0.9,0.375,0.925,0.375,0.95,0.375,0.975,0.375,1,0.5,0.9,0.5,0.925,0.5,0.95,0.5,0.975,0.5,1,0.875,0.75,1,0.75,1,1,0.875,0.5,1,0.5,0.875,0.25,1,0.25,0.875,0,1,0,0.75,0.75,0.875,1,0.75,0.5,0.75,0.25,0.75,0,0.625,0.75,0.75,1,0.625,0.5,0.625,0.25,0.625,0,0.5,0.75,0.625,1,0.5,0.5,0.5,0.25,0.5,0,0.375,0.75,0.5,0.75,0.5,1,0.375,0.5,0.5,0.5,0.375,0.25,0.5,0.25,0.375,0,0.5,0,0.25,0.75,0.375,1,0.25,0.5,0.25,0.25,0.25,0,0.125,0.75,0.25,1,0.125,0.5,0.125,0.25,0.125,0,0,0.75,0.125,1,0,0.5,0,0.25,0,0,0.875,0.75,1,0.75,1,1,0.875,0.5,1,0.5,0.875,0.25,1,0.25,0.875,0,1,0,0.75,0.75,0.875,1,0.75,0.5,0.75,0.25,0.75,0,0.625,0.75,0.75,1,0.625,0.5,0.625,0.25,0.625,0,0.5,0.75,0.625,1,0.5,0.5,0.5,0.25,0.5,0,0.375,0.75,0.5,0.75,0.5,1,0.375,0.5,0.5,0.5,0.375,0.25,0.5,0.25,0.375,0,0.5,0,0.25,0.75,0.375,1,0.25,0.5,0.25,0.25,0.25,0,0.125,0.75,0.25,1,0.125,0.5,0.125,0.25,0.125,0,0,0.75,0.125,1,0,0.5,0,0.25,0,0,1,1,0.875,1,0.875,0.75,1,0.75,0.875,0.5,1,0.5,0.875,0.25,1,0.25,0.875,0,1,0,0.75,1,0.75,0.75,0.75,0.5,0.75,0.25,0.75,0,0.625,1,0.625,0.75,0.625,0.5,0.625,0.25,0.625,0,0.5,1,0.5,0.75,0.5,0.5,0.5,0.25,0.5,0,0.5,1,0.375,1,0.375,0.75,0.5,0.75,0.375,0.5,0.5,0.5,0.375,0.25,0.5,0.25,0.375,0,0.5,0,0.25,1,0.25,0.75,0.25,0.5,0.25,0.25,0.25,0,0.125,1,0.125,0.75,0.125,0.5,0.125,0.25,0.125,0,0,1,0,0.75,0,0.5,0,0.25,0,0,1,1,0.875,1,0.875,0.75,1,0.75,0.875,0.5,1,0.5,0.875,0.25,1,0.25,0.875,0,1,0,0.75,1,0.75,0.75,0.75,0.5,0.75,0.25,0.75,0,0.625,1,0.625,0.75,0.625,0.5,0.625,0.25,0.625,0,0.5,1,0.5,0.75,0.5,0.5,0.5,0.25,0.5,0,0.5,1,0.375,1,0.375,0.75,0.5,0.75,0.375,0.5,0.5,0.5,0.375,0.25,0.5,0.25,0.375,0,0.5,0,0.25,1,0.25,0.75,0.25,0.5,0.25,0.25,0.25,0,0.125,1,0.125,0.75,0.125,0.5,0.125,0.25,0.125,0,0,1,0,0.75,0,0.5,0,0.25,0,0],indices:[0,1,2,2,3,0,3,2,4,4,5,3,5,4,6,6,7,5,7,6,8,8,9,7,1,10,11,11,2,1,2,11,12,12,4,2,4,12,13,13,6,4,6,13,14,14,8,6,10,15,16,16,11,10,11,16,17,17,12,11,12,17,18,18,13,12,13,18,19,19,14,13,15,20,21,21,16,15,16,21,22,22,17,16,17,22,23,23,18,17,18,23,24,24,19,18,25,26,27,27,28,25,28,27,29,29,30,28,30,29,31,31,32,30,32,31,33,33,34,32,26,35,36,36,27,26,27,36,37,37,29,27,29,37,38,38,31,29,31,38,39,39,33,31,35,40,41,41,36,35,36,41,42,42,37,36,37,42,43,43,38,37,38,43,44,44,39,38,40,45,46,46,41,40,41,46,47,47,42,41,42,47,48,48,43,42,43,48,49,49,44,43,50,51,52,52,53,50,53,52,54,54,55,53,55,54,56,56,57,55,57,56,58,58,59,57,51,60,61,61,52,51,52,61,62,62,54,52,54,62,63,63,56,54,56,63,64,64,58,56,60,65,66,66,61,60,61,66,67,67,62,61,62,67,68,68,63,62,63,68,69,69,64,63,65,70,71,71,66,65,66,71,72,72,67,66,67,72,73,73,68,67,68,73,74,74,69,68,75,76,77,77,78,75,78,77,79,79,80,78,80,79,81,81,82,80,82,81,83,83,84,82,76,85,86,86,77,76,77,86,87,87,79,77,79,87,88,88,81,79,81,88,89,89,83,81,85,90,91,91,86,85,86,91,92,92,87,86,87,92,93,93,88,87,88,93,94,94,89,88,90,95,96,96,91,90,91,96,97,97,92,91,92,97,98,98,93,92,93,98,99,99,94,93,100,101,102,102,103,100,103,102,104,104,105,103,105,104,106,106,107,105,107,106,108,108,109,107,101,110,111,111,102,101,102,111,112,112,104,102,104,112,113,113,106,104,106,113,114,114,108,106,110,115,116,116,111,110,111,116,117,117,112,111,112,117,118,118,113,112,113,118,119,119,114,113,115,120,121,121,116,115,116,121,122,122,117,116,117,122,123,123,118,117,118,123,124,124,119,118,125,126,127,127,128,125,128,127,129,129,130,128,130,129,131,131,132,130,132,131,133,133,134,132,126,135,136,136,127,126,127,136,137,137,129,127,129,137,138,138,131,129,131,138,139,139,133,131,135,140,141,141,136,135,136,141,142,142,137,136,137,142,143,143,138,137,138,143,144,144,139,138,140,145,146,146,141,140,141,146,147,147,142,141,142,147,148,148,143,142,143,148,149,149,144,143,150,151,152,152,153,150,153,152,154,154,155,153,155,154,156,156,157,155,157,156,158,158,159,157,151,160,161,161,152,151,152,161,162,162,154,152,154,162,163,163,156,154,156,163,164,164,158,156,160,165,166,166,161,160,161,166,167,167,162,161,162,167,168,168,163,162,163,168,169,169,164,163,165,170,171,171,166,165,166,171,172,172,167,166,167,172,173,173,168,167,168,173,174,174,169,168,175,176,177,177,178,175,178,177,179,179,180,178,180,179,181,181,182,180,182,181,183,183,184,182,176,185,186,186,177,176,177,186,187,187,179,177,179,187,188,188,181,179,181,188,189,189,183,181,185,190,191,191,186,185,186,191,192,192,187,186,187,192,193,193,188,187,188,193,194,194,189,188,190,195,196,196,191,190,191,196,197,197,192,191,192,197,198,198,193,192,193,198,199,199,194,193,200,201,202,202,203,200,203,202,204,204,205,203,205,204,206,206,207,205,207,206,208,208,209,207,201,210,211,211,202,201,202,211,212,212,204,202,204,212,213,213,206,204,206,213,214,214,208,206,210,215,216,216,211,210,211,216,217,217,212,211,212,217,218,218,213,212,213,218,219,219,214,213,215,220,221,221,216,215,216,221,222,222,217,216,217,222,223,223,218,217,218,223,224,224,219,218,225,226,227,227,228,225,228,227,229,229,230,228,230,229,231,231,232,230,232,231,233,233,234,232,226,235,236,236,227,226,227,236,237,237,229,227,229,237,238,238,231,229,231,238,239,239,233,231,235,240,241,241,236,235,236,241,242,242,237,236,237,242,243,243,238,237,238,243,244,244,239,238,240,245,246,246,241,240,241,246,247,247,242,241,242,247,248,248,243,242,243,248,249,249,244,243,250,251,252,252,253,250,253,252,254,254,255,253,255,254,256,256,257,255,257,256,258,258,259,257,251,260,261,261,252,251,252,261,262,262,254,252,254,262,263,263,256,254,256,263,264,264,258,256,260,265,266,266,261,260,261,266,267,267,262,261,262,267,268,268,263,262,263,268,269,269,264,263,265,270,271,271,266,265,266,271,272,272,267,266,267,272,273,273,268,267,268,273,274,274,269,268,275,276,277,277,278,275,278,277,279,279,280,278,280,279,281,281,282,280,282,281,283,283,284,282,276,285,286,286,277,276,277,286,287,287,279,277,279,287,288,288,281,279,281,288,289,289,283,281,285,290,291,291,286,285,286,291,292,292,287,286,287,292,293,293,288,287,288,293,294,294,289,288,290,295,296,296,291,290,291,296,297,297,292,291,292,297,298,298,293,292,293,298,299,299,294,293,300,301,302,302,303,300,303,302,304,304,305,303,305,304,306,306,307,305,307,306,308,301,309,310,310,302,301,302,310,311,311,304,302,304,311,312,312,306,304,306,312,313,309,314,315,315,310,309,310,315,316,316,311,310,311,316,317,317,312,311,312,317,318,314,319,320,320,315,314,315,320,321,321,316,315,316,321,322,322,317,316,317,322,323,324,325,326,326,327,324,327,326,328,328,329,327,329,328,330,330,331,329,331,330,332,325,333,334,334,326,325,326,334,335,335,328,326,328,335,336,336,330,328,330,336,337,333,338,339,339,334,333,334,339,340,340,335,334,335,340,341,341,336,335,336,341,342,338,343,344,344,339,338,339,344,345,345,340,339,340,345,346,346,341,340,341,346,347,348,349,350,350,351,348,351,350,352,352,353,351,353,352,354,354,355,353,355,354,356,349,357,358,358,350,349,350,358,359,359,352,350,352,359,360,360,354,352,354,360,361,357,362,363,363,358,357,358,363,364,364,359,358,359,364,365,365,360,359,360,365,366,362,367,368,368,363,362,363,368,369,369,364,363,364,369,370,370,365,364,365,370,371,372,373,374,374,375,372,375,374,376,376,377,375,377,376,378,378,379,377,379,378,380,373,381,382,382,374,373,374,382,383,383,376,374,376,383,384,384,378,376,378,384,385,381,386,387,387,382,381,382,387,388,388,383,382,383,388,389,389,384,383,384,389,390,386,391,392,392,387,386,387,392,393,393,388,387,388,393,394,394,389,388,389,394,395,396,397,398,398,399,396,399,398,400,400,401,399,401,400,402,402,403,401,403,402,404,404,405,403,397,406,407,407,398,397,398,407,408,408,400,398,400,408,409,409,402,400,402,409,410,410,404,402,406,411,412,412,407,406,407,412,413,413,408,407,408,413,414,414,409,408,409,414,415,415,410,409,411,416,417,417,412,411,412,417,418,418,413,412,413,418,419,419,414,413,414,419,420,420,415,414,421,422,423,423,424,421,424,423,425,425,426,424,426,425,427,427,428,426,428,427,429,429,430,428,422,431,432,432,423,422,423,432,433,433,425,423,425,433,434,434,427,425,427,434,435,435,429,427,431,436,437,437,432,431,432,437,438,438,433,432,433,438,439,439,434,433,434,439,440,440,435,434,436,441,442,442,437,436,437,442,443,443,438,437,438,443,444,444,439,438,439,444,445,445,440,439,446,447,448,448,449,446,449,448,450,450,451,449,451,450,452,452,453,451,453,452,454,454,455,453,447,456,457,457,448,447,448,457,458,458,450,448,450,458,459,459,452,450,452,459,460,460,454,452,456,461,462,462,457,456,457,462,463,463,458,457,458,463,464,464,459,458,459,464,465,465,460,459,461,466,467,467,462,461,462,467,468,468,463,462,463,468,469,469,464,463,464,469,470,470,465,464,471,472,473,473,474,471,474,473,475,475,476,474,476,475,477,477,478,476,478,477,479,479,480,478,472,481,482,482,473,472,473,482,483,483,475,473,475,483,484,484,477,475,477,484,485,485,479,477,481,486,487,487,482,481,482,487,488,488,483,482,483,488,489,489,484,483,484,489,490,490,485,484,486,491,492,492,487,486,487,492,493,493,488,487,488,493,494,494,489,488,489,494,495,495,490,489,496,497,498,498,499,496,499,498,500,500,501,499,501,500,502,502,503,501,503,502,504,504,505,503,497,506,507,507,498,497,498,507,508,508,500,498,500,508,509,509,502,500,502,509,510,510,504,502,506,511,512,512,507,506,507,512,513,513,508,507,508,513,514,514,509,508,509,514,515,515,510,509,511,516,517,517,512,511,512,517,518,518,513,512,513,518,519,519,514,513,514,519,520,520,515,514,521,522,523,523,524,521,524,523,525,525,526,524,526,525,527,527,528,526,528,527,529,529,530,528,522,531,532,532,523,522,523,532,533,533,525,523,525,533,534,534,527,525,527,534,535,535,529,527,531,536,537,537,532,531,532,537,538,538,533,532,533,538,539,539,534,533,534,539,540,540,535,534,536,541,542,542,537,536,537,542,543,543,538,537,538,543,544,544,539,538,539,544,545,545,540,539,546,547,548,548,549,546,549,548,550,550,551,549,551,550,552,552,553,551,553,552,554,554,555,553,547,556,557,557,548,547,548,557,558,558,550,548,550,558,559,559,552,550,552,559,560,560,554,552,556,561,562,562,557,556,557,562,563,563,558,557,558,563,564,564,559,558,559,564,565,565,560,559,561,566,567,567,562,561,562,567,568,568,563,562,563,568,569,569,564,563,564,569,570,570,565,564,571,572,573,573,574,571,574,573,575,575,576,574,576,575,577,577,578,576,578,577,579,579,580,578,572,581,582,582,573,572,573,582,583,583,575,573,575,583,584,584,577,575,577,584,585,585,579,577,581,586,587,587,582,581,582,587,588,588,583,582,583,588,589,589,584,583,584,589,590,590,585,584,586,591,592,592,587,586,587,592,593,593,588,587,588,593,594,594,589,588,589,594,595,595,590,589,596,597,598,597,596,599,599,600,597,600,599,601,601,602,600,602,601,603,603,604,602,605,596,606,596,605,607,607,599,596,599,607,608,608,601,599,601,608,609,609,603,601,610,605,611,605,610,612,612,607,605,607,612,613,613,608,607,608,613,614,614,609,608,615,610,616,610,615,617,617,612,610,612,617,618,618,613,612,613,618,619,619,614,613,620,621,622,621,620,623,623,624,621,624,623,625,625,626,624,626,625,627,627,628,626,629,620,630,620,629,631,631,623,620,623,631,632,632,625,623,625,632,633,633,627,625,634,629,635,629,634,636,636,631,629,631,636,637,637,632,631,632,637,638,638,633,632,639,634,640,634,639,641,641,636,634,636,641,642,642,637,636,637,642,643,643,638,637,644,645,646,645,644,647,647,648,645,648,647,649,649,650,648,650,649,651,651,652,650,653,644,654,644,653,655,655,647,644,647,655,656,656,649,647,649,656,657,657,651,649,658,653,659,653,658,660,660,655,653,655,660,661,661,656,655,656,661,662,662,657,656,663,658,664,658,663,665,665,660,658,660,665,666,666,661,660,661,666,667,667,662,661,668,669,670,669,668,671,671,672,669,672,671,673,673,674,672,674,673,675,675,676,674,677,668,678,668,677,679,679,671,668,671,679,680,680,673,671,673,680,681,681,675,673,682,677,683,677,682,684,684,679,677,679,684,685,685,680,679,680,685,686,686,681,680,687,682,688,682,687,689,689,684,682,684,689,690,690,685,684,685,690,691,691,686,685,692,693,694,694,695,692,695,694,696,696,697,695,697,696,698,698,699,697,699,698,700,700,701,699,693,702,703,703,694,693,694,703,704,704,696,694,696,704,705,705,698,696,698,705,706,706,700,698,702,707,708,708,703,702,703,708,709,709,704,703,704,709,710,710,705,704,705,710,711,711,706,705,707,712,713,713,708,707,708,713,714,714,709,708,709,714,715,715,710,709,710,715,716,716,711,710,717,718,719,719,720,717,720,719,721,721,722,720,722,721,723,723,724,722,724,723,725,725,726,724,718,727,728,728,719,718,719,728,729,729,721,719,721,729,730,730,723,721,723,730,731,731,725,723,727,732,733,733,728,727,728,733,734,734,729,728,729,734,735,735,730,729,730,735,736,736,731,730,732,737,738,738,733,732,733,738,739,739,734,733,734,739,740,740,735,734,735,740,741,741,736,735,742,743,744,744,745,742,745,744,746,746,747,745,747,746,748,748,749,747,749,748,750,750,751,749,743,752,753,753,744,743,744,753,754,754,746,744,746,754,755,755,748,746,748,755,756,756,750,748,752,757,758,758,753,752,753,758,759,759,754,753,754,759,760,760,755,754,755,760,761,761,756,755,757,762,763,763,758,757,758,763,764,764,759,758,759,764,765,765,760,759,760,765,766,766,761,760,767,768,769,769,770,767,770,769,771,771,772,770,772,771,773,773,774,772,774,773,775,775,776,774,768,777,778,778,769,768,769,778,779,779,771,769,771,779,780,780,773,771,773,780,781,781,775,773,777,782,783,783,778,777,778,783,784,784,779,778,779,784,785,785,780,779,780,785,786,786,781,780,782,787,788,788,783,782,783,788,789,789,784,783,784,789,790,790,785,784,785,790,791,791,786,785]};function Teapot(options){this.size=1;Teapot.__super__.constructor.call(this,options)}Teapot.prototype.init=function(verts,colors,texes,norms,indices){var i,j,k,l,len,len1,len2,len3,len4,m,max,ref,ref1,ref2,ref3,ref4,results,scale,v;max=null;ref=teapot.vertices;for(i=0,len=ref.length;i<len;i++){v=ref[i];if(max===null||v>max){max=v}}scale=this.size/max;ref1=teapot.vertices;for(j=0,len1=ref1.length;j<len1;j++){v=ref1[j];verts.push(v*scale)}ref2=teapot.normals;for(k=0,len2=ref2.length;k<len2;k++){v=ref2[k];norms.push(v)}ref3=teapot.textureCoords;for(l=0,len3=ref3.length;l<len3;l++){v=ref3[l];texes.push(v)}ref4=teapot.indices;results=[];for(m=0,len4=ref4.length;m<len4;m++){v=ref4[m];results.push(indices.push(v))}return results};return Teapot})(Jax.Mesh.Triangles)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Mesh.Torus=(function(superClass){extend(Torus,superClass);function Torus(options){this.innerRadius=0.6;this.outerRadius=1.8;this.sides=16;this.rings=32;Torus.__super__.constructor.call(this,options)}Torus.prototype.init=function(vertices,colors,texes,normals){var cosphi,costheta,costheta1,dist,i,innerRadius,j,k,l,outerRadius,phi,ref,ref1,results,ringdelta,rings,sidedelta,sides,sinphi,sintheta,sintheta1,theta,theta1;innerRadius=this.innerRadius;outerRadius=this.outerRadius;sides=this.sides;rings=this.rings;sidedelta=2*Math.PI/sides;ringdelta=2*Math.PI/rings;theta=sintheta=0;costheta=1;results=[];for(i=k=ref=rings-1;ref<=0?k<=0:k>=0;i=ref<=0?++k:--k){theta1=theta+ringdelta;costheta1=Math.cos(theta1);sintheta1=Math.sin(theta1);phi=0;for(j=l=ref1=sides;ref1<=0?l<=0:l>=0;j=ref1<=0?++l:--l){phi=phi+sidedelta;cosphi=Math.cos(phi);sinphi=Math.sin(phi);dist=outerRadius+(innerRadius*cosphi);normals.push(costheta1*cosphi,-sintheta1*cosphi,sinphi);vertices.push(costheta1*dist,-sintheta1*dist,innerRadius*sinphi);normals.push(costheta*cosphi,-sintheta*cosphi,sinphi);vertices.push(costheta*dist,-sintheta*dist,innerRadius*sinphi)}theta=theta1;costheta=costheta1;results.push(sintheta=sintheta1)}return results};return Torus})(Jax.Mesh.TriangleStrip)}).call(this);(function(){}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Framerate=(function(superClass){var clamp,drawPath;extend(Framerate,superClass);drawPath=function(ctx,points,height,current){var i,j,ref;ctx.beginPath();ctx.moveTo(0,clamp(height-points[0]*height,0,height));for(i=j=0,ref=current;0<=ref?j<=ref:j>=ref;i=0<=ref?++j:--j){ctx.lineTo(i,clamp(height-points[i]*height,0,height))}ctx.stroke();return ctx.closePath()};clamp=function(val,min,max){if(val<min){return min}else{if(val>max){return max}else{return val}}};function Framerate(options){if(options==null){options={}}options.stroke||(options.stroke="rgba(0, 0, 0, 255)");options.fill||(options.fill="rgba(255, 0, 255, 255)");options.width||(options.width=128);options.height||(options.height=64);options.position||(options.position=[options.width/2,options.height/2,-0.1001]);options.castShadow||(options.castShadow=false);options.receiveShadow||(options.receiveShadow=false);options.illuminated||(options.illuminated=false);options.fontHeight||(options.fontHeight=12);Framerate.__super__.constructor.call(this,options);this.canvas=document.createElement("canvas");this.canvas.width=this.width;this.canvas.height=this.height;this.ctx=this.canvas.getContext("2d");this.ctx.font=this.font||(this.font=this.fontHeight+"px Arial");this.history=[];this.current=-1;this.max_fps=100;if(this.ema===void 0){this.ema=30}this.ema_exponent=2/(this.ema+1);this._max_data_width=this.width/3;this._fps_label_left=0;this._one_quarter_height=this.height*0.25;this._two_quarter_height=this.height*0.5;this._three_quarter_height=this.height*0.75;this._12_pcnt_height=this.height*0.12;this._marker_offset=this.width-this._12_pcnt_height;this._max_queue_size=Math.round(this.width-this._12_pcnt_height);this.glTex=new Jax.Texture.Bitmap({data:this.canvas,mag_filter:GL_LINEAR,min_filter:GL_LINEAR,flip_y:true,wrap_s:GL_CLAMP_TO_EDGE,wrap_t:GL_CLAMP_TO_EDGE});this.mesh=new Jax.Mesh.Quad({width:this.width,height:this.height,color:[1,1,1,1],transparent:true,material:new Jax.Material.Custom({layers:[{type:"Position"},{type:"VertexColor"},{type:"Texture",instance:this.glTex}]})})}Framerate.prototype.render=function(context,material){var curEMA,curPcnt,fpsPcnt,i,j,ref,stack,x,y;this.fps=context.getFramesPerSecond();fpsPcnt=this.fps/this.max_fps;if(this.fps===Number.POSITIVE_INFINITY){this.fps=fpsPcnt=0}if(this.current===this._max_queue_size){for(i=j=0,ref=this.current;0<=ref?j<=ref:j>=ref;i=0<=ref?++j:--j){this.history[i]=this.history[i+1]}}else{this.current++}if(this.ema){if(this.current===0){curEMA=0}else{curEMA=this.history[this.current-1]}this.history[this.current]=curPcnt=(fpsPcnt*this.ema_exponent)+(curEMA*(1-this.ema_exponent))}else{this.history[this.current]=curPcnt=fpsPcnt}this.ctx.clearRect(0,0,this.width,this.height);if(!this.ema||this.current>=this.ema){this.ctx.strokeStyle=this.fill;drawPath(this.ctx,this.history,this.height,this.current);this.ctx.textBaseline="center";x=this.width-this.fontHeight*4.25;y=clamp(this.height-(curPcnt*this.height+5),this.fontHeight,this.height);this.ctx.strokeStyle=this.stroke;this.ctx.strokeText((Math.round(this.fps))+" FPS",x,y);this.ctx.fillStyle=this.fill;this.ctx.fillText((Math.round(this.fps))+" FPS",x,y)}else{this.ctx.strokeStyle=this.stroke;this.ctx.fillText("Gathering data...",10,this.height/2,this.width-20);this.ctx.fillStyle="rgba(128, 128, 128, 255)";this.ctx.fillText("Gathering data...",10,this.height/2,this.width-20)}this.glTex.invalidate("data");if(!this.ortho){this.camera.ortho({left:0,right:context.canvas.width,bottom:0,top:context.canvas.height});this.ortho=this.camera.get("projection").matrix;this.identity=mat4.identity(mat4.create())}stack=context.matrix_stack;stack.push();stack.loadProjectionMatrix(this.ortho);stack.loadViewMatrix(this.identity);stack.multModelMatrix(this.camera.get("matrix"));this.mesh.render(context,this,material);return stack.pop()};return Framerate})(Jax.Model)}).call(this);(function(){}).call(this);(function(){}).call(this);(function(){Jax.Shader=(function(){Shader.include(Jax.Mixins.EventEmitter);Shader.instances={};function Shader(name1){this.name=name1!=null?name1:"generic";this.id=Jax.guid();this.clear()}Shader.prototype.clear=function(){this.variables={};this.sources=[];this.main=new Array();return this.trigger("changed")};Shader.prototype.processExportsAndImports=function(code){var definitions,exp,exportID,exports,expr,imp,j,k,l,len,len1,match,offset,offsetEnd,offsetStart,ofs,ref,remainder,replacement,rx,value;exports=[];rx=/export[\s\t\n]*\(/;offset=0;exportID=0;while(match=rx.exec(code.slice(offset))){offsetStart=match.index+offset;offsetEnd=offsetStart+match[0].length;remainder=Jax.Util.scan(code.slice(offsetEnd));offsetEnd+=remainder.length+1;exp=/^(.*?)[\s\t\n]*,[\s\t\n]*(.*?)[\s\t\n]*,[\s\t\n]*(.*)$/.exec(remainder);exports.push({fullMatch:code.slice(offsetStart,offsetEnd),type:exp[1],name:exp[2],mangledName:"export_"+exp[2]+exportID++,value:exp[3],offsetStart:offsetStart,offsetEnd:offsetEnd});offset=offsetEnd}rx=/import[\s\t\n]*\(/;for(offset=j=ref=code.length-1;ref<=0?j<=0:j>=0;offset=ref<=0?++j:--j){if(match=rx.exec(code.slice(offset))){offsetStart=match.index+offset;offsetEnd=offsetStart+match[0].length;remainder=Jax.Util.scan(code.slice(offsetEnd));offsetEnd+=remainder.length+1;if(code[offsetEnd]===";"){offsetEnd++}imp=/^(.*?)[\s\t\n]*,[\s\t\n]*(.*)$/.exec(remainder);imp={fullMatch:code.slice(offsetStart,offsetEnd),name:imp[1],value:imp[2],offsetStart:offsetStart,offsetEnd:offsetEnd};replacement="";for(k=0,len=exports.length;k<len;k++){exp=exports[k];if(exp.name===imp.name&&exp.offsetStart<imp.offsetStart){value=imp.value.replace(new RegExp(imp.name,"g"),exp.mangledName);replacement+=value+";\n"}}code=code.replace(imp.fullMatch,replacement)}}definitions="";for(l=0,len1=exports.length;l<len1;l++){exp=exports[l];definitions+=exp.type+" "+exp.mangledName+";\n";expr=exp.mangledName+" = "+exp.value;code=code.replace(exp.fullMatch,expr)}if(match=/precision.*?\n/.exec(code)){ofs=match.index+match[0].length;code=code.slice(0,ofs)+definitions+code.slice(ofs)}else{code=definitions+code}return code};Shader.prototype.toLines=function(){return this.toString().split("\n")};Shader.prototype.toString=function(){var body,cache,cacheCode,cacheName,cacheType,caches,definitions,i,j,k,len,len1,line,main,mangledMain,match,name,offsetEnd,offsetStart,ofs,ref,ref1,rest,result,src;main=new Array();ref=this.main;for(j=0,len=ref.length;j<len;j++){line=ref[j];main.push(line)}result="";ref1=this.sources;for(i=k=0,len1=ref1.length;k<len1;i=++k){src=ref1[i];result+=src.mangle(result);result+="\n";if(mangledMain=src.getMangledMain()){main.push(mangledMain.mangledName+"();")}}body=this.processExportsAndImports(result+("void main(void) {\n  "+(main.join("\n  "))+"\n}"));caches={};while(match=/cache[\s\t\n]*\([\s\t\n]*([^,]+?)[\s\t\n]*,[\s\t\n]*(.*?)[\s\t\n]*\)[\s\t\n]*\{/.exec(body)){cacheType=match[1].trim();cacheName=match[2].trim();offsetStart=match.index;offsetEnd=offsetStart+match[0].length;rest=Jax.Util.scan(body.slice(offsetEnd),"}","{");offsetEnd+=rest.length+1;cache=body.slice(offsetStart,offsetEnd);cacheCode="";if(caches[cacheName]){if(caches[cacheName].type!==cacheType){throw new Error("Cached variable "+cacheName+" has a conflicting type: "+cacheType+" (already defined as a "+caches[cacheName].type+")")}}else{caches[cacheName]={name:cacheName,type:cacheType};cacheCode+=rest}body=body.slice(0,offsetStart)+cacheCode+body.slice(offsetEnd)}definitions="";for(name in caches){cache=caches[name];definitions+=cache.type+" "+cache.name+";\n"}if(match=/precision.*?\n/.exec(body)){ofs=match.index+match[0].length;body=body.slice(0,ofs)+definitions+body.slice(ofs)}else{body=definitions+body}if(body.indexOf("precision")===-1){return"precision mediump float;\nprecision mediump int;\n\n"+body}else{return body}};Shader.prototype.mergeVariables=function(parser,map){var definition,j,k,len,len1,name,ref,ref1;ref=parser.findVariables();for(j=0,len=ref.length;j<len;j++){definition=ref[j];ref1=definition.names;for(k=0,len1=ref1.length;k<len1;k++){name=ref1[k];name=map[name];this.variables[name]={name:name,qualifier:definition.qualifier,type:definition.type}}}return this.variables};Shader.prototype.insert=function(src,mangler,index){var map,parser;this.sources.splice(index,0,parser=new Jax.Shader.Parser(src,mangler));map=parser.map();this.mergeVariables(parser,map);this.trigger("changed");return map};Shader.prototype.append=function(src,mangler){if(mangler==null){mangler=Jax.guid()}return this.insert(src,mangler,this.sources.length)};return Shader})()}).call(this);(function(){var Variable;Variable=(function(){function Variable(){this.names=[];this.shared=false;this.qualifier=null;this.type=null}return Variable})();Jax.Shader.Parser=(function(){Parser.prototype.findVariables=function(){var STATE_COMMENT_MULTI,STATE_COMMENT_SINGLE,STATE_NONE,STATE_QUALIFIED,STATE_SHARED,STATE_TYPED,ch,i,len,match,matching,offset,processToken,src,state,token,variable,variables;variables=[];src=this.src;STATE_NONE=0;STATE_SHARED=1;STATE_QUALIFIED=2;STATE_TYPED=4;STATE_COMMENT_SINGLE=8;STATE_COMMENT_MULTI=16;state=STATE_NONE;token="";variable=new Variable();matching=[];match={0:"",offset:0};processToken=function(token){if(token===""){return}if(state===STATE_NONE){switch(token){case"shared":state|=STATE_SHARED;return variable.shared=true;case"varying":case"uniform":case"attribute":state|=STATE_QUALIFIED;return variable.qualifier=token}}else{if(state&STATE_TYPED){variable.names||(variable.names=[]);return variable.names.push(token.replace(/,/,""))}else{if(state&STATE_QUALIFIED){state|=STATE_TYPED;return variable.type=token}else{if(state&STATE_SHARED){switch(token){case"varying":case"uniform":case"attribute":state|=STATE_QUALIFIED;return variable.qualifier=token;default:return state=STATE_NONE}}else{throw new Error("Unexpected state: "+state)}}}}};for(offset=i=0,len=src.length;i<len;offset=++i){ch=src[offset];match[0]+=ch;if(ch==="\n"&&state&STATE_COMMENT_SINGLE){state^=STATE_COMMENT_SINGLE;continue}if(match[0].length>=2&&match[0].indexOf("*/")===match[0].length-2&&state&STATE_COMMENT_MULTI){state^=STATE_COMMENT_MULTI;continue}if(state&STATE_COMMENT_SINGLE||state&STATE_COMMENT_MULTI){continue}if(match[0].length>=2&&match[0].indexOf("//")===match[0].length-2){token=token.replace(/\/$/,"");state|=STATE_COMMENT_SINGLE;continue}if(match[0].length>=2&&match[0].indexOf("/*")===match[0].length-2){token=token.replace(/\/$/,"");state|=STATE_COMMENT_MULTI;continue}if(ch===";"){processToken(token);if(state&STATE_TYPED){variable.match=match;variables.push(variable);variable=new Variable()}state=STATE_NONE;match={0:"",offset:offset};token=""}else{if(ch==="\n"||ch===" "||ch==="\t"){processToken(token);if(state===STATE_NONE){match={0:"",offset:offset}}token=""}else{token+=ch}}}return variables};Parser.prototype.findFunctions=function(){var func,functions,match,offsetEnd,offsetStart,rx,signature,src;functions=[];rx=/(shared[\s\t\n]+|)(\w+)[\s\t\n]+(\w+)[\s\t\n]*\([\s\t\n]*[\s\t\n]*(.*?)[\s\t\n]*\)[\s\t\n]*{/;src=this.src;while(match=rx.exec(src)){offsetStart=match.index;offsetEnd=match.index+match[0].length;signature=match[4];offsetEnd+=Jax.Util.scan(src.slice(offsetEnd),"}","{").length+1;func=src.slice(offsetStart,offsetEnd);src=src.slice(0,offsetStart)+src.slice(offsetEnd);functions.push({shared:!!match[1],signature:signature,full:func,type:match[2],name:match[3]})}return functions};function Parser(src1,mangler){this.src=src1;this.mangler=mangler}Parser.prototype.getMangledMain=function(){var i,len,mangle,mangles;mangles=this.findFunctions();for(i=0,len=mangles.length;i<len;i++){mangle=mangles[i];if(mangle.name==="main"){mangle.mangledName=mangle.name+this.mangler;return mangle}}return null};Parser.prototype.map=function(){var i,j,len,len1,mangle,mangles,map,name,ref;map={};mangles=this.findVariables();for(i=0,len=mangles.length;i<len;i++){mangle=mangles[i];ref=mangle.names;for(j=0,len1=ref.length;j<len1;j++){name=ref[j];if(mangle.shared){map[name]=name}else{map[name]=name+this.mangler}}}return map};Parser.prototype.mangle=function(currentSrc){var i,j,k,l,len,len1,len2,len3,mangle,mangledFunc,mangledName,mangledNames,mangledSignature,mangles,match,name,ref,ref1,src,variable;src=this.src;mangles=this.findVariables();for(i=0,len=mangles.length;i<len;i++){mangle=mangles[i];mangledNames=[];ref=mangle.names;for(j=0,len1=ref.length;j<len1;j++){name=ref[j];if(mangle.shared){if(new RegExp(name+"(,|;)").test(currentSrc)){continue}mangledNames.push(name)}else{mangledNames.push(name+this.mangler)}}if(mangledNames.length>0){mangledNames=mangledNames.join(", ");variable=[mangle.qualifier,mangle.type,mangledNames].join(" ");variable+=";"}else{variable=""}src=src.replace(mangle.match[0],variable);if(mangle.shared){continue}ref1=mangle.names;for(k=0,len2=ref1.length;k<len2;k++){name=ref1[k];mangledName=name+this.mangler;while(match=new RegExp("(^|\\W)"+name+"(\\W|$)").exec(src)){src=src.replace(match[0],match[1]+mangledName+match[2])}}}mangles=this.findFunctions();for(l=0,len3=mangles.length;l<len3;l++){mangle=mangles[l];if(mangle.shared){mangledName=mangle.name}else{mangledName=mangle.name+this.mangler}mangledSignature=mangle.signature.replace(mangle.name,mangledName);mangledFunc=mangle.full.replace(mangle.signature,mangledSignature);mangledFunc=mangledFunc.replace(/shared[\s\t\n]+/,"");src=src.replace(mangle.full,mangledFunc);if(mangle.shared){continue}while(match=new RegExp("(^|\\W)"+mangle.name+"(\\W|$)").exec(src)){src=src.replace(match[0],match[1]+mangledName+match[2])}}return src};return Parser})()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Jax.Shader.CompileError=(function(superClass){extend(CompileError,superClass);function CompileError(message){CompileError.__super__.constructor.call(this);this.message=message}return CompileError})(Jax.Error);Jax.Shader.Program=(function(){var popularity,shallowClone;popularity={};Program.resetPopularities=function(){return popularity={}};Program.getPopularities=function(){return popularity};Program.getGenericDescriptor=function(){return{maxVertexTextureImageUnits:0,maxFragmentTextureImageUnits:8,maxCombinedTextureImageUnits:8,maxVertexAttribs:8,maxVertexUniformVectors:128,maxVaryingVectors:8,maxFragmentUniformVectors:16,maxDrawBuffers:1,shadingLanguageVersion:1}};shallowClone=function(obj){var clone,k,v;clone={};for(k in obj){v=obj[k];clone[k]=v}return clone};function Program(name1){this.name=name1!=null?name1:"generic";this.invalidate=bind(this.invalidate,this);this.fragmentShaderChanged=bind(this.fragmentShaderChanged,this);this.vertexShaderChanged=bind(this.vertexShaderChanged,this);this._contexts={};this._guid=Jax.guid();this._dislikedAttributes=[];this.layers=[];this.variableMaps=[];this.variables={attributes:{},uniforms:{},varyings:{}};this.vertex=new Jax.Shader(this.name+"-v");this.vertex.on("changed",this.vertexShaderChanged);this.fragment=new Jax.Shader(this.name+"-f");this.fragment.on("changed",this.fragmentShaderChanged);if(this.vertex.main.length===0){this.vertex.main.push("gl_Position = vec4(1.0, 1.0, 1.0, 1.0);")}if(this.fragment.main.length===0){this.fragment.main.push("gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);")}}Program.prototype.set=function(context,assigns){var attribute,descriptor,gl,id,mustRebind,name,ref,ref1,uniform,value;gl=context.renderer;mustRebind=false;ref=this.variables.attributes;for(name in ref){attribute=ref[name];if((value=assigns[name])!==void 0){this.setAttribute(context,attribute,value)}else{id=context.id;if(this.isAttributeEnabled(context,attribute.location[id])){if(attribute.location[id]===0&&this._dislikedAttributes.indexOf(name)===-1){this._dislikedAttributes.push(name);mustRebind=true}this.disableAttribute(context,attribute.location[id],attribute.name)}}attribute.value=value}if(mustRebind){descriptor=this.getDescriptor(context);this.popularize();this.relink(descriptor);this.bind(context);return this.set(context,assigns)}this.__textureIndex=0;ref1=this.variables.uniforms;for(name in ref1){uniform=ref1[name];value=assigns[name];if(value===void 0){continue}if(value!=null?value.toVec4:void 0){value=value.toVec4()}this.setUniform(context,uniform,value);uniform.value=value}return true};Program.prototype.setAttribute=function(context,variable,value){var id;id=context.id;if(!this.isAttributeEnabled(context,variable.location[id])){this.enableAttribute(context,variable.location[id],variable.name)}value.bind(context);return context.renderer.vertexAttribPointer(variable.location[id],value.itemSize,value.dataType||GL_FLOAT,false,0,value.offset||0)};Program.prototype.setUniform=function(context,variable,value){var gl,handle,id;gl=context.renderer;id=context.id;switch(variable.type){case"float":return gl.uniform1f(variable.location[id],value);case"bool":case"int":return gl.uniform1i(variable.location[id],value);case"vec2":return gl.uniform2fv(variable.location[id],value);case"vec3":return gl.uniform3fv(variable.location[id],value);case"vec4":return gl.uniform4fv(variable.location[id],value);case"bvec2":case"ivec2":return gl.uniform2iv(variable.location[id],value);case"bvec3":case"ivec3":return gl.uniform3iv(variable.location[id],value);case"bvec4":case"ivec4":return gl.uniform4iv(variable.location[id],value);case"mat2":return gl.uniformMatrix2fv(variable.location[id],false,value);case"mat3":return gl.uniformMatrix3fv(variable.location[id],false,value);case"mat4":return gl.uniformMatrix4fv(variable.location[id],false,value);case"sampler2D":case"samplerCube":gl.activeTexture(GL_TEXTURE0+this.__textureIndex);if(handle=value.validate(context)){gl.bindTexture(value.get("target"),handle)}else{gl.bindTexture(value.get("target"),null)}return gl.uniform1i(variable.location[id],value=this.__textureIndex++);default:throw new Error("Unexpected variable type: "+variable.type)}};Program.prototype.insert=function(vsrc,fsrc,index){var fmap,k,mangler,map,v,vmap;mangler=Jax.guid();map={};vmap=this.vertex.insert(vsrc,mangler,index);fmap=this.fragment.insert(fsrc,mangler,index);for(k in fmap){v=fmap[k];map[k]=v}for(k in vmap){v=vmap[k];map[k]=v}return map};Program.prototype.append=function(vsrc,fsrc,index){var fmap,k,mangler,map,v,vmap;mangler=Jax.guid();map={};vmap=this.vertex.append(vsrc,mangler);fmap=this.fragment.append(fsrc,mangler);for(k in fmap){v=fmap[k];map[k]=v}for(k in vmap){v=vmap[k];map[k]=v}return map};Program.prototype.clear=function(){this.vertex.clear();return this.fragment.clear()};Program.prototype.bindAttributeLocations=function(descriptor){var gl,i,id,len,name,nextAvailableLocation,variable,variables;gl=descriptor.context.renderer;variables=(function(){var ref,results;ref=this.variables.attributes;results=[];for(name in ref){variable=ref[name];results.push(variable)}return results}).call(this);variables.sort((function(_this){return function(a,b){var aarr,barr,da,db,s;if((da=_this._dislikedAttributes.indexOf(a.name))!==(db=_this._dislikedAttributes.indexOf(b.name))){if(da===-1){return -1}else{return 1}}if((barr=popularity[b.name])&&(aarr=popularity[a.name])){if((s=barr.length-aarr.length)!==0){return s}}return a.name.toLowerCase().localeCompare(b.name.toLowerCase())}})(this));nextAvailableLocation=0;id=descriptor.context.id;for(i=0,len=variables.length;i<len;i++){variable=variables[i];variable.location||(variable.location={});variable.location[id]=nextAvailableLocation;gl.bindAttribLocation(descriptor.glProgram,nextAvailableLocation,variable.name);nextAvailableLocation+=(function(){switch(variable.type){case"mat2":return 2;case"mat3":return 3;case"mat4":return 4;default:return 1}})()}return true};Program.prototype.enableAllAttributes=function(descriptor){var id,name,ref,variable;id=descriptor.context.id;ref=this.variables.attributes;for(name in ref){variable=ref[name];this.enableAttribute(descriptor.context,variable.location[id],name)}return true};Program.prototype.enableAttribute=function(context,location,name){context._enabledAttributes[location]=1;return context.renderer.enableVertexAttribArray(location)};Program.prototype.disableAttribute=function(context,location,name){context._enabledAttributes[location]=0;return context.renderer.disableVertexAttribArray(location)};Program.prototype.isAttributeEnabled=function(context,location){return context._enabledAttributes[location]===1};Program.prototype.getUniformLocations=function(descriptor){var gl,id,name,program,ref,variable;gl=descriptor.context.renderer;program=this.getGLProgram(descriptor.context);id=descriptor.context.id;ref=this.variables.uniforms;for(name in ref){variable=ref[name];variable.location||(variable.location={});variable.location[id]=gl.getUniformLocation(program,variable.name);if(variable.location[id]===null){delete this.variables.uniforms[name]}}return true};Program.prototype.relink=function(descriptor){var gl;gl=descriptor.context.renderer;this.bindAttributeLocations(descriptor);gl.linkProgram(descriptor.glProgram);this.enableAllAttributes(descriptor);return this.getUniformLocations(descriptor)};Program.prototype.compileShader=function(descriptor,type,jaxShader,glShader){var backtrace,gl,source;gl=descriptor.context.renderer;source=jaxShader.toString();gl.shaderSource(glShader,source);gl.compileShader(glShader);if(!gl.getShaderParameter(glShader,GL_COMPILE_STATUS)){backtrace=this.buildBacktrace(gl,glShader,source.split(/\n/));throw new Jax.Shader.CompileError("Shader "+jaxShader.name+" failed to compile\n\n"+(backtrace.join("\n")))}return glShader};Program.prototype.compileShaders=function(descriptor){var context,fragment,gl,glFragment,glVertex,helper,i,info,layer,len,ref,ref1,vertex;context=descriptor.context,glVertex=descriptor.glVertex,glFragment=descriptor.glFragment;this.clear();info=this.getShaderContext(descriptor,"vertex");helper=new Jax.Material.SourceHelper(info);ref=this.layers;for(i=0,len=ref.length;i<len;i++){layer=ref[i];ref1=layer.getShaderSource(helper),vertex=ref1.vertex,fragment=ref1.fragment;this.variableMaps.push(this.append(vertex,fragment))}gl=context.renderer;this.compileShader(descriptor,"vertex",this.vertex,glVertex);this.compileShader(descriptor,"fragment",this.fragment,glFragment);gl.attachShader(descriptor.glProgram,descriptor.glVertex);return gl.attachShader(descriptor.glProgram,descriptor.glFragment)};Program.prototype.compileProgram=function(descriptor){var gl;gl=descriptor.context.renderer;descriptor.glProgram||(descriptor.glProgram=gl.createProgram());descriptor.glVertex||(descriptor.glVertex=gl.createShader(GL_VERTEX_SHADER));descriptor.glFragment||(descriptor.glFragment=gl.createShader(GL_FRAGMENT_SHADER));this.compileShaders(descriptor);this.relink(descriptor);if(!gl.getProgramParameter(descriptor.glProgram,GL_LINK_STATUS)){throw new Error("Could not initialize shader!\n\n"+gl.getProgramInfoLog(descriptor.glProgram)+"\n\n"+this.vertex.toString()+"\n\n"+this.fragment.toString())}};Program.prototype.bind=function(context){var descriptor,glProgram;descriptor=this.getDescriptor(context);if(!descriptor.valid){this.validate(context)}context=descriptor.context,glProgram=descriptor.glProgram;if(context._currentProgram!==glProgram){context.renderer.useProgram(glProgram);return context._currentProgram=glProgram}};Program.prototype.getGLProgram=function(context){return this.getDescriptor(context).glProgram};Program.prototype.vertexShaderChanged=function(){this.invalidate();return this.mergeVariables(this.vertex)};Program.prototype.fragmentShaderChanged=function(){this.invalidate();return this.mergeVariables(this.fragment)};Program.prototype.addLayer=function(layer){this.invalidate();return this.layers.push(layer)};Program.prototype.popularize=function(){var ary,index,name,ref,variable;for(name in popularity){ary=popularity[name];if((index=ary.indexOf(this._guid))!==-1){ary.splice(ary.indexOf(this._guid),1)}}ref=this.variables.attributes;for(name in ref){variable=ref[name];ary=popularity[name]||(popularity[name]=[]);if(this._dislikedAttributes.indexOf(name)===-1){ary.push(this._guid)}}return true};Program.prototype.mergeVariables=function(shader){var clone,name,ref,variable;ref=shader.variables;for(name in ref){variable=ref[name];clone=shallowClone(variable);switch(variable.qualifier){case"attribute":this.variables.attributes[name]=clone;break;case"varying":this.variables.varyings[name]=clone;break;case"uniform":this.variables.uniforms[name]=clone;break;default:throw new Error("Unexpected qualifier: "+variable.qualifier)}}this.popularize();return this.variables};Program.prototype.validate=function(context){var descriptor;descriptor=this.getDescriptor(context);this.compileProgram(descriptor);context._attributesEnabled||(context._attributesEnabled={});return descriptor.valid=true};Program.prototype.getDescriptor=function(context){var descriptor,maxAttrs;if(!(descriptor=this._contexts[context.id])){descriptor=this._contexts[context.id]={valid:false,context:context};maxAttrs=this.getShaderContext(descriptor).maxVertexAttribs;context._enabledAttributes||(context._enabledAttributes=new Uint8Array(maxAttrs))}return descriptor};Program.prototype.isValid=function(context){return this.getDescriptor(context).valid};Program.prototype.invalidate=function(context){var descriptor,id,ref,results;if(context==null){context=null}if(context){return this.getDescriptor(context).valid=false}else{ref=this._contexts;results=[];for(id in ref){descriptor=ref[id];results.push(this.invalidate(descriptor.context))}return results}};Program.prototype.getShaderContext=function(descriptor){var gl;gl=descriptor.context.renderer;return descriptor.shaderContext||(descriptor.shaderContext={maxVertexAttribs:gl.getParameter(GL_MAX_VERTEX_ATTRIBS),maxVertexUniformVectors:gl.getParameter(GL_MAX_VERTEX_UNIFORM_VECTORS),maxVaryingVectors:gl.getParameter(GL_MAX_VARYING_VECTORS),maxCombinedTextureImageUnits:gl.getParameter(GL_MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:gl.getParameter(GL_MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxFragmentTextureImageUnits:gl.getParameter(GL_MAX_TEXTURE_IMAGE_UNITS),maxFragmentUniformVectors:gl.getParameter(GL_MAX_FRAGMENT_UNIFORM_VECTORS),shadingLanguageVersion:gl.getParameter(GL_SHADING_LANGUAGE_VERSION),gl:gl})};Program.prototype.buildBacktrace=function(gl,shader,source){var errno,errors,humanLineNo,i,index,j,line,log,ref,ref1,ref2,rx;log=((ref=gl.getShaderInfoLog(shader))!=null?ref.split(/\n/):void 0)||[];rx=/\d+:(\d+):(.*)/;errors=(function(){var i,len,results;results=[];for(i=0,len=log.length;i<len;i++){line=log[i];results.push(rx.exec(line))}return results})();for(index=i=0,ref1=source.length;0<=ref1?i<ref1:i>ref1;index=0<=ref1?++i:--i){line=source[index];humanLineNo=index+1;if(humanLineNo<10){humanLineNo="  "+humanLineNo}else{if(humanLineNo<100){humanLineNo=" "+humanLineNo}}log.push(humanLineNo+" : "+line);for(errno=j=0,ref2=errors.length;0<=ref2?j<ref2:j>ref2;errno=0<=ref2?++j:--j){if(errors[errno]&&parseInt(errors[errno][1])===index+1){log.push("   :: ERROR : "+errors[errno][2]);errors.splice(errno-1,1);errno=0}}}return log};return Program})()}).call(this);(function(){Jax.Material=(function(){function Material(options,name1){var j,key,layer,len,value;this.name=name1!=null?name1:"generic";options=Jax.Util.merge(options,{});for(key in options){value=options[key];switch(key){case"layers":for(j=0,len=value.length;j<len;j++){layer=value[j];this.addLayer(layer)}break;default:this[key]=value}}}Material.define("vertex",{get:function(){if(!this._shaderReady){this.prepareShader()}return this.shader.vertex}});Material.define("fragment",{get:function(){if(!this._shaderReady){this.prepareShader()}return this.shader.fragment}});Material.prototype.findLayer=function(klass){var j,layer,len,ref;ref=this.layers;for(j=0,len=ref.length;j<len;j++){layer=ref[j];if(layer instanceof klass){return layer}}return null};Material.prototype.insertLayer=function(index,options){var Klass,layer;this._shaderReady=false;this.layers||(this.layers=[]);if(typeof options==="string"){options={type:options}}if(options instanceof Jax.Material.Layer){this._shaderReady=false;this.layers.splice(index,0,options);return options}options=Jax.Util.merge(options,{});Klass=Jax.Material.Layer[options.type];if(!Klass){if(Jax.Material[options.type]){console.log((this.name+": Material layer type "+options.type+" could not be found ")+"within namespace Jax.Material.Layer, but an object of the same name was found within namespace Jax.Material. Please note that this is deprecated usage, and material layers should appear within namespace Jax.Material.Layer.");Klass=Jax.Material[options.type]}else{throw new Error(this.name+": Material layer type "+options.type+" could not be found")}}options.shader||(options.shader=Klass.shader||Jax.Util.underscore(options.type));layer=new Klass(options);if(layer instanceof Jax.Material){throw new Error(this.name+": Custom material layers now inherit from Jax.Material.Layer instead of Jax.Material.")}this._shaderReady=false;this.layers.splice(index,0,layer);return layer};Material.prototype.addLayer=function(options){this.layers||(this.layers=[]);return this.insertLayer(this.layers.length,options)};Material.prototype.prepareShader=function(){var base,crc,j,layer,len,ref;this.layers||(this.layers=[]);crc="";ref=this.layers;for(j=0,len=ref.length;j<len;j++){layer=ref[j];crc+=";"+layer.crc()}this.shader=(base=Jax.Shader.instances)[crc]||(base[crc]=(function(_this){return function(){var index,l,len1,ref1,shader;shader=new Jax.Shader.Program(_this.name);ref1=_this.layers;for(index=l=0,len1=ref1.length;l<len1;index=++l){layer=ref1[index];shader.addLayer(layer)}return shader}})(this)());return this._shaderReady=true};Material.prototype.renderMesh=function(context,mesh,model){var gl,j,l,layer,len,numPassesRendered,numPassesRequested,pass,passes,ref,ref1;if(!this._shaderReady){this.prepareShader()}numPassesRendered=0;numPassesRequested=0;mesh.data.context=context;ref=this.layers;for(j=0,len=ref.length;j<len;j++){layer=ref[j];layer.material=this;if(layer.prepare){layer.prepare(context,mesh,model)}passes=layer.numPasses(context,mesh,model);if(passes>numPassesRequested){numPassesRequested=passes}}mesh.data.context=context;this.shader.bind(context);gl=context.renderer;for(pass=l=0,ref1=numPassesRequested;0<=ref1?l<ref1:l>ref1;pass=0<=ref1?++l:--l){if(!this.preparePass(context,mesh,model,pass,numPassesRendered)){continue}numPassesRendered++;this.drawBuffers(context,mesh,pass)}if(numPassesRendered>1){gl.blendFunc(GL_SRC_ALPHA,GL_ONE_MINUS_SRC_ALPHA);gl.depthFunc(GL_LESS)}return numPassesRendered};Material.prototype.preparePass=function(context,mesh,model,pass,numPassesRendered){var assigns,gl,i,j,k,layer,len,map,ref,result,v,variableMaps;if(numPassesRendered==null){numPassesRendered=0}assigns=mesh.assigns;variableMaps=this.shader.variableMaps;ref=this.layers;for(i=j=0,len=ref.length;j<len;i=++j){layer=ref[i];if((result=layer.setup(context,mesh,model,pass))===false){return false}else{map=variableMaps[i];for(k in result){v=result[k];if(map[k]){k=map[k]}if(v!==void 0){assigns[k]=v}}}}if(numPassesRendered===1){gl=context.renderer;gl.blendFunc(GL_ONE,GL_ONE);gl.depthFunc(GL_EQUAL)}this.shader.set(context,assigns);return true};Material.prototype.drawBuffers=function(context,mesh,pass){var buffer,length,ref;if(pass==null){pass=0}if((buffer=mesh.getIndexBuffer())&&buffer.length){if(pass===0){buffer.bind(context)}return context.renderer.drawElements(mesh.draw_mode,buffer.length,buffer.dataType,0)}else{if(length=(ref=mesh.data.vertexBuffer)!=null?ref.length:void 0){return context.renderer.drawArrays(mesh.draw_mode,0,length)}}};Material.prototype.render=function(context,mesh,model){var numPassesRendered;numPassesRendered=0;while(mesh){numPassesRendered+=this.renderMesh(context,mesh,model);mesh=mesh.submesh}return numPassesRendered};Material.instances={};Material.resources={};Material.__isMaterial=true;Material.all=function(){var name,results;results=[];for(name in Jax.Material.resources){results.push(name)}return results};Material.find=function(name){var Klass,data,ref;if(Jax.Material.instances[name]){return Jax.Material.instances[name]}if(!(data=Jax.Material.resources[name])){throw new Error("Material '"+name+"' could not be found!")}switch((ref=data.type)!=null?ref.toString().toUpperCase():void 0){case"CUSTOM":Klass=Jax.Material.Custom;break;case"LEGACY":Klass=Jax.Material.Legacy;break;case"SURFACE":Klass=Jax.Material.Surface;break;case"HALO":Klass=Jax.Material.Halo;break;case"WIRE":Klass=Jax.Material.Wire;break;default:if(!((Klass=Jax.Material[data.type])&&Klass.__isMaterial)){console.log((name+": Material type "+data.type+" is invalid. Please note that its meaning ")+"changed in Jax v3.0; it should be one of 'Surface', 'Legacy', 'Wire', 'Custom'.");console.log("Type of material "+name+" is defaulting to 'Legacy'.");Klass=Jax.Material.Legacy}}if(!Klass){throw new Error(name+": Material type "+data.type+" is not yet implemented.")}return Jax.Material.instances[name]=new Klass(data,name)};Material.addResources=function(resources){var data,name,results;results=[];for(name in resources){data=resources[name];results.push(Jax.Material.resources[name]=data)}return results};Material.clearResources=function(){Jax.Material.resources={};return Jax.Material.instances={}};return Material})()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Custom=(function(superClass){extend(Custom,superClass);function Custom(){return Custom.__super__.constructor.apply(this,arguments)}return Custom})(Jax.Material)}).call(this);(function(){Jax.Material.Layer=(function(){Jax.Material.SourceHelper=(function(){function SourceHelper(descriptor){$.extend(this,descriptor)}SourceHelper.prototype.require=function(path){var ref;if((ref=Jax.shaderTemplates)!=null?ref[path]:void 0){return Jax.shaderTemplates[path](this)}else{throw new Error("Shader source template "+path+" does not exist")}};return SourceHelper})();Layer.prototype.getShaderSource=function(sourceHelper,type){var base,base1,fragment,vertex;if(type==null){type=null}if(type){sourceHelper.shaderType=type;return((typeof(base=this.shaders).common==="function"?base.common(sourceHelper):void 0)||"")+((typeof(base1=this.shaders)[type]==="function"?base1[type](sourceHelper):void 0)||"")}else{if(this.shaders){vertex=this.getShaderSource(sourceHelper,"vertex");fragment=this.getShaderSource(sourceHelper,"fragment");return{vertex:vertex,fragment:fragment}}else{return{vertex:"",fragment:""}}}};function Layer(options){if(options!=null?options.setVariables:void 0){this.setVariables=options!=null?options.setVariables:void 0}this.assigns=new Jax.Material.ShaderVariableMap}Layer.prototype.numPasses=function(context){return 1};Layer.prototype.crc=function(){var descriptor,helper,source;descriptor=Jax.Shader.Program.getGenericDescriptor();helper=new Jax.Material.SourceHelper(descriptor);source=this.getShaderSource(helper);return Jax.Util.crc(source.vertex+source.fragment)};Layer.prototype.clearAssigns=function(){var k,map;map=this.assigns;for(k in map){map[k]=void 0}return true};Layer.prototype.setup=function(context,mesh,model,pass){var result,varmap;varmap=null;this.clearAssigns();if(this.setVariables){result=this.setVariables(context,mesh,model,this.assigns,pass);if(result===false){return false}}return this.assigns};return Layer})()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.IlluminationLayer=(function(superClass){extend(IlluminationLayer,superClass);function IlluminationLayer(){return IlluminationLayer.__super__.constructor.apply(this,arguments)}IlluminationLayer.prototype.numPasses=function(context){return context.world.lights.length+1};IlluminationLayer.prototype.setVariables=function(context,mesh,model,vars,pass){var light;vars.PASS=pass;if(!pass){return}light=context.world.lights[pass-1];if(!(light.enabled&&light.isInRange(model))){return false}return this.illuminate(context,mesh,model,vars,light)};IlluminationLayer.prototype.illuminate=function(context,mesh,model,vars,light){};return IlluminationLayer})(Jax.Material.Layer)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Legacy=(function(superClass){extend(Legacy,superClass);Legacy.define("ambient",{get:function(){return this._ambient},set:function(c){var ref;this._ambient=Jax.Color.parse(c);return(ref=this.findLayer(Jax.Material.Layer.LightAmbient))!=null?ref.color=this._ambient:void 0}});Legacy.define("diffuse",{get:function(){return this._diffuse},set:function(c){var ref;this._diffuse=Jax.Color.parse(c);return(ref=this.findLayer(Jax.Material.Layer.LambertDiffuse))!=null?ref.color=this._diffuse:void 0}});Legacy.define("specular",{get:function(){return this._specular},set:function(c){var ref;this._specular=Jax.Color.parse(c);return(ref=this.findLayer(Jax.Material.Layer.PhongSpecular))!=null?ref.color=this._specular:void 0}});Legacy.define("shininess",{get:function(){return this._shininess},set:function(c){var ref;this._shininess=c;return(ref=this.findLayer(Jax.Material.Layer.PhongSpecular))!=null?ref.shininess=this._shininess:void 0}});function Legacy(options,name){var i,layer,layers,len;this.addLayer("Position");this.addLayer("VertexColor");if(options){layers=options.layers;delete options.layers}Legacy.__super__.constructor.call(this,options,name);if(layers){for(i=0,len=layers.length;i<len;i++){layer=layers[i];switch(layer.type){case"Lighting":layer.type="LightAmbient";this.addLayer(layer);layer.type="LambertDiffuse";this.addLayer(layer);layer.type="PhongSpecular";this.addLayer(layer);break;case"NormalMap":this.insertLayer(0,layer);break;default:this.addLayer(layer)}}}this.ambient=this.ambient||"#ffff";this.diffuse=this.diffuse||"#ffff";this.specular=this.specular||"#ffff";if(this.shininess===void 0){this.shininess=60}}return Legacy})(Jax.Material.Custom)}).call(this);(function(){Jax.Material.ShaderVariableMap=(function(){function ShaderVariableMap(){}ShaderVariableMap.prototype.set=function(keyOrVariables,valueOrNothing){var k,results,v;if(!this.alreadyWarned){this.alreadyWarned=true;console.log("`vars.set` and `vars.texture` are both deprecated. Instead, you should just set variable values directly on the `vars` object. For example, to set a shader variable named `color` to the value [1, 1, 1, 1], use the syntax: vars.color = [1, 1, 1, 1]`")}if(valueOrNothing===void 0){results=[];for(k in keyOrVariables){v=keyOrVariables[k];if(v===void 0){continue}results.push(this[k]=v)}return results}else{k=keyOrVariables;v=valueOrNothing;if(v!==void 0){return this[k]=v}}};ShaderVariableMap.prototype.texture=function(name,tex,context){return this.set(name,tex)};ShaderVariableMap.define("set",{enumerable:false});ShaderVariableMap.define("texture",{enumerable:false});return ShaderVariableMap})()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Surface=(function(superClass){extend(Surface,superClass);Surface.define("intensity",{get:function(){return this._intensity},set:function(obj){var intensity;intensity=this._intensity;if(typeof obj==="number"){return intensity.ambient=intensity.diffuse=intensity.specular=obj}else{if(obj.ambient!==void 0){intensity.ambient=obj.ambient}if(obj.diffuse!==void 0){intensity.diffuse=obj.diffuse}if(obj.specular!==void 0){return intensity.specular=obj.specular}}}});Surface.define("color",{get:function(){return this._color},set:function(obj){var color,isColor;color=this._color;isColor=typeof obj!=="object"||(obj.ambient===void 0&&obj.diffuse===void 0&&obj.specular===void 0);if(isColor){return color.ambient=color.diffuse=color.specular=obj}else{if(obj.ambient!==void 0){color.ambient=obj.ambient}if(obj.diffuse!==void 0){color.diffuse=obj.diffuse}if(obj.specular!==void 0){return color.specular=obj.specular}}}});Surface.define("shininess",{get:function(){return this._shininess},set:function(s){var ref;if((ref=this.findLayer(Jax.Material.Layer.PhongSpecular))!=null){ref.shininess=s}return this._shininess=s}});Surface.define("pcf",{get:function(){return this._pcf},set:function(s){var ref;if((ref=this.findLayer(Jax.Material.Layer.ShadowMap))!=null){ref.pcf=s}return this._pcf=s}});function Surface(options,name){var j,k,len,len1,map,mat,ref,ref1,texture;this._intensity={};mat=this;Object.defineProperty(this._intensity,"ambient",{get:function(){return this._ambient},set:function(i){var ref,ref1;if((ref=mat.findLayer(Jax.Material.Layer.WorldAmbient))!=null){ref.intensity=i}if((ref1=mat.findLayer(Jax.Material.Layer.LightAmbient))!=null){ref1.intensity=i}return this._ambient=i}});Object.defineProperty(this._intensity,"diffuse",{get:function(){return this._diffuse},set:function(i){var ref;if((ref=mat.findLayer(Jax.Material.Layer.LambertDiffuse))!=null){ref.intensity=i}return this._diffuse=i}});Object.defineProperty(this._intensity,"specular",{get:function(){return this._specular},set:function(i){var ref;if((ref=mat.findLayer(Jax.Material.Layer.PhongSpecular))!=null){ref.intensity=i}return this._specular=i}});this._color={};mat=this;Object.defineProperty(this._color,"ambient",{get:function(){return this._ambient},set:function(c){var ref,ref1;if((ref=mat.findLayer(Jax.Material.Layer.WorldAmbient))!=null){ref.color=Jax.Color.parse(c)}if((ref1=mat.findLayer(Jax.Material.Layer.LightAmbient))!=null){ref1.color=Jax.Color.parse(c)}return this._ambient=c}});Object.defineProperty(this._color,"diffuse",{get:function(){return this._diffuse},set:function(c){var ref;if((ref=mat.findLayer(Jax.Material.Layer.LambertDiffuse))!=null){ref.color=Jax.Color.parse(c)}return this._diffuse=c}});Object.defineProperty(this._color,"specular",{get:function(){return this._specular},set:function(c){var ref;if((ref=mat.findLayer(Jax.Material.Layer.PhongSpecular))!=null){ref.color=Jax.Color.parse(c)}return this._specular=c}});this.addLayer("Position");this.addLayer("VertexColor");this.addLayer("WorldAmbient");this.addLayer("LambertDiffuse");this.addLayer("PhongSpecular");this.addLayer("ShadowMap");this.addLayer("LightAmbient");this.addLayer("Attenuation");this.addLayer("ClampColor");options||(options={});if(options.intensity===void 0){options.intensity=1}if(options.color===void 0){options.color="#fff"}if(options.shininess===void 0){options.shininess=60}if(options.pcf===void 0){options.pcf=true}Surface.__super__.constructor.call(this,options,name);if(options){if(options.textures){ref=options.textures;for(j=0,len=ref.length;j<len;j++){texture=ref[j];this.addLayer({type:"Texture",texture:texture})}}if(options.normalMaps){ref1=options.normalMaps;for(k=0,len1=ref1.length;k<len1;k++){map=ref1[k];this.insertLayer(0,{type:"NormalMap",texture:map})}}}}return Surface})(Jax.Material.Custom)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Wire=(function(superClass){extend(Wire,superClass);function Wire(options,name){this.transparent=true;this.addLayer("Wire");Wire.__super__.constructor.call(this,options,name)}return Wire})(Jax.Material.Surface)}).call(this);if(Date.now===undefined){Date.now=function(){return new Date().valueOf()}}var TWEEN=TWEEN||(function(){var _tweens=[];return{REVISION:"11dev",getAll:function(){return _tweens},removeAll:function(){_tweens=[]},add:function(tween){_tweens.push(tween)},remove:function(tween){var i=_tweens.indexOf(tween);if(i!==-1){_tweens.splice(i,1)}},update:function(time){if(_tweens.length===0){return false}var i=0,numTweens=_tweens.length;time=time!==undefined?time:(typeof window!=="undefined"&&window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now());while(i<numTweens){if(_tweens[i].update(time)){i++}else{_tweens.splice(i,1);numTweens--}}return true}}})();TWEEN.Tween=function(object){var _object=object;var _valuesStart={};var _valuesEnd={};var _valuesStartRepeat={};var _duration=1000;var _repeat=0;var _yoyo=false;var _reversed=false;var _delayTime=0;var _startTime=null;var _easingFunction=TWEEN.Easing.Linear.None;var _interpolationFunction=TWEEN.Interpolation.Linear;var _chainedTweens=[];var _onStartCallback=null;var _onStartCallbackFired=false;var _onUpdateCallback=null;var _onCompleteCallback=null;for(var field in object){_valuesStart[field]=parseFloat(object[field],10)}this.to=function(properties,duration){if(duration!==undefined){_duration=duration}_valuesEnd=properties;return this};this.start=function(time){TWEEN.add(this);_onStartCallbackFired=false;_startTime=time!==undefined?time:(typeof window!=="undefined"&&window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now());_startTime+=_delayTime;for(var property in _valuesEnd){if(_valuesEnd[property] instanceof Array){if(_valuesEnd[property].length===0){continue}_valuesEnd[property]=[_object[property]].concat(_valuesEnd[property])}_valuesStart[property]=_object[property];if((_valuesStart[property] instanceof Array)===false){_valuesStart[property]*=1}_valuesStartRepeat[property]=_valuesStart[property]||0}return this};this.stop=function(){TWEEN.remove(this);return this};this.delay=function(amount){_delayTime=amount;return this};this.repeat=function(times){_repeat=times;return this};this.yoyo=function(yoyo){_yoyo=yoyo;return this};this.easing=function(easing){_easingFunction=easing;return this};this.interpolation=function(interpolation){_interpolationFunction=interpolation;return this};this.chain=function(){_chainedTweens=arguments;return this};this.onStart=function(callback){_onStartCallback=callback;return this};this.onUpdate=function(callback){_onUpdateCallback=callback;return this};this.onComplete=function(callback){_onCompleteCallback=callback;return this};this.update=function(time){var property;if(time<_startTime){return true}if(_onStartCallbackFired===false){if(_onStartCallback!==null){_onStartCallback.call(_object)}_onStartCallbackFired=true}var elapsed=(time-_startTime)/_duration;elapsed=elapsed>1?1:elapsed;var value=_easingFunction(elapsed);for(property in _valuesEnd){var start=_valuesStart[property]||0;var end=_valuesEnd[property];if(end instanceof Array){_object[property]=_interpolationFunction(end,value)}else{if(typeof(end)==="string"){end=start+parseFloat(end,10)}if(typeof(end)==="number"){_object[property]=start+(end-start)*value}}}if(_onUpdateCallback!==null){_onUpdateCallback.call(_object,value)}if(elapsed==1){if(_repeat>0){if(isFinite(_repeat)){_repeat--}for(property in _valuesStartRepeat){if(typeof(_valuesEnd[property])==="string"){_valuesStartRepeat[property]=_valuesStartRepeat[property]+parseFloat(_valuesEnd[property],10)}if(_yoyo){var tmp=_valuesStartRepeat[property];_valuesStartRepeat[property]=_valuesEnd[property];_valuesEnd[property]=tmp;_reversed=!_reversed}_valuesStart[property]=_valuesStartRepeat[property]}_startTime=time+_delayTime;return true}else{if(_onCompleteCallback!==null){_onCompleteCallback.call(_object)}for(var i=0,numChainedTweens=_chainedTweens.length;i<numChainedTweens;i++){_chainedTweens[i].start(time)}return false}}return true}};TWEEN.Easing={Linear:{None:function(k){return k}},Quadratic:{In:function(k){return k*k},Out:function(k){return k*(2-k)},InOut:function(k){if((k*=2)<1){return 0.5*k*k}return -0.5*(--k*(k-2)-1)}},Cubic:{In:function(k){return k*k*k},Out:function(k){return --k*k*k+1},InOut:function(k){if((k*=2)<1){return 0.5*k*k*k}return 0.5*((k-=2)*k*k+2)}},Quartic:{In:function(k){return k*k*k*k},Out:function(k){return 1-(--k*k*k*k)},InOut:function(k){if((k*=2)<1){return 0.5*k*k*k*k}return -0.5*((k-=2)*k*k*k-2)}},Quintic:{In:function(k){return k*k*k*k*k},Out:function(k){return --k*k*k*k*k+1},InOut:function(k){if((k*=2)<1){return 0.5*k*k*k*k*k}return 0.5*((k-=2)*k*k*k*k+2)}},Sinusoidal:{In:function(k){return 1-Math.cos(k*Math.PI/2)},Out:function(k){return Math.sin(k*Math.PI/2)},InOut:function(k){return 0.5*(1-Math.cos(Math.PI*k))}},Exponential:{In:function(k){return k===0?0:Math.pow(1024,k-1)},Out:function(k){return k===1?1:1-Math.pow(2,-10*k)},InOut:function(k){if(k===0){return 0}if(k===1){return 1}if((k*=2)<1){return 0.5*Math.pow(1024,k-1)}return 0.5*(-Math.pow(2,-10*(k-1))+2)}},Circular:{In:function(k){return 1-Math.sqrt(1-k*k)},Out:function(k){return Math.sqrt(1-(--k*k))},InOut:function(k){if((k*=2)<1){return -0.5*(Math.sqrt(1-k*k)-1)}return 0.5*(Math.sqrt(1-(k-=2)*k)+1)}},Elastic:{In:function(k){var s,a=0.1,p=0.4;if(k===0){return 0}if(k===1){return 1}if(!a||a<1){a=1;s=p/4}else{s=p*Math.asin(1/a)/(2*Math.PI)}return -(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p))},Out:function(k){var s,a=0.1,p=0.4;if(k===0){return 0}if(k===1){return 1}if(!a||a<1){a=1;s=p/4}else{s=p*Math.asin(1/a)/(2*Math.PI)}return(a*Math.pow(2,-10*k)*Math.sin((k-s)*(2*Math.PI)/p)+1)},InOut:function(k){var s,a=0.1,p=0.4;if(k===0){return 0}if(k===1){return 1}if(!a||a<1){a=1;s=p/4}else{s=p*Math.asin(1/a)/(2*Math.PI)}if((k*=2)<1){return -0.5*(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p))}return a*Math.pow(2,-10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*0.5+1}},Back:{In:function(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function(k){var s=1.70158;return --k*k*((s+1)*k+s)+1},InOut:function(k){var s=1.70158*1.525;if((k*=2)<1){return 0.5*(k*k*((s+1)*k-s))}return 0.5*((k-=2)*k*((s+1)*k+s)+2)}},Bounce:{In:function(k){return 1-TWEEN.Easing.Bounce.Out(1-k)},Out:function(k){if(k<(1/2.75)){return 7.5625*k*k}else{if(k<(2/2.75)){return 7.5625*(k-=(1.5/2.75))*k+0.75}else{if(k<(2.5/2.75)){return 7.5625*(k-=(2.25/2.75))*k+0.9375}else{return 7.5625*(k-=(2.625/2.75))*k+0.984375}}}},InOut:function(k){if(k<0.5){return TWEEN.Easing.Bounce.In(k*2)*0.5}return TWEEN.Easing.Bounce.Out(k*2-1)*0.5+0.5}}};TWEEN.Interpolation={Linear:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f),fn=TWEEN.Interpolation.Utils.Linear;if(k<0){return fn(v[0],v[1],f)}if(k>1){return fn(v[m],v[m-1],m-f)}return fn(v[i],v[i+1>m?m:i+1],f-i)},Bezier:function(v,k){var b=0,n=v.length-1,pw=Math.pow,bn=TWEEN.Interpolation.Utils.Bernstein,i;for(i=0;i<=n;i++){b+=pw(1-k,n-i)*pw(k,i)*v[i]*bn(n,i)}return b},CatmullRom:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f),fn=TWEEN.Interpolation.Utils.CatmullRom;if(v[0]===v[m]){if(k<0){i=Math.floor(f=m*(1+k))}return fn(v[(i-1+m)%m],v[i],v[(i+1)%m],v[(i+2)%m],f-i)}else{if(k<0){return v[0]-(fn(v[0],v[0],v[1],v[1],-f)-v[0])}if(k>1){return v[m]-(fn(v[m],v[m],v[m-1],v[m-1],f-m)-v[m])}return fn(v[i?i-1:0],v[i],v[m<i+1?m:i+1],v[m<i+2?m:i+2],f-i)}},Utils:{Linear:function(p0,p1,t){return(p1-p0)*t+p0},Bernstein:function(n,i){var fc=TWEEN.Interpolation.Utils.Factorial;return fc(n)/fc(i)/fc(n-i)},Factorial:(function(){var a=[1];return function(n){var s=1,i;if(a[n]){return a[n]}for(i=n;i>1;i--){s*=i}return a[n]=s}})(),CatmullRom:function(p0,p1,p2,p3,t){var v0=(p2-p0)*0.5,v1=(p3-p1)*0.5,t2=t*t,t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}}};(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};quat.setAxes=(function(){var matr;matr=mat3.create();return function(out,view,right,up){matr[0]=right[0];matr[3]=right[1];matr[6]=right[2];matr[1]=up[0];matr[4]=up[1];matr[7]=up[2];matr[2]=-view[0];matr[5]=-view[1];matr[8]=-view[2];return quat.normalize(out,quat.fromMat3(out,matr))}})();Jax.Camera=(function(){var FLAGS,LOOK_AT_FLAGS,MOVE_FLAGS,PITCH_FLAGS,ROLL_FLAGS,ROTATE_FLAGS,ROTATE_QUAT_FLAGS,SET_DIRECTION_FLAGS,SET_POSITION_FLAGS,SET_ROTATION_FLAGS,STRAFE_FLAGS,TRANSLATE_FLAGS,YAW_FLAGS,_animvec,_get,_lookAtDirection,_norm,_origin,_position,_quat,_rotMat,_unitX,_unitY,_unitZ,_unprojectInf,_unprojmat,_view,_viewport,_worldAxis,orthoDefaults,perspectiveDefaults;Camera.include(Jax.Mixins.EventEmitter);Camera.include(Jax.Mixins.Attributes);Camera.getter("frustum",function(){this._frustum||(this._frustum=new Jax.Frustum(this.get("inverseMatrix"),this.get("projection").matrix));this.get("inverseMatrix");this.get("projection");this._frustum.validate();return this._frustum});_unitX=vec3.clone([1,0,0]);_unitY=vec3.clone([0,1,0]);_unitZ=vec3.clone([0,0,-1]);_view=vec3.create();_quat=quat.create();_rotMat=mat4.create();_origin=vec3.create();_position=vec3.create();_lookAtDirection=vec3.create();_worldAxis=vec3.create();_animvec=vec3.create();_unprojectInf=vec4.create();_viewport=vec4.create();_unprojmat=mat4.create();_norm=vec3.create();_get=Jax.Mixins.Attributes.get;FLAGS={matrix:1,inverseMatrix:2,position:4,up:8,right:16,direction:32,rotation:64,normalMatrix:128,inverseNormalMatrix:256,inverseConcatenatedMatrices:512};function Camera(opts){if(opts==null){opts={}}this.animationUpdated=bind(this.animationUpdated,this);this.initializeAttributes();this.activeAnimations={};this.animationQueues={};this._time=0;this.set("matrix",mat4.identity(mat4.create()));this.set("inverseMatrix",mat4.identity(mat4.create()));this.set("normalMatrix",mat3.identity(mat3.create()));this.set("inverseNormalMatrix",mat3.identity(mat3.create()));this.set("inverseConcatenatedMatrices",mat4.identity(mat4.create()));this.set("position",vec3.create());this.set("up",vec3.clone([0,1,0]));this.set("right",vec3.clone([1,0,0]));this.set("direction",vec3.clone([0,0,-1]));this.set("rotation",quat.identity(quat.create()));this.set("projection",{type:"identity",matrix:mat4.identity(mat4.create())});this.on("animation:update",this.animationUpdated);this.reset();if(opts.position){this.setPosition(opts.position)}if(opts.direction){this.setDirection(opts.direction)}}Camera.prototype.animationUpdated=function(newState){var currentPosition,currentRotation,endRotation,lerpAmount,matrix,newPosition,ref,rotationOpts,startRotation,x;startRotation=newState.startRotation,endRotation=newState.endRotation,rotationOpts=newState.rotationOpts;currentPosition=this.get("position");newPosition=null;if((x=newState.positionX)!==void 0){newPosition=_animvec;newPosition[0]=x;newPosition[1]=newState.positionY;newPosition[2]=newState.positionZ}if(lerpAmount=newState.rotationLerpAmount){matrix=this.attributes.matrix;currentRotation=this.attributes.rotation;if(newState.slerp){quat.slerp(currentRotation,startRotation,endRotation,lerpAmount)}else{quat.lerp(currentRotation,startRotation,endRotation,lerpAmount)}mat4.fromRotationTranslation(matrix,currentRotation,newPosition||currentPosition);this.set("matrix",matrix);this.set("rotation",currentRotation);this.stale|=FLAGS.inverseMatrix|FLAGS.up|FLAGS.direction|FLAGS.right|FLAGS.normalMatrix|FLAGS.inverseNormalMatrix|FLAGS.position|FLAGS.inverseConcatenatedMatrices;if((ref=this._frustum)!=null){ref.invalidate()}}else{if(newPosition){this.setPosition(newPosition)}}if(newState.facing){return this.setDirection(this.calcDirection(_animvec,newState.facing))}};Camera.prototype.animate=function(opts){var base,name,queue;if(opts.rotation){if(opts.direction||opts.facing||opts.right||opts.up){throw new Error("Can't animate toward directional vectors AND a rotation quaternion -- choose one or the other")}}else{if(opts.direction&&opts.facing){throw new Error("Can't animate toward view vector AND reference point -- choose one or the other")}}queue=(base=this.animationQueues)[name=opts.queue||"default"]||(base[name]=[]);queue.push(opts);return this};Camera.prototype.update=function(tc){var animation,queue,queueName,ref,ref1,time;time=this._time+=tc*1000;ref=this.activeAnimations;for(queueName in ref){animation=ref[queueName];if(!animation.update(time)){delete this.activeAnimations[queueName]}}ref1=this.animationQueues;for(queueName in ref1){queue=ref1[queueName];if(queue.length&&!this.activeAnimations[queueName]){this.activeAnimations[queueName]=this.createAnimation(queue.shift());this.activeAnimations[queueName].start(time)}}return this};Camera.prototype.calcRotation=function(out,opts){if(opts.direction){if(opts.up&&opts.right){quat.setAxes(out,opts.direction,opts.right,opts.up)}else{if(opts.up){vec3.normalize(_animvec,vec3.cross(_animvec,opts.direction,opts.up));quat.setAxes(out,opts.direction,_animvec,opts.up)}else{if(opts.right){vec3.normalize(_animvec,vec3.cross(_animvec,opts.right,opts.direction));quat.setAxes(out,opts.direction,opts.right,_animvec)}else{quat.rotationTo(out,this.get("direction"),opts.direction);quat.multiply(out,out,this.get("rotation"))}}}}else{if(opts.up&&opts.right){vec3.normalize(_animvec,vec3.cross(_animvec,opts.up,opts.right));quat.setAxes(out,_animvec,opts.right,opts.up)}else{if(opts.up){quat.rotationTo(out,this.get("up"),opts.up)}else{if(opts.right){quat.rotationTo(out,this.get("right"),opts.right)}}quat.multiply(out,out,this.get("rotation"))}}return out};Camera.prototype.createAnimation=function(opts){var currentPosition,duration,easing,end,endPosition,interpolation,newRotation,ref,self,slerp,start,tween;duration=1000;easing=TWEEN.Easing.Linear.None;interpolation=TWEEN.Interpolation.Linear;slerp=true;if(opts.duration!==void 0){duration=opts.duration}if(opts.easing!==void 0){easing=opts.easing}if(opts.interpolation!==void 0){interpolation=opts.interpolation}if(opts.slerp!==void 0){slerp=opts.slerp}ref=[{},{}],start=ref[0],end=ref[1];newRotation=null;if(opts.rotation){newRotation=opts.rotation}if(opts.facing){start.facing=opts.facing}if(opts.direction||opts.up||opts.right){newRotation=this.calcRotation(quat.create(),opts);start.rotationOpts=opts}if(newRotation){start.slerp=slerp;start.startRotation=quat.clone(this.get("rotation"));start.endRotation=newRotation;start.rotationLerpAmount=0;end.rotationLerpAmount=1}if(opts.position){currentPosition=this.get("position");endPosition=opts.position;start.positionX=currentPosition[0];start.positionY=currentPosition[1];start.positionZ=currentPosition[2];end.positionX=endPosition[0];end.positionY=endPosition[1];end.positionZ=endPosition[2]}self=this;tween=new TWEEN.Tween(start);tween.to(end,duration);tween.easing(easing);tween.interpolation(interpolation);tween.onUpdate(function(){return self.trigger("animation:update",this)});tween.onStart(function(){return self.trigger("animation:start",this)});tween.onComplete(function(){return self.trigger("animation:complete",this)});return tween};Camera.prototype.get=function(k){var flag,value;value=_get.call(this,k);if(flag=FLAGS[k]){if(this.stale&flag){this.stale^=flag;return this.recalculate(k,value)}else{return value}}else{return value}};SET_ROTATION_FLAGS=FLAGS.inverseMatrix|FLAGS.up|FLAGS.right|FLAGS.direction|FLAGS.normalMatrix|FLAGS.inverseNormalMatrix|FLAGS.inverseConcatenatedMatrices;Camera.prototype.setRotation=function(newRotation){var matrix,position,rotation;rotation=this.attributes.rotation;quat.copy(rotation,newRotation);this.set("rotation",rotation);position=this.get("position");matrix=this.attributes.matrix;this.set("matrix",mat4.fromRotationTranslation(matrix,rotation,position));this.stale|=SET_ROTATION_FLAGS;return this};Camera.prototype.recalculate=function(k,value){var mm,pm;switch(k){case"matrix":this.set("matrix",mat4.invert(value,this.get("inverseMatrix")));break;case"inverseMatrix":this.set("inverseMatrix",mat4.invert(value,this.get("matrix")));break;case"position":this.set("position",this.transformEye3(value,_origin));break;case"right":this.set("right",this.rotateEye3(value,_unitX));break;case"up":this.set("up",this.rotateEye3(value,_unitY));break;case"direction":this.set("direction",this.rotateEye3(value,_unitZ));break;case"rotation":this.set("rotation",quat.setAxes(value,this.get("direction"),this.get("right"),this.get("up")));break;case"normalMatrix":this.set("normalMatrix",mat3.normalFromMat4(value,this.get("matrix")));break;case"inverseNormalMatrix":this.set("inverseNormalMatrix",mat3.normalFromMat4(value,this.get("inverseMatrix")));break;case"inverseConcatenatedMatrices":mm=this.get("inverseMatrix");pm=this.get("projection").matrix;mat4.multiply(value,pm,mm);if(!mat4.invert(value,value)){throw new Error("Can't calculate inverse of concatenated matrices")}}return value};Camera.prototype.unprojectPoint=function(out,winx,winy,winz){var inf,m,projection,ref,ref1,viewport;inf=_unprojectInf;projection=this.get("projection");viewport=_viewport;switch(projection.type){case"orthographic":ref=[projection.left,projection.bottom,projection.right,projection.top],viewport[0]=ref[0],viewport[1]=ref[1],viewport[2]=ref[2],viewport[3]=ref[3];break;case"perspective":ref1=[0,0,projection.width,projection.height],viewport[0]=ref1[0],viewport[1]=ref1[1],viewport[2]=ref1[2],viewport[3]=ref1[3]}m=this.get("inverseConcatenatedMatrices");inf[0]=(winx-viewport[0])/viewport[2]*2-1;inf[1]=-((winy-viewport[1])/viewport[3]*2-1);inf[2]=2*winz-1;inf[3]=1;vec4.transformMat4(inf,inf,m);if(inf[3]===0){return null}inf[3]=1/inf[3];out[0]=inf[0]*inf[3];out[1]=inf[1]*inf[3];out[2]=inf[2]*inf[3];return out};Camera.prototype.unprojectLineSegment=function(out,winx,winy,winzNear,winzFar){if(winzNear==null){winzNear=0}if(winzFar==null){winzFar=1}this.unprojectPoint(out[0],winx,winy,winzNear);this.unprojectPoint(out[1],winx,winy,winzFar);return out};Camera.prototype.reset=function(){var ref;this.stale=FLAGS.inverseMatrix|FLAGS.position|FLAGS.up|FLAGS.right|FLAGS.direction|FLAGS.rotation|FLAGS.normalMatrix|FLAGS.inverseNormalMatrix|FLAGS.inverseConcatenatedMatrices;if((ref=this._frustum)!=null){ref.invalidate()}this.set("matrix",mat4.identity(this.get("matrix")));return this};orthoDefaults={left:-1,right:1,top:1,bottom:-1,near:0.1,far:200};Camera.prototype.ortho=function(options){var proj,ref;proj=this.get("projection");$.extend(proj,orthoDefaults,proj,options);proj.width=proj.right-proj.left;proj.height=proj.top-proj.bottom;proj.depth=proj.far-proj.near;proj.type="orthographic";mat4.ortho(proj.matrix,proj.left,proj.right,proj.bottom,proj.top,proj.near,proj.far);this.set("projection",proj);if((ref=this._frustum)!=null){ref.invalidate()}return this};perspectiveDefaults={near:0.1,far:200,fov:0.765398};Camera.prototype.perspective=function(options){var proj,ref;if(!(options!=null?options.width:void 0)){throw new Error("Expected a screen width in Jax.Camera#perspective")}if(!(options!=null?options.height:void 0)){throw new Error("Expected a screen height in Jax.Camera#perspective")}proj=this.get("projection");$.extend(proj,perspectiveDefaults,proj,options);proj.width=options.width;proj.height=options.height;proj.depth=proj.far-proj.near;proj.aspectRatio=proj.width/proj.height;proj.type="perspective";mat4.perspective(proj.matrix,proj.fov,proj.aspectRatio,proj.near,proj.far);this.set("projection",proj);if((ref=this._frustum)!=null){ref.invalidate()}return this};Camera.prototype.calcDirection=function(out,point){this.transformEye3(out,_origin);vec3.subtract(out,point,out);vec3.normalize(out,out);return out};LOOK_AT_FLAGS=FLAGS.matrix|FLAGS.up|FLAGS.right|FLAGS.direction|FLAGS.rotation|FLAGS.normalMatrix|FLAGS.inverseNormalMatrix|FLAGS.inverseConcatenatedMatrices;Camera.prototype.lookAt=function(eye,point,up){var m,ref;m=this.get("inverseMatrix");this.set("inverseMatrix",mat4.lookAt(m,eye,point,up));this.set("position",vec3.copy(this.attributes.position,eye));this.stale|=LOOK_AT_FLAGS;if((ref=this._frustum)!=null){ref.invalidate()}return this};SET_DIRECTION_FLAGS=FLAGS.inverseMatrix|FLAGS.normalMatrix|FLAGS.inverseNormalMatrix|FLAGS.inverseConcatenatedMatrices;Camera.prototype.setDirection=function(newDir,up){var magSq,matrix,ref,right,rotation,view;view=this.attributes.direction;magSq=vec3.dot(newDir,newDir);if(magSq-1>Math.EPSILON){vec3.scale(_norm,newDir,1/magSq)}else{if(magSq===0){ref=[0,0,-1],_norm[0]=ref[0],_norm[1]=ref[1],_norm[2]=ref[2]}else{vec3.copy(_norm,newDir)}}if(up){right=this.attributes.right;up=vec3.copy(this.attributes.up,up);vec3.copy(view,_norm);vec3.normalize(right,vec3.cross(right,_norm,up));vec3.normalize(up,vec3.cross(up,right,_norm));rotation=quat.setAxes(this.attributes.rotation,view,right,up);matrix=mat4.fromRotationTranslation(this.attributes.matrix,rotation,this.get("position"));this.set("matrix",matrix);this.set("direction",view);this.set("right",right);this.set("up",up);this.set("rotation",rotation);this.stale|=SET_DIRECTION_FLAGS}else{rotation=quat.rotationTo(_quat,this.get("direction"),_norm);this.rotateQuat(rotation);this.set("direction",vec3.copy(view,_norm));this.stale^=FLAGS.direction}return this};SET_POSITION_FLAGS=FLAGS.inverseMatrix|FLAGS.position|FLAGS.normalMatrix|FLAGS.inverseNormalMatrix|FLAGS.inverseConcatenatedMatrices;Camera.prototype.setPosition=function(newPos){var m,ref;m=this.get("matrix");m[12]=newPos[0];m[13]=newPos[1];m[14]=newPos[2];m[15]=1;this.set("matrix",m);this.stale|=SET_POSITION_FLAGS;if((ref=this._frustum)!=null){ref.invalidate()}return this};ROTATE_QUAT_FLAGS=FLAGS.inverseMatrix|FLAGS.up|FLAGS.right|FLAGS.direction|FLAGS.normalMatrix|FLAGS.inverseNormalMatrix|FLAGS.inverseConcatenatedMatrices;Camera.prototype.rotateQuat=function(newRotation){var matrix,ref,rotMat,rotation;rotMat=mat4.fromRotationTranslation(_rotMat,newRotation,_origin);matrix=this.get("matrix");rotation=this.get("rotation");this.set("matrix",mat4.multiply(matrix,matrix,rotMat));this.set("rotation",quat.multiply(rotation,newRotation,rotation));this.stale|=ROTATE_QUAT_FLAGS;if((ref=this._frustum)!=null){ref.invalidate()}return this};ROTATE_FLAGS=FLAGS.inverseMatrix|FLAGS.up|FLAGS.right|FLAGS.direction|FLAGS.rotation|FLAGS.normalMatrix|FLAGS.inverseNormalMatrix|FLAGS.inverseConcatenatedMatrices;Camera.prototype.rotate=function(n,axis){var m,ref;m=this.get("matrix");this.set("matrix",mat4.rotate(m,m,n,axis));this.stale|=ROTATE_FLAGS;if((ref=this._frustum)!=null){ref.invalidate()}return this};Camera.prototype.rotateWorld=function(n,axis){this.transformWorld3(_worldAxis,axis);return this.rotate(n,_worldAxis)};MOVE_FLAGS=FLAGS.inverseMatrix|FLAGS.position|FLAGS.normalMatrix|FLAGS.inverseNormalMatrix|FLAGS.inverseConcatenatedMatrices;Camera.prototype.move=function(n){var m,ref,ref1,w,x,y,z;n=-n;m=this.get("matrix");ref=[m[8]*n,m[9]*n,m[10]*n,m[11]*n],x=ref[0],y=ref[1],z=ref[2],w=ref[3];m[12]+=x;m[13]+=y;m[14]+=z;m[15]+=w;this.set("matrix",m);this.stale|=MOVE_FLAGS;if((ref1=this._frustum)!=null){ref1.invalidate()}return this};STRAFE_FLAGS=FLAGS.inverseMatrix|FLAGS.position|FLAGS.normalMatrix|FLAGS.inverseNormalMatrix|FLAGS.inverseConcatenatedMatrices;Camera.prototype.strafe=function(n){var m,ref,ref1,w,x,y,z;m=this.get("matrix");ref=[m[0]*n,m[1]*n,m[2]*n,m[3]*n],x=ref[0],y=ref[1],z=ref[2],w=ref[3];m[12]+=x;m[13]+=y;m[14]+=z;m[15]+=w;this.set("matrix",m);this.stale|=STRAFE_FLAGS;if((ref1=this._frustum)!=null){ref1.invalidate()}return this};TRANSLATE_FLAGS=FLAGS.inverseMatrix|FLAGS.position|FLAGS.normalMatrix|FLAGS.inverseNormalMatrix|FLAGS.inverseConcatenatedMatrices;Camera.prototype.translate=function(vec){var m,ref;m=this.get("matrix");this.set("matrix",mat4.translate(m,m,vec));this.stale|=TRANSLATE_FLAGS;if((ref=this._frustum)!=null){ref.invalidate()}return this};YAW_FLAGS=FLAGS.inverseMatrix|FLAGS.right|FLAGS.direction|FLAGS.rotation|FLAGS.normalMatrix|FLAGS.inverseNormalMatrix|FLAGS.inverseConcatenatedMatrices;Camera.prototype.yaw=function(n){var m,ref;m=this.get("matrix");this.set("matrix",mat4.rotateY(m,m,n));this.stale|=YAW_FLAGS;if((ref=this._frustum)!=null){ref.invalidate()}return this};ROLL_FLAGS=FLAGS.inverseMatrix|FLAGS.right|FLAGS.up|FLAGS.rotation|FLAGS.normalMatrix|FLAGS.inverseNormalMatrix|FLAGS.inverseConcatenatedMatrices;Camera.prototype.roll=function(n){var m,ref;m=this.get("matrix");this.set("matrix",mat4.rotateZ(m,m,n));this.stale|=ROLL_FLAGS;if((ref=this._frustum)!=null){ref.invalidate()}return this};PITCH_FLAGS=FLAGS.inverseMatrix|FLAGS.up|FLAGS.direction|FLAGS.rotation|FLAGS.normalMatrix|FLAGS.inverseNormalMatrix|FLAGS.inverseConcatenatedMatrices;Camera.prototype.pitch=function(n){var m,ref;m=this.get("matrix");this.set("matrix",mat4.rotateX(m,m,n));this.stale|=PITCH_FLAGS;if((ref=this._frustum)!=null){ref.invalidate()}return this};Camera.prototype.transformEye3=function(out,a){return vec3.transformMat4(out,a,this.get("matrix"))};Camera.prototype.rotateEye3=function(out,a){return vec3.transformMat3(out,a,this.get("normalMatrix"))};Camera.prototype.transformEye4=function(out,a){return vec4.transformMat4(out,a,this.get("matrix"))};Camera.prototype.transformWorld3=function(out,a){return vec3.transformMat4(out,a,this.get("inverseMatrix"))};Camera.prototype.rotateWorld3=function(out,a){return vec3.transformMat3(out,a,this.get("inverseNormalMatrix"))};Camera.prototype.transformWorld4=function(out,a){return vec4.transformMat4(out,a,this.get("inverseMatrix"))};return Camera})()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Frustum=(function(superClass){var BOTTOM,FAR,LEFT,NEAR,RIGHT,TOP,extractedM,extractedVec,ref,testVec;extend(Frustum,superClass);Frustum.include(Jax.Mixins.EventEmitter);ref=[0,1,2,3,4,5],RIGHT=ref[0],LEFT=ref[1],BOTTOM=ref[2],TOP=ref[3],FAR=ref[4],NEAR=ref[5];Frustum.OUTSIDE=Jax.Geometry.Plane.BACK;Frustum.INTERSECT=Jax.Geometry.Plane.INTERSECT;Frustum.INSIDE=Jax.Geometry.Plane.FRONT;function Frustum(modelview,projection){var i;this.modelview=modelview;this.projection=projection;Frustum.__super__.constructor.call(this);this.planes=(function(){var j,results;results=[];for(i=j=0;j<6;i=++j){results.push(new Jax.Geometry.Plane)}return results})();this.invalidate()}Frustum.getter("mesh",function(){var mesh,recalculateMeshVertices;if(this._mesh){return this._mesh}mesh=this._mesh=new Jax.Mesh.Lines({init:function(vertices,colors){var i,j,results;results=[];for(i=j=0;j<28;i=++j){vertices.push(0,0,0);results.push(colors.push(1,1,0,1))}return results}});recalculateMeshVertices=(function(_this){return function(){var e,i,j,vertices;vertices=mesh.data.vertexBuffer;e=_this.extents();for(i=j=0;j<=2;i=++j){vertices[0+i]=e.ntl[i];vertices[3+i]=e.ntr[i];vertices[6+i]=e.ntr[i];vertices[9+i]=e.nbr[i];vertices[12+i]=e.ntr[i];vertices[15+i]=e.nbr[i];vertices[18+i]=e.nbr[i];vertices[21+i]=e.nbl[i];vertices[24+i]=e.nbl[i];vertices[27+i]=e.ntl[i];vertices[30+i]=e.ftl[i];vertices[33+i]=e.ftr[i];vertices[36+i]=e.ftr[i];vertices[39+i]=e.fbr[i];vertices[42+i]=e.ftr[i];vertices[45+i]=e.fbr[i];vertices[48+i]=e.fbr[i];vertices[51+i]=e.fbl[i];vertices[54+i]=e.fbl[i];vertices[57+i]=e.ftl[i];vertices[60+i]=e.ntl[i];vertices[63+i]=e.ftl[i];vertices[66+i]=e.nbl[i];vertices[69+i]=e.fbl[i];vertices[72+i]=e.ntr[i];vertices[75+i]=e.ftr[i];vertices[78+i]=e.nbr[i];vertices[81+i]=e.fbr[i]}return mesh.data.invalidate()}})(this);this.on("updated",recalculateMeshVertices);recalculateMeshVertices();return mesh});testVec=vec3.create();Frustum.prototype.point=function(point,y,z){var j,len,plane,ref1,ref2;this.validate();if(y!==void 0){ref1=[point,y,z],testVec[0]=ref1[0],testVec[1]=ref1[1],testVec[2]=ref1[2];point=testVec}ref2=this.planes;for(j=0,len=ref2.length;j<len;j++){plane=ref2[j];if(plane.distance(point)<0){return Jax.Frustum.OUTSIDE}}return Jax.Frustum.INSIDE};Frustum.prototype.sphere=function(center,radius,y,z){var distance,j,len,plane,ref1,ref2,result;this.validate();if(y!==void 0){radius=z;ref1=[center,radius,y],testVec[0]=ref1[0],testVec[1]=ref1[1],testVec[2]=ref1[2];center=testVec}result=Jax.Frustum.INSIDE;ref2=this.planes;for(j=0,len=ref2.length;j<len;j++){plane=ref2[j];distance=plane.distance(center);if(distance<-radius){return Jax.Frustum.OUTSIDE}if(distance<radius){result=Jax.Frustum.INTERSECT}}return result};Frustum.prototype.cube=function(position,w,h,d){var c,c2,j,len,plane,ref1,ref2,ref3,ref4,xn,xp,yn,yp,zn,zp;this.validate();c2=0;ref1=[position[0]+w,position[0]-w],xp=ref1[0],xn=ref1[1];ref2=[position[1]+h,position[1]-h],yp=ref2[0],yn=ref2[1];ref3=[position[2]+d,position[2]-d],zp=ref3[0],zn=ref3[1];ref4=this.planes;for(j=0,len=ref4.length;j<len;j++){plane=ref4[j];c=0;if(plane.classify(xp,yp,zp)>0){c++}if(plane.classify(xn,yp,zp)>0){c++}if(plane.classify(xp,yn,zp)>0){c++}if(plane.classify(xn,yn,zp)>0){c++}if(plane.classify(xp,yp,zn)>0){c++}if(plane.classify(xn,yp,zn)>0){c++}if(plane.classify(xp,yn,zn)>0){c++}if(plane.classify(xn,yn,zn)>0){c++}if(c===0){return Jax.Frustum.OUTSIDE}if(c===8){c2++}}if(c2===6){return Jax.Frustum.INSIDE}else{return Jax.Frustum.INTERSECT}};Frustum.prototype.pointVisible=function(center,y,z){return this.point(center,y,z)!==Jax.Frustum.OUTSIDE};Frustum.prototype.sphereVisible=function(center,radius,y,z){return this.sphere(center,radius,y,z)!==Jax.Frustum.OUTSIDE};Frustum.prototype.cubeVisible=function(position,w,h,d){return this.cube(position,w,h,d)!==Jax.Frustum.OUTSIDE};Frustum.prototype.invalidate=function(){return this._isValid=false};Frustum.prototype.isValid=function(){return this._isValid};Frustum.prototype.validate=function(){if(this.isValid()){return}this.extractFrustum();this._isValid=true;return this.trigger("updated")};extractedM=mat4.create();extractedVec=vec3.create();Frustum.prototype.calcExtent=function(vec,x,y,z){vec[0]=x;vec[1]=y;vec[2]=z;vec[3]=1;vec4.transformMat4(vec,vec,extractedM);if(vec[3]===0){vec[0]=vec[1]=vec[2]=0;return vec}vec[3]=1/vec[3];vec[0]=vec[0]*vec[3];vec[1]=vec[1]*vec[3];vec[2]=vec[2]*vec[3];return vec};Frustum.prototype.extents=function(){var e,m;if(this.isValid()){return this._extractedExtents}e=this._extractedExtents||(this._extractedExtents={ntl:vec4.create(),ntr:vec4.create(),nbl:vec4.create(),nbr:vec4.create(),ftl:vec4.create(),ftr:vec4.create(),fbl:vec4.create(),fbr:vec4.create()});m=extractedM;mat4.multiply(m,this.projection,this.modelview);mat4.invert(m,m);this.calcExtent(e.ntl,-1,1,-1);this.calcExtent(e.ntr,1,1,-1);this.calcExtent(e.nbl,-1,-1,-1);this.calcExtent(e.nbr,1,-1,-1);this.calcExtent(e.ftl,-1,1,1);this.calcExtent(e.ftr,1,1,1);this.calcExtent(e.fbl,-1,-1,1);this.calcExtent(e.fbr,1,-1,1);return this._extractedExtents};Frustum.prototype.extractFrustum=function(){var e;e=this.extents();this.planes[TOP].set(e.ntr,e.ntl,e.ftl);this.planes[BOTTOM].set(e.nbl,e.nbr,e.fbr);this.planes[LEFT].set(e.ntl,e.nbl,e.fbl);this.planes[RIGHT].set(e.nbr,e.ntr,e.fbr);this.planes[NEAR].set(e.ntl,e.ntr,e.nbr);return this.planes[FAR].set(e.ftr,e.ftl,e.fbl)};Frustum.prototype.render=function(context,material){return this.mesh.render(context,this,material)};return Frustum})(Jax.Model)}).call(this);(function(){Jax.Octree=(function(){var chvec;function Octree(splitThreshold,mergeThreshold,depth,size,parent){this.splitThreshold=splitThreshold!=null?splitThreshold:2;this.mergeThreshold=mergeThreshold!=null?mergeThreshold:1;this.depth=depth!=null?depth:0;this.size=size!=null?size:1;this.parent=parent;this._isParent=false;this._isSubdivided=false;this.children=[];this.objectCount=0;this.nestedObjectCount=0;this.objects={};this.nestedObjects={};this.position=vec3.create()}Octree.getter("mesh",function(){return this._mesh||(this._mesh=new Jax.Mesh.LineCube(this.size,this.position))});Octree.prototype.isParent=function(){return this._isParent};Octree.prototype.isSubdivided=function(){return this._isSubdivided};Octree.prototype.enlarge=function(){var child,j,len,ref;this.size*=2;ref=this.children;for(j=0,len=ref.length;j<len;j++){child=ref[j];if(child){this.recalculateChildPosition(child);child.enlarge();child.reEvaluateObjects()}}this.subdivide();this.reEvaluateObjects();this.mesh.halfSize=this.size;this.mesh.offset=this.position;return this.mesh.invalidate()};Octree.prototype.subdivide=function(){return this._isSubdivided=true};chvec=vec3.create();Octree.prototype.getChildInQuadrant=function(vec){var child;if(child=this.children[this.quadrant(vec,chvec)]){return child}else{child=new Jax.Octree(this.splitThreshold,this.mergeThreshold,this.depth+1,this.size*0.5,this);vec3.scale(chvec,chvec,this.size*0.5);vec3.add(child.position,chvec,this.position);return this.children[this.quadrant(vec)]=child}};Octree.prototype.recalculateChildPosition=function(child){this.quadrant(child.position,chvec);vec3.scale(chvec,chvec,this.size*0.5);return vec3.add(child.position,chvec,this.position)};Octree.prototype.canContain=function(obj){var objPos,objSize,octPos,octSize,ref;objPos=obj.position;objSize=((ref=obj.mesh)!=null?ref.bounds.radius:void 0)||0.1;octPos=this.position;octSize=this.size;if(objSize>octSize){return false}if(objPos[0]>octPos[0]+octSize){return false}if(objPos[0]<octPos[0]-octSize){return false}if(objPos[1]>octPos[1]+octSize){return false}if(objPos[1]<octPos[1]-octSize){return false}if(objPos[2]>octPos[2]+octSize){return false}if(objPos[2]<octPos[2]-octSize){return false}return true};Octree.prototype.trackNestedObject=function(obj){if(!this.nestedObjects[obj.__unique_id]){this.nestedObjects[obj.__unique_id]=obj;this.nestedObjectCount++}if(this.parent){this.parent.trackNestedObject(obj)}return obj};Octree.prototype.untrackNestedObject=function(obj){if(this.nestedObjects[obj.__unique_id]){delete this.nestedObjects[obj.__unique_id];this.nestedObjectCount--;if(this.nestedObjectCount<=this.mergeThreshold){this.merge()}}if(this.parent){this.parent.untrackNestedObject(obj)}return obj};Octree.prototype.addToSelf=function(obj){if(!this.objects[obj.__unique_id]){this.objects[obj.__unique_id]=obj;this.objectCount++;if(this.objectCount>=this.splitThreshold){this.split()}}return this.trackNestedObject(obj)};Octree.prototype.add=function(obj){if(!this.hasBeenMerged()&&this.canContain(obj)){if(this.isSubdivided()){return this.addToChild(obj)||this.addToSelf(obj)}else{return this.addToSelf(obj)}}else{if(this.parent){return this.parent.add(obj)}else{this.enlarge();return this.add(obj)}}};Octree.prototype.hasBeenMerged=function(){return this.parent&&!this.parent.isSubdivided()};Octree.prototype.remove=function(obj){if(this.objects[obj.__unique_id]){delete this.objects[obj.__unique_id];this.objectCount--}return this.untrackNestedObject(obj)};Octree.prototype.split=function(){var id,obj,ref;this.subdivide();ref=this.objects;for(id in ref){obj=ref[id];this.addToChild(obj)}return true};Octree.prototype.reEvaluateObjects=function(){var i,obj,ref;if(this.isSubdivided()){ref=this.objects;for(i in ref){obj=ref[i];this.addToChild(obj)}}return true};Octree.prototype.merge=function(){var child,id,j,len,obj,ref,ref1;this._isSubdivided=false;ref=this.children;for(j=0,len=ref.length;j<len;j++){child=ref[j];if(child!=null){child.clear()}}this.objectCount=this.nestedObjectCount;ref1=this.nestedObjects;for(id in ref1){obj=ref1[id];this.objects[id]=obj}return true};Octree.prototype.clear=function(){var child,id,j,len,obj,ref,ref1,ref2;ref=this.nestedObjects;for(id in ref){obj=ref[id];delete this.nestedObjects[id]}ref1=this.objects;for(id in ref1){obj=ref1[id];delete this.objects[id]}ref2=this.children;for(j=0,len=ref2.length;j<len;j++){child=ref2[j];if(child!=null){child.clear()}}this._isSubdivided=false;return this.objectCount=this.nestedObjectCount=0};Octree.prototype.addToChild=function(obj){var child;child=this.getChildInQuadrant(obj.position);if(child.canContain(obj)){if(this.objects[obj.__unique_id]){delete this.objects[obj.__unique_id];this.objectCount--}this._isParent=true;child.add(obj);this.trackNestedObject(obj);return true}else{return false}};Octree.prototype.quadrant=function(pos,dest){var position,quadrant;position=this.position;quadrant=0;if(pos[0]>position[0]){quadrant|=1}if(pos[1]>position[1]){quadrant|=2}if(pos[2]>position[2]){quadrant|=4}if(dest){dest[0]=(quadrant&1?1:-1);dest[1]=(quadrant&2?1:-1);dest[2]=(quadrant&4?1:-1)}return quadrant};Octree.prototype.find=function(obj){var child,j,len,ref,result;if(this.objects[obj.__unique_id]){return this}else{ref=this.children;for(j=0,len=ref.length;j<len;j++){child=ref[j];if(child&&child.nestedObjects[obj.__unique_id]){if(result=child.find(obj)){return result}}}}return null};Octree.prototype.update=function(obj){var id,node,replace;node=this.find(obj);replace=false;while(node&&!node.canContain(obj)){replace=true;id=obj.__unique_id;if(node.nestedObjects[id]){delete node.nestedObjects[id];node.nestedObjectCount--}if(node.objects[id]){delete node.objects[id];node.objectCount--}if(node.nestedObjectCount<=node.mergeThreshold){node.merge()}node=node.parent}if(!replace){return}node||(node=this);node.add(obj);return true};Octree.prototype.traverse=function(pos,callback){var first,ref,ref1,ref2,ref3,ref4,ref5,ref6,ref7;if(this.nestedObjectCount===0){return}if(callback(this)===false){return}if(this.isSubdivided()){first=this.quadrant(pos);if((ref=this.children[first])!=null){ref.traverse(pos,callback)}if((ref1=this.children[first^1])!=null){ref1.traverse(pos,callback)}if((ref2=this.children[first^2])!=null){ref2.traverse(pos,callback)}if((ref3=this.children[first^4])!=null){ref3.traverse(pos,callback)}if((ref4=this.children[first^3])!=null){ref4.traverse(pos,callback)}if((ref5=this.children[first^5])!=null){ref5.traverse(pos,callback)}if((ref6=this.children[first^6])!=null){ref6.traverse(pos,callback)}if((ref7=this.children[first^7])!=null){ref7.traverse(pos,callback)}}return true};return Octree})()}).call(this);(function(){Jax.World=(function(){var hashify,pickDataBuffers,singlePickArray;World.include(Jax.Mixins.EventEmitter);function World(context1){var buf,world;this.context=context1;this.renderOctree=false;this.lights=[];this._objects={};this.ambientColor=new Jax.Color(0.05,0.05,0.05,1);this._objectsArray=[];this._renderQueue=[];this._sortPosition=vec3.create();this._cameras=[];this.cameras=1;this.octree=new Jax.Octree(20,10);this._octreeModel=new Jax.Model({octree:this.octree});world=this;this.invalidateShadowMaps=function(){var k,len,light,obj,ref;obj=this;if(obj.castShadow){ref=world.lights;for(k=0,len=ref.length;k<len;k++){light=ref[k];if(!(light.shadowmap&&light.isInRange(obj))){continue}light.shadowmap.invalidate()}}return true};this.updateOctree=function(){return world.octree.update(this)};buf=vec3.create();this._queueSorter=function(a,b){var camPos,len1,len2,ref,ref1;camPos=world._sortPosition;len1=vec3.length(vec3.subtract(buf,a.position,camPos))-(((ref=a.mesh)!=null?ref.bounds.radius:void 0)||0);len2=vec3.length(vec3.subtract(buf,b.position,camPos))-(((ref1=b.mesh)!=null?ref1.bounds.radius:void 0)||0);return len1-len2}}World.define("ambientColor",{get:function(){return this._ambientColor},set:function(c){(this._ambientColor||(this._ambientColor=new Jax.Color)).parse(c);return this.trigger("ambientChanged")}});World.getter("objects",function(){var k,len,obj,ref,result;console.log("The getter `objects` is deprecated; please use `getObjects()` instead.\nNote that the latter returns an array, where the former used to be a\ngeneric object.");console.log(new Error().stack);result={};ref=this.getObjects();for(k=0,len=ref.length;k<len;k++){obj=ref[k];result[obj.__unique_id]=obj}return result});World.define("cameras",{get:function(){return this._cameras},set:function(i){var j,k,num,ref,ref1;if(i<1){i=1}num=this._cameras.length;this._cameras.length=i;if(i>num){for(j=k=ref=num,ref1=i;ref<=ref1?k<ref1:k>ref1;j=ref<=ref1?++k:--k){this._cameras[j]=new Jax.Camera}}return this.trigger("numCamerasChanged")}});World.prototype.render=function(material,cull){if(material){if(!(material instanceof Jax.Material)){material=Jax.Material.find(material)}}return this.renderOpaques(material,cull)+this.renderTransparencies(material)};World.prototype.renderTransparencies=function(material){var context,queue;context=this.context;queue=this._renderQueue;if(queue.length){queue=queue.sort(this._queueSorter);while(queue.length){queue.pop().render(context,material)}}return queue.length};World.prototype.renderOrEnqueue=function(material,models){var context,i,model,num,queue;context=this.context;queue=this._renderQueue;num=0;for(i in models){model=models[i];if(model.transparent||(model.mesh&&model.mesh.transparent)){queue.push(model)}else{model.render(context,material);num++}}return num};World.prototype.renderOpaques=function(material,cull){var numObjectsRendered;numObjectsRendered=0;this._sortPosition[0]=this._sortPosition[1]=this._sortPosition[2]=0;vec3.transformMat4(this._sortPosition,this._sortPosition,this.context.matrix_stack.getInverseModelViewMatrix());if(cull!==false){numObjectsRendered+=this.renderOpaquesInOctree(material)}else{numObjectsRendered+=this.renderOrEnqueue(material,this.octree.nestedObjects)}return numObjectsRendered+this.renderOrEnqueue(material,this._objects)};World.prototype.renderOpaquesInOctree=function(material){var context,frustum,numObjectsRendered,octreeModel,queue,ref,renderOctree;numObjectsRendered=0;context=this.context;frustum=context.activeCamera.frustum;queue=this._renderQueue;ref=[this.renderOctree,this.octreeModel],renderOctree=ref[0],octreeModel=ref[1];this.octree.traverse(this._sortPosition,(function(_this){return function(node){var keepRecursing,objectCount,objects,size;size=node.size*2;switch(frustum.cube(node.position,size,size,size)){case Jax.Frustum.OUTSIDE:return false;case Jax.Frustum.INSIDE:objectCount=node.nestedObjectCount;objects=node.nestedObjects;keepRecursing=false;break;default:objectCount=node.objectCount;objects=node.objects;keepRecursing=true}if(renderOctree&&objectCount){node.mesh.render(context,octreeModel,material)}numObjectsRendered+=_this.renderOrEnqueue(material,objects);return keepRecursing}})(this));return numObjectsRendered};World.prototype.getPickBuffer=function(){return this.pickBuffer||(this.pickBuffer=new Jax.Framebuffer({depth:true,width:this.context.canvas.width,height:this.context.canvas.height}))};World.prototype.addLight=function(light){if(!(light instanceof Jax.Light)){light=Jax.Light.find(light)}this.lights.push(light);this.trigger("lightAdded",light);return light};World.prototype.removeLight=function(light){this.lights.splice(this.lights.indexOf(light));this.trigger("lightRemoved",light);return light};World.prototype.addObject=function(object,options){var addToOctree;addToOctree=(!options||options.addToOctree!==false&&options.cull!==false)&&object.cull!==false&&object.mesh&&object.mesh.cull!==false;if(addToOctree){this.octree.add(object);object.on("transformed",this.updateOctree);this.trigger("objectAddedToOctree")}else{this._objects[object.__unique_id]=object}this.getObjects().push(object);this.trigger("objectAdded");if(object.castShadow!==false){this.invalidateShadowMaps.call(object);object.on("transformed",this.invalidateShadowMaps)}return object};World.prototype.getObject=function(id){var k,len,object,ref;if(object=this._objects[id]){return object}ref=this.getObjects();for(k=0,len=ref.length;k<len;k++){object=ref[k];if(object.__unique_id===id){return object}}return null};World.prototype.removeObject=function(obj){var node,objectArray;delete this._objects[obj.__unique_id];objectArray=this.getObjects();objectArray.splice(objectArray.indexOf(obj),1);this.invalidateShadowMaps.call(obj);obj.off("transformed",this.invalidateShadowMaps);obj.off("transformed",this.updateOctree);if(node=this.octree.find(obj)){node.remove(obj);this.trigger("objectRemovedFromOctree")}this.trigger("objectRemoved");return obj};pickDataBuffers={};hashify=function(a,b,c,d){return(a.toFixed(6))+","+(b.toFixed(6))+","+(c.toFixed(6))+","+(d.toFixed(6))};World.prototype.parsePickData=function(rgba,array){var i,index,k,ref;for(i=k=2,ref=rgba.length;k<ref;i=k+=4){if(rgba[i]>0){index=Jax.Util.decodePickingColor(rgba[i-2],rgba[i-1],rgba[i],rgba[i+1]);if(index!==void 0&&array.indexOf(index)===-1){array.push(index)}}}return array};World.prototype.pickRegionalIndices=function(x1,y1,x2,y2,ary){var context,data,h,name,pickBuffer,ref,ref1,w,x,y;if(ary==null){ary=[]}ref=[Math.min(x1,x2),Math.min(y1,y2)],x=ref[0],y=ref[1];ref1=[Math.max(x1,x2)-x,Math.max(y1,y2)-y],w=ref1[0],h=ref1[1];ary.length=0;context=this.context;y=this.context.canvas.height-(y+h);data=pickDataBuffers[name=hashify(x,y,w,h)]||(pickDataBuffers[name]=new Uint8Array(w*h*4));pickBuffer=this.getPickBuffer();pickBuffer.bind(context);pickBuffer.viewport(context);context.gl.clear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT);context.gl.disable(GL_BLEND);this.render("picking");context.gl.enable(GL_BLEND);context.gl.readPixels(x,y,w,h,GL_RGBA,GL_UNSIGNED_BYTE,data);if(data.data){data=data.data}pickBuffer.unbind(context);context.viewport();return this.parsePickData(data,ary)};World.prototype.pickRegion=function(x1,y1,x2,y2,array){var i,k,ref,result;if(array==null){array=[]}result=this.pickRegionalIndices(x1,y1,x2,y2,array);for(i=k=0,ref=result.length;0<=ref?k<ref:k>ref;i=0<=ref?++k:--k){result[i]=Jax.Model.__instances[result[i]]}return result};singlePickArray=new Array(1);World.prototype.pickIndex=function(x,y){return this.pickRegionalIndices(x,y,x+1,y+1,singlePickArray)[0]};World.prototype.pick=function(x,y){return this.pickRegion(x,y,x+1,y+1,singlePickArray)[0]};World.prototype.countObjects=function(){return this.getObjects().length};World.prototype.getObjects=function(){return this._objectsArray};World.prototype.update=function(timechange){var k,len,object,ref,ref1,results;ref=this.getObjects();results=[];for(k=0,len=ref.length;k<len;k++){object=ref[k];if((ref1=object.camera)!=null){if(typeof ref1.update==="function"){ref1.update(timechange)}}results.push(typeof object.update==="function"?object.update(timechange):void 0)}return results};World.prototype.dispose=function(includeObjects){var k,l,len,len3,light,obj,ref,ref1;if(includeObjects==null){includeObjects=true}if(includeObjects){ref=this.getObjects().slice(0);for(k=0,len=ref.length;k<len;k++){obj=ref[k];this.removeObject(obj);obj.dispose(this.context)}}ref1=this.lights.splice(0);for(l=0,len3=ref1.length;l<len3;l++){light=ref1[l];this.removeLight(light);light.dispose(this.context)}this.ambientColor=new Jax.Color(0.05,0.05,0.05,1);this.trigger("disposed");return true};return World})()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.POINT_LIGHT=1;Jax.SPOT_LIGHT=2;Jax.DIRECTIONAL_LIGHT=3;Jax.Light=(function(superClass){var __maxSpotAngle,crMinIntensity,inRangeVec;extend(Light,superClass);__maxSpotAngle=Math.PI/2-Math.EPSILON;Light.getMaxSpotAngle=function(){return __maxSpotAngle};function Light(options){if(this.__proto__.constructor.name==="Light"){if(options!=null?options.type:void 0){switch(options.type){case"SPOT_LIGHT":case Jax.SPOT_LIGHT:options.type="Spot";break;case"POINT_LIGHT":case Jax.POINT_LIGHT:options.type="Point";break;case"DIRECTIONAL_LIGHT":case Jax.DIRECITONAL_LIGHT:options.type="Directional"}if(Jax.Light[options.type]){return new Jax.Light[options.type](options)}}}this.shadows=false;this.enabled=true;this._color=new Jax.Light.Color;this._attenuation=new Jax.Light.Attenuation;this.innerSpotAngle=Math.PI/4.375;this.outerSpotAngle=Math.PI/4;this.attenuation.on("constantChanged",(function(_this){return function(){return _this._maxEffectiveRangeCache=null}})(this));this.attenuation.on("linearChanged",(function(_this){return function(){return _this._maxEffectiveRangeCache=null}})(this));this.attenuation.on("quadraticChanged",(function(_this){return function(){return _this._maxEffectiveRangeCache=null}})(this));Light.__super__.constructor.call(this,options)}Light.define("color",{get:function(){return this._color},set:function(c){return this._color=new Jax.Light.Color(c)}});Light.define("attenuation",{get:function(){return this._attenuation},set:function(options){return this._attenuation=new Jax.Light.Attenuation(options)}});Light.define("direction",{get:function(){return this.camera.get("direction")},set:function(dir){return this.camera.setDirection(dir)}});Light.define("position",{get:function(){return this.camera.get("position")},set:function(pos){return this.camera.setPosition(pos)}});Light.define("innerSpotAngle",{get:function(){return this._innerSpotAngle},set:function(c){this._innerSpotAngle=c;this._innerSpotAngleCos=Math.cos(c/2);this.trigger("innerSpotAngleChanged",c);if(this._outerSpotAngle<c){return this.outerSpotAngle=c}}});Light.define("outerSpotAngle",{get:function(){return this._outerSpotAngle},set:function(c){this._outerSpotAngle=c;this._outerSpotAngleCos=Math.cos(c/2);this.trigger("outerSpotAngleChanged",c);if(this._innerSpotAngle>c){return this.innerSpotAngle=c}}});Light.define("outerSpotAngleCos",{get:function(){return this._outerSpotAngleCos}});Light.define("innerSpotAngleCos",{get:function(){return this._innerSpotAngleCos}});inRangeVec=vec3.create();Light.prototype.isInRange=function(model){var dist,objPos,radius,range,ref;radius=((ref=model.mesh)!=null?ref.bounds.radius:void 0)||0;objPos=model.position;dist=vec3.length(vec3.subtract(inRangeVec,objPos,this.position))-radius;range=this.maxEffectiveRange();return range===-1||range>=dist};Light.prototype.dispose=function(context){var ref;return(ref=this.shadowmap)!=null?ref.dispose(context):void 0};Light.prototype.rotate=function(amount,axisX,axisY,axisZ){return this.camera.rotate(amount,axisX,axisY,axisZ)};Light.prototype.eyeDirection=function(matrix,dest){dest||(dest=vec3.create());return vec3.normalize(dest,vec3.transformMat3(dest,this.camera.get("direction"),matrix))};Light.prototype.eyePosition=function(matrix,dest){return vec3.transformMat4(dest,this.camera.get("position"),matrix)};crMinIntensity=10/256;Light.prototype.maxEffectiveRange=function(rangeIncrement){var attenuation,distance;if(rangeIncrement==null){rangeIncrement=1}if(this._maxEffectiveRangeCache){return this._maxEffectiveRangeCache}attenuation=this.attenuation;if(attenuation.constant<Math.EPSILON||attenuation.linear<Math.EPSILON||attenuation.quadratic<Math.EPSILON||(attenuation.constant<(1/crMinIntensity)&&attenuation.linear<Math.EPSILON&&attenuation.quadratic<Math.EPSILON)){return this._maxEffectiveRangeCache=-1}distance=rangeIncrement;while(this.calculateIntensity(distance)>crMinIntensity){distance+=rangeIncrement}return this._maxEffectiveRangeCache=distance};Light.prototype.calculateIntensity=function(distance){return 1/(this.attenuation.constant+this.attenuation.linear*distance+this.attenuation.quadratic*distance*distance)};return Light})(Jax.Model);Jax.Scene||(Jax.Scene={});Jax.Scene.LightSource=(function(superClass){var notice;extend(LightSource,superClass);notice=function(){console.log("Please note that Jax.LightSource has been deprecated; it is now just Jax.Light.");return console.log("(You should also rename `app/assets/jax/resources/light_sources` to `app/assets/jax/resources/lights`.)")};function LightSource(options){notice();LightSource.__super__.constructor.call(this,options)}LightSource.find=function(){var ref;notice();return(ref=Jax.Light).find.apply(ref,arguments)};LightSource.addResources=function(){var ref;notice();return(ref=Jax.Light).addResources.apply(ref,arguments)};return LightSource})(Jax.Light);Jax.getGlobal().LightSource=Jax.LightSource=Jax.Scene.LightSource}).call(this);(function(){var slice=[].slice;Jax.Light.Attenuation=(function(){Attenuation.include(Jax.Mixins.EventEmitter);Attenuation.define("constant",{get:function(){return this._constant},set:function(v){this._constant=v;return this.trigger("constantChanged",v)}});Attenuation.define("linear",{get:function(){return this._linear},set:function(v){this._linear=v;return this.trigger("linearChanged",v)}});Attenuation.define("quadratic",{get:function(){return this._quadratic},set:function(v){this._quadratic=v;return this.trigger("quadraticChanged",v)}});function Attenuation(defaults){var ref;this.constant=0;this.linear=1;this.quadratic=0;if(defaults!=null?defaults.length:void 0){ref=slice.call(defaults),this.constant=ref[0],this.linear=ref[1],this.quadratic=ref[2]}else{if((defaults!=null?defaults.constant:void 0)!==void 0){this.constant=defaults.constant}if((defaults!=null?defaults.linear:void 0)!==void 0){this.linear=defaults.linear}if((defaults!=null?defaults.quadratic:void 0)!==void 0){this.quadratic=defaults.quadratic}}}return Attenuation})()}).call(this);(function(){Jax.Light.Color=(function(){Color.define("ambient",{get:function(){return this._ambient},set:function(c){return this._ambient=Jax.Color.parse(c)}});Color.define("diffuse",{get:function(){return this._diffuse},set:function(c){return this._diffuse=Jax.Color.parse(c)}});Color.define("specular",{get:function(){return this._specular},set:function(c){return this._specular=Jax.Color.parse(c)}});function Color(defaults){this.diffuse=new Jax.Color(0,0,0,1);this.specular=new Jax.Color(0,0,0,1);this.ambient=new Jax.Color(0,0,0,1);if(defaults){if(defaults.length||defaults.toVec4){this.diffuse=defaults;this.specular=defaults;this.ambient=defaults}else{if(defaults.diffuse!==void 0){this.diffuse=defaults.diffuse}if(defaults.specular!==void 0){this.specular=defaults.specular}if(defaults.ambient!==void 0){this.ambient=defaults.ambient}}}}return Color})()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Light.Directional=(function(superClass){extend(Directional,superClass);function Directional(options){Directional.__super__.constructor.call(this,options);this.innerSpotAngle=Math.PI;this.outerSpotAngle=Math.PI;this.type=Jax.DIRECTIONAL_LIGHT;this.shadowmap=new Jax.ShadowMap.Directional(this)}Directional.define("attenuation",{get:function(){return this._realAttenuation||(this._realAttenuation=new Jax.Light.Attenuation({constant:1,linear:0,quadratic:0}))}});return Directional})(Jax.Light)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Light.Point=(function(superClass){extend(Point,superClass);function Point(options){Point.__super__.constructor.call(this,options);this.innerSpotAngle=Math.PI*2;this.outerSpotAngle=Math.PI*2;this.type=Jax.POINT_LIGHT;this.shadowmap=new Jax.ShadowMap.Point(this)}return Point})(Jax.Light)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Light.Spot=(function(superClass){extend(Spot,superClass);function Spot(options){Spot.__super__.constructor.call(this,options);this.type=Jax.SPOT_LIGHT;this.shadowmap=new Jax.ShadowMap.Spot(this)}return Spot})(Jax.Light)}).call(this);(function(){Jax.ShadowMap=(function(){var illuminationArray;function ShadowMap(light){this.light=light;this._shadowMatrix=mat4.create();this._projectionMatrix=mat4.create();this._isValid=false;this.light.camera.on("change",(function(_this){return function(){return _this.invalidate()}})(this));this.biasMatrix=mat4.identity(mat4.create());this.clearColor=[0,0,0,0];this.cullFace=GL_FRONT;mat4.translate(this.biasMatrix,this.biasMatrix,[0.5,0.5,0.5]);mat4.scale(this.biasMatrix,this.biasMatrix,[0.5,0.5,0.5])}ShadowMap.getter("shadowMatrix",function(){if(!this.isValid()){this.validate()}return this._shadowMatrix});ShadowMap.getter("projectionMatrix",function(){if(!this.isValid()){this.validate()}return this._projectionMatrix});ShadowMap.prototype.bindTextures=function(context,vars,texture1){var ref;return vars[texture1]=(ref=this.shadowmapFBO)!=null?ref.getTexture(context,0):void 0};ShadowMap.prototype.setupProjection=function(projection){throw new Error("ShadowMap type "+this.__proto__.constructor.name+" did not initialize its projection matrix!")};ShadowMap.prototype.validate=function(context){var maxSize;if(context&&!this._isValid){if(!this._initialized){maxSize=context.renderer.getParameter(GL_MAX_RENDERBUFFER_SIZE);if(maxSize>1024){maxSize=1024}this.width=this.height=maxSize;this.shadowmapFBO=new Jax.Framebuffer({width:this.width,height:this.height,depth:true,color:{format:GL_RGBA,min_filter:GL_NEAREST,mag_filter:GL_NEAREST,generate_mipmap:false,flip_y:false}});this._initialized=true}this.setupProjection(this._projectionMatrix,context);mat4.copy(this._shadowMatrix,this.light.camera.get("inverseMatrix"));mat4.multiply(this._shadowMatrix,this._projectionMatrix,this._shadowMatrix);this._isValid=true;this.illuminate(context);return mat4.multiply(this._shadowMatrix,this.biasMatrix,this._shadowMatrix)}};ShadowMap.prototype.invalidate=function(){return this._isValid=this._isUpToDate=false};ShadowMap.prototype.dispose=function(context){var ref,ref1;if((ref=this.shadowmapFBO)!=null){ref.dispose(context)}return(ref1=this.illuminationFBO)!=null?ref1.dispose(context):void 0};ShadowMap.prototype.isValid=function(){return this._isValid};ShadowMap.prototype.setupMatrices=function(stack){stack.loadModelMatrix(mat4.IDENTITY);stack.loadViewMatrix(this.shadowMatrix);return stack.loadProjectionMatrix(mat4.IDENTITY)};ShadowMap.prototype.isDualParaboloid=function(){return false};ShadowMap.prototype.illuminate=function(context,material,fbo,capture){var clearColor,gl;if(material==null){material="depthmap"}if(fbo==null){fbo=this.shadowmapFBO}if(capture==null){capture=false}gl=context.renderer;clearColor=context.renderer.clearColor;fbo.bind(context,(function(_this){return function(){var cc;fbo.viewport(context);cc=_this.clearColor;gl.clearColor(cc[0],cc[1],cc[2],cc[3]);gl.clear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT);gl.disable(GL_BLEND);gl.enable(GL_POLYGON_OFFSET_FILL);if(_this.cullFace){gl.cullFace(_this.cullFace)}gl.polygonOffset(2,2);context.matrix_stack.push();_this.setupMatrices(context.matrix_stack);context.world.render(material,false);context.matrix_stack.pop();if(capture){return gl.readPixels(0,0,_this.width,_this.height,GL_RGBA,GL_UNSIGNED_BYTE,_this.illuminationData)}}})(this));gl.clearColor(clearColor[0],clearColor[1],clearColor[2],clearColor[3]);context.viewport();gl.polygonOffset(0,0);gl.disable(GL_POLYGON_OFFSET_FILL);gl.cullFace(GL_BACK);return gl.enable(GL_BLEND)};illuminationArray=[];ShadowMap.prototype.isIlluminated=function(model,context){var cullFace;this.validate(context);this.illuminationFBO||(this.illuminationFBO=new Jax.Framebuffer({width:this.width,height:this.height,depth:true,color:GL_RGBA}));this.illuminationData||(this.illuminationData=new Uint8Array(this.width*this.height*4));cullFace=this.cullFace;this.cullFace=null;this.illuminate(context,"picking",this.illuminationFBO,true);this.cullFace=cullFace;context.world.parsePickData(this.illuminationData,illuminationArray);return illuminationArray.indexOf(model.__unique_id)!==-1};return ShadowMap})()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.ShadowMap.Directional=(function(superClass){var center;extend(Directional,superClass);function Directional(){return Directional.__super__.constructor.apply(this,arguments)}center=vec3.create();Directional.prototype.setupProjection=function(projection,context){var count,dist,i,j,len,len1,length,obj,ref,ref1,ref2,sceneRadius;center[0]=center[1]=center[2]=0;count=0;ref=context.world.getObjects();for(i=0,len=ref.length;i<len;i++){obj=ref[i];if(!obj.castShadow){continue}count+=1;vec3.add(center,obj.camera.get("position"),center)}if(count>0){vec3.scale(center,center,1/count);this.light.camera.setPosition(center);sceneRadius=0;dist=vec3.create();ref1=context.world.getObjects();for(j=0,len1=ref1.length;j<len1;j++){obj=ref1[j];if(!obj.castShadow){continue}length=vec3.length(vec3.subtract(dist,center,obj.camera.get("position")))+((ref2=obj.mesh)!=null?ref2.bounds.radius:void 0);if(sceneRadius<length){sceneRadius=length}}if(sceneRadius===0){sceneRadius=1}sceneRadius+=0.1;return mat4.ortho(projection,-sceneRadius,sceneRadius,-sceneRadius,sceneRadius,-sceneRadius,sceneRadius)}else{return mat4.ortho(projection,-1,1,-1,1,-1,1)}};return Directional})(Jax.ShadowMap)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,slice=[].slice;Jax.ShadowMap.Point=(function(superClass){var relative;extend(Point,superClass);function Point(){var args;args=1<=arguments.length?slice.call(arguments,0):[];Point.__super__.constructor.apply(this,args);this.clearColor=[0,0,0,0];mat4.identity(this.biasMatrix)}Point.prototype.illuminate=function(context,material,fbo){var layer;if(material==null){material="paraboloid-depthmap"}if(fbo==null){fbo=this.shadowmapFBO}if(!this.backFBO){this.backFBO=new Jax.Framebuffer({width:this.width,height:this.height,depth:true,color:GL_RGBA})}material=Jax.Material.find(material);layer=material.findLayer(Jax.Material.Layer.Paraboloid);layer.paraboloidNear=this.paraboloidNear;layer.paraboloidFar=this.paraboloidFar;this.cullFace=GL_FRONT;layer.direction=1;Point.__super__.illuminate.call(this,context,material,fbo);this.cullFace=GL_BACK;layer.direction=-1;return Point.__super__.illuminate.call(this,context,material,this.backFBO)};Point.prototype.dispose=function(context){var ref;Point.__super__.dispose.call(this,context);return(ref=this.backFBO)!=null?ref.dispose(context):void 0};Point.prototype.isDualParaboloid=function(){return true};Point.prototype.bindTextures=function(context,vars,front,back){Point.__super__.bindTextures.call(this,context,vars,front);return vars[back]=this.backFBO.getTexture(context,0)};relative=vec3.create();Point.prototype.setupProjection=function(projection,context){var dist,far,id,mostDistant,obj,rangeIncrement,ref,ref1;mat4.identity(projection);mostDistant=0;ref=context.world.getObjects();for(id in ref){obj=ref[id];vec3.subtract(relative,this.light.position,obj.camera.get("position"));dist=vec3.length(relative)+((ref1=obj.mesh)!=null?ref1.bounds.radius:void 0);if(dist>mostDistant){mostDistant=dist}}rangeIncrement=(mostDistant/100)||0.1;far=this.light.maxEffectiveRange(rangeIncrement);if(far===-1){far=mostDistant}this.paraboloidNear=0.1;return this.paraboloidFar=far};return Point})(Jax.ShadowMap)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.ShadowMap.Spot=(function(superClass){var relative;extend(Spot,superClass);function Spot(){return Spot.__super__.constructor.apply(this,arguments)}relative=vec3.create();Spot.prototype.setupProjection=function(projection,context){var angle,aspect_ratio,dist,far,fov,id,mostDistant,near,obj,rangeIncrement,ref,ref1;mostDistant=0;ref=context.world.getObjects();for(id in ref){obj=ref[id];vec3.subtract(relative,this.light.position,obj.camera.get("position"));dist=vec3.length(relative)+((ref1=obj.mesh)!=null?ref1.bounds.radius:void 0);if(dist>mostDistant){mostDistant=dist}}rangeIncrement=(mostDistant/100)||0.1;far=this.light.maxEffectiveRange(rangeIncrement);if(far===-1){far=mostDistant}angle=this.light.outerSpotAngle;if(angle<=Math.EPSILON){angle=Math.EPSILON}angle+=Math.EPSILON;fov=angle;near=0.1;aspect_ratio=this.width/this.height;return mat4.perspective(projection,fov,aspect_ratio,near,far)};return Spot})(Jax.ShadowMap)}).call(this);(function(){Jax.TrackballControls={rotate_on_dragged:function(camera,x,y,dx,dy,w,h){var amplitude,cursorInducedQuat,r;amplitude=Math.TAU/2222;r=Math.min(w,h)/2;if(x*x+y*y<r*r){cursorInducedQuat=quat.multiply(quat.create(),quat.setAxisAngle(quat.create(),camera.up,-1*dx*amplitude),quat.setAxisAngle(quat.create(),camera.right,-1*dy*amplitude));camera.direction=vec3.transformQuat(vec3.create(),camera.direction,cursorInducedQuat);return camera.position=vec3.transformQuat(vec3.create(),camera.position,cursorInducedQuat)}else{return camera.roll(-1*(Math.sign(y)*dx+Math.sign(x)*dy)*amplitude)}},mouse_dragged:function(context,e){var h,w;w=context.canvas.width;h=context.canvas.height;Jax.TrackballControls.rotate_on_dragged(context.activeCamera,e.x-w/2,(e.y-h/2)*-1,e.diffx,e.diffy,w,h);return true},mouse_scrolled:function(context,e){var cam,delta,dist;cam=context.activeCamera;delta=e.originalEvent.wheelDeltaY;dist=vec3.length(cam.get("position"));if(dist<3&&delta>0){return}if(dist>9&&delta<0){return}cam.move(delta/1111);return true}}}).call(this);(function(){var _cameraQuat,_cameraQuatRi,_cameraQuatUp,_isAndroid,_is_camera_moving,_last_touchmove_x,_last_touchmove_y,_oldDirection,_sum_touchmove_x,_sum_touchmove_y,_too_small_dx,_too_small_dy,_vecDirection,_vecPosition,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;_is_camera_moving=false;_too_small_dx=Math.EPSILON;_too_small_dy=Math.EPSILON;_cameraQuat=quat.create();_cameraQuatUp=quat.create();_cameraQuatRi=quat.create();_oldDirection=vec3.create();_vecDirection=vec3.create();_vecPosition=vec3.create();_isAndroid=navigator.userAgent.match(/Android/i);_last_touchmove_x=null;_last_touchmove_y=null;_sum_touchmove_x=0;_sum_touchmove_y=0;Jax.CyxGameController=(function(superClass){var ACTIVE_ZONE_Z_BOUNDARY,CAMERA_FRICTION,DRAG_STRENGTH,MAX_CAMERA_DISTANCE,MIN_CAMERA_DISTANCE,TOUCH_DRAG_STRENGTH,_latest_swipe_gesture_processed;extend(CyxGameController,superClass);function CyxGameController(){this.leap_hand_translated=bind(this.leap_hand_translated,this);this.leap_gesture_swiped=bind(this.leap_gesture_swiped,this);return CyxGameController.__super__.constructor.apply(this,arguments)}CyxGameController.prototype.soundSystem=void 0;CyxGameController.prototype.isActiveWindow=true;CyxGameController.prototype.isReactingToControls=true;CyxGameController.prototype.canPlaceStones=true;CyxGameController.prototype.shouldRepositionCursor=false;CyxGameController.prototype.activateControls=function(){return this.isReactingToControls=true};CyxGameController.prototype.deactivateControls=function(){return this.isReactingToControls=false};CyxGameController.prototype.activateStonePlacement=function(){return this.canPlaceStones=true};CyxGameController.prototype.deactivateStonePlacement=function(){return this.canPlaceStones=false};CyxGameController.prototype.setupEverything=function(){if(window.debug!=null){this.setupFramerate()}this.setupCamera();this.setupInputs();this.setupLights();this.setupGeode();this.setupCursors();return this.setupSoundSystem()};CyxGameController.prototype.setupFramerate=function(){this.world.addObject(new Jax.Framerate({fill:"rgba(0, 164, 241, 255)",stroke:"rgba(0, 0, 0, 255)"}));return this};CyxGameController.prototype.setupCamera=function(){this.context.activeCamera.lookAt([0.00001,0.00001,5],[0,0,0],[0,0,1]);this.context.activeCamera.dx=0;this.context.activeCamera.dy=0;this.game.on("player_move",(function(_this){return function(move){if(move.player instanceof Cyx.Player.Bot){return _this.positionCameraAboveSubmesh(move.tile.submesh)}}})(this));return this};CyxGameController.prototype.setupInputs=function(){this.mouse={x:-1,y:-1};this.isReactingToControls=true;this.canPlaceStones=true;this.game.on("player_move",(function(_this){return function(move){_this.placeStoneModel(move.tile,_this.world,move.player);return true}})(this));this.isActiveWindow=true;window.addEventListener("blur",(function(_this){return function(e){return _this.isActiveWindow=false}})(this));window.addEventListener("focus",(function(_this){return function(e){return _this.isActiveWindow=true}})(this));this.jax.canvas.addEventListener("touchstart",(function(_this){return function(e){_last_touchmove_x=null;_last_touchmove_y=null;_sum_touchmove_x=0;_sum_touchmove_y=0;if(_isAndroid){e.preventDefault()}return true}})(this));this.jax.canvas.addEventListener("touchend",(function(_this){return function(e){var b,shouldClick,touch;shouldClick=false;if(e.changedTouches&&e.changedTouches.length){touch=e.changedTouches[0];if(_last_touchmove_x===null){shouldClick=true}else{b=_sum_touchmove_x+_sum_touchmove_y;if(b<17){shouldClick=true}}if(shouldClick){e.x=touch.pageX;e.y=touch.pageY;_this.mouse_clicked(e)}}return true}})(this));this.jax.canvas.addEventListener("touchmove",(function(_this){return function(e){var touch,x,y;if(e.touches&&e.touches.length){touch=e.touches[0];x=touch.screenX;y=touch.screenY;if(_last_touchmove_x!==null){e.diffx=x-_last_touchmove_x;e.diffy=y-_last_touchmove_y;_sum_touchmove_x+=Math.abs(e.diffx);_sum_touchmove_y+=Math.abs(e.diffy);_this.touch_moved(e)}_last_touchmove_x=x;_last_touchmove_y=y}return true}})(this));return this};CyxGameController.prototype.setupLights=function(){return this};CyxGameController.prototype.setupGeode=function(){this.geode=new Jax.Model({position:[0,0,0],mesh:new Jax.Mesh.LatticedGeodeDual({material:"geode",size:1.7,subdivisions:this.game.subdivisions})});this.world.addObject(this.geode);this.lattice=this.geode.mesh.lattice;window.dbglattice=this.lattice;return this};CyxGameController.prototype.setupFloatingShapes=function(){this.floatingFlower=new Jax.Model({position:[3,0,0],mesh:new Jax.Mesh.Plane({color:[0,0,0,0.8],material:new Jax.Material.Custom({layers:[{type:"Position"},{type:"VertexColor"},{type:"Texture",path:"img/uvs/geode/anthracite.png"}]}),size:1})});this.world.addObject(this.floatingFlower);return this};CyxGameController.prototype.setupCursors=function(){this.setupCrosshair();this.setupEtaba();this.setupGhost();this.setupLastGhost();this.htmlTarget=document.body;this.setPlayerCssTheme(this.game.activePlayer);this.game.on("turn_end",(function(_this){return function(e){_this.clearPlayerCssTheme();return _this.setPlayerCssTheme(_this.game.activePlayer)}})(this));this.game.on("game_over",(function(_this){return function(e){return _this.clearPlayerCssTheme()}})(this));return this};CyxGameController.prototype.setPlayerCssTheme=function(player){if(player.theme){this.htmlTarget.classList.add("player-"+player.theme)}return this};CyxGameController.prototype.clearPlayerCssTheme=function(){var i,len,p,ref;ref=this.game.players;for(i=0,len=ref.length;i<len;i++){p=ref[i];if(p.theme){this.htmlTarget.classList.remove("player-"+p.theme)}}return this};CyxGameController.prototype.setupEtaba=function(){this.etaba=this.world.addObject(Etaba.find("default"));this.etaba.setFillingColor(this.game.activePlayer.color);this.etaba.hide();this.etaba.on("action",(function(_this){return function(e){_this.game.tryMove(_this.etaba.targetSubmesh.tile);return _this.hideCursor()}})(this));this.game.on("turn_end",(function(_this){return function(e){_this.etaba.setFillingColor(_this.game.activePlayer.color);return true}})(this));return this};CyxGameController.prototype.setupGhost=function(){this.ghost=this.world.addObject(Ghost.find("default"));this.ghost.setColor(this.game.activePlayer.color);this.ghost.hide();this.game.on("turn_end",(function(_this){return function(e){_this.ghost.setColor(_this.game.activePlayer.color);return true}})(this));return this};CyxGameController.prototype.setupLastGhost=function(){this.lastGhost=this.world.addObject(Ghost.find("last_move"));this.lastGhost.setColor(this.game.activePlayer.color);this.lastGhost.hide();this.game.on("player_move",(function(_this){return function(e){_this.lastGhost.setColor(e.player.color);_this.lastGhost.showOn(e.tile.submesh);_this.ghost.positionOnSubmesh(e.tile.submesh);_this.lastGhost.alignWith(_this.ghost);return true}})(this));this.game.on("game_over",(function(_this){return function(e){_this.lastGhost.hide();return true}})(this));return this};CyxGameController.prototype.setupCrosshair=function(){this.game.on("turn_end",(function(_this){return function(e){_this.game.ui.setCrosshairColor(_this.game.activePlayer.color);return true}})(this));return this};CyxGameController.prototype.setupSoundSystem=function(){this.soundSystem=new Cyx.Sound.SoundSystem();this.game.on("player_move",(function(_this){return function(move){_this.soundSystem.play_sound_place_stone(move.tile);return true}})(this));this.soundSystem.on("play_start",(function(_this){return function(e){return true}})(this));this.soundSystem.on("play_stop",(function(_this){return function(e){return true}})(this));return this};CyxGameController.prototype.showCrosshair=function(){return this.game.ui.showCrosshair()};CyxGameController.prototype.hideCrosshair=function(){return this.game.ui.hideCrosshair()};CyxGameController.prototype.hideCursor=function(){this.ghost.hide();this.etaba.hide();return this};CyxGameController.prototype.repositionCursorAtCenter=function(){var selectedSubmesh;if(this.canPlaceStones&&this.shouldRepositionCursor){selectedSubmesh=Cyx.Util.findGeodeSubmeshClosestTo(this.context,this.geode,this.context.activeCamera.get("position"));if(selectedSubmesh&&this.game.isTiledGeodeSubmeshFree(selectedSubmesh)){this.ghost.showOn(selectedSubmesh);this.etaba.showOn(selectedSubmesh)}else{this.hideCursor()}}return this};CyxGameController.prototype.positionCameraAboveSubmesh=function(submesh){var camera,distance,newDirection,newPosition,normPosition;camera=this.context.activeCamera;distance=vec3.length(camera.get("position"));normPosition=vec3.normalize(vec3.create(),submesh.getCenter());newPosition=vec3.scale(vec3.create(),normPosition,distance);newDirection=vec3.negate(vec3.create(),normPosition);camera.animate({direction:newDirection,position:newPosition,easing:TWEEN.Easing.Sinusoidal.InOut});return this};CyxGameController.prototype.placeStoneModel=function(tile,world,player){var polygon,stone;polygon=tile.isPentagon?"pentagon":"hexagon";stone=world.addObject(Stone.find(polygon));stone.build_mesh(tile.submesh);stone.setColor(player.color);return tile.stone=stone};CyxGameController.prototype.encodeMoves=function(){var i,len,move,ref,s;s="";ref=this.game.moves;for(i=0,len=ref.length;i<len;i++){move=ref[i];s+=move.player.id+","+move.tile.coordinates.full.join(",")+";"}if(s){s=s.substring(0,s.length-1)}return LZString.compressToEncodedURIComponent(s)};CyxGameController.prototype.key_pressed=function(e){var arrowsStrength,targetSubmesh;if(!this.isReactingToControls){return false}arrowsStrength=0.0055555;if(e.keyCode===37){this.context.activeCamera.dx+=+1*arrowsStrength;this.shouldRepositionCursor=true;this.hideCursor();this.showCrosshair()}else{if(e.keyCode===38){this.context.activeCamera.dy+=+1*arrowsStrength;this.shouldRepositionCursor=true;this.hideCursor();this.showCrosshair()}else{if(e.keyCode===39){this.context.activeCamera.dx+=-1*arrowsStrength;this.shouldRepositionCursor=true;this.hideCursor();this.showCrosshair()}else{if(e.keyCode===40){this.context.activeCamera.dy+=-1*arrowsStrength;this.shouldRepositionCursor=true;this.hideCursor();this.showCrosshair()}else{if(e.keyCode===32||e.keyCode===13){targetSubmesh=this.ghost.targetSubmesh;if(this.canPlaceStones&&targetSubmesh){this.hideCursor();this.game.tryMove(targetSubmesh.tile)}}else{if(e.keyCode===27){this.game.ui.trigger("game_exit")}else{if(e.keyCode===77){this.soundSystem.toggleMute()}}}}}}}return true};CyxGameController.prototype.mouse_moved=function(e){var selectedSubmesh;this.mouse.x=e.x;this.mouse.y=e.y;if(!this.isReactingToControls||!this.canPlaceStones){return false}this.shouldRepositionCursor=false;selectedSubmesh=Cyx.Util.findSelectedGeodeSubmesh(this.context,this.geode,this.mouse.x,this.mouse.y);if(selectedSubmesh&&this.game.isTiledGeodeSubmeshFree(selectedSubmesh)){this.etaba.hide();this.ghost.showOn(selectedSubmesh);if(this.game.isTileImportant(selectedSubmesh.tile)){return this.ghost.setEmphasized()}else{return this.ghost.setNormal()}}else{return this.hideCursor()}};CyxGameController.prototype.mouse_clicked=function(e){var selectedSubmesh;this.mouse.x=e.x;this.mouse.y=e.y;if(!this.isReactingToControls||!this.canPlaceStones){return false}selectedSubmesh=Cyx.Util.findSelectedGeodeSubmesh(this.context,this.geode,this.mouse.x,this.mouse.y);if(selectedSubmesh){this.hideCursor();return this.game.tryMove(selectedSubmesh.tile)}};DRAG_STRENGTH=1/6600;CyxGameController.prototype.mouse_dragged=function(e){var camera,dx,dy;if(!this.isReactingToControls){return false}this.shouldRepositionCursor=false;dx=e.diffx*DRAG_STRENGTH*this.timechange*60;dy=e.diffy*DRAG_STRENGTH*this.timechange*60;camera=this.context.activeCamera;camera.dx+=dx;camera.dy+=dy;return true};MIN_CAMERA_DISTANCE=3;MAX_CAMERA_DISTANCE=9;CyxGameController.prototype.mouse_scrolled=function(e){var camera,delta,dist;if(!this.isReactingToControls){return false}camera=this.context.activeCamera;delta=e.originalEvent.wheelDeltaY/1111;if(delta===null||isNaN(delta)){delta=e.originalEvent.detail/11*-1}dist=vec3.length(camera.get("position"));if(dist<MIN_CAMERA_DISTANCE&&delta>0){return}if(dist>MAX_CAMERA_DISTANCE&&delta<0){return}camera.move(delta);return true};TOUCH_DRAG_STRENGTH=10;CyxGameController.prototype.touch_moved=function(e){var camera,dx,dy;if(!this.isReactingToControls){return false}this.shouldRepositionCursor=false;dx=e.diffx*DRAG_STRENGTH*this.timechange*60;dy=e.diffy*DRAG_STRENGTH*this.timechange*60;camera=this.context.activeCamera;camera.dx+=dx;camera.dy+=dy;return true};_latest_swipe_gesture_processed={id:0};CyxGameController.prototype.leap_gesture_swiped=function(e){if(e.gesture.id!==_latest_swipe_gesture_processed.id){_latest_swipe_gesture_processed=e.gesture;return this.game.ui.hideNotification()}};ACTIVE_ZONE_Z_BOUNDARY=77;CyxGameController.prototype.leap_hand_translated=function(e){var camera,dx,dy,dz,hand,palmPosition,strength,translation;if(!this.isActiveWindow||!this.isReactingToControls){return false}this.showCrosshair();camera=this.context.activeCamera;hand=e.hand;translation=e.translation;palmPosition=hand.palmPosition;if(palmPosition[2]>ACTIVE_ZONE_Z_BOUNDARY){this.shouldRepositionCursor=false;this.hideCursor();return false}else{this.shouldRepositionCursor=true}strength=this.timechange*Math.TAU/485;dx=translation[0]*strength;dy=translation[1]*strength;dz=translation[2]*strength;if(Math.abs(dz)>Math.abs(dy)){dy=-1*dz}camera.dx+=dx;camera.dy-=dy*1.5;return true};CyxGameController.prototype.timechange=1/60;CAMERA_FRICTION=0.955;CyxGameController.prototype.update=function(timechange){var adx,ady,camera,dx,dy;camera=this.context.activeCamera;dx=camera.dx*CAMERA_FRICTION;dy=camera.dy*CAMERA_FRICTION;this.timechange=timechange;adx=Math.abs(dx);ady=Math.abs(dy);if(adx>=_too_small_dx||ady>=_too_small_dy){_is_camera_moving=true}if(adx>0&&adx<_too_small_dx&&ady>0&&ady<_too_small_dy){if(_is_camera_moving){_is_camera_moving=false;this.repositionCursorAtCenter()}}if(_is_camera_moving){quat.setAxisAngle(_cameraQuatUp,camera.get("up"),-1*dx);quat.setAxisAngle(_cameraQuatRi,camera.get("right"),-1*dy);quat.multiply(_cameraQuat,_cameraQuatUp,_cameraQuatRi);vec3.copy(_oldDirection,camera.get("direction"));camera.setDirection(vec3.transformQuat(_vecDirection,_oldDirection,_cameraQuat),camera.get("up"));if(!vec3.equalish(_oldDirection,camera.get("direction"))){camera.setPosition(vec3.transformQuat(_vecPosition,camera.get("position"),_cameraQuat));this.repositionCursorAtCenter()}else{_too_small_dx=Math.max(_too_small_dx,adx);_too_small_dy=Math.max(_too_small_dy,ady);_is_camera_moving=false;this.repositionCursorAtCenter()}}camera.dx=dx;camera.dy=dy;return true};CyxGameController.prototype.show_point=function(point,color){if(point==null){point=[0,0,0]}if(color==null){color=[1,1,1,1]}return this.world.addObject(new Jax.Model({position:point,mesh:new Jax.Mesh.Icosahedron({size:0.008,color:color,material:new Jax.Material.Wire()})}))};return CyxGameController})(Jax.Controller)}).call(this);(function(){var GMF;GMF=window.GMF=window.GMF||{};GMF.Core||(GMF.Core={});GMF.Data||(GMF.Data={});GMF.Math||(GMF.Math={});GMF.Player||(GMF.Player={});GMF.Space||(GMF.Space={});GMF.Storage||(GMF.Storage={});GMF.UI||(GMF.UI={});GMF.Util||(GMF.Util={})}).call(this);(function(){GMF.Core.Game=(function(){function Game(options){if(options==null){options={}}}return Game})()}).call(this);(function(){GMF.Core.LinearScenario=(function(){LinearScenario.include(Jax.Mixins.EventEmitter);LinearScenario.prototype.steps=[];LinearScenario.prototype.advancement=0;function LinearScenario(storage,name1){this.storage=storage;this.name=name1!=null?name1:"scenario"}LinearScenario.prototype.registerStep=function(name){this.steps.push(name);return this};LinearScenario.prototype.completeStep=function(name,data){var index;if(data==null){data={}}index=this.steps.indexOf(name);if(index===this.advancement){this.advancement++;this.trigger(name+"_completed",data);data.step=name;data.first_time=true;this.save(name,data);this.trigger("scenario_advanced",data);if(this.advancement===this.steps.length){this.trigger("scenario_completed",data)}}return this};LinearScenario.prototype.getStepData=function(name){return this.storage.get(this.name+"_step_"+name)};LinearScenario.prototype.load=function(){var data,i,j,name,ref;this.advancement=this.storage.get(this.name+"_advancement");if(this.advancement===null){this.advancement=0}else{for(i=j=0,ref=this.advancement;j<ref;i=j+=1){name=this.steps[i];data=this.getStepData(name);data.first_time=false;this.trigger(name+"_completed",data);if(this.advancement===this.steps.length){this.trigger("scenario_completed",data)}}}return this};LinearScenario.prototype.save=function(name,data){this.storage.set(this.name+"_advancement",this.advancement);this.storage.set(this.name+"_step_"+name,data);return this};return LinearScenario})()}).call(this);(function(){GMF.Data.Color={orange:[1,0.4,0],cyan:[0,0.6,1]}}).call(this);(function(){var c1,c2,h,s1,s2;Math.mt_rand=function(min,max){var argc;argc=arguments.length;if(argc===0){min=0;max=2147483647}else{if(argc===1){throw new Error("Warning: mt_rand() expects exactly 2 parameters, 1 given")}else{min=parseInt(min,10);max=parseInt(max,10)}}return Math.floor(Math.random()*(max-min+1))+min};c1=(Math.sqrt(5)-1)/4;c2=(Math.sqrt(5)+1)/4;s1=(Math.sqrt(10+2*Math.sqrt(5)))/4;s2=(Math.sqrt(10-2*Math.sqrt(5)))/4;h=Math.sqrt(3)/2;GMF.Math.Pentagon={geometry:{top:{verticesCartesian:[[0,0],[0,1],[-s1,c1],[-s2,-c2],[s2,-c2],[s1,c1]]}}};GMF.Math.Hexagon={geometry:{top:{verticesCartesian:[[0,0],[0,1],[-h,0.5],[-h,-0.5],[0,-1],[h,-0.5],[h,0.5]]}}}}).call(this);(function(){Jax.Mixins.InvisibleModel={hide:function(){if(this.mesh){this._hiddenMesh=this.mesh}this.mesh=void 0;return this},show:function(){if(!this.mesh){this.mesh=this._hiddenMesh}return this}}}).call(this);(function(){GMF.Player.playerCount=0;GMF.Player.Player=(function(){Player.prototype.colorName=void 0;function Player(options){var key,value;if(options==null){options={}}this.id=GMF.Player.playerCount++;if(options.color){this.setColor(options.color);delete options.color}else{this.setColor([Math.random(),Math.random(),Math.random()])}if(options.name){this.setName(options.name);delete options.name}else{this.setName("Player #"+(this.id+1))}if(options){for(key in options){value=options[key];this[key]=value}}}Player.prototype.setColor=function(color){this.color=Jax.Util.colorize(color);return this};Player.prototype.setName=function(name){this.name=name;return this};return Player})()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;GMF.Player.Local=(function(superClass){extend(Local,superClass);function Local(options){if(options==null){options={}}Local.__super__.constructor.call(this,options)}return Local})(GMF.Player.Player)}).call(this);(function(){GMF.Space.GeodeVertexTile=(function(){function GeodeVertexTile(lattice,coordinates){this.lattice=lattice;if(!coordinates||coordinates.length!==8){throw new Error("An array of 8 coordinates is required")}this.isPentagon=false;this.isHexagon=true;this.setCoordinates(coordinates)}GeodeVertexTile.prototype.setCoordinates=function(coordinates){var a,b,c;this.coordinates={full:coordinates.slice(0),face:coordinates.slice(0,5),major:coordinates.slice(0,2),minor:coordinates.slice(2,5),bary:coordinates.slice(5,8)};a=coordinates[5];b=coordinates[6];c=coordinates[7];if((a>0&&b===0&&c===0)||(a===0&&b>0&&c===0)||(a===0&&b===0&&c>0)){this.isPentagon=true;this.isHexagon=false}return void 0};GeodeVertexTile.prototype.is=function(coordinates){var it,me;me=this.coordinates.full;it=coordinates;return me[0]===it[0]&&me[1]===it[1]&&me[2]===it[2]&&me[3]===it[3]&&me[4]===it[4]&&me[5]===it[5]&&me[6]===it[6]&&me[7]===it[7]};GeodeVertexTile.prototype.isOnSameIcosaFaceThan=function(otherTile){var it,me;me=this.coordinates.face;it=otherTile.coordinates.face;return me[0]===it[0]&&me[1]===it[1]&&me[2]===it[2]&&me[3]===it[3]&&me[4]===it[4]};GeodeVertexTile.prototype.getHexAxisOfAdjacency=function(withAdjacentTile){var axisDeltas,coord,delta,hexAxis,i,len;axisDeltas=this.lattice.bl.directions;for(hexAxis=i=0,len=axisDeltas.length;i<len;hexAxis=++i){delta=axisDeltas[hexAxis];coord=Goutte.Math.Tuple.clone(this.coordinates.full);coord[5]+=delta[0];coord[6]+=delta[1];coord[7]+=delta[2];this.lattice.normalize(coord);if(this.lattice.findTileAt(coord)===withAdjacentTile){return hexAxis}}throw new Error("Tile "+this.coordinates.full.join()+" not adjacent to "+withAdjacentTile.coordinates.full.join())};GeodeVertexTile.prototype.toString=function(){return""+(this.coordinates.full.join(","))};return GeodeVertexTile})()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;GMF.Space.GeodeVertexTileHexagon=(function(superClass){extend(GeodeVertexTileHexagon,superClass);function GeodeVertexTileHexagon(){return GeodeVertexTileHexagon.__super__.constructor.apply(this,arguments)}GeodeVertexTileHexagon.prototype.directionsCount=6;GeodeVertexTileHexagon.prototype.rotateDirection=function(direction,offsetToTheLeft){return(direction+(offsetToTheLeft%6)+6)%6};GeodeVertexTileHexagon.prototype.oppositeDirection=function(direction){return this.rotateDirection(direction,3)};GeodeVertexTileHexagon.prototype.getDirectionOfAdjacencyWith=function(adjacentTile){var axisDeltas,coord,delta,hexAxis,i,len;axisDeltas=this.lattice.bl.directions;for(hexAxis=i=0,len=axisDeltas.length;i<len;hexAxis=++i){delta=axisDeltas[hexAxis];coord=Goutte.Math.Tuple.clone(this.coordinates.full);coord[5]+=delta[0];coord[6]+=delta[1];coord[7]+=delta[2];this.lattice.normalize(coord);if(this.lattice.findTileAt(coord)===adjacentTile){return hexAxis}}throw new Error("Tile "+this.coordinates.full.join()+" not adjacent to "+adjacentTile.coordinates.full.join())};GeodeVertexTileHexagon.prototype.getNeighbors=function(){var bary,barys,coord,i,len,neighbors;neighbors=[];barys=this.lattice.bl.findNeighbors(this.coordinates.bary);for(i=0,len=barys.length;i<len;i++){bary=barys[i];coord=Goutte.Math.Tuple.clone(this.coordinates.full);coord[5]=bary[0];coord[6]=bary[1];coord[7]=bary[2];this.lattice.normalize(coord);neighbors.push(this.lattice.findTileAt(coord))}return neighbors};GeodeVertexTileHexagon.prototype.getAdjacent=function(hexDirection){var baryDelta,coord;baryDelta=this.lattice.bl.directions[hexDirection];coord=Goutte.Math.Tuple.clone(this.coordinates.full);coord[5]+=baryDelta[0];coord[6]+=baryDelta[1];coord[7]+=baryDelta[2];this.lattice.normalize(coord);return this.lattice.findTileAt(coord)};return GeodeVertexTileHexagon})(GMF.Space.GeodeVertexTile)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;GMF.Space.GeodeVertexTilePentagon=(function(superClass){extend(GeodeVertexTilePentagon,superClass);function GeodeVertexTilePentagon(){return GeodeVertexTilePentagon.__super__.constructor.apply(this,arguments)}GeodeVertexTilePentagon.prototype.directionsCount=5;GeodeVertexTilePentagon.prototype.rotateDirection=function(direction,unitsToTheLeft){if(unitsToTheLeft==null){unitsToTheLeft=0}return(direction+(unitsToTheLeft%5)+5)%5};GeodeVertexTilePentagon.prototype.oppositeDirection=function(direction){throw new Error("Hexagons cannot flexagon !")};GeodeVertexTilePentagon.prototype.getDirectionOfAdjacencyWith=function(adjacentTile){var j,k,len,neighbor,neighbors;neighbors=this.getNeighbors();for(k=j=0,len=neighbors.length;j<len;k=++j){neighbor=neighbors[k];if(neighbor===adjacentTile){return k}}throw new Error("Tile "+this.coordinates.full.join()+" not adjacent to "+adjacentTile.coordinates.full.join())};GeodeVertexTilePentagon.prototype.getNeighbors=function(){var axis,bary,coord,face,faces,i,j,l,len,neighbors,tile;neighbors=[];bary=this.coordinates.bary;axis=bary.indexOf(this.lattice.bl.scale);faces=this.lattice.findIcosafacesAroundIcosafaceVertex(this.coordinates.face,axis);for(j=0,len=faces.length;j<len;j++){face=faces[j];for(i=l=1;l<=2;i=l+=1){coord=Goutte.Math.Tuple.clone(face[1]);coord.push.apply(coord,bary);coord[5+(axis+0)%3]--;coord[5+(axis+i)%3]++;Goutte.Math.Tuple.applySubCycle(coord,5,7,axis-face[0]);if(this.lattice.isNormal(coord)){tile=this.lattice.findTileAt(coord);neighbors.push(tile)}}}return neighbors};GeodeVertexTilePentagon.prototype.getAdjacent=function(pentDirection){var adjacent,adjacents;adjacents=this.getNeighbors();adjacent=adjacents[((pentDirection%5)+5)%5];if(!adjacent){throw new Error("No adjacent tile in direction "+pentDirection)}return adjacent};return GeodeVertexTilePentagon})(GMF.Space.GeodeVertexTile)}).call(this);(function(){GMF.Space.GeodeVerticesLattice=(function(){GeodeVerticesLattice.prototype._lexicalTiles=[];GeodeVerticesLattice.prototype._hashedTiles={};function GeodeVerticesLattice(options){this.options=options!=null?options:{};this.subdivisions=this.options.subdivisions||0;this.a5=new Goutte.Math.AlternatingGroup5();this.bl=new Goutte.Math.BarycentricLattice({subdivisions:this.subdivisions})}GeodeVerticesLattice.prototype._createTile=function(tileCoordinates){var a,b,c,tile;a=tileCoordinates[5];b=tileCoordinates[6];c=tileCoordinates[7];if((a>0&&b===0&&c===0)||(a===0&&b>0&&c===0)||(a===0&&b===0&&c>0)){tile=new GMF.Space.GeodeVertexTilePentagon(this,tileCoordinates)}else{tile=new GMF.Space.GeodeVertexTileHexagon(this,tileCoordinates)}return tile};GeodeVerticesLattice.prototype._computeTiles=function(){var bary,barys,hash,j,l,len,len1,p,permutations,tile,tileCoords;this._lexicalTiles=[];permutations=this.a5.getAllPermutations();barys=this.bl.getAllPositiveTiles();for(j=0,len=permutations.length;j<len;j++){p=permutations[j];for(l=0,len1=barys.length;l<len1;l++){bary=barys[l];tileCoords=[p[0],p[1],p[2],p[3],p[4],bary[0],bary[1],bary[2]];hash=tileCoords.join("");this.normalize(tileCoords);if(tileCoords.join("")===hash){tile=this._createTile(tileCoords);this._lexicalTiles.push(tile);this._indexTile(tile)}}}return this._lexicalTiles};GeodeVerticesLattice.prototype._indexTile=function(tile){var hash;this._hashedTiles=this._hashedTiles||{};hash=tile.coordinates.full.join("");this._hashedTiles[hash]=tile;return void 0};GeodeVerticesLattice.prototype.getAllTiles=function(){if(!this._lexicalTiles.length){this._lexicalTiles=this._computeTiles()}return this._lexicalTiles};GeodeVerticesLattice.prototype.getTilesValidating=function(validator){var j,len,ref,tile,tiles;tiles=[];ref=this.getAllTiles();for(j=0,len=ref.length;j<len;j++){tile=ref[j];if(validator(tile)){tiles.push(tile)}}return tiles};GeodeVerticesLattice.prototype.getRandomEmptyTile=function(){var emptyTiles,j,len,ref,tile;emptyTiles=[];ref=this.getAllTiles();for(j=0,len=ref.length;j<len;j++){tile=ref[j];if(tile.owner===void 0){emptyTiles.push(tile)}}if(emptyTiles.length===0){return void 0}return GMF.Util.getRandomArrayValue(emptyTiles)};GeodeVerticesLattice.prototype.findTileAt=function(coordinates){var hash,tile;if(!this._lexicalTiles.length){this._lexicalTiles=this._computeTiles()}this.normalize(coordinates);hash=coordinates.join("");tile=this._hashedTiles[hash];if(tile){return tile}throw new Error("No tile found at ("+coordinates.join()+")")};GeodeVerticesLattice.prototype.isNormal=function(coordinates){var hash;hash=coordinates.join("");this.normalize(coordinates);return hash===coordinates.join("")};GeodeVerticesLattice.prototype.contains=function(tileCoordinates){var a5Valid,blValid;if(tileCoordinates.length!==8){throw new Error("Invalid tile coordinates")}a5Valid=this.a5.contains(tileCoordinates.slice(0,5));blValid=this.bl.contains(tileCoordinates.slice(5,8));return blValid&&a5Valid};GeodeVerticesLattice.prototype.getOffsetOfMinor=function(tileCoordinates){var actual,j,k,n,offset;actual=tileCoordinates[2];offset=0;for(k=j=1;j<=2;k=j+=1){n=tileCoordinates[k+2];if(n<actual){offset=k;actual=n}}return offset};GeodeVerticesLattice.prototype.normalize=function(tileCoordinates){var _tileTuple,a,adjacent,adjacentMajor,axisAndFaces,axisValue,b,c,comparison,flipAdjacencyAxis,majorRotationCoords,minimumSupported,minorOffset,tileAdjacencyAxis;minorOffset=this.getOffsetOfMinor(tileCoordinates);if(minorOffset>0){Goutte.Math.Tuple.applySubCycle(tileCoordinates,2,4,minorOffset);Goutte.Math.Tuple.applySubCycle(tileCoordinates,5,7,minorOffset)}majorRotationCoords=tileCoordinates.slice(0,2);a=tileCoordinates[5];b=tileCoordinates[6];c=tileCoordinates[7];if(a>0&&b>0&&c>0){return tileCoordinates}_tileTuple=Goutte.Math.Tuple.clone(tileCoordinates);if(a<0&&b<0||a<0&&c<0||b<0&&c<0){throw new Error("Only edge-flipping is supported ATM, cannot normalize ("+tileCoordinates.join()+")")}minimumSupported=this.bl.scale*-1;if(a<minimumSupported||b<minimumSupported||c<minimumSupported){throw new Error("Only one edge-flip is supported ATM, cannot normalize ("+tileCoordinates.join()+")")}tileAdjacencyAxis=-1;if(a<0&&b>=0&&c>=0){tileAdjacencyAxis=0}if(a>=0&&b<0&&c>=0){tileAdjacencyAxis=1}if(a>=0&&b>=0&&c<0){tileAdjacencyAxis=2}if(tileAdjacencyAxis>-1){adjacent=this.a5.expandPrefixLexicographically(this._getMajorOfAdjacentFace(_tileTuple,tileAdjacencyAxis));Goutte.Math.Tuple.copy(tileCoordinates,adjacent);tileCoordinates[5+tileAdjacencyAxis]*=-1;axisValue=tileCoordinates[5+tileAdjacencyAxis];tileCoordinates[5+(tileAdjacencyAxis+1)%3]=_tileTuple[5+(tileAdjacencyAxis+2)%3]-axisValue;tileCoordinates[5+(tileAdjacencyAxis+2)%3]=_tileTuple[5+(tileAdjacencyAxis+1)%3]-axisValue;flipAdjacencyAxis=this._findAdjacencyAxis(tileCoordinates,_tileTuple);Goutte.Math.Tuple.applySubCycle(tileCoordinates,5,7,tileAdjacencyAxis-flipAdjacencyAxis);return tileCoordinates}tileAdjacencyAxis=-1;if(a>0&&b===0&&c===0){tileAdjacencyAxis=0}if(a===0&&b>0&&c===0){tileAdjacencyAxis=1}if(a===0&&b===0&&c>0){tileAdjacencyAxis=2}if(tileAdjacencyAxis>-1){axisAndFaces=this.findIcosafacesAroundIcosafaceVertex(_tileTuple,tileAdjacencyAxis);axisAndFaces.sort(function(a,b){return Goutte.Math.Tuple.compareLexicographically(a[1],b[1])});Goutte.Math.Tuple.copy(tileCoordinates,axisAndFaces[0][1]);minorOffset=tileAdjacencyAxis-axisAndFaces[0][0];Goutte.Math.Tuple.applySubCycle(tileCoordinates,5,7,minorOffset);return tileCoordinates}tileAdjacencyAxis=-1;if(a===0&&b>0&&c>0){tileAdjacencyAxis=0}if(a>0&&b===0&&c>0){tileAdjacencyAxis=1}if(a>0&&b>0&&c===0){tileAdjacencyAxis=2}if(tileAdjacencyAxis>-1){adjacentMajor=this._getMajorOfAdjacentFace(_tileTuple,tileAdjacencyAxis);comparison=Goutte.Math.Tuple.compareLexicographically(majorRotationCoords,adjacentMajor);if(comparison>0){this.a5.expandPrefixLexicographically(adjacentMajor);Goutte.Math.Tuple.copy(tileCoordinates,adjacentMajor);flipAdjacencyAxis=this._findAdjacencyAxis(tileCoordinates,_tileTuple);tileCoordinates[5+(flipAdjacencyAxis+0)%3]=0;tileCoordinates[5+(flipAdjacencyAxis+1)%3]=_tileTuple[5+(tileAdjacencyAxis+2)%3];tileCoordinates[5+(flipAdjacencyAxis+2)%3]=_tileTuple[5+(tileAdjacencyAxis+1)%3];return tileCoordinates}}return tileCoordinates};GeodeVerticesLattice.prototype.findIcosafacesAroundIcosafaceVertex=function(icosaface,axis){var d,data,f,i,icosafaces,j,k,l,len,len1,m0,m1,offset,v0,v1,v2;m0=icosaface[0];m1=icosaface[1];v0=icosaface[2+(axis+0)%3];v1=icosaface[2+(axis+1)%3];v2=icosaface[2+(axis+2)%3];icosafaces=[];data=[[[m0,m1],v0],[[v2,v0],m0],[[v1,m0],v2],[[m1,v2],v1],[[v0,v1],m1]];i=-1;for(k=j=0,len=data.length;j<len;k=++j){d=data[k];if(d[1]===0){i=k;break}}if(i>=0){Goutte.Math.Tuple.applySubCycle(data,0,data.length-1,i)}for(l=0,len1=data.length;l<len1;l++){d=data[l];f=this.a5.expandPrefixLexicographically(d[0]);offset=f.indexOf(d[1])-2;icosafaces.push([offset,f])}return icosafaces};GeodeVerticesLattice.prototype._findAdjacencyAxis=function(ofFace,withFace){if(ofFace[3]===withFace[0]&&ofFace[4]===withFace[1]){return 0}if(ofFace[4]===withFace[0]&&ofFace[2]===withFace[1]){return 1}if(ofFace[2]===withFace[0]&&ofFace[3]===withFace[1]){return 2}throw new Error("Faces not adjacent or not 5-tuples")};GeodeVerticesLattice.prototype._getMajorOfAdjacentFace=function(faceTuple,axisIndex){var mrcoaf;mrcoaf=new Goutte.Math.Tuple.create(2);if(axisIndex===0){mrcoaf[0]=faceTuple[3];mrcoaf[1]=faceTuple[4]}else{if(axisIndex===1){mrcoaf[0]=faceTuple[4];mrcoaf[1]=faceTuple[2]}else{if(axisIndex===2){mrcoaf[0]=faceTuple[2];mrcoaf[1]=faceTuple[3]}else{throw new Error("Invalid axisIndex : "+axisIndex)}}}return mrcoaf};GeodeVerticesLattice.prototype.findTileAdjacentToHexTile=function(hexTile,hexDirection){var baryDelta,coord;if(hexTile.isPentagon){throw new Error("No pentagons allowed")}baryDelta=this.bl.directions[hexDirection];coord=Goutte.Math.Tuple.clone(hexTile.coordinates.full);coord[5]+=baryDelta[0];coord[6]+=baryDelta[1];coord[7]+=baryDelta[2];this.normalize(coord);return this.findTileAt(coord)};GeodeVerticesLattice.prototype.findNeighbors=function(ofTile){var axis,bary,barys,coord,face,faces,i,j,l,len,len1,m,neighbors,tile;neighbors=[];if(ofTile.isPentagon){axis=ofTile.coordinates.bary.indexOf(this.bl.scale);faces=this.findIcosafacesAroundIcosafaceVertex(ofTile.coordinates.face,axis);bary=ofTile.coordinates.bary;for(j=0,len=faces.length;j<len;j++){face=faces[j];for(i=l=1;l<=2;i=l+=1){coord=Goutte.Math.Tuple.clone(face[1]);coord.push.apply(coord,bary);coord[5+(axis+0)%3]--;coord[5+(axis+i)%3]++;Goutte.Math.Tuple.applySubCycle(coord,5,7,axis-face[0]);if(this.isNormal(coord)){tile=this.findTileAt(coord);neighbors.push(tile)}}}}else{barys=this.bl.findNeighbors(ofTile.coordinates.bary);for(m=0,len1=barys.length;m<len1;m++){bary=barys[m];coord=Goutte.Math.Tuple.clone(ofTile.coordinates.full);coord[5]=bary[0];coord[6]=bary[1];coord[7]=bary[2];this.normalize(coord);tile=this.findTileAt(coord);neighbors.push(tile)}}return neighbors};return GeodeVerticesLattice})()}).call(this);(function(){GMF.Storage.LocalStorage=(function(){function LocalStorage(){}LocalStorage.prototype.get=function(key){var value;value=window.localStorage.getItem(key);if(value!==null){value=JSON.parse(value)}return value};LocalStorage.prototype.set=function(key,value){if(typeof value!=="undefined"){value=JSON.stringify(value);window.localStorage.setItem(key,value)}return void 0};return LocalStorage})()}).call(this);(function(){GMF.UI.Base=(function(){Base.include(Jax.Mixins.EventEmitter);function Base(jQuery,elements){var $,jElement,key,value;this.jQuery=jQuery;if(elements==null){elements={}}if(!this.jQuery){throw new Error("jQuery is a dependency")}$=this.jQuery;this.elements=[];if(elements){for(key in elements){value=elements[key];if(typeof value==="string"||value instanceof String){jElement=this[key]=$(value);this.elements.push(jElement)}}}$("*[data-show-on]").each(function(index){var element,event;element=$(this);event=element.attr("data-show-on");return element.on(event,function(e){if(e.currentTarget===e.target){return $(this).removeClass("hidden")}})});$("*[data-hide-on]").each(function(index){var element,event;element=$(this);event=element.attr("data-hide-on");return element.on(event,function(e){if(e.currentTarget===e.target){return $(this).addClass("hidden")}})});$("*[data-load-on]").each(function(index){var element,event;element=$(this);event=element.attr("data-load-on");return element.on(event,function(e){if(e.currentTarget===e.target){return $(this).addClass("loaded")}})})}Base.prototype._getElementsWithListeners=function(){return this.jQuery("*[data-show-on],*[data-hide-on],*[data-load-on]").add(this.elements)};Base.prototype.trigger=function(name,event){var element,i,j,len,len1,listener,ref,ref1;ref=this.getEventListeners(name);for(i=0,len=ref.length;i<len;i++){listener=ref[i];listener.call(this,event)}ref1=this._getElementsWithListeners();for(j=0,len1=ref1.length;j<len1;j++){element=ref1[j];this.jQuery(element).trigger(name,event)}return true};return Base})()}).call(this);(function(){$(function(){$.gmfNotification=function(element,options){var appendCloseButton,centerInWindow,hideOnClick,setState,state,wrapInnerElement;this.defaults={show:true,showClass:"fadeIn",hideClass:"fadeOut",animationDuration:1000,innerDivClass:"inner",closeButton:false,closeButtonText:"close",closeButtonClass:"close",hideOnClick:true,onLoad:function(){return{}},onVisible:function(){return{}},onHide:function(){return{}},onHidden:function(){return{}}};state="";this.settings={};this.$element=$(element);setState=function(_state){return state=_state};centerInWindow=(function(_this){return function(){var left,top;left=(($(window)).width()-_this.$element.outerWidth())/2;top=(($(window)).height()-_this.$element.outerHeight())/2;_this.$element.css("top",top);return _this.$element.css("left",left)}})(this);wrapInnerElement=(function(_this){return function(){_this.$elementInner=$("<div />",{"class":_this.getSetting("innerDivClass")});return _this.$element.wrapInner(_this.$elementInner)}})(this);appendCloseButton=(function(_this){return function(){var $closeButton;$closeButton=$("<a />",{"class":_this.getSetting("closeButtonClass"),html:_this.getSetting("closeButtonText")});_this.$element.children().append($closeButton);return $closeButton.bind("click",function(){return _this.hide()})}})(this);hideOnClick=(function(_this){return function(e){if(_this.getState()!=="hidden"&&e.target.tagName!=="A"){return _this.hide()}}})(this);this.getState=function(){return state};this.getSetting=function(settingKey){return this.settings[settingKey]};this.callSettingFunction=function(functionName){return this.settings[functionName](element)};this.init=function(){setState("hidden");this.settings=$.extend({},this.defaults,options);if(!this.$element.length){return}wrapInnerElement();if(this.getSetting("closeButton")){appendCloseButton()}if(this.getSetting("show")){this.show()}if(this.getSetting("hideOnClick")){return $(document.body).on("click",hideOnClick)}};this.show=function(){if(this.getState()==="visible"){return}centerInWindow();this.callSettingFunction("onLoad");this.$element.removeClass("hidden");this.$element.removeClass(this.getSetting("hideClass"));this.$element.addClass(this.getSetting("showClass"));return setTimeout((function(_this){return function(){setState("visible");return _this.callSettingFunction("onVisible")}})(this),this.getSetting("animationDuration"))};this.hide=function(){if(this.getState()==="hidden"){return}setState("hidden");this.callSettingFunction("onHide");this.$element.removeClass(this.getSetting("showClass"));this.$element.addClass(this.getSetting("hideClass"));if(this.getSetting("hideOnClick")){$(document.body).off("click",hideOnClick)}return setTimeout((function(_this){return function(){_this.$element.addClass("hidden");return _this.callSettingFunction("onHidden")}})(this),this.getSetting("animationDuration"))};this.init();return this};return $.fn.gmfNotification=function(options){return this.each(function(){var plugin;plugin=$(this).data("gmfNotification");if(plugin===void 0){plugin=new $.gmfNotification(this,options);return $(this).data("gmfNotification",plugin)}else{return plugin.show()}})}})}).call(this);(function(){GMF.Util.getRandomArrayValue=function(array){return array[Math.floor(Math.random()*array.length)]};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}}).call(this);(function(factory){if(typeof define==="function"&&define.amd){if(typeof jQuery!=="undefined"){define(["jquery"],factory)}else{define([],factory)}}else{if(typeof jQuery!=="undefined"){factory(jQuery)}else{factory()}}})(function($,undefined){var tag2attr={a:"href",img:"src",form:"action",base:"href",script:"src",iframe:"src",link:"href"},key=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],aliases={anchor:"fragment"},parser={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},toString=Object.prototype.toString,isint=/^[0-9]+$/;function parseUri(url,strictMode){var str=decodeURI(url),res=parser[strictMode||false?"strict":"loose"].exec(str),uri={attr:{},param:{},seg:{}},i=14;while(i--){uri.attr[key[i]]=res[i]||""}uri.param.query=parseString(uri.attr.query);uri.param.fragment=parseString(uri.attr.fragment);uri.seg.path=uri.attr.path.replace(/^\/+|\/+$/g,"").split("/");uri.seg.fragment=uri.attr.fragment.replace(/^\/+|\/+$/g,"").split("/");uri.attr.base=uri.attr.host?(uri.attr.protocol?uri.attr.protocol+"://"+uri.attr.host:uri.attr.host)+(uri.attr.port?":"+uri.attr.port:""):"";return uri}function getAttrName(elm){var tn=elm.tagName;if(typeof tn!=="undefined"){return tag2attr[tn.toLowerCase()]}return tn}function promote(parent,key){if(parent[key].length==0){return parent[key]={}}var t={};for(var i in parent[key]){t[i]=parent[key][i]}parent[key]=t;return t}function parse(parts,parent,key,val){var part=parts.shift();if(!part){if(isArray(parent[key])){parent[key].push(val)}else{if("object"==typeof parent[key]){parent[key]=val}else{if("undefined"==typeof parent[key]){parent[key]=val}else{parent[key]=[parent[key],val]}}}}else{var obj=parent[key]=parent[key]||[];if("]"==part){if(isArray(obj)){if(""!=val){obj.push(val)}}else{if("object"==typeof obj){obj[keys(obj).length]=val}else{obj=parent[key]=[parent[key],val]}}}else{if(~part.indexOf("]")){part=part.substr(0,part.length-1);if(!isint.test(part)&&isArray(obj)){obj=promote(parent,key)}parse(parts,obj,part,val)}else{if(!isint.test(part)&&isArray(obj)){obj=promote(parent,key)}parse(parts,obj,part,val)}}}}function merge(parent,key,val){if(~key.indexOf("]")){var parts=key.split("["),len=parts.length,last=len-1;parse(parts,parent,"base",val)}else{if(!isint.test(key)&&isArray(parent.base)){var t={};for(var k in parent.base){t[k]=parent.base[k]}parent.base=t}set(parent.base,key,val)}return parent}function parseString(str){return reduce(String(str).split(/&|;/),function(ret,pair){try{pair=decodeURIComponent(pair.replace(/\+/g," "))}catch(e){}var eql=pair.indexOf("="),brace=lastBraceInKey(pair),key=pair.substr(0,brace||eql),val=pair.substr(brace||eql,pair.length),val=val.substr(val.indexOf("=")+1,val.length);if(""==key){key=pair,val=""}return merge(ret,key,val)},{base:{}}).base}function set(obj,key,val){var v=obj[key];if(undefined===v){obj[key]=val}else{if(isArray(v)){v.push(val)}else{obj[key]=[v,val]}}}function lastBraceInKey(str){var len=str.length,brace,c;for(var i=0;i<len;++i){c=str[i];if("]"==c){brace=false}if("["==c){brace=true}if("="==c&&!brace){return i}}}function reduce(obj,accumulator){var i=0,l=obj.length>>0,curr=arguments[2];while(i<l){if(i in obj){curr=accumulator.call(undefined,curr,obj[i],i,obj)}++i}return curr}function isArray(vArg){return Object.prototype.toString.call(vArg)==="[object Array]"}function keys(obj){var keys=[];for(prop in obj){if(obj.hasOwnProperty(prop)){keys.push(prop)}}return keys}function purl(url,strictMode){if(arguments.length===1&&url===true){strictMode=true;url=undefined}strictMode=strictMode||false;url=url||window.location.toString();return{data:parseUri(url,strictMode),attr:function(attr){attr=aliases[attr]||attr;return typeof attr!=="undefined"?this.data.attr[attr]:this.data.attr},param:function(param){return typeof param!=="undefined"?this.data.param.query[param]:this.data.param.query},fparam:function(param){return typeof param!=="undefined"?this.data.param.fragment[param]:this.data.param.fragment},segment:function(seg){if(typeof seg==="undefined"){return this.data.seg.path}else{seg=seg<0?this.data.seg.path.length+seg:seg-1;return this.data.seg.path[seg]}},fsegment:function(seg){if(typeof seg==="undefined"){return this.data.seg.fragment}else{seg=seg<0?this.data.seg.fragment.length+seg:seg-1;return this.data.seg.fragment[seg]}}}}if(typeof $!=="undefined"){$.fn.url=function(strictMode){var url="";if(this.length){url=$(this).attr(getAttrName(this[0]))||""}return purl(url,strictMode)};$.url=purl}else{window.purl=purl}});(function(){var Cyx,base;Cyx=window.Cyx=window.Cyx||{};if(Cyx.Controller==null){Cyx.Controller={}}if(Cyx.Mesh==null){Cyx.Mesh={}}if((base=Cyx.Mesh).Stone==null){base.Stone={}}if(Cyx.Shape==null){Cyx.Shape={}}if(Cyx.Player==null){Cyx.Player={}}if(Cyx.Sound==null){Cyx.Sound={}}if(Cyx.UI==null){Cyx.UI={}}if(Cyx.Util==null){Cyx.Util={}}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Cyx.Game=(function(superClass){extend(Game,superClass);Game.include(Jax.Mixins.EventEmitter);function Game(options){if(options==null){options={}}this.shapes=options.shapes||[Cyx.Shape.Line,Cyx.Shape.Triangle,Cyx.Shape.Circle,Cyx.Shape.Flower];this.subdivisions=options.subdivisions||2;this.players=[];this.moves=[];this.activePlayer=void 0;this.hasEnded=false;this.ui=void 0;this.helper=new Cyx.Player.HelperBot(this);this.on("turn_end",(function(_this){return function(){return _this.helper.meditate()}})(this))}Game.prototype.setUI=function(ui){return this.ui=ui};Game.prototype.addPlayer=function(player){if(!this.activePlayer){this.activePlayer=player}this.players.push(player);return this};Game.prototype.setActivePlayer=function(player){if(this.players.indexOf(player)===-1){throw new Error("This player was not added to the game")}return this.activePlayer=player};Game.prototype.chooseRandomActivePlayer=function(){if(this.players.length===0){throw new Error("No player added to this game")}return this.activePlayer=this.players[Math.mt_rand(0,this.players.length-1)]};Game.prototype.isTileFree=function(tile){return tile.owner===void 0};Game.prototype.isTiledGeodeSubmeshFree=function(tiledGeodeSubmesh){return this.isTileFree(tiledGeodeSubmesh.tile)};Game.prototype.isTileImportant=function(tile){return this.helper.isTileImportant(tile)};Game.prototype.countTiles=function(){return 12+10*(Math.pow(4,this.subdivisions)-1)};Game.prototype.findPotentialShapesAround=function(tile,skipCompleted){var i,j,len,len1,potentialShapes,ref,ref1,s,shape,shapeClass;if(skipCompleted==null){skipCompleted=true}potentialShapes=[];ref=this.shapes;for(i=0,len=ref.length;i<len;i++){shapeClass=ref[i];shape=new shapeClass();if(!shape instanceof Cyx.Shape.Base){throw new Error("Your shape must extend Cyx.Shape.Base")}ref1=shape.findPotentialShapesAround(tile);for(j=0,len1=ref1.length;j<len1;j++){s=ref1[j];if(!skipCompleted||s.remain.length>0){potentialShapes.push({shape:shapeClass,played:s.played,remain:s.remain})}}}return potentialShapes};Game.prototype.tryMove=function(tile){var dataOrNull,move,player,ref;if(!this.isTileFree(tile)){return false}player=this.activePlayer;tile.owner=player;move={player:player,tile:tile};this.moves.push(move);this.trigger("player_move",move);dataOrNull=this.checkVictoryConditions(move);this.endPlayerTurn();if(dataOrNull!==null){this.trigger("game_over",dataOrNull);if((ref=this.ui)!=null){ref.trigger("game_over",dataOrNull)}}return true};Game.prototype.getPlayerAfter=function(player){return this.players[(this.players.indexOf(player)+1)%this.players.length]};Game.prototype.endPlayerTurn=function(){var oldPlayer;if(!this.activePlayer){throw new Error("No active player to end turn of")}oldPlayer=this.activePlayer;this.activePlayer=this.getPlayerAfter(oldPlayer);this.trigger("turn_end",{oldPlayer:oldPlayer,newPlayer:this.activePlayer});return this};Game.prototype.checkVictoryConditions=function(move){var count,data,i,len,loser,next,player,ref,shape,shapeClass,tile,victoriousTiles,victoryShape;tile=move.tile;if(!tile){return false}player=move.player;if(!player){return false}victoryShape=null;victoriousTiles=[];ref=this.shapes;for(i=0,len=ref.length;i<len;i++){shapeClass=ref[i];shape=new shapeClass();if(!shape instanceof Cyx.Shape.Base){throw new Error("Your shape must extend Cyx.Shape.Base")}if(shape.isFoundAround(tile,victoriousTiles)){victoryShape=shape;break}}if(victoryShape){count=this.moves.filter(function(el){return el.player===player});count=count.length;data={winner:player,loser:this.getPlayerAfter(player),shape:victoryShape,moves:count,tile:tile,tiles:victoriousTiles};this.gameOver(data);return data}if(this.moves.length===this.countTiles()){loser=void 0;next=this.getPlayerAfter(player);if(player instanceof Cyx.Player.DumbBot){loser=player}if(next instanceof Cyx.Player.DumbBot){loser=next}data={moves:this.countTiles(),loser:loser,tiles:[]};this.gameOver(data);return data}return null};Game.prototype.gameOver=function(data){var i,len,tile,tiles;tiles=data.tiles;if(tiles){for(i=0,len=tiles.length;i<len;i++){tile=tiles[i];tile.wins=true;tile.stone.mesh.color=Jax.Util.colorize(tile.stone.winningColor)}}return this.hasEnded=true};return Game})(GMF.Core.Game)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Cyx.Scenario=(function(superClass){extend(Scenario,superClass);function Scenario(){return Scenario.__super__.constructor.apply(this,arguments)}Scenario.prototype.completeStep=function(name,data){var index,prev;if(data==null){data={}}index=this.steps.indexOf(name);if(index!==this.advancement){prev=this.getStepData(name);if(prev.moves>data.moves){this.trigger(name+"_completed",data);this.save(name,data)}}return Scenario.__super__.completeStep.call(this,name,data)};return Scenario})(GMF.Core.LinearScenario)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Cyx.UI.Main=(function(superClass){extend(Main,superClass);function Main(jQuery1,jax,doms){var ui;this.jQuery=jQuery1;this.jax=jax;if(doms==null){doms={}}Main.__super__.constructor.call(this,this.jQuery,doms);this.replay=jQuery.url().param("replay")||null;if(this.replay){this.hideCrosshair()}this.storage=new GMF.Storage.LocalStorage();this.scenario=new Cyx.Scenario(this.storage,"scenario_3.10");this.scenario.registerStep("beat_easy_ai");this.scenario.registerStep("beat_normal_ai");this.scenario.registerStep("beat_hard_ai");this.scenario.registerStep("beat_expert_ai");this.scenario.on("beat_easy_ai_completed",(function(_this){return function(e){_this.start_solo_normal.removeClass("locked");return _this.updatePlayLinkInfo(_this.start_solo_easy,e)}})(this));this.scenario.on("beat_normal_ai_completed",(function(_this){return function(e){_this.start_solo_hard.removeClass("locked");return _this.updatePlayLinkInfo(_this.start_solo_normal,e)}})(this));this.scenario.on("beat_hard_ai_completed",(function(_this){return function(e){_this.start_solo_expert.removeClass("locked");return _this.updatePlayLinkInfo(_this.start_solo_hard,e)}})(this));this.scenario.on("beat_expert_ai_completed",(function(_this){return function(e){return _this.updatePlayLinkInfo(_this.start_solo_expert,e)}})(this));this.scenario.on("scenario_completed",(function(_this){return function(e){if(e.first_time){_this.notifyGameOver(I18n.t("achievement.powerplay"))}return true}})(this));this.scenario.load();this.on("game_enter",function(e){var action,controller;this.hideMainMenu();this.showGameFrame();controller=e.controller;action=e.action||null;controller.jax=this.jax;this.jax.redirect(controller,action);this.cyx=this.jax.controller.game;this.cyx.setUI(this);this.mute();this.game_canvas.focus();this.hideCrosshair();this.setCrosshairColor(this.cyx.activePlayer.color);return console.info("Inserting coin")});this.on("game_exit",function(e){console.info("Goodbye !");return window.location=window.location.pathname+window.location.hash});this.on("game_over",function(e){var data,loser,winner;loser=e.loser;winner=e.winner;this.hideCrosshair();if(loser instanceof Cyx.Player.Bot&&!this.replay){data={moves:e.moves};switch(loser.txtLevel){case"easy":this.scenario.completeStep("beat_easy_ai",data);break;case"normal":this.scenario.completeStep("beat_normal_ai",data);break;case"hard":this.scenario.completeStep("beat_hard_ai",data);break;case"expert":this.scenario.completeStep("beat_expert_ai",data);break;default:true}}if(!this.replay){if(winner instanceof Cyx.Player.Bot){this.notifyGameOver(I18n.t("feedback.defeat.title"),I18n.t("feedback.defeat."+winner.txtLevel),"wiggle")}else{if(winner){if(typeof loser.txtLevel!=="undefined"){this.notifyGameOver(I18n.t("feedback.victory.title"),I18n.t("feedback.victory."+loser.txtLevel),"pulse")}else{this.notifyGameOver(I18n.t("feedback.victory.title"),I18n.t("feedback.victory.hotseat",{name:winner.name}),"pulse")}}else{this.notifyGameOver(I18n.t("feedback.draw.title"),I18n.t("feedback.draw.message"))}}}this.jax.controller.deactivateStonePlacement();return this.game_over_msg.show()});this.start_hotseat.on("click",(function(_this){return function(e){var data;e.preventDefault();if(e.ctrlKey){data={controller:new Jax.DemoGameController}}else{data={controller:new Jax.HotseatGameController}}_this.trigger("game_enter",data);return _this.trigger("game_start",data)}})(this));ui=this;this.start_solo.on("click",function(e){var data,element;e.preventDefault();element=$(this);if(element.hasClass("locked")){return false}data={controller:new Jax.SingleGameController,action:element.attr("data-jax-action")};ui.trigger("game_enter",data);return ui.trigger("game_start",data)});this.start_solo.on("mouseenter",function(e){var data,element,level,titleElement;e.preventDefault();element=$(this);if(element.hasClass("locked")){return false}level=element.attr("data-jax-action").substring(4).toLowerCase();data=ui.scenario.getStepData("beat_"+level+"_ai");titleElement=element.children("span:first-child");if(!element.attr("data-cyx-title")){element.attr("data-cyx-title",titleElement.html())}if(data!=null?data.moves:void 0){return titleElement.html("Won in<br />"+data.moves+" moves")}});this.start_solo.on("mouseleave",function(e){var element,titleElement;e.preventDefault();element=$(this);if(element.hasClass("locked")){return false}titleElement=element.children("span:first-child");if(element.attr("data-cyx-title")){return titleElement.html(element.attr("data-cyx-title"))}});this.jQuery(document).on("click",".btn_exit",(function(_this){return function(e){e.preventDefault();if(_this.jax.controller.game.hasEnded){return _this.trigger("game_exit")}}})(this));this.toggle_mute.click((function(_this){return function(e){e.preventDefault();_this.game_canvas.focus();if(_this.toggle_mute.hasClass("muted")){_this.unmute()}else{_this.mute()}return true}})(this))}Main.prototype.isGameRunning=function(){return !!this.cyx};Main.prototype.mute=function(){var ss;ss=this.getSoundSystem();if(ss){ss.mute();this.toggle_mute.addClass("muted")}return this};Main.prototype.unmute=function(){var ss;ss=this.getSoundSystem();if(ss){ss.unmute();this.toggle_mute.removeClass("muted")}return this};Main.prototype.updatePlayLinkInfo=function(link,data){return this};Main.prototype.getSoundSystem=function(){var ref;return(ref=this.jax.controller)!=null?ref.soundSystem:void 0};Main.prototype.setCursor=function(cursor){if(cursor==null){cursor=""}return this.jQuery(document.body).css("cursor",cursor)};Main.prototype.setCrosshairColor=function(color){var c;c=Jax.Color.parse(color);return this.crosshair.css("background-color",c.toString(6))};Main.prototype.hideCrosshair=function(){return this.crosshair.hide()};Main.prototype.showCrosshair=function(){return this.crosshair.show()};Main.prototype.hideMainMenu=function(){return this.main_menu.addClass("hidden")};Main.prototype.showMainMenu=function(){return this.main_menu.removeClass("hidden")};Main.prototype.hideGameFrame=function(){return this.game_frame.addClass("hidden")};Main.prototype.showGameFrame=function(){return this.game_frame.removeClass("hidden")};Main.prototype.isHelpOverlayHidden=function(){return this.help_overlay.hasClass("hidden")};Main.prototype.notifyGameOver=function(title,msg,animation){var moves;if(animation==null){animation="pulse"}if(typeof msg==="undefined"){msg=""}else{msg="<p>"+msg+"</p>"}if(typeof title!=="undefined"){msg=('<h2 class="animated infinitelyAnimated '+animation+'">'+title+"</h2>")+msg}msg+='<br><p><a href="#" class="btn btn_exit">RETRY</a>&nbsp;&nbsp;&nbsp;&nbsp;';if(!this.replay){moves=this.jax.controller.encodeMoves();msg+='<a href="?replay='+moves+'" class=\'btn\' target="_blank">WATCH</a>'}msg+="</p>";msg+='<br><p class="continue">'+I18n.t("help.continue")+"</p>";msg=msg.replace(/\n/g,"<br>");this.notification.html(msg);this.notifs=this.jQuery.gmfNotification(this.notification,{showClass:"bounceIn",hideClass:"bounceOut",onHidden:(function(_this){return function(element){return _this.game_canvas.focus()}})(this)});return this};Main.prototype.hideNotification=function(){var ref;if((ref=this.notifs)!=null){ref.hide()}return this};return Main})(GMF.UI.Base)}).call(this);(function(){Cyx.Mesh.Cloner={cloneTrianglesVertices:function(nbOfTriangles,fromVertices,intoVertices,start){var i,index,j,k,nt,ref;if(nbOfTriangles==null){nbOfTriangles=0}if(start==null){start=0}for(nt=j=0,ref=nbOfTriangles;0<=ref?j<ref:j>ref;nt=0<=ref?++j:--j){for(i=k=0;k<=2;i=++k){index=start+i*3+nt*9;intoVertices.push(fromVertices[index+0]);intoVertices.push(fromVertices[index+1]);intoVertices.push(fromVertices[index+2])}}return true},cloneTrianglesUVs:function(nbOfTriangles,fromUVs,inUVs,start){var i,index,j,k,nt,ref;if(nbOfTriangles==null){nbOfTriangles=0}if(start==null){start=0}for(nt=j=0,ref=nbOfTriangles;0<=ref?j<ref:j>ref;nt=0<=ref?++j:--j){for(i=k=0;k<=2;i=++k){index=start+i*2+nt*6;inUVs.push(fromUVs[index+0]);inUVs.push(fromUVs[index+1])}}return true}}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Cyx.Mesh.Stone.Cone=(function(superClass){extend(Cone,superClass);Cone.include(Cyx.Mesh.Cloner);function Cone(options){if(options==null){options={}}this.tile=options.tile;if(!this.tile){throw new Error("Provide the `tile` to set the stone on")}delete options.tile;this.n=this.tile.directionsCount;Cone.__super__.constructor.call(this,options)}Cone.prototype.init=function(vertices,colors,textureCoords,vertexNormals,vertexIndices,tangents,bitangents){var i,index,j,k,nt,ref,start,startUVs,tileNormals,tileUVs,tileVertices,v,x,y,z;tileVertices=this.tile.submesh.mesh.vertices;tileNormals=this.tile.submesh.mesh.data.normalBuffer;start=this.tile.submesh.verticesStart;for(nt=j=0,ref=this.n;0<=ref?j<ref:j>ref;nt=0<=ref?++j:--j){for(i=k=0;k<=2;i=++k){index=start+i*3+nt*9;x=tileVertices[index+0];y=tileVertices[index+1];z=tileVertices[index+2];v=vec3.fromValues(x,y,z);if(i===0){vec3.scale(v,v,1.0777)}vertices.push.apply(vertices,v)}}this.cloneTrianglesVertices(this.n,tileNormals,vertexNormals,start);tileUVs=this.tile.submesh.mesh.data.textureCoordsBuffer;startUVs=start*2/3;this.cloneTrianglesUVs(this.n,tileUVs,textureCoords,startUVs);return true};return Cone})(Jax.Mesh.Triangles)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Cyx.Mesh.Stone.Default=(function(superClass){extend(Default,superClass);Default.include(Cyx.Mesh.Cloner);function Default(options){if(options==null){options={}}this.tile=options.tile;if(!this.tile){throw new Error("Provide the `tile` to set the stone on")}delete options.tile;this.n=this.tile.directionsCount;Default.__super__.constructor.call(this,options)}Default.prototype.init=function(vertices,colors,textureCoords,vertexNormals,vertexIndices,tangents,bitangents){var start,tileNormals,tileUVs,tileVertices;tileVertices=this.tile.submesh.mesh.vertices;tileNormals=this.tile.submesh.mesh.data.normalBuffer;start=this.tile.submesh.verticesStart;this.cloneTrianglesVertices(this.n,tileVertices,vertices,start);this.cloneTrianglesVertices(this.n,tileNormals,vertexNormals,start);tileUVs=this.tile.submesh.mesh.data.textureCoordsBuffer;this.cloneTrianglesUVs(this.n,tileUVs,textureCoords,start);return true};return Default})(Jax.Mesh.Triangles)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Cyx.Player.Bot=(function(superClass){extend(Bot,superClass);function Bot(){return Bot.__super__.constructor.apply(this,arguments)}return Bot})(GMF.Player.Player)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Cyx.Player.DumbBot=(function(superClass){extend(DumbBot,superClass);DumbBot.prototype.game=void 0;function DumbBot(options){if(options==null){options={}}if(!options.game){throw new Error("AI needs options.game")}options.txtLevel||(options.txtLevel="normal");options.numLevel||(options.numLevel=2);options.intolerance||(options.intolerance=2);DumbBot.__super__.constructor.call(this,options)}DumbBot.prototype.play=function(lattice){var tile;if(this.numLevel>1){tile=this.finish(lattice)}if(!tile){tile=this.counter(lattice)}if(!tile){tile=this.attack(lattice)}if(!tile){tile=this.improvise(lattice)}return tile};DumbBot.prototype.finish=function(lattice){return this.attack(lattice,true)};DumbBot.prototype.counter=function(lattice,intolerance){var move,potentialShapes,targetShape;if(intolerance==null){intolerance=this.intolerance}if(this.game.moves.length===0){return void 0}if(this.numLevel===1&&Math.random()<1/42){return void 0}if(this.numLevel===2&&Math.random()<1/111){return void 0}move=this.game.moves[this.game.moves.length-1];potentialShapes=this.game.findPotentialShapesAround(move.tile);if(potentialShapes.length===0){return void 0}targetShape=this._pickTargetShape(potentialShapes);if(targetShape.remain.length<=intolerance){return GMF.Util.getRandomArrayValue(targetShape.remain)}return void 0};DumbBot.prototype.attack=function(lattice,onlyIfLastMove){var _potentialShapes,ai,i,isMyTile,j,len,len1,myPlayedTiles,potentialShapes,targetShape,tile,val;if(onlyIfLastMove==null){onlyIfLastMove=false}ai=this;isMyTile=function(tile){return tile.owner===ai};myPlayedTiles=lattice.getTilesValidating(isMyTile);potentialShapes=[];for(i=0,len=myPlayedTiles.length;i<len;i++){tile=myPlayedTiles[i];_potentialShapes=this.game.findPotentialShapesAround(tile);for(j=0,len1=_potentialShapes.length;j<len1;j++){val=_potentialShapes[j];potentialShapes.push(val)}}if(onlyIfLastMove){potentialShapes=potentialShapes.filter(function(a){return a.played.length===5})}if(potentialShapes.length===0){return void 0}targetShape=this._pickTargetShape(potentialShapes);return GMF.Util.getRandomArrayValue(targetShape.remain)};DumbBot.prototype.improvise=function(lattice){var e,move,potentialShapes,targetShape,tile;if(this.game.moves.length===1){move=this.game.moves[0];potentialShapes=this.game.findPotentialShapesAround(move.tile);targetShape=GMF.Util.getRandomArrayValue(potentialShapes);tile=GMF.Util.getRandomArrayValue(targetShape.remain)}else{try{tile=lattice.getRandomEmptyTile()}catch(error){e=error;tile=void 0}}return tile};DumbBot.prototype._pickTargetShape=function(shapes){var _shapes,maxPlayedCount;shapes.sort(function(a,b){return b.played.length-a.played.length});maxPlayedCount=shapes[0].played.length;_shapes=shapes.filter(function(a){return a.played.length===maxPlayedCount});return GMF.Util.getRandomArrayValue(_shapes)};return DumbBot})(Cyx.Player.Bot)}).call(this);(function(){Cyx.Player.HelperBot=(function(){HelperBot.prototype._movesCountOfLastMeditation=0;HelperBot.prototype.game=void 0;HelperBot.prototype.willK={};HelperBot.prototype.willV={};HelperBot.prototype._willMax=-Infinity;function HelperBot(game){this.game=game}HelperBot.prototype.play=function(){return void 0};HelperBot.prototype.meditate=function(){var i,j,l,len,len1,len2,move,potentialShapes,ref,ref1,shape,tile,will;if(this.game.moves.length===this._movesCountOfLastMeditation){return false}this._movesCountOfLastMeditation=this.game.moves.length;this.willK={};this.willV={};ref=this.game.moves;for(i=0,len=ref.length;i<len;i++){move=ref[i];potentialShapes=this.game.findPotentialShapesAround(move.tile);for(j=0,len1=potentialShapes.length;j<len1;j++){shape=potentialShapes[j];ref1=shape.remain;for(l=0,len2=ref1.length;l<len2;l++){tile=ref1[l];will=shape.remain.length===1?42:shape.played.length;if(shape.remain.length===1&&move.player===this){will*=2}if(!this.willK[tile]){this.willK[tile]=tile}if(!this.willV[tile]){this.willV[tile]=will}else{this.willV[tile]+=will}}}}this._willMax=Object.keys(this.willV).reduce(((function(_this){return function(m,k){if(_this.willV[k]>m){return _this.willV[k]}else{return m}}})(this)),-Infinity);return true};HelperBot.prototype.isTileImportant=function(tile){if(this._willMax<42){return false}return this.willV[tile.toString()]>0.9*this._willMax};return HelperBot})()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Cyx.Player.SimpleBot=(function(superClass){extend(SimpleBot,superClass);SimpleBot.prototype.game=void 0;function SimpleBot(options){if(options==null){options={}}if(!options.game){throw new Error("AI needs options.game")}options.txtLevel||(options.txtLevel="expert");SimpleBot.__super__.constructor.call(this,options)}SimpleBot.prototype.play=function(lattice){var best,i,j,l,len,len1,len2,max,move,potentialShapes,ref,ref1,shape,tile,will,willK,willTilesCoords,willV;willK={};willV={};ref=this.game.moves;for(i=0,len=ref.length;i<len;i++){move=ref[i];potentialShapes=this.game.findPotentialShapesAround(move.tile);for(j=0,len1=potentialShapes.length;j<len1;j++){shape=potentialShapes[j];ref1=shape.remain;for(l=0,len2=ref1.length;l<len2;l++){tile=ref1[l];will=shape.remain.length===1?42:shape.played.length;if(shape.remain.length===1&&move.player===this){will*=2}if(!willK[tile]){willK[tile]=tile}if(!willV[tile]){willV[tile]=will}else{willV[tile]+=will}}}}willTilesCoords=Object.keys(willV);if(0===willTilesCoords.length){return lattice.getRandomEmptyTile()}max=willTilesCoords.reduce((function(m,k){if(willV[k]>m){return willV[k]}else{return m}}),-Infinity);best=(function(){var len3,n,results;results=[];for(n=0,len3=willTilesCoords.length;n<len3;n++){tile=willTilesCoords[n];if(willV[tile]===max){results.push(tile)}}return results})();return willK[GMF.Util.getRandomArrayValue(best)]};return SimpleBot})(Cyx.Player.Bot)}).call(this);(function(){Cyx.Shape.Base=(function(){function Base(){}Base.prototype.isFoundAround=function(tile,outTiles){throw new Error("Override Cyx.Shape.Base#isFoundAround")};Base.prototype.findPotentialShapesAround=function(tile){throw new Error("Override Cyx.Shape.Base#findPotentialShapesAround")};Base.prototype.isFoundStarting=function(fromTile,direction,length,outTiles){var adjacent,current,i,ii,j,lattice,maybe,owner,ref,relativeDirection;owner=fromTile.owner;if(owner===void 0){throw new Error("Starting tile has no owner")}lattice=fromTile.lattice;maybe=true;i=length-1;current=fromTile;relativeDirection=direction;for(ii=j=0,ref=i;j<ref;ii=j+=1){adjacent=current.getAdjacent(relativeDirection);if(adjacent.isPentagon){outTiles.push(adjacent);if(ii<i-1||adjacent.owner!==owner){maybe=false}break}relativeDirection=adjacent.oppositeDirection(adjacent.getDirectionOfAdjacencyWith(current));current=adjacent;outTiles.push(current);if(current.owner!==owner){maybe=false;break}}return maybe};Base.prototype.isLineFound=function(fromTile,direction,length,validates,outTiles){var adjacent,current,i,j,maybe,ref,relativeDirection;if(outTiles==null){outTiles=[]}maybe=true;length--;current=fromTile;relativeDirection=direction;for(i=j=0,ref=length;j<ref;i=j+=1){adjacent=current.getAdjacent(relativeDirection);if(adjacent.isPentagon){if((i<length-1)||(!validates(adjacent))){maybe=false;break}else{outTiles.push(adjacent)}}else{relativeDirection=adjacent.oppositeDirection(adjacent.getDirectionOfAdjacencyWith(current));current=adjacent;if(validates(current)){outTiles.push(current)}else{maybe=false;break}}}return maybe};Base.prototype._addPotentialShape=function(originTile,otherTiles,potential){var j,len,played,remain,tile;played=[originTile];remain=[];for(j=0,len=otherTiles.length;j<len;j++){tile=otherTiles[j];if(tile.owner===originTile.owner){played.push(tile)}else{remain.push(tile)}}return potential.push({played:played,remain:remain})};return Base})()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Cyx.Shape.Circle=(function(superClass){extend(Circle,superClass);function Circle(){return Circle.__super__.constructor.apply(this,arguments)}Circle.prototype.isFoundAround=function(tile,outTiles){var adjacent,current,direction,directionsCount,i,j,k,maybe,owner,ref,relativeDirection;outTiles.length=0;owner=tile.owner;directionsCount=tile.directionsCount;for(direction=j=0,ref=directionsCount;j<ref;direction=j+=1){outTiles.push(tile);maybe=true;current=tile;relativeDirection=direction;for(i=k=0;k<5;i=k+=1){adjacent=current.getAdjacent(relativeDirection);if(adjacent.owner!==owner||outTiles.indexOf(adjacent)!==-1){maybe=false;break}outTiles.push(adjacent);relativeDirection=adjacent.rotateDirection(adjacent.getDirectionOfAdjacencyWith(current),2);current=adjacent}if(maybe){return true}else{outTiles.length=0}}return false};Circle.prototype.findPotentialShapesAround=function(tile){var adjacent,current,direction,directionsCount,i,j,k,maybe,owner,played,potential,ref,relativeDirection,remain;potential=[];owner=tile.owner;directionsCount=tile.directionsCount;for(direction=j=0,ref=directionsCount;j<ref;direction=j+=1){played=[];remain=[];played.push(tile);maybe=true;current=tile;relativeDirection=direction;for(i=k=0;k<5;i=k+=1){adjacent=current.getAdjacent(relativeDirection);if((adjacent.owner&&adjacent.owner!==owner)||(played.indexOf(adjacent)!==-1)){maybe=false;break}if(adjacent.owner===void 0){remain.push(adjacent)}else{played.push(adjacent)}relativeDirection=adjacent.rotateDirection(adjacent.getDirectionOfAdjacencyWith(current),2);current=adjacent}if(maybe){potential.push({remain:remain,played:played})}}return potential};return Circle})(Cyx.Shape.Base)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Cyx.Shape.Flower=(function(superClass){extend(Flower,superClass);function Flower(){return Flower.__super__.constructor.apply(this,arguments)}Flower.prototype._checkPetals=function(pentagon,outTile,validityBetween){var i,len,neighbor,neighbors;neighbors=pentagon.getNeighbors();for(i=0,len=neighbors.length;i<len;i++){neighbor=neighbors[i];outTile.push(neighbor);if(!validityBetween(pentagon,neighbor)){return false}}return true};Flower.prototype._haveSameOwner=function(tileA,tileB){return tileB.owner===tileA.owner};Flower.prototype._haveSameOwnerOrIsEmpty=function(tileA,tileB){return(tileB.owner===void 0)||(tileB.owner===tileA.owner)};Flower.prototype.isFoundAround=function(tile,outTiles){var found,i,len,neighbor,neighbors;outTiles.length=0;if(tile.isPentagon){outTiles.push(tile);return this._checkPetals(tile,outTiles,this._haveSameOwner)}else{neighbors=tile.getNeighbors();for(i=0,len=neighbors.length;i<len;i++){neighbor=neighbors[i];if(neighbor.isPentagon&&this._haveSameOwner(tile,neighbor)){outTiles.push(neighbor);found=this._checkPetals(neighbor,outTiles,this._haveSameOwner);if(found){return true}}outTiles.length=0}}return false};Flower.prototype.findPotentialShapesAround=function(tile){var haveSameOwnerOrIsEmpty,i,j,k,len,len1,len2,neighbor,neighbors,outTiles,owner,pentagon,petal,shapeFound;shapeFound={remain:[],played:[]};outTiles=[];owner=tile.owner;haveSameOwnerOrIsEmpty=function(tileA,tileB){return(tileB.owner===void 0)||(tileB.owner===owner)};if(tile.isPentagon){shapeFound.played.push(tile);if(this._checkPetals(tile,outTiles,this._haveSameOwnerOrIsEmpty)){for(i=0,len=outTiles.length;i<len;i++){petal=outTiles[i];if(this._haveSameOwner(tile,petal)){shapeFound.played.push(petal)}else{shapeFound.remain.push(petal)}}return[shapeFound]}else{return[]}}else{neighbors=tile.getNeighbors();for(j=0,len1=neighbors.length;j<len1;j++){neighbor=neighbors[j];if(neighbor.isPentagon){pentagon=neighbor;if(this._haveSameOwnerOrIsEmpty(tile,pentagon)){if(this._haveSameOwner(tile,pentagon)){shapeFound.played.push(neighbor)}else{shapeFound.remain.push(neighbor)}outTiles=[];if(this._checkPetals(neighbor,outTiles,haveSameOwnerOrIsEmpty)){for(k=0,len2=outTiles.length;k<len2;k++){petal=outTiles[k];if(this._haveSameOwner(tile,petal)){shapeFound.played.push(petal)}else{shapeFound.remain.push(petal)}}return[shapeFound]}else{return[]}}else{return[]}}}}return[]};return Flower})(Cyx.Shape.Base)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Cyx.Shape.Line=(function(superClass){extend(Line,superClass);function Line(){return Line.__super__.constructor.apply(this,arguments)}Line.prototype.isFoundAround=function(tile,outTiles){var hexAxis,i,j,k,l,lattice,len,m,maybe,neighbor,neighbors,oppositeHexAxis,owner;owner=tile.owner;lattice=tile.lattice;outTiles.length=0;if(tile.isPentagon){neighbors=lattice.findNeighbors(tile);for(k=0,len=neighbors.length;k<len;k++){neighbor=neighbors[k];outTiles.push(tile);if(neighbor.owner!==owner||neighbor.isPentagon){outTiles.length=0;continue}outTiles.push(neighbor);hexAxis=neighbor.oppositeDirection(neighbor.getHexAxisOfAdjacency(tile));if(this.isFoundStarting(neighbor,hexAxis,5,outTiles)){return true}else{outTiles.length=0}}}else{for(hexAxis=l=0;l<=5;hexAxis=l+=2){oppositeHexAxis=tile.oppositeDirection(hexAxis);for(i=m=0;m<=5;i=m+=1){j=5-i;outTiles.push(tile);maybe=this.isFoundStarting(tile,hexAxis,i+1,outTiles);if(maybe){maybe=this.isFoundStarting(tile,oppositeHexAxis,j+1,outTiles)}if(maybe){return true}else{outTiles.length=0}}}}return false};Line.prototype.findPotentialShapesAround=function(tile){var direction,hexAxis,i,j,k,l,m,oppositeHexAxis,outTiles,owner,potential,ref,validator;potential=[];owner=tile.owner;validator=function(tile){return tile.owner===void 0||tile.owner===owner};if(tile.isPentagon){for(direction=k=0,ref=tile.directionsCount;k<ref;direction=k+=1){outTiles=[];if(this.isLineFound(tile,direction,6,validator,outTiles)){this._addPotentialShape(tile,outTiles,potential)}}}else{for(hexAxis=l=0;l<=2;hexAxis=l+=1){oppositeHexAxis=tile.oppositeDirection(hexAxis);for(i=m=0;m<=5;i=m+=1){j=5-i;outTiles=[];if(this.isLineFound(tile,hexAxis,i+1,validator,outTiles)){if(this.isLineFound(tile,oppositeHexAxis,j+1,validator,outTiles)){this._addPotentialShape(tile,outTiles,potential)}}}}}return potential};return Line})(Cyx.Shape.Base)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Cyx.Shape.Triangle=(function(superClass){extend(Triangle,superClass);function Triangle(){return Triangle.__super__.constructor.apply(this,arguments)}Triangle.prototype._isFoundStarting=function(fromTile,direction,outTiles){var adjacent,current,owner,relativeDirection;owner=fromTile.owner;if(owner===void 0){throw new Error("Starting tile has no owner")}current=fromTile;relativeDirection=direction;adjacent=current.getAdjacent(relativeDirection);if(adjacent.isPentagon){relativeDirection=adjacent.rotateDirection(adjacent.getDirectionOfAdjacencyWith(current),2)}else{relativeDirection=adjacent.oppositeDirection(adjacent.getDirectionOfAdjacencyWith(current))}current=adjacent;outTiles.push(current);if(current.owner!==owner){return false}adjacent=current.getAdjacent(relativeDirection);current=adjacent;outTiles.push(current);if(current.owner!==owner){return false}return true};Triangle.prototype._isTriangleEdgeFound=function(fromTile,direction,validates,outTiles){var adjacent,current,relativeDirection;if(outTiles==null){outTiles=[]}current=fromTile;relativeDirection=direction;adjacent=current.getAdjacent(relativeDirection);if(adjacent.isPentagon){relativeDirection=adjacent.rotateDirection(adjacent.getDirectionOfAdjacencyWith(current),2)}else{relativeDirection=adjacent.oppositeDirection(adjacent.getDirectionOfAdjacencyWith(current))}current=adjacent;if(!validates(current)){return false}else{outTiles.push(current)}adjacent=current.getAdjacent(relativeDirection);current=adjacent;if(!validates(current)){return false}else{outTiles.push(current)}return true};Triangle.prototype.isFoundAround=function(tile,outTiles){var ante,direction,directionsCount,i,j,last,maybe,ref,ref1;outTiles.length=0;directionsCount=tile.directionsCount;for(direction=i=0,ref=directionsCount;i<ref;direction=i+=1){outTiles.push(tile);maybe=this._isFoundStarting(tile,direction,outTiles);if(maybe){ante=outTiles[outTiles.length-2];last=outTiles[outTiles.length-1];direction=last.rotateDirection(last.getDirectionOfAdjacencyWith(ante),-1);maybe=this._isFoundStarting(last,direction,outTiles);if(maybe){ante=outTiles[outTiles.length-2];last=outTiles[outTiles.length-1];direction=last.rotateDirection(last.getDirectionOfAdjacencyWith(ante),-1);maybe=this.isFoundStarting(last,direction,2,outTiles)}}if(maybe){return true}else{outTiles.length=0}}outTiles.length=0;for(direction=j=0,ref1=directionsCount;j<ref1;direction=j+=1){outTiles.push(tile);maybe=this.isFoundStarting(tile,direction,2,outTiles);if(maybe){ante=outTiles[outTiles.length-2];last=outTiles[outTiles.length-1];direction=last.rotateDirection(last.getDirectionOfAdjacencyWith(ante),-1);maybe=this._isFoundStarting(last,direction,outTiles);if(maybe){ante=outTiles[outTiles.length-2];last=outTiles[outTiles.length-1];direction=last.rotateDirection(last.getDirectionOfAdjacencyWith(ante),-1);maybe=this._isFoundStarting(last,direction,outTiles)}}if(maybe){return true}else{outTiles.length=0}}return false};Triangle.prototype.findPotentialShapesAround=function(tile){var ante,direction,directionsCount,i,j,last,maybe,outTiles,owner,potential,ref,ref1,validator;potential=[];owner=tile.owner;validator=function(tile){return tile.owner===void 0||tile.owner===owner};directionsCount=tile.directionsCount;for(direction=i=0,ref=directionsCount;i<ref;direction=i+=1){outTiles=[];maybe=this._isTriangleEdgeFound(tile,direction,validator,outTiles);if(maybe){ante=outTiles[outTiles.length-2]||tile;last=outTiles[outTiles.length-1];direction=last.rotateDirection(last.getDirectionOfAdjacencyWith(ante),-1);maybe=this._isTriangleEdgeFound(last,direction,validator,outTiles);if(maybe){ante=outTiles[outTiles.length-2];last=outTiles[outTiles.length-1];direction=last.rotateDirection(last.getDirectionOfAdjacencyWith(ante),-1);maybe=this.isLineFound(last,direction,2,validator,outTiles)}}if(maybe){this._addPotentialShape(tile,outTiles,potential)}}for(direction=j=0,ref1=directionsCount;j<ref1;direction=j+=1){outTiles=[];maybe=this.isLineFound(tile,direction,2,validator,outTiles);if(maybe){ante=outTiles[outTiles.length-2]||tile;last=outTiles[outTiles.length-1];direction=last.rotateDirection(last.getDirectionOfAdjacencyWith(ante),-1);maybe=this._isTriangleEdgeFound(last,direction,validator,outTiles);if(maybe){ante=outTiles[outTiles.length-2];last=outTiles[outTiles.length-1];direction=last.rotateDirection(last.getDirectionOfAdjacencyWith(ante),-1);maybe=this._isTriangleEdgeFound(last,direction,validator,outTiles)}}if(maybe){this._addPotentialShape(tile,outTiles,potential)}}return potential};return Triangle})(Cyx.Shape.Base)}).call(this);(function(){Cyx.Sound.SoundSystem=(function(){SoundSystem.include(Jax.Mixins.EventEmitter);function SoundSystem(options){if(options==null){options={}}this.muted=options.muted||false;delete options.muted}SoundSystem.prototype.mute=function(){return this.muted=true};SoundSystem.prototype.unmute=function(){return this.muted=false};SoundSystem.prototype.toggleMute=function(){return this.muted=!this.muted};SoundSystem.prototype.play_sound_place_stone=function(onTile){var e;if(!this.muted){this.trigger("play_start",{});try{return this.play_sound_place_stone_3(onTile)}catch(error){e=error;return this.trigger("play_stop",{})}}};SoundSystem.prototype.play_sound_place_stone_1=function(onTile){var env,t,table,that;that=this;table=[0,[0.8,"BPM120 L8"],[0.4,"BPM120 L16"],[0.3,56],[0.9,250],[0,"BPM120 L4","lin"]];env=T("env",{table:table,loopNode:3,releaseNode:6,curve:"exp"});env.append(T("pulse",{mul:0.15})).on("ended",function(){return this.pause()}).bang().play();t=T("timeout",{timeout:1250},function(){env.release();t.stop();return that.trigger("play_stop",{})}).start();return true};SoundSystem.prototype.play_sound_place_stone_2=function(onTile){var bary,lerp,sine1,sine2,x;bary=onTile.coordinates.bary;x=(bary[0]+bary[1])/onTile.lattice.bl.scale;lerp=function(x,start,end){return((end-start)*x)+start};sine1=T("saw",{freq:440,mul:lerp(x,0,1)});sine2=T("saw",{freq:660,mul:lerp(1-x,0,1)});T("perc",{r:555},sine1,sine2).bang().play();this.trigger("play_stop",{});return true};SoundSystem.prototype.play_sound_place_stone_3=function(onTile){var bary,get_random_wave,lerp,major,n,perc,perc2,sine1,sine2,sine3,sine4,t,tEnd,that,volume,xa,xb,xc,y1;that=this;major=onTile.coordinates.major;bary=onTile.coordinates.bary;n=onTile.lattice.bl.scale;xa=bary[0]/n;xb=bary[1]/n;xc=bary[2]/n;y1=(major[0]*10+major[1])/43;get_random_wave=function(){return["sin","tri","saw","pulse","fami"][(Math.random()*5)|0]};lerp=function(x,start,end){return((end-start)*x)+start};volume=0.25;sine1=T(get_random_wave(),{freq:550,mul:lerp(xa,0,volume)});sine2=T(get_random_wave(),{freq:660,mul:lerp(xb,0,volume)});sine3=T(get_random_wave(),{freq:110,mul:lerp(xc,0,volume)});sine4=T(get_random_wave(),{freq:220,mul:lerp(y1,0,volume)});perc=T("perc",{a:500,d:500},sine1,sine2,sine3,sine4);perc2=T("perc",{r:1000},sine4,sine3,sine1,sine2);perc.set("mul",0.15).bang().play();t=T("timeout",{timeout:1151},function(){perc2.set("mul",0.3).bang().play();return t.stop()}).start();tEnd=T("timeout",{timeout:3000},function(){perc.pause();perc2.pause();tEnd.stop();return that.trigger("play_stop",{})}).start();return true};SoundSystem.prototype.play_sound_place_stone_4=function(onTile){var audio1,audio2,src,that;src="wav/laser3.wav";src="wav/electric.wav";that=this;audio1=T("audio",{loop:false}).load("wav/laser3.wav");audio2=T("audio",{loop:false}).load("wav/electric.wav");$.when(audio1,audio2).then(function(){var e;try{T("+",audio1,audio2).play();return that.trigger("play_stop",{})}catch(error){e=error;return console.log("Error with timbre: "+e)}});return true};return SoundSystem})()}).call(this);(function(){Cyx.Util.exportLatticeForTesting=function(lattice){var data,i,len,tile,tiles;tiles=lattice.getAllTiles();data="\n";for(i=0,len=tiles.length;i<len;i++){tile=tiles[i];if(tile.owner){data+="["+tile.coordinates.full.join()+", "+tile.owner.id+"]\n"}}return data};Cyx.Util.importMovesIntoMockLattice=function(moves,lattice){var i,len,move,tile;for(i=0,len=moves.length;i<len;i++){move=moves[i];tile=lattice.findTileAt(move.slice(0,8));if(!tile){throw new Error("Wrong data : "+move.join())}tile.owner=move[8];tile.stone=true}return true}}).call(this);(function(){var _collision_point,_triangle,_triangle_a,_triangle_b,_triangle_c;Cyx.Util.findSelectedGeodeSubmesh=function(context,geode,mouseX,mouseY){var direction,eye,projection;if(mouseX==null){mouseX=0}if(mouseY==null){mouseY=0}eye=context.activeCamera.get("position");projection=context.activeCamera.unprojectPoint(vec3.create(),mouseX,mouseY,1);direction=vec3.create();vec3.subtract(direction,projection,eye);vec3.normalize(direction,direction);return Cyx.Util.findGeodeSubmeshUnderRay(context,geode,eye,direction)};Cyx.Util.findGeodeSubmeshClosestTo=function(context,geode,position){var direction,eye;eye=geode.position;direction=vec3.create();vec3.subtract(direction,position,eye);vec3.normalize(direction,direction);return Cyx.Util.findUniqueGeodeSubmeshUnderRay(context,geode,eye,direction)};_collision_point=vec4.create();_triangle=new Jax.Geometry.Triangle();_triangle_a=vec3.create();_triangle_b=vec3.create();_triangle_c=vec3.create();Cyx.Util.findGeodeSubmeshUnderRay=function(context,geode,eye,direction){var buf,found,hexagon,i,j,k,l,len,len1,m,n,pentagon,ref,ref1;found=[];buf=geode.mesh.vertices;ref=geode.mesh.pentagons;for(k=0,len=ref.length;k<len;k++){pentagon=ref[k];for(i=l=0;l<5;i=l+=1){j=i*9+pentagon.verticesStart;vec3.set(_triangle_a,buf[j+0],buf[j+1],buf[j+2]);vec3.set(_triangle_b,buf[j+3],buf[j+4],buf[j+5]);vec3.set(_triangle_c,buf[j+6],buf[j+7],buf[j+8]);_triangle.assign(_triangle_a,_triangle_b,_triangle_c);if(_triangle.intersectRay(eye,direction,_collision_point)){found.push([vec4.clone(_collision_point),pentagon]);break}}}ref1=geode.mesh.hexagons;for(m=0,len1=ref1.length;m<len1;m++){hexagon=ref1[m];for(i=n=0;n<6;i=n+=1){j=i*9+hexagon.verticesStart;vec3.set(_triangle_a,buf[j+0],buf[j+1],buf[j+2]);vec3.set(_triangle_b,buf[j+3],buf[j+4],buf[j+5]);vec3.set(_triangle_c,buf[j+6],buf[j+7],buf[j+8]);_triangle.assign(_triangle_a,_triangle_b,_triangle_c);if(_triangle.intersectRay(eye,direction,_collision_point)){found.push([vec4.clone(_collision_point),hexagon]);break}}}if(found.length>0){found.sort(function(a,b){return a[0][3]-b[0][3]});return found[0][1]}else{return void 0}};Cyx.Util.findUniqueGeodeSubmeshUnderRay=function(context,geode,eye,direction){var buf,hexagon,i,j,k,l,len,len1,m,n,pentagon,ref,ref1;buf=geode.mesh.vertices;ref=geode.mesh.pentagons;for(k=0,len=ref.length;k<len;k++){pentagon=ref[k];for(i=l=0;l<5;i=l+=1){j=i*9+pentagon.verticesStart;vec3.set(_triangle_a,buf[j+0],buf[j+1],buf[j+2]);vec3.set(_triangle_b,buf[j+3],buf[j+4],buf[j+5]);vec3.set(_triangle_c,buf[j+6],buf[j+7],buf[j+8]);_triangle.assign(_triangle_a,_triangle_b,_triangle_c);if(_triangle.intersectRay(eye,direction,_collision_point)){return pentagon}}}ref1=geode.mesh.hexagons;for(m=0,len1=ref1.length;m<len1;m++){hexagon=ref1[m];for(i=n=0;n<6;i=n+=1){j=i*9+hexagon.verticesStart;vec3.set(_triangle_a,buf[j+0],buf[j+1],buf[j+2]);vec3.set(_triangle_b,buf[j+3],buf[j+4],buf[j+5]);vec3.set(_triangle_c,buf[j+6],buf[j+7],buf[j+8]);_triangle.assign(_triangle_a,_triangle_b,_triangle_c);if(_triangle.intersectRay(eye,direction,_collision_point)){return hexagon}}}return void 0}}).call(this);(function(){var Goutte;Goutte=window.Goutte=window.Goutte||{};Goutte.Math=Goutte.Math||{};Goutte.Math.Tuple=Goutte.Math.Tuple||{}}).call(this);(function(){var Goutte,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item){return i}}return -1};Goutte=window.Goutte=window.Goutte||{};Goutte.Math=Goutte.Math||{};Goutte.Math.AlternatingGroup5=(function(){function AlternatingGroup5(){}AlternatingGroup5.prototype.order=60;AlternatingGroup5.prototype.length=AlternatingGroup5.prototype.order;AlternatingGroup5.prototype.identity=[0,1,2,3,4];AlternatingGroup5.prototype.applyPermutation=function(permutation,to){return permutation[to]};AlternatingGroup5.prototype.contains=function(permutationTuple){var el,j,k,l,len,len1,n,next,ref,ref1,sign,visited;n=permutationTuple.length;if(n!==this.identity.length){throw new Error("Invalid tuple length: "+(permutationTuple.length||0))}ref=this.identity;for(j=0,len1=ref.length;j<len1;j++){el=ref[j];if(indexOf.call(permutationTuple,el)<0){throw new Error("Permutation ("+permutationTuple.join()+") ought to have "+el)}}visited=[false,false,false,false,false];sign=1;for(k=l=0,ref1=n;l<ref1;k=l+=1){if(!visited[k]){next=k;len=0;while(!visited[next]){len++;visited[next]=true;next=this.applyPermutation(permutationTuple,next)}if(len%2===0){sign=-sign}}}return 1===sign};AlternatingGroup5.prototype.getAllPermutations=function(){var a,aK,all,b,bK,identity,j,k,l,m,p,tmp;all=[];identity=this.identity;for(aK=j=0;j<5;aK=j+=1){a=identity[aK];for(bK=l=0;l<5;bK=l+=1){if(aK===bK){continue}b=identity[bK];p=[a,b];for(k=m=0;m<5;k=m+=1){if(k===aK||k===bK){continue}p.push(identity[k])}if(!this.contains(p)){tmp=p[3];p[3]=p[4];p[4]=tmp}all.push(p.slice(0));Goutte.Math.Tuple.applySubCycle(p,2,4,1);all.push(p.slice(0));Goutte.Math.Tuple.applySubCycle(p,2,4,1);all.push(p.slice(0))}}return all};AlternatingGroup5.prototype.getIcosaPermutations=function(){var a,aK,all,b,bK,identity,j,k,l,m,p,tmp;all=[];identity=this.identity;for(aK=j=0;j<5;aK=j+=1){a=identity[aK];for(bK=l=0;l<5;bK=l+=1){if(aK===bK){continue}b=identity[bK];p=[a,b];for(k=m=0;m<5;k=m+=1){if(k===aK||k===bK){continue}p.push(identity[k])}if(!this.contains(p)){tmp=p[3];p[3]=p[4];p[4]=tmp}all.push(p.slice(0))}}return all};AlternatingGroup5.prototype.multiply=function(out,inA,inB){var j,k;for(k=j=0;j<5;k=j+=1){out[k]=inA[inB[k]]}return out};AlternatingGroup5.prototype.expandPrefixLexicographically=function(prefixTuple){var i,identity,j,k,next,ref,ref1;identity=this.identity;for(i=j=ref=prefixTuple.length;j<5;i=j+=1){k=0;next=null;while(next===null&&k<5){if(ref1=identity[k],indexOf.call(prefixTuple,ref1)<0){next=identity[k]}k++}prefixTuple[i]=next}if(!this.contains(prefixTuple)){this.swapTwoElements(prefixTuple,3,4)}return prefixTuple};AlternatingGroup5.prototype.swapTwoElements=function(tuple,indexA,indexB){var tmp;tmp=tuple[indexA];tuple[indexA]=tuple[indexB];tuple[indexB]=tmp;return tuple};return AlternatingGroup5})()}).call(this);(function(){var Goutte;Goutte=window.Goutte=window.Goutte||{};Goutte.Math=Goutte.Math||{};Goutte.Math.BarycentricLattice=(function(){function BarycentricLattice(options){this.options=options!=null?options:{};this.subdivisions=this.options.subdivisions||0;this.scale=Math.pow(2,this.subdivisions);this.directions=[[1,0,-1],[0,1,-1],[-1,1,0],[-1,0,1],[0,-1,1],[1,-1,0]]}BarycentricLattice.prototype.contains=function(tileCoords){var tile;tile=new Int8Array(tileCoords);if(tile.length!==3){throw new Error("Invalid tile coordinates")}return tile[0]+tile[1]+tile[2]===this.scale};BarycentricLattice.prototype.findNeighbors=function(ofTile){var direction,j,len,neighbor,neighbors,ref;if(!this.contains(ofTile)){throw Error("Tile is invalid")}neighbors=[];ref=this.directions;for(j=0,len=ref.length;j<len;j++){direction=ref[j];neighbor=Goutte.Math.Tuple.clone(ofTile);neighbor[0]+=direction[0];neighbor[1]+=direction[1];neighbor[2]+=direction[2];neighbors.push(neighbor)}return neighbors};BarycentricLattice.prototype.getAllPositiveTiles=function(){var a,b,c,coords,i,j,k,n,ref,ref1;coords=[];n=this.scale;for(a=j=0,ref=n;0<=ref?j<=ref:j>=ref;a=0<=ref?++j:--j){for(i=k=0,ref1=n-a;0<=ref1?k<=ref1:k>=ref1;i=0<=ref1?++k:--k){b=i;c=n-a-b;coords.push([a,b,c])}}return coords};BarycentricLattice.prototype.rotatedDirection=function(hexDirection,angleStep){if(angleStep<0){angleStep=(angleStep%6)+6}return(hexDirection+angleStep)%6};BarycentricLattice.prototype.oppositeDirection=function(hexDirection){return(hexDirection%6+9)%6};return BarycentricLattice})()}).call(this);(function(){Goutte.Math.Tuple.create=function(length){return new Array(length)};Goutte.Math.Tuple.copy=function(out,tuple){var j,k,ref;for(k=j=0,ref=tuple.length;j<ref;k=j+=1){out[k]=tuple[k]}return out};Goutte.Math.Tuple.clone=function(tuple){var out;out=Goutte.Math.Tuple.create(tuple.length);return Goutte.Math.Tuple.copy(out,tuple)};Goutte.Math.Tuple.compareLexicographically=function(tupleA,tupleB){var j,k,lA,lB,nA,nB,ref;lA=tupleA.length;lB=tupleB.length;for(k=j=0,ref=Math.min(lA,lB);j<ref;k=j+=1){nA=tupleA[k];nB=tupleB[k];if(nA>nB){return 1}if(nA<nB){return -1}}if(lA>lB){return 1}if(lA<lB){return -1}return 0};Goutte.Math.Tuple.applySubCycle=function(tuple,start,end,offset){var i,j,lc,ref,tmp;if(offset===0){return tuple}if(start>end){throw new Error("start > end is not supported atm")}lc=end-start+1;if(lc<2){return tuple}offset=((offset%lc)+lc)%lc;tmp=null;while(offset--){tmp=tuple[start];for(i=j=0,ref=lc-1;j<ref;i=j+=1){tuple[start+i]=tuple[start+i+1]}tuple[start+lc-1]=tmp}return tuple}}).call(this);if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement){if(this===void 0||this===null){throw new TypeError()}var t=Object(this);var len=t.length>>>0;if(len===0){return -1}var n=0;if(arguments.length>0){n=Number(arguments[1]);if(n!==n){n=0}else{if(n!==0&&n!==(Infinity)&&n!==-(Infinity)){n=(n>0||-1)*Math.floor(Math.abs(n))}}}if(n>=len){return -1}var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++){if(k in t&&t[k]===searchElement){return k}}return -1}}var I18n=window.I18n=I18n||{};I18n.defaultLocale="en";I18n.fallbacks=false;I18n.defaultSeparator=".";I18n.locale=null;I18n.PLACEHOLDER=/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm;I18n.fallbackRules={};I18n.pluralizationRules={en:function(n){return n==0?["zero","none","other"]:n==1?"one":"other"}};I18n.getFallbacks=function(locale){if(locale===I18n.defaultLocale){return[]}else{if(!I18n.fallbackRules[locale]){var rules=[],components=locale.split("-");for(var l=1;l<components.length;l++){rules.push(components.slice(0,l).join("-"))}rules.push(I18n.defaultLocale);I18n.fallbackRules[locale]=rules}}return I18n.fallbackRules[locale]};I18n.isValidNode=function(obj,node,undefined){return obj[node]!==null&&obj[node]!==undefined};I18n.lookup=function(scope,options){var options=options||{},lookupInitialScope=scope,translations=this.prepareOptions(I18n.translations),locale=options.locale||I18n.currentLocale(),messages=translations[locale]||{},options=this.prepareOptions(options),currentScope;if(typeof(scope)=="object"){scope=scope.join(this.defaultSeparator)}if(options.scope){scope=options.scope.toString()+this.defaultSeparator+scope}scope=scope.split(this.defaultSeparator);while(messages&&scope.length>0){currentScope=scope.shift();messages=messages[currentScope]}if(!messages){if(I18n.fallbacks){var fallbacks=this.getFallbacks(locale);for(var fallback=0;fallback<fallbacks.length;fallbacks++){messages=I18n.lookup(lookupInitialScope,this.prepareOptions({locale:fallbacks[fallback]},options));if(messages){break}}}if(!messages&&this.isValidNode(options,"defaultValue")){messages=options.defaultValue}}return messages};I18n.prepareOptions=function(){var options={},opts,count=arguments.length;for(var i=0;i<count;i++){opts=arguments[i];if(!opts){continue}for(var key in opts){if(!this.isValidNode(options,key)){options[key]=opts[key]}}}return options};I18n.interpolate=function(message,options){options=this.prepareOptions(options);var matches=message.match(this.PLACEHOLDER),placeholder,value,name;if(!matches){return message}for(var i=0;placeholder=matches[i];i++){name=placeholder.replace(this.PLACEHOLDER,"$1");value=options[name];if(!this.isValidNode(options,name)){value="[missing "+placeholder+" value]"}regex=new RegExp(placeholder.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}"));message=message.replace(regex,value)}return message};I18n.translate=function(scope,options){options=this.prepareOptions(options);var translation=this.lookup(scope,options);try{if(typeof(translation)=="object"){if(typeof(options.count)=="number"){return this.pluralize(options.count,scope,options)}else{return translation}}else{return this.interpolate(translation,options)}}catch(err){return this.missingTranslation(scope)}};I18n.localize=function(scope,value){switch(scope){case"currency":return this.toCurrency(value);case"number":scope=this.lookup("number.format");return this.toNumber(value,scope);case"percentage":return this.toPercentage(value);default:if(scope.match(/^(date|time)/)){return this.toTime(scope,value)}else{return value.toString()}}};I18n.parseDate=function(date){var matches,convertedDate;if(typeof(date)=="object"){return date}matches=date.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2}))?(Z|\+0000)?/);if(matches){for(var i=1;i<=6;i++){matches[i]=parseInt(matches[i],10)||0}matches[2]-=1;if(matches[7]){convertedDate=new Date(Date.UTC(matches[1],matches[2],matches[3],matches[4],matches[5],matches[6]))}else{convertedDate=new Date(matches[1],matches[2],matches[3],matches[4],matches[5],matches[6])}}else{if(typeof(date)=="number"){convertedDate=new Date();convertedDate.setTime(date)}else{if(date.match(/\d+ \d+:\d+:\d+ [+-]\d+ \d+/)){convertedDate=new Date();convertedDate.setTime(Date.parse(date))}else{convertedDate=new Date();convertedDate.setTime(Date.parse(date))}}}return convertedDate};I18n.toTime=function(scope,d){var date=this.parseDate(d),format=this.lookup(scope);if(date.toString().match(/invalid/i)){return date.toString()}if(!format){return date.toString()}return this.strftime(date,format)};I18n.strftime=function(date,format){var options=this.lookup("date");if(!options){return date.toString()}options.meridian=options.meridian||["AM","PM"];var weekDay=date.getDay(),day=date.getDate(),year=date.getFullYear(),month=date.getMonth()+1,hour=date.getHours(),hour12=hour,meridian=hour>11?1:0,secs=date.getSeconds(),mins=date.getMinutes(),offset=date.getTimezoneOffset(),absOffsetHours=Math.floor(Math.abs(offset/60)),absOffsetMinutes=Math.abs(offset)-(absOffsetHours*60),timezoneoffset=(offset>0?"-":"+")+(absOffsetHours.toString().length<2?"0"+absOffsetHours:absOffsetHours)+(absOffsetMinutes.toString().length<2?"0"+absOffsetMinutes:absOffsetMinutes);if(hour12>12){hour12=hour12-12}else{if(hour12===0){hour12=12}}var padding=function(n){var s="0"+n.toString();return s.substr(s.length-2)};var f=format;f=f.replace("%a",options.abbr_day_names[weekDay]);f=f.replace("%A",options.day_names[weekDay]);f=f.replace("%b",options.abbr_month_names[month]);f=f.replace("%B",options.month_names[month]);f=f.replace("%d",padding(day));f=f.replace("%e",day);f=f.replace("%-d",day);f=f.replace("%H",padding(hour));f=f.replace("%-H",hour);f=f.replace("%I",padding(hour12));f=f.replace("%-I",hour12);f=f.replace("%m",padding(month));f=f.replace("%-m",month);f=f.replace("%M",padding(mins));f=f.replace("%-M",mins);f=f.replace("%p",options.meridian[meridian]);f=f.replace("%S",padding(secs));f=f.replace("%-S",secs);f=f.replace("%w",weekDay);f=f.replace("%y",padding(year));f=f.replace("%-y",padding(year).replace(/^0+/,""));f=f.replace("%Y",year);f=f.replace("%z",timezoneoffset);return f};I18n.toNumber=function(number,options){options=this.prepareOptions(options,this.lookup("number.format"),{precision:3,separator:".",delimiter:",",strip_insignificant_zeros:false});var negative=number<0,string=Math.abs(number).toFixed(options.precision).toString(),parts=string.split("."),precision,buffer=[],formattedNumber;number=parts[0];precision=parts[1];while(number.length>0){buffer.unshift(number.substr(Math.max(0,number.length-3),3));number=number.substr(0,number.length-3)}formattedNumber=buffer.join(options.delimiter);if(options.precision>0){formattedNumber+=options.separator+parts[1]}if(negative){formattedNumber="-"+formattedNumber}if(options.strip_insignificant_zeros){var regex={separator:new RegExp(options.separator.replace(/\./,"\\.")+"$"),zeros:/0+$/};formattedNumber=formattedNumber.replace(regex.zeros,"").replace(regex.separator,"")}return formattedNumber};I18n.toCurrency=function(number,options){options=this.prepareOptions(options,this.lookup("number.currency.format"),this.lookup("number.format"),{unit:"$",precision:2,format:"%u%n",delimiter:",",separator:"."});number=this.toNumber(number,options);number=options.format.replace("%u",options.unit).replace("%n",number);return number};I18n.toHumanSize=function(number,options){var kb=1024,size=number,iterations=0,unit,precision;while(size>=kb&&iterations<4){size=size/kb;iterations+=1}if(iterations===0){unit=this.t("number.human.storage_units.units.byte",{count:size});precision=0}else{unit=this.t("number.human.storage_units.units."+[null,"kb","mb","gb","tb"][iterations]);precision=(size-Math.floor(size)===0)?0:1}options=this.prepareOptions(options,{precision:precision,format:"%n%u",delimiter:""});number=this.toNumber(size,options);number=options.format.replace("%u",unit).replace("%n",number);return number};I18n.toPercentage=function(number,options){options=this.prepareOptions(options,this.lookup("number.percentage.format"),this.lookup("number.format"),{precision:3,separator:".",delimiter:""});number=this.toNumber(number,options);return number+"%"};I18n.pluralizer=function(locale){pluralizer=this.pluralizationRules[locale];if(pluralizer!==undefined){return pluralizer}return this.pluralizationRules.en};I18n.findAndTranslateValidNode=function(keys,translation){for(i=0;i<keys.length;i++){key=keys[i];if(this.isValidNode(translation,key)){return translation[key]}}return null};I18n.pluralize=function(count,scope,options){var translation;try{translation=this.lookup(scope,options)}catch(error){}if(!translation){return this.missingTranslation(scope)}var message;options=this.prepareOptions(options);options.count=count.toString();pluralizer=this.pluralizer(this.currentLocale());key=pluralizer(Math.abs(count));keys=((typeof key=="object")&&(key instanceof Array))?key:[key];message=this.findAndTranslateValidNode(keys,translation);if(message==null){message=this.missingTranslation(scope,keys[0])}return this.interpolate(message,options)};I18n.missingTranslation=function(){var message='[missing "'+this.currentLocale(),count=arguments.length;for(var i=0;i<count;i++){message+="."+arguments[i]}message+='" translation]';return message};I18n.currentLocale=function(){return(I18n.locale||I18n.defaultLocale)};I18n.t=I18n.translate;I18n.l=I18n.localize;I18n.p=I18n.pluralize;(function(){I18n.fallbacks=true;I18n.translations={en:{html:{tagline:"Draw one of the shapes before your opponent does",menu:{exit:"Exit"},help:{draw:"Draw one of these shapes before your opponent does",move:"Move",play:"Play"},title:{play:"Play",share:"Share",listen:"Listen",support:"Support"},play:{hotseat:"2 Players, Hotseat",online:"[LOCKED] Human vs ???, Online",versus_ai:{easy:"Solo against AI (Easy)",normal:"Solo against AI (Normal)",hard:"Solo against AI (Hard)",insane:"Solo against AI (Insane)"},status:{beaten:"Won in {{count}} moves"}},share:{download:"Download in the"},support:{plea:"Like it ? Feed us ! (seriously)"}},confirm:{abandon:"Abandon current game and return to menu ?"},help:{"continue":"(click or swipe to continue)",notif_intro_title:"It's <em>YOUR TURN</em> !",notif_intro_text:"Move the camera around and stop over the tile you wish to play on.\n\n<b>Make one of the four shapes !</b>"},error:{noleap:"No LEAP Motion Controller detected",leap_disconnected:{title:"The LEAP Motion Controller was disconnected !",text:"You can keep playing using the mouse or keyboard."},nowebgl:{message:"It looks like your browser does not support WebGL !\nWe are sorry, you need a webGL-friendly browser and video card to play.",getwebgl:"Get WebGL"}},feedback:{defeat:{title:"DEFEAT",easy:"The opponent has made one of the four shapes.",normal:"Almost there...",hard:"Better luck next time?",expert:"<strong>MWAHAHAHA!</strong>"},draw:{title:"DRAW",message:"Everybody wins! <br> Especially <strong>YOU</strong>, handsome! <br> <br> <em>(you should read <a href='http://hpmor.com'>hpmor</a> instead of painting geodes)</em>"},victory:{title:"VICTORY",hotseat:"{{name}} wins!",easy:"Well played!",normal:"You're fabulous!",hard:"You're incredible! <br> <em>Now, I will play seriously...</em>",expert:"<em>You've beaten me!? <br> I don't believe this! <br> <strong>You're an unsung genius!</strong></em><br><br><small>(if you send the replay to antoine@goutenoir.com you will be the first recorded player to ever beat Cyx's expert mode ; I definitely could not)</small>"}},achievement:{alchemist:"YOU ACHIEVED THE RANK OF ALCHEMIST !",powerplay:"YOU ACHIEVED THE RANK OF POWER PLAYER !"},player:{name:"Player {{color}}",human:"The MeatBag"},color:{orange:"orange",cyan:"cyan"}},fr:{html:{tagline:"Dessinez une des formes avant votre adversaire",menu:{exit:"Exit"},help:{draw:"Dessinez une de ces formes avant votre adversaire",move:"Se dplacer",play:"Jouer"},title:{play:"Jouer",share:"Partager",listen:"couter",support:"Encourager"},play:{hotseat:"2 joueurs, cran partag",online:"[VERROUILL] Humain vs ???, en ligne",versus_ai:{easy:"Seul contre l'IA (Facile)",normal:"Seul contre l'IA (Normal)",hard:"Seul contre l'IA (Difficile)",insane:"Seul contre l'IA (Enfer)"},status:{beaten:"Gagn en {{count}} coups"}},share:{download:"Tlcharger dans le"},support:{plea:"a vous plat ? Donnez du fromage !"}},confirm:{abandon:"Abandonner la partie courante et retourner au menu ?"},help:{"continue":"(balayez de la main ou cliquez pour continuer)",notif_intro_title:"C'est <em> VOUS DE JOUER</em> !",notif_intro_text:"Dplacez la camra et arrtez-la sur la case sur laquelle vous voulez jouer.\n\n<b>Dessinez une des quatre formes !</b>"},error:{leap_disconnected:{title:"The LEAP Motion Controller was disconnected !",text:"You can keep playing using the mouse or keyboard."},nowebgl:{message:"Il semble que votre navigateur ne supporte pas WebGL !<br>Nous sommes dsols, vous ne pourrez pas jouer...",getwebgl:"Installer WebGL"}},feedback:{defeat:"DFAITE !\nEssaye encore !",draw:"GALIT !\nTOUT LE MONDE GAGNE !",victory:"VICTOIRE !\n{{name}} A GAGN !"},achievement:{powerplay:"HAUT-FAIT DU JOUEUR ACHARN !",alchemist:"HAUT-FAIT DE L'ALCHIMISTE !"},player:{name:"Joueur {{color}}",human:"Le Sac de Viande"},color:{orange:"orange",cyan:"cyan"}},es:{html:{tagline:"Dibuja una de las formas antes que tu oponente",menu:{exit:"Exit"},help:{draw:"Dibuja una de las formas antes que tu oponente",move:"Move",play:"Jugar"},title:{play:"Jugar",share:"Compartir",listen:"Escuchar",support:"Apoyar"},play:{hotseat:"Dos jugadores, pantalla dividida",online:"[BLOQUEADO] Humano vs ???, Online",versus_ai:{easy:"Solo contra la IA (Fcil)",normal:"Solo contra la IA (Normal)",hard:"Solo contra la IA (Difcil)",insane:"Solo contra la IA (Infierno)"},status:{beaten:"Gan en {{count}} movimientos"}},share:{download:"Descarga en el"},support:{plea:"Te gusta? Alimntanos! (serio)"}},confirm:{abandon:"Abandonar partida actual y volver al men?"},help:{"continue":"(clic o pase para continuar)",notif_intro_title:"Es <strong>su turno</strong>!",notif_intro_text:"Mueva la cmara alrededor y dejar el azulejo que desea jugar."},error:{leap_disconnected:{title:"The LEAP Motion Controller was disconnected !",text:"You can keep playing using the mouse or keyboard."},nowebgl:{message:"Lo sentimos, usted necesita un navegador compatible WebGL para jugar.",getwebgl:"Get WebGL"}},feedback:{defeat:" DERROTA !\nIntntelo de nuevo.",draw:" SORTEO !\n TODOS GAGNAN !",victory:" VICTORIA !\n{{name}} gana !"},achievement:{alchemist:"YOU ACHIEVED THE RANK OF ALCHEMIST !",powerplay:"HA LOGRADO EL RANGO DE OBSESIVO JUGADOR !"},player:{name:"Jugador {{color}}",human:"La bolsa de carne"},color:{orange:"naranja",cyan:"cian"}},cn:{html:{tagline:"",menu:{exit:"Exit"},help:{draw:"",move:"",play:""},title:{play:"",share:"",listen:"",support:""},play:{hotseat:"",online:"[]",versus_ai:{easy:"AI",normal:"AI",hard:"AI",insane:"AI"},status:{beaten:"{{count}}"}},share:{download:""},support:{plea:"  "}},confirm:{abandon:""},help:{"continue":"",notif_intro_title:"",notif_intro_text:""},error:{leap_disconnected:{title:"The LEAP Motion Controller was disconnected !",text:"You can keep playing using the mouse or keyboard."},nowebgl:{message:"WebGL",getwebgl:"Get WebGL"}},feedback:{defeat:"\n",draw:"\n",victory:"\n{{name}} "},achievement:{alchemist:"",powerplay:""},player:{name:" {{color}}",human:""},color:{orange:"",cyan:""}}}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.DemoGameController=(function(superClass){extend(DemoGameController,superClass);function DemoGameController(){return DemoGameController.__super__.constructor.apply(this,arguments)}DemoGameController.prototype.game=void 0;DemoGameController.prototype.geode=void 0;DemoGameController.prototype.lastGhost=void 0;DemoGameController.prototype.numLevel=1;DemoGameController.prototype.txtLevel="easy";DemoGameController.prototype.index=function(){var firstTurnWarmup,ref;this.game=new Cyx.Game();this.ai_1=new Cyx.Player.SimpleBot({theme:"orange",name:"Dumb",game:this.game,color:GMF.Data.Color.orange});this.ai_2=new Cyx.Player.SimpleBot({theme:"cyan",name:"Dumber",game:this.game,color:GMF.Data.Color.cyan});this.game.addPlayer(this.ai_1);this.game.addPlayer(this.ai_2);this.game.setActivePlayer(this.ai_1);this.setupEverything();this.deactivateStonePlacement();if((ref=this.game.ui)!=null){ref.setCursor("wait")}firstTurnWarmup=3333;setTimeout((function(_this){return function(){var tile;tile=_this.ai_1.play(_this.lattice);if(tile===void 0){return console.error("AI HAS NOWHERE TO PLAY !?")}else{return _this.game.tryMove(tile)}}})(this),firstTurnWarmup);return this.game.on("turn_end",(function(_this){return function(e){var fxDuration,ref1;if(!_this.game.hasEnded){fxDuration=1618;setTimeout(function(){var tile;tile=_this.ai_1.play(_this.lattice);if(tile===void 0){return console.error("AI HAS NOWHERE TO PLAY !?")}else{return _this.game.tryMove(tile)}},fxDuration)}else{if((ref1=_this.game.ui)!=null){ref1.setCursor()}}return true}})(this))};return DemoGameController})(Jax.CyxGameController)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.HotseatGameController=(function(superClass){extend(HotseatGameController,superClass);function HotseatGameController(){return HotseatGameController.__super__.constructor.apply(this,arguments)}HotseatGameController.prototype.index=function(){this.game=new Cyx.Game({subdivisions:2});this.game.addPlayer(new GMF.Player.Local({theme:"orange",color:GMF.Data.Color.orange,name:I18n.t("player.name",{color:I18n.t("color.orange")})}));this.game.addPlayer(new GMF.Player.Local({theme:"cyan",color:GMF.Data.Color.cyan,name:I18n.t("player.name",{color:I18n.t("color.cyan")})}));this.game.chooseRandomActivePlayer();this.setupEverything();this.game.on("turn_end",(function(_this){return function(e){var fxDuration,ref;if(!_this.game.hasEnded){_this.deactivateStonePlacement();if((ref=_this.game.ui)!=null){ref.setCursor("wait")}fxDuration=1618;setTimeout(function(){var ref1;_this.activateStonePlacement();return(ref1=_this.game.ui)!=null?ref1.setCursor():void 0},fxDuration)}return true}})(this));return this};return HotseatGameController})(Jax.CyxGameController)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.ReplayGameController=(function(superClass){extend(ReplayGameController,superClass);function ReplayGameController(){return ReplayGameController.__super__.constructor.apply(this,arguments)}ReplayGameController.prototype.game=void 0;ReplayGameController.prototype.geode=void 0;ReplayGameController.prototype.replay=void 0;ReplayGameController.prototype.currentReplayMove=0;ReplayGameController.prototype.timeout_initial=2222;ReplayGameController.prototype.timeout_between_moves=2772;ReplayGameController.prototype.index=function(){var encodedMoves;encodedMoves=jQuery.url().param("replay");encodedMoves=LZString.decompressFromEncodedURIComponent(encodedMoves);this.replay=encodedMoves.split(";");this.game=new Cyx.Game();this.game.addPlayer(new GMF.Player.Local({theme:"orange",color:GMF.Data.Color.orange,name:I18n.t("player.name",{color:I18n.t("color.orange")})}));this.game.addPlayer(new GMF.Player.Local({theme:"cyan",color:GMF.Data.Color.cyan,name:I18n.t("player.name",{color:I18n.t("color.cyan")})}));this.setupEverything();this.deactivateStonePlacement();return setTimeout(((function(_this){return function(){return _this.replayNextMove()}})(this)),this.timeout_initial)};ReplayGameController.prototype.replayNextMove=function(){var moveCoords,moveData,playerId;if(this.currentReplayMove<this.replay.length){moveData=this.replay[this.currentReplayMove].split(",");playerId=moveData[0];moveCoords=moveData.slice(1);this.game.setActivePlayer(this.game.players[playerId]);this.game.tryMove(this.lattice.findTileAt(moveCoords));this.currentReplayMove++;setTimeout(((function(_this){return function(){return _this.replayNextMove()}})(this)),this.timeout_between_moves)}return this};return ReplayGameController})(Jax.CyxGameController)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.SingleGameController=(function(superClass){extend(SingleGameController,superClass);function SingleGameController(){return SingleGameController.__super__.constructor.apply(this,arguments)}SingleGameController.prototype.game=void 0;SingleGameController.prototype.geode=void 0;SingleGameController.prototype.lastGhost=void 0;SingleGameController.prototype.numLevel=1;SingleGameController.prototype.txtLevel="easy";SingleGameController.prototype.index=function(){return this.playLevel(this.numLevel,this.txtLevel)};SingleGameController.prototype.playEasy=function(){return this.playLevel(1,"easy")};SingleGameController.prototype.playNormal=function(){return this.playLevel(2,"normal")};SingleGameController.prototype.playHard=function(){return this.playLevel(3,"hard")};SingleGameController.prototype.playExpert=function(){return this.playLevel(4,"expert")};SingleGameController.prototype.playLevel=function(numLevel,txtLevel){this.numLevel=numLevel;this.txtLevel=txtLevel;this.game=new Cyx.Game();this.human=new GMF.Player.Local({theme:"orange",color:GMF.Data.Color.orange,name:I18n.t("player.human")});if(this.numLevel<4){this.ai=new Cyx.Player.DumbBot({theme:"cyan",name:this.txtLevel.capitalize()+" Cyx Ranger",game:this.game,color:GMF.Data.Color.cyan,intolerance:Math.min(this.numLevel,4),numLevel:this.numLevel,txtLevel:this.txtLevel})}else{this.ai=new Cyx.Player.SimpleBot({theme:"cyan",name:"Masato-san",game:this.game,color:GMF.Data.Color.cyan})}this.game.addPlayer(this.human);this.game.addPlayer(this.ai);this.game.setActivePlayer(this.human);this.setupEverything();return this.game.on("turn_end",(function(_this){return function(e){var fxDuration,ref,ref1;if(e.oldPlayer===_this.human&&!_this.game.hasEnded){_this.deactivateStonePlacement();if((ref=_this.game.ui)!=null){ref.setCursor("wait")}fxDuration=1618;setTimeout(function(){var tile;tile=_this.ai.play(_this.lattice);if(tile===void 0){return console.error("AI HAS NOWHERE TO PLAY !?")}else{return _this.game.tryMove(tile)}},fxDuration)}else{if((ref1=_this.game.ui)!=null){ref1.setCursor()}_this.activateStonePlacement()}return true}})(this))};return SingleGameController})(Jax.CyxGameController)}).call(this);(function(){Jax.Mesh.Base.prototype.getVerticesAsVectors=function(){var data,i,j,ref,vertices;vertices=[];data=this.data.vertexBuffer;for(i=j=0,ref=data.length;j<ref;i=j+=3){vertices.push(vec3.fromValues(data[i],data[i+1],data[i+2]))}return vertices};Jax.Mesh.Triangles.prototype.getFacesAsTriangles=function(){var data,faces,i,j,ref;faces=[];data=this.data.vertexBuffer;for(i=j=0,ref=data.length;j<ref;i=j+=9){faces.push(new Jax.Geometry.Triangle([data[i+0],data[i+1],data[i+2]],[data[i+3],data[i+4],data[i+5]],[data[i+6],data[i+7],data[i+8]]))}return faces};Jax.Geometry.Triangle.prototype.isEquilateral=function(){var distA,distB,distC;distA=vec3.distance(this.a,this.b);distB=vec3.distance(this.b,this.c);distC=vec3.distance(this.c,this.a);return Math.equalish(distA,distB)&&Math.equalish(distB,distC)}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Mesh.LatticedGeode=(function(superClass){var gol;extend(LatticedGeode,superClass);gol=(1+Math.sqrt(5))/2;LatticedGeode.prototype.icosahedron={vertices:[[-1,gol,0],[1,gol,0],[-1,-gol,0],[1,-gol,0],[0,-1,gol],[0,1,gol],[0,-1,-gol],[0,1,-gol],[gol,0,-1],[gol,0,1],[-gol,0,-1],[-gol,0,1]],faces:[[0,11,5],[10,7,6],[4,2,3],[1,9,8],[3,6,8],[2,4,11],[9,1,5],[7,10,0],[9,5,4],[1,8,7],[11,0,10],[3,2,6],[7,0,1],[10,6,2],[8,9,3],[5,11,4],[2,11,10],[4,3,9],[0,5,1],[6,7,8]],coords:[[0,1,2,3,4],[0,2,1,4,3],[0,3,1,2,4],[0,4,1,3,2],[1,0,2,4,3],[1,2,0,3,4],[1,3,0,4,2],[1,4,0,2,3],[2,0,1,3,4],[2,1,0,4,3],[2,3,0,1,4],[2,4,0,3,1],[3,0,1,4,2],[3,1,0,2,4],[3,2,0,4,1],[3,4,0,1,2],[4,0,1,2,3],[4,1,0,3,2],[4,2,0,1,3],[4,3,0,2,1]],uvU:2/11,uvV:1/3,facesUVs:[[[1,1],[1/2,0],[0,1]],[[2,1],[3/2,2],[5/2,2]],[[4,1],[3,1],[7/2,2]],[[11/2,2],[9/2,2],[5,3]],[[7/2,2],[5/2,2],[3,3]],[[3,1],[4,1],[7/2,0]],[[9/2,2],[11/2,2],[5,1]],[[3/2,2],[2,1],[1,1]],[[9/2,2],[5,1],[4,1]],[[1/2,2],[1,3],[3/2,2]],[[3/2,0],[1,1],[2,1]],[[7/2,2],[3,1],[5/2,2]],[[3/2,2],[1,1],[1/2,2]],[[2,1],[5/2,2],[3,1]],[[4,3],[9/2,2],[7/2,2]],[[5,1],[9/2,0],[4,1]],[[3,1],[5/2,0],[2,1]],[[4,1],[7/2,2],[9/2,2]],[[1,1],[0,1],[1/2,2]],[[5/2,2],[3/2,2],[2,3]]]};function LatticedGeode(options){if(options==null){options={}}this.size=1;this.subdivisions=options.subdivisions||0;if(this.subdivisions>5){console.warn("Geode subdivided > 5 times is NOT supported ATM. Use at your own risk !")}this.lattice=new GMF.Space.GeodeVerticesLattice({subdivisions:this.subdivisions});LatticedGeode.__super__.constructor.call(this,options)}LatticedGeode.prototype.init=function(vertices,colors,textureCoords,vertexNormals,vertexIndices,tangents,bitangents){var __vA,__vB,__vC,_vA,_vB,_vC,face,faceUVs,i,j,k,len,len1,n,permutations,recursiveInit,recursiveInitUV,recursiveInitWithLattice,ref,ref1,ref2,size,u,v,vertexCoords;size=this.size;_vA=vec3.create();_vB=vec3.create();_vC=vec3.create();recursiveInit=function(vA,vB,vC,detail){var midAB,midBC,midCA;if(detail<1){vec3.normalize(_vA,vA);vec3.normalize(_vB,vB);vec3.normalize(_vC,vC);vertexNormals.push(_vA[0],_vA[1],_vA[2],_vB[0],_vB[1],_vB[2],_vC[0],_vC[1],_vC[2]);vec3.scale(_vA,_vA,size);vec3.scale(_vB,_vB,size);vec3.scale(_vC,_vC,size);vertices.push(_vA[0],_vA[1],_vA[2],_vB[0],_vB[1],_vB[2],_vC[0],_vC[1],_vC[2])}else{detail--;midAB=vec3.create();midBC=vec3.create();midCA=vec3.create();vec3.scale(midAB,vec3.add(midAB,vA,vB),1/2);vec3.scale(midBC,vec3.add(midBC,vB,vC),1/2);vec3.scale(midCA,vec3.add(midCA,vC,vA),1/2);recursiveInit(vA,midAB,midCA,detail);recursiveInit(midAB,vB,midBC,detail);recursiveInit(midCA,midBC,vC,detail);recursiveInit(midAB,midBC,midCA,detail)}return true};u=this.icosahedron.uvU;v=this.icosahedron.uvV;recursiveInitUV=function(uvA,uvB,uvC,detail){var midAB,midBC,midCA;if(detail<1){textureCoords.push(uvA[0]*u,uvA[1]*v,uvB[0]*u,uvB[1]*v,uvC[0]*u,uvC[1]*v)}else{detail--;midAB=vec3.create();midBC=vec3.create();midCA=vec3.create();vec3.scale(midAB,vec3.add(midAB,uvA,uvB),1/2);vec3.scale(midBC,vec3.add(midBC,uvB,uvC),1/2);vec3.scale(midCA,vec3.add(midCA,uvC,uvA),1/2);recursiveInitUV(uvA,midAB,midCA,detail);recursiveInitUV(midAB,uvB,midBC,detail);recursiveInitUV(midCA,midBC,uvC,detail);recursiveInitUV(midAB,midBC,midCA,detail)}return true};__vA=vec3.create();__vB=vec3.create();__vC=vec3.create();recursiveInitWithLattice=function(lattice,a5Coord,vA,baryA,vB,baryB,vC,baryC,detail){var baryAB,baryBC,baryCA,midAB,midBC,midCA,tileCoordsA,tileCoordsB,tileCoordsC;if(detail<1){vec3.normalize(__vA,vA);vec3.normalize(__vB,vB);vec3.normalize(__vC,vC);vertexNormals.push(__vA[0],__vA[1],__vA[2],__vB[0],__vB[1],__vB[2],__vC[0],__vC[1],__vC[2]);vec3.scale(__vA,__vA,size);vec3.scale(__vB,__vB,size);vec3.scale(__vC,__vC,size);vertices.push.apply(vertices,__vA);vertices.push.apply(vertices,__vB);vertices.push.apply(vertices,__vC);tileCoordsA=[a5Coord[0],a5Coord[1],a5Coord[2],a5Coord[3],a5Coord[4],baryA[0],baryA[1],baryA[2]];tileCoordsA=lattice.normalize(tileCoordsA);vertexCoords.push(tileCoordsA);tileCoordsB=[a5Coord[0],a5Coord[1],a5Coord[2],a5Coord[3],a5Coord[4],baryB[0],baryB[1],baryB[2]];tileCoordsB=lattice.normalize(tileCoordsB);vertexCoords.push(tileCoordsB);tileCoordsC=[a5Coord[0],a5Coord[1],a5Coord[2],a5Coord[3],a5Coord[4],baryC[0],baryC[1],baryC[2]];tileCoordsC=lattice.normalize(tileCoordsC);vertexCoords.push(tileCoordsC)}else{detail--;midAB=vec3.create();midBC=vec3.create();midCA=vec3.create();vec3.scale(midAB,vec3.add(midAB,vA,vB),1/2);vec3.scale(midBC,vec3.add(midBC,vB,vC),1/2);vec3.scale(midCA,vec3.add(midCA,vC,vA),1/2);baryAB=vec3.create();baryBC=vec3.create();baryCA=vec3.create();vec3.scale(baryAB,vec3.add(baryAB,baryA,baryB),1/2);vec3.scale(baryBC,vec3.add(baryBC,baryB,baryC),1/2);vec3.scale(baryCA,vec3.add(baryCA,baryC,baryA),1/2);recursiveInitWithLattice(lattice,a5Coord,vA,baryA,midAB,baryAB,midCA,baryCA,detail);recursiveInitWithLattice(lattice,a5Coord,midAB,baryAB,vB,baryB,midBC,baryBC,detail);recursiveInitWithLattice(lattice,a5Coord,midCA,baryCA,midBC,baryBC,vC,baryC,detail);recursiveInitWithLattice(lattice,a5Coord,midAB,baryAB,midBC,baryBC,midCA,baryCA,detail)}return true};if(this.lattice){permutations=this.lattice.a5.getIcosaPermutations();n=Math.pow(2,this.subdivisions);vertexCoords=[];ref=this.icosahedron.faces;for(k in ref){face=ref[k];recursiveInitWithLattice(this.lattice,permutations[k],vec3.clone(this.icosahedron.vertices[face[0]]),[n,0,0],vec3.clone(this.icosahedron.vertices[face[1]]),[0,n,0],vec3.clone(this.icosahedron.vertices[face[2]]),[0,0,n],this.subdivisions)}this._geode_vertex_coords=vertexCoords}else{ref1=this.icosahedron.faces;for(i=0,len=ref1.length;i<len;i++){face=ref1[i];recursiveInit(vec3.clone(this.icosahedron.vertices[face[0]]),vec3.clone(this.icosahedron.vertices[face[1]]),vec3.clone(this.icosahedron.vertices[face[2]]),this.subdivisions)}}ref2=this.icosahedron.facesUVs;for(j=0,len1=ref2.length;j<len1;j++){faceUVs=ref2[j];recursiveInitUV(vec2.clone(faceUVs[0]),vec2.clone(faceUVs[1]),vec2.clone(faceUVs[2]),this.subdivisions)}return true};return LatticedGeode})(Jax.Mesh.Triangles)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,slice=[].slice;Jax.SubMesh=Jax.SubMesh||{};Jax.SubMesh.TriangleFan=(function(){function TriangleFan(trianglesCount,mesh,verticesStart){this.trianglesCount=trianglesCount;this.mesh=mesh;this.verticesStart=verticesStart!=null?verticesStart:0}TriangleFan.prototype.getCenter=function(){var j,vertexBuffer;vertexBuffer=this.mesh.vertices;j=this.verticesStart;return vec3.fromValues(vertexBuffer[j],vertexBuffer[j+1],vertexBuffer[j+2])};TriangleFan.prototype.getNormal=function(){var i,k,normal,ref;normal=vec3.create();for(i=k=0,ref=this.trianglesCount;k<ref;i=k+=1){vec3.add(normal,normal,this.getTriangleNormal(i))}return vec3.normalize(normal,normal)};TriangleFan.prototype.getTriangleNormal=function(nth){var j,normal,vA,vAB,vAC,vB,vC,vertexBuffer;vertexBuffer=this.mesh.vertices;j=this.verticesStart+nth*9;vA=vec3.fromValues(vertexBuffer[j],vertexBuffer[j+1],vertexBuffer[j+2]);vB=vec3.fromValues(vertexBuffer[j+3],vertexBuffer[j+4],vertexBuffer[j+5]);vC=vec3.fromValues(vertexBuffer[j+6],vertexBuffer[j+7],vertexBuffer[j+8]);vAB=vec3.subtract(vec3.create(),vB,vA);vAC=vec3.subtract(vec3.create(),vC,vA);normal=vec3.create();vec3.cross(normal,vAB,vAC);return vec3.normalize(normal,normal)};return TriangleFan})();Jax.SubMesh.Pentagon=(function(superClass){extend(Pentagon,superClass);function Pentagon(mesh,verticesStart){this.mesh=mesh;this.verticesStart=verticesStart!=null?verticesStart:0;Pentagon.__super__.constructor.call(this,5,this.mesh,this.verticesStart)}return Pentagon})(Jax.SubMesh.TriangleFan);Jax.SubMesh.Hexagon=(function(superClass){extend(Hexagon,superClass);function Hexagon(mesh,verticesStart){this.mesh=mesh;this.verticesStart=verticesStart!=null?verticesStart:0;Hexagon.__super__.constructor.call(this,6,this.mesh,this.verticesStart)}return Hexagon})(Jax.SubMesh.TriangleFan);Jax.Mesh.LatticedGeodeDual=(function(superClass){extend(LatticedGeodeDual,superClass);function LatticedGeodeDual(options){if(options==null){options={}}if(options.subdivisions>3){console.warn("Dual Geode subdivided > 3 times is not supported.")}LatticedGeodeDual.__super__.constructor.call(this,options);this.pentagons=[];this.hexagons=[]}LatticedGeodeDual.prototype.init=function(vertices,colors,textureCoords,vertexNormals,vertexIndices,tangents,bitangents){var a,b,c,centerVertices,closestVertices,currentVertexBufferIndex,geodeColors,geodeTextureCoords,geodeVertexCoords,geodeVertexNormals,geodeVertices,getClosestVertices,hexagon,i,icosahedronVertices,isIn,k,l,m,medianAltitude,n,o,p,pentagon,ref,ref1,ref2,ref3,ref4,secret,secret_uvs,uniqueGeodeVertices,uniqueGeodeVerticesCoords,vertex,vertexKey;isIn=function(needleVertex,verticesHaystack){var k,len1,vertex;for(k=0,len1=verticesHaystack.length;k<len1;k++){vertex=verticesHaystack[k];if(vec3.distance(needleVertex,vertex)<Math.EPSILON){return true}}return false};getClosestVertices=function(vertex,vertices,howMuch){var _vA,_vB,closestVertices,i,k,ref,start;howMuch=Math.min(howMuch,vertices.length);vertices.sort(function(vA,vB){if(vA===vertex){return 1}if(vB===vertex){return -1}return vec3.dot(vertex,vB)-vec3.dot(vertex,vA)});closestVertices=[];for(i=k=0,ref=howMuch;k<ref;i=k+=1){closestVertices.push(vertices[i])}start=vec3.subtract([],closestVertices[0],vertex);vec3.normalize(start,start);_vA=vec3.create();_vB=vec3.create();closestVertices.sort(function(vA,vB){var a,b,dA,dB,dotA,dotB;dA=vec3.normalize(_vA,vec3.subtract(_vA,vA,vertex));dB=vec3.normalize(_vB,vec3.subtract(_vB,vB,vertex));a=vec3.dot(start,dA)+1;b=vec3.dot(start,dB)+1;dotA=vec3.dot(vertex,vec3.cross([],start,dA));dotB=vec3.dot(vertex,vec3.cross([],start,dB));if(dotA<0){a*=-1}if(dotB<0){b*=-1}return b-a});return closestVertices};ref=[[],[],[],[]],geodeVertices=ref[0],geodeColors=ref[1],geodeTextureCoords=ref[2],geodeVertexNormals=ref[3];LatticedGeodeDual.__super__.init.call(this,geodeVertices,geodeColors,geodeTextureCoords,geodeVertexNormals);geodeVertexCoords=this._geode_vertex_coords;uniqueGeodeVertices=[];uniqueGeodeVerticesCoords=[];centerVertices=[];for(i=k=0,ref1=geodeVertices.length;k<ref1;i=k+=9){a=[geodeVertices[i],geodeVertices[i+1],geodeVertices[i+2]];b=[geodeVertices[i+3],geodeVertices[i+4],geodeVertices[i+5]];c=[geodeVertices[i+6],geodeVertices[i+7],geodeVertices[i+8]];o=vec3.scale([],vec3.normalize([],vec3.add([],vec3.add([],a,b),c)),this.size);if(!isIn(a,uniqueGeodeVertices)){uniqueGeodeVertices.push(a);uniqueGeodeVerticesCoords.push(geodeVertexCoords[0+i/3])}if(!isIn(b,uniqueGeodeVertices)){uniqueGeodeVertices.push(b);uniqueGeodeVerticesCoords.push(geodeVertexCoords[1+i/3])}if(!isIn(c,uniqueGeodeVertices)){uniqueGeodeVertices.push(c);uniqueGeodeVerticesCoords.push(geodeVertexCoords[2+i/3])}centerVertices.push(o)}icosahedronVertices=this.icosahedron.vertices.slice(0);for(i=l=0,ref2=icosahedronVertices.length;l<ref2;i=l+=1){vec3.normalize(icosahedronVertices[i],icosahedronVertices[i]);vec3.scale(icosahedronVertices[i],icosahedronVertices[i],this.size)}secret=window.secret=[];currentVertexBufferIndex=0;for(vertexKey in uniqueGeodeVertices){vertex=uniqueGeodeVertices[vertexKey];if(isIn(vertex,icosahedronVertices)){n=5;pentagon=new Jax.SubMesh.Pentagon(this,currentVertexBufferIndex);pentagon.tile=this.lattice.findTileAt(uniqueGeodeVerticesCoords[vertexKey]);pentagon.tile.submesh=pentagon;this.pentagons.push(pentagon);this.pushPentagonUV(textureCoords);secret_uvs=[];this.pushPentagonUV(secret_uvs);secret.push([n,pentagon,pentagon.tile.coordinates.full,secret_uvs])}else{n=6;hexagon=new Jax.SubMesh.Hexagon(this,currentVertexBufferIndex);hexagon.tile=this.lattice.findTileAt(uniqueGeodeVerticesCoords[vertexKey]);hexagon.tile.submesh=hexagon;this.hexagons.push(hexagon);this.pushHexagonUV(textureCoords);secret_uvs=[];this.pushHexagonUV(secret_uvs);secret.push([n,hexagon,hexagon.tile.coordinates.full,secret_uvs])}closestVertices=getClosestVertices(vertex,centerVertices,n);medianAltitude=[0,0,0];for(i=m=0,ref3=n;m<ref3;i=m+=1){vec3.add(medianAltitude,medianAltitude,closestVertices[i])}medianAltitude=vec3.length(medianAltitude)/n;vec3.normalize(vertex,vertex);vec3.scale(vertex,vertex,medianAltitude);for(i=p=0,ref4=n;p<ref4;i=p+=1){vertices.push.apply(vertices,vertex);vertices.push(closestVertices[i][0],closestVertices[i][1],closestVertices[i][2]);vertices.push(closestVertices[(i+1)%n][0],closestVertices[(i+1)%n][1],closestVertices[(i+1)%n][2])}currentVertexBufferIndex+=n*9}return true};LatticedGeodeDual.prototype.pushPentagonUV=function(intoUVs){var k,l,len1,len2,o,ref,v,vertices;vertices=[];ref=GMF.Math.Pentagon.geometry.top.verticesCartesian;for(k=0,len1=ref.length;k<len1;k++){v=ref[k];vertices.push(v.slice(0))}o=[1,1];for(l=0,len2=vertices.length;l<len2;l++){v=vertices[l];v[1]*=-1;vec2.add(v,v,o);v[0]*=1/4;v[1]*=1/2}o=vertices.shift();this.pushTriangleFanUV(o,vertices,intoUVs);return void 0};LatticedGeodeDual.prototype.pushHexagonUV=function(intoUVs){var k,l,len1,len2,o,ref,v,vertices;vertices=[];ref=GMF.Math.Hexagon.geometry.top.verticesCartesian;for(k=0,len1=ref.length;k<len1;k++){v=ref[k];vertices.push(v.slice(0))}o=[1,1];for(l=0,len2=vertices.length;l<len2;l++){v=vertices[l];v[1]*=-1;vec2.add(v,v,o);v[0]*=1/4;v[1]*=1/2;v[0]+=0.5}o=vertices.shift();this.pushTriangleFanUV(o,vertices,intoUVs);return void 0};LatticedGeodeDual.prototype.pushTriangleFanUV=function(o,vertices,intoUVs){var i,k,len,ref,v1,v2;len=vertices.length;for(i=k=0,ref=len;k<ref;i=k+=1){v1=vertices[(i+0)%len];v2=vertices[(i+1)%len];this.pushTriangleUV(o,v1,v2,intoUVs)}return void 0};LatticedGeodeDual.prototype.pushTriangleUV=function(a,b,c,intoUVs){return intoUVs.push.apply(intoUVs,slice.call(a).concat(slice.call(b),slice.call(c)))};return LatticedGeodeDual})(Jax.Mesh.LatticedGeode)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Mesh.Ray=(function(superClass){extend(Ray,superClass);function Ray(data){this.origin=data.origin||[0,0,0];this.target=data.target||null;this.direction=data.direction||[0,0,0];this.segmentLength=data.segmentLength||1;Ray.__super__.constructor.call(this,data)}Ray.prototype.init=function(vertices,colors,normals,textures,indices){var origin,target;origin=this.origin;if(this.target){target=this.target}else{target=vec3.create();vec3.add(target,origin,vec3.scale(target,this.direction,this.segmentLength))}vertices.push.apply(vertices,origin);vertices.push.apply(vertices,target);textures.push.apply(textures,[0,0]);textures.push.apply(textures,[1,1]);return true};return Ray})(Jax.Mesh.Lines)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.getGlobal().Etaba=(function(superClass){extend(Etaba,superClass);function Etaba(){return Etaba.__super__.constructor.apply(this,arguments)}Etaba.prototype.targetSubmesh=void 0;Etaba.prototype._hiddenMesh=void 0;Etaba.prototype._currentColorBufferIndex=0;Etaba.prototype._endColorBufferIndex=void 0;Etaba.prototype.after_initialize=function(){this.duration||(this.duration=1.618*1.5);this.mesh=new Jax.Mesh.Torus({innerRadius:this.innerRadius,outerRadius:this.outerRadius,sides:this.sides,rings:this.rings,color:this.color,material:new Jax.Material.Custom({layers:[{type:"Position"},{type:"VertexColor"}]})});return this._hiddenMesh=this.mesh};Etaba.prototype.update=function(timechange){if(this.mesh){this.step(Math.floor(timechange*this._meshVerticesCount/this.duration)||1);return this.camera.roll(this.rotationSpeed*timechange*Math.TAU)}};Etaba.prototype.hide=function(){this.mesh=void 0;this.targetSubmesh=void 0;this._endColorBufferIndex=void 0;return this};Etaba.prototype.show=function(){if(!this.mesh){this.mesh=this._hiddenMesh}return this};Etaba.prototype.showOn=function(submesh,lookingAt){if(lookingAt==null){lookingAt=[0,0,0]}this.show();if(submesh===this.targetSubmesh){return this}this.targetSubmesh=submesh;this.camera.lookAt(submesh.getCenter(),lookingAt,this.camera.get("up"));this.reset();return this};Etaba.prototype._fillingColor=new Jax.Color().parse("#ff0");Etaba.prototype.setFillingColor=function(color){return this._fillingColor=Jax.Color.parse(color)};Etaba.prototype.reset=function(){var l;if(this.mesh){this.mesh.color=this.color;l=this.mesh.data.colorBuffer.length;this._endColorBufferIndex=(this._currentColorBufferIndex+l)%l;return this._meshVerticesCount=l/4}};Etaba.prototype.step=function(n){var _color,buf,data,i,j,k,ref;if(!this.mesh){return false}n||(n=1);data=this.mesh.data;buf=this.mesh.data.colorBuffer;_color=this._fillingColor;for(k=j=0,ref=n;j<ref;k=j+=1){i=this._currentColorBufferIndex;buf[i+0]=_color.red;buf[i+1]=_color.green;buf[i+2]=_color.blue;buf[i+3]=_color.alpha;this._currentColorBufferIndex=(this._currentColorBufferIndex+4)%buf.length;if(this._currentColorBufferIndex===this._endColorBufferIndex){this.trigger("action")}}data.trigger("colorChanged");return data.invalidate()};return Etaba})(Jax.Model)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.getGlobal().Ghost=(function(superClass){extend(Ghost,superClass);function Ghost(){return Ghost.__super__.constructor.apply(this,arguments)}Ghost.prototype._hiddenMesh=void 0;Ghost.prototype.targetSubmesh=void 0;Ghost.prototype._materialName="Normal";Ghost.prototype.after_initialize=function(){this.materials={Normal:new Jax.Material.Custom({layers:[{type:"Position"},{type:"VertexColor"},{type:"Ghost"}]}),Emphasized:new Jax.Material.Custom({layers:[{type:"Position"},{type:"VertexColor"},{type:"GhostImportant"}]})};this;this.mesh=new Jax.Mesh.Sphere({radius:this.size,color:this.color,material:this.materials[this._materialName]});return this._hiddenMesh=this.mesh};Ghost.prototype.update=function(timechange){return this.camera.roll(this.rotationSpeed*timechange*Math.TAU)};Ghost.prototype.setColor=function(color){var ref,ref1;color=vec4.clone(color);color[3]=this.alpha;if((ref=this.mesh)!=null){ref.color=color}return(ref1=this._hiddenMesh)!=null?ref1.color=color:void 0};Ghost.prototype.setNormal=function(){return this.setMaterial("Normal")};Ghost.prototype.setEmphasized=function(){return this.setMaterial("Emphasized")};Ghost.prototype.setMaterial=function(materialName){if(this._materialName!==materialName){this._materialName=materialName;this.mesh.material=this.materials[materialName]}return this};Ghost.prototype.hide=function(){this.mesh=void 0;this.targetSubmesh=void 0;return this};Ghost.prototype.show=function(){if(!this.mesh){this.mesh=this._hiddenMesh}return this};Ghost.prototype.showOn=function(submesh,lookingAt){if(lookingAt==null){lookingAt=[0,0,0]}this.positionOnSubmesh(submesh,lookingAt);this.show();return this};Ghost.prototype.positionOnSubmesh=function(submesh,lookingAt){if(lookingAt==null){lookingAt=[0,0,0]}if(submesh===this.targetSubmesh){return this}this.targetSubmesh=submesh;this.camera.lookAt(submesh.getCenter(),lookingAt,this.camera.get("up"));return this};Ghost.prototype.alignWith=function(otherGhost){this.camera.setRotation(otherGhost.camera.get("rotation"));return this};return Ghost})(Jax.Model)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.getGlobal().Ray=(function(superClass){extend(Ray,superClass);function Ray(){return Ray.__super__.constructor.apply(this,arguments)}Ray.prototype.after_initialize=function(){return this.mesh=new Jax.Mesh.Ray({origin:this.origin,target:this.target,direction:this.direction,segmentLength:this.segmentLength})};return Ray})(Jax.Model)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.getGlobal().Stone=(function(superClass){extend(Stone,superClass);function Stone(){return Stone.__super__.constructor.apply(this,arguments)}Stone.prototype.after_initialize=function(){};Stone.prototype.tile=void 0;Stone.prototype._normal=void 0;Stone.prototype._apparitionTranslationDistance=0.04242;Stone.prototype.build_mesh=function(tileSubmesh){var posFrom,posTo,rotFrom,rotTo;this.tile=tileSubmesh.tile;this.mesh=new Cyx.Mesh.Stone.Cone({tile:this.tile,size:this.size,material:"glowstone"});this._normal=tileSubmesh.getNormal();rotFrom=quat.setAxisAngle(quat.create(),this._normal,-0.999*Math.TAU/2);rotTo=quat.setAxisAngle(quat.create(),this._normal,0);this.camera.setRotation(rotFrom);this.camera.animate({rotation:rotTo,easing:TWEEN.Easing.Sinusoidal.Out,duration:this.apparitionDuration*1000,queue:"stone_"+this.tile.coordinates.full.join("")+"_rotation"});posTo=vec3.clone(this.camera.get("position"));posFrom=vec3.scale(vec3.create(),this._normal,this._apparitionTranslationDistance);posFrom=vec3.sub(posFrom,posTo,posFrom);this.camera.setPosition(posFrom);return this.camera.animate({position:posTo,easing:TWEEN.Easing.Cubic.Out,duration:this.apparitionDuration*1000,queue:"stone_"+this.tile.coordinates.full.join("")+"_position"})};return Stone})(Jax.Model)}).call(this);(function(){Jax.Material.addResources({basic:{type:"Custom",layers:[{type:"Basic"}]},"default":{type:"Surface",intensity:{ambient:1,diffuse:1,specular:1},shininess:60,color:{ambient:"#ffffff",diffuse:"#cccccc",specular:"#ffffff"}},depthmap:{type:"Custom",layers:[{type:"Position"},{type:"Depthmap"}]},"paraboloid-depthmap":{type:"Custom",layers:[{type:"Paraboloid"},{type:"Depthmap"}]},picking:{type:"Custom",layers:[{type:"Position"},{type:"Picking"}]},ssao:{type:"Custom",layers:[{type:"SSAO"}]},wire:{type:"Wire",intensity:{ambient:1,diffuse:1,specular:1},shininess:60,color:{ambient:"#ffffff",diffuse:"#cccccc",specular:"#ffffff"}}})}).call(this);(function(){Jax.getGlobal().Etaba.addResources({"default":{color:Jax.Color.parse("#4f4f4f"),rotationSpeed:-1.618*0.777,alpha:0.85,innerRadius:0.019999,outerRadius:0.122222,sides:13,rings:23}})}).call(this);(function(){Jax.getGlobal().Ghost.addResources({"default":{color:[0,0,0,1],size:0.099,rotationSpeed:0.5,alpha:0.85}})}).call(this);(function(){Jax.getGlobal().Ghost.addResources({last_move:{rotationSpeed:0.5,size:0.099,alpha:0.85}})}).call(this);(function(){Jax.Light.addResources({camera_flashlight:{shadowcaster:false,enabled:true,position:{x:0,y:0,z:0},type:Jax.POINT_LIGHT,attenuation:{constant:0,linear:0,quadratic:0.28},color:{ambient:{red:0.2,green:0.2,blue:0.2,alpha:1},diffuse:{red:0.5,green:0.5,blue:0.5,alpha:1},specular:{red:0.2,green:0.2,blue:0.2,alpha:1}}}})}).call(this);(function(){Jax.Material.addResources({geode:{type:"Custom",color:{diffuse:"#ffffff",specular:"#ffffff"},intensity:{ambient:1,diffuse:1,specular:1},shininess:60,layers:[{type:"Position"},{type:"VertexColor"},{type:"Texture",path:"img/uvs/geode/anthracite.png"}]}})}).call(this);(function(){Jax.Material.addResources({glowstone:{type:"Custom",color:{diffuse:"#ffffff",specular:"#ffffff"},intensity:{ambient:1,diffuse:1,specular:1},shininess:60,layers:[{type:"Position"},{type:"VertexColor"},{type:"Texture",path:"img/uvs/geode/graphite.png"}]}})}).call(this);(function(){Jax.getGlobal().Ray.addResources({"default":{}})}).call(this);(function(){Jax.getGlobal().Stone.addResources({"default":{}})}).call(this);(function(){Jax.getGlobal().Stone.addResources({hexagon:{size:0.128,isHexagon:true,isPentagon:false,winningColor:[1,1,0,1],apparitionDuration:1.618}})}).call(this);(function(){Jax.getGlobal().Stone.addResources({pentagon:{size:0.089,isHexagon:false,isPentagon:true,winningColor:[1,1,0,1],apparitionDuration:1.618}})}).call(this);(function(){}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/attenuation/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("",require("shaders/lib/lights"),"\n\nshared uniform int PASS;\nshared uniform float ConstantAttenuation;\nshared uniform float LinearAttenuation;\nshared uniform float QuadraticAttenuation;\n\nvoid main(void) {\n  if (PASS != 0) {\n    cache(float, LightDistanceFromSurface) { LightDistanceFromSurface = 1.0; }\n    cache(float, SpotAttenuation) { SpotAttenuation = 1.0; }\n\n    float multiplier = 1.0;\n    import(AttenuationMultiplier, multiplier *= AttenuationMultiplier);\n\n    // the SkipAttenuation stuff will be optimized out by the compiler since it will\n    // be essentially become a set of constant expressions\n    int skipAttenuation = 0;\n    import(SkipAttenuation, skipAttenuation += SkipAttenuation);\n  \n    if (skipAttenuation == 0) {\n      multiplier *= SpotAttenuation;\n      gl_FragColor.rgb *= multiplier / (ConstantAttenuation +\n                                 LinearAttenuation * LightDistanceFromSurface +\n                                 QuadraticAttenuation * pow(LightDistanceFromSurface, 2.0));\n    }\n  }\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.Attenuation=(function(superClass){extend(Attenuation,superClass);Attenuation.prototype.shaders={fragment:Jax.shaderTemplates["shaders/attenuation/fragment"]};function Attenuation(options){Attenuation.__super__.constructor.call(this,options)}Attenuation.prototype.numPasses=function(context){return context.world.lights.length+1};Attenuation.prototype.setVariables=function(context,mesh,model,vars,pass){var light;vars.PASS=pass;if(!pass){return}light=context.world.lights[pass-1];vars.ConstantAttenuation=light.attenuation.constant;vars.LinearAttenuation=light.attenuation.linear;return vars.QuadraticAttenuation=light.attenuation.quadratic};return Attenuation})(Jax.Material.Layer)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/clamp_color/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("void main(void) { gl_FragColor = clamp(gl_FragColor, 0.0, 1.0); }\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.ClampColor=(function(superClass){extend(ClampColor,superClass);function ClampColor(){return ClampColor.__super__.constructor.apply(this,arguments)}ClampColor.prototype.shaders={fragment:Jax.shaderTemplates["shaders/clamp_color/fragment"]};return ClampColor})(Jax.Material.Layer)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/cube_map/common"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("/*\n  HACK that makes cube textures magically work on my machine.\n  This may be a driver bug. If so, we can remove the hack when the driver\n  becomes fixed, blacklisted or obsolete.\n\n  Symptom: If the first texture to be bound is a TEXTURE_CUBE_MAP,\n  Invalid Operation errors start popping up all over. If the first bound\n  texture is a TEXTURE_2D, everything works just fine.\n \n  NOTE: There is some performance cost to this hack, because in order to\n  prevent the GLSL compiler from simply removing unused samplers we have\n  to actually sample the `HAX` texture in the shader. So, it behooves us\n  to remove the hack as soon as possible.\n*/\n\nuniform sampler2D HAX;\nuniform samplerCube CUBE_MAP;\n\nuniform mat3 CNORMAL_MATRIX;\n\nvarying vec3 vCubeMapNormal;\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/cube_map/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("void main(void) {\n  gl_FragColor.rgb *= textureCube(CUBE_MAP, normalize(vCubeMapNormal)).rgb + texture2D(HAX, vec2(0.0, 0.0)).rgb * 0.0;\n}\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/cube_map/vertex"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("shared attribute vec3 CVNORMAL, CVERTEX;\n\nvoid main(void) {\n  vCubeMapNormal = CNORMAL_MATRIX * normalize(normalize(CVERTEX) + CVNORMAL);\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.CubeMap=(function(superClass){var HAX,center,identity,origin;extend(CubeMap,superClass);center=vec3.create();origin=vec3.create();identity=mat3.identity(mat3.create());HAX=new Jax.Texture();CubeMap.prototype.shaders={common:Jax.shaderTemplates["shaders/cube_map/common"],vertex:Jax.shaderTemplates["shaders/cube_map/vertex"],fragment:Jax.shaderTemplates["shaders/cube_map/fragment"]};function CubeMap(options,material){if(!(this.cubeMap=options.cubeMap)){throw new Error("Jax.Material.Layer.CubeMap requires a `cubeMap` option which must be an instance of Jax.Texture.CubeMap")}this.cubeMap=options.cubeMap;this.space=options.space||"world";this.map={vertices:"CVERTEX",normals:"CVNORMAL"};CubeMap.__super__.constructor.call(this,options,material)}CubeMap.prototype.numPasses=function(){return 1};CubeMap.prototype.setVariables=function(context,mesh,options,vars){vars.CUBE_MAP=this.cubeMap;vars.HAX=HAX;switch(this.space){case"object":vars.CNORMAL_MATRIX=this.identity;break;case"world":vars.CNORMAL_MATRIX=context.matrix_stack.getModelNormalMatrix();break;case"eye":vars.CNORMAL_MATRIX=context.matrix_stack.getNormalMatrix();break;default:throw new Error("Space must be one of 'object', 'world' or 'eye'; got '"+this.space+"'")}return mesh.data.set(vars,this.map)};return CubeMap})(Jax.Material.Layer)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/depthmap/common"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("shared uniform mat4 pMatrix;\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/depthmap/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("",require("shaders/functions/depth_map"),"\n\nvoid main(void) {\n  vec4 pos = gl_FragCoord;\n  gl_FragColor = pack_depth(pos.z);\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.Depthmap=(function(superClass){extend(Depthmap,superClass);function Depthmap(){return Depthmap.__super__.constructor.apply(this,arguments)}Depthmap.prototype.shaders={common:Jax.shaderTemplates["shaders/depthmap/common"],vertex:Jax.shaderTemplates["shaders/depthmap/vertex"],fragment:Jax.shaderTemplates["shaders/depthmap/fragment"]};Depthmap.prototype.setVariables=function(context,mesh,model,vars,pass){if(!model.castShadow){return false}};return Depthmap})(Jax.Material.Layer)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/fog/common"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("const float LOG2 = 1.442695;\n\nuniform vec4 FogColor;\nuniform int Algorithm;\nuniform float Scale;\nuniform float End;\nuniform float Start;\nuniform float Density;\n\nvarying float vDistance;\n\nshared uniform mat4 ModelViewProjectionMatrix;\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/fog/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("void main() {\n  /*\n  I used to use gl_FragCoord.z / gl_FragCoord.w but noted that\n  at least on my machine, it didn't interpolate cleanly; I don't\n  know how best to define the issue but it seemed at first similar\n  to a contrast or gamma issue. Switching to my own varying fixes\n  the issue.\n  */\n  \n  float fog;\n\n  if (Algorithm == ",Jax.LINEAR,") {\n    fog = smoothstep(Start, End, vDistance);\n  } else if (Algorithm == ",Jax.EXPONENTIAL,") {\n    fog = exp(-Density * vDistance);\n    fog = 1.0 - clamp(fog, 0.0, 1.0);\n  } else if (Algorithm == ",Jax.EXP2,") {\n    fog = exp2(-Density * Density * vDistance * vDistance * LOG2);\n    fog = 1.0 - clamp(fog, 0.0, 1.0);\n  }\n  \n  gl_FragColor.rgb = mix(gl_FragColor.rgb, FogColor.rgb, fog);\n}\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/fog/vertex"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("shared attribute vec4 VERTEX_POSITION;\n\nvoid main(void) {\n  vDistance = (ModelViewProjectionMatrix * VERTEX_POSITION).z;\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.LINEAR=1;Jax.EXPONENTIAL=2;Jax.EXP2=3;Jax.Material.Layer.Fog=(function(superClass){extend(Fog,superClass);Fog.prototype.shaders={common:Jax.shaderTemplates["shaders/fog/common"],vertex:Jax.shaderTemplates["shaders/fog/vertex"],fragment:Jax.shaderTemplates["shaders/fog/fragment"]};Fog.define("color",{get:function(){return this._color},set:function(c){return this._color=Jax.Color.parse(c)}});function Fog(options){options||(options={});this.start=options.start;this.end=options.end;this.density=options.density||0.0025;this.algorithm=options.algorithm||Jax.EXP2;this.color=options.color||Jax.Color.parse("#fff");this.color=Jax.Util.colorize(this.color);this._positionMap={vertices:"VERTEX_POSITION"};Fog.__super__.constructor.call(this,options);switch(this.algorithm){case Jax.LINEAR:case Jax.EXPONENTIAL:case Jax.EXP2:break;case"LINEAR":case"EXPONENTIAL":case"EXP2":options.algorithm=Jax[options.algorithm];break;default:throw new Error("Jax: Fog algorithm must be one of LINEAR, EXPONENTIAL, or EXP2")}}Fog.prototype.setVariables=function(context,mesh,model,vars,pass){var ref,ref1;if(this.start){vars.Start=this.start}else{vars.Start=((ref=context.activeCamera.projection)!=null?ref.near:void 0)||0.1}if(this.end){vars.End=this.end}else{vars.End=((ref1=context.activeCamera.projection)!=null?ref1.far:void 0)||200}vars.Scale=1/(vars.End-vars.Start);vars.Algorithm=this.algorithm;vars.Density=this.density;vars.FogColor=this.color;vars.ModelViewProjectionMatrix=context.matrix_stack.getModelViewProjectionMatrix();return mesh.data.set(vars,this._positionMap)};return Fog})(Jax.Material.Layer)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/functions/depth_map"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("vec4 pack_depth(in float depth)\n{\n  vec4 bit_shift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n  vec4 bit_mask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n  vec4 res = fract(depth * bit_shift);\n  res -= res.xxyz * bit_mask;\n  return res;\n}\n\nfloat unpack_depth(in vec4 rgba_depth)\n{\n  vec4 bit_shift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n  float depth = dot(rgba_depth, bit_shift);\n  return depth;\n}\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/functions/lights"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("shared uniform bool LIGHT_ENABLED;\nshared uniform int LIGHT_TYPE;\nshared uniform vec3 LIGHT_POSITION, LIGHT_DIRECTION;\nshared uniform vec4 LIGHT_AMBIENT, LIGHT_DIFFUSE, LIGHT_SPECULAR;\nshared uniform float LIGHT_ATTENUATION_CONSTANT, LIGHT_ATTENUATION_LINEAR, LIGHT_ATTENUATION_QUADRATIC,\n                     LIGHT_SPOT_EXPONENT, LIGHT_SPOT_COS_CUTOFF;\n\nfloat calcAttenuation(in vec3 ecPosition3,\n                      out vec3 lightDirection)\n{\n//  lightDirection = vec3(vnMatrix * -light.position) - ecPosition3;\n  lightDirection = vec3(ivMatrix * vec4(LIGHT_POSITION, 1.0)) - ecPosition3;\n  float d = length(lightDirection);\n  \n  return 1.0 / (LIGHT_ATTENUATION_CONSTANT + LIGHT_ATTENUATION_LINEAR * d + LIGHT_ATTENUATION_QUADRATIC * d * d);\n}\n\nvoid DirectionalLight(in vec3 normal,\n                      inout vec4 ambient,\n                      inout vec4 diffuse,\n                      inout vec4 specular)\n{\n  vec3 nLDir = normalize(vnMatrix * -normalize(LIGHT_DIRECTION));\n  vec3 halfVector = normalize(nLDir + vec3(0,0,1));\n  float pf;\n    \n  float NdotD  = max(0.0, dot(normal, nLDir));\n  float NdotHV = max(0.0, dot(normal, halfVector));\n    \n  if (NdotD == 0.0) pf = 0.0;\n  else pf = pow(NdotHV, materialShininess);\n    \n  ambient += LIGHT_AMBIENT;\n  diffuse += LIGHT_DIFFUSE * NdotD;\n  specular += LIGHT_SPECULAR * pf;\n}\n\n/* Use when attenuation != (1,0,0) */\nvoid PointLightWithAttenuation(in vec3 ecPosition3,\n                               in vec3 normal,\n                               inout vec4 ambient,\n                               inout vec4 diffuse,\n                               inout vec4 specular)\n{\n  float NdotD; // normal . light direction\n  float NdotHV;// normal . half vector\n  float pf;    // specular factor\n  float attenuation;\n  vec3 VP;     // direction from surface to light position\n  vec3 halfVector; // direction of maximum highlights\n  \n  attenuation = calcAttenuation(ecPosition3, VP);\n  VP = normalize(VP);\n  \n  halfVector = normalize(VP+vec3(0,0,1));\n  NdotD = max(0.0, dot(normal, VP));\n  NdotHV= max(0.0, dot(normal, halfVector));\n  \n  if (NdotD == 0.0) pf = 0.0;\n  else pf = pow(NdotHV, materialShininess);\n\n  ambient += LIGHT_AMBIENT * attenuation;\n  diffuse += LIGHT_DIFFUSE * NdotD * attenuation;\n  specular += LIGHT_SPECULAR * pf * attenuation;\n}\n\n/* Use for better performance when attenuation == (1,0,0) */\nvoid PointLightWithoutAttenuation(in vec3 ecPosition3,\n                                  in vec3 normal,\n                                  inout vec4 ambient,\n                                  inout vec4 diffuse,\n                                  inout vec4 specular)\n{\n  float NdotD; // normal . light direction\n  float NdotHV;// normal . half vector\n  float pf;    // specular factor\n  float d;     // distance from surface to light source\n  vec3 VP;     // direction from surface to light position\n  vec3 halfVector; // direction of maximum highlights\n  \n  VP = vec3(ivMatrix * vec4(LIGHT_POSITION, 1.0)) - ecPosition3;\n  d = length(VP);\n  VP = normalize(VP);\n  halfVector = normalize(VP+vec3(0,0,1));\n  NdotD = max(0.0, dot(normal, VP));\n  NdotHV= max(0.0, dot(normal, halfVector));\n  \n  if (NdotD == 0.0) pf = 0.0;\n  else pf = pow(NdotHV, materialShininess);\n  \n  ambient += LIGHT_AMBIENT;\n  diffuse += LIGHT_DIFFUSE * NdotD;\n  specular += LIGHT_SPECULAR * pf;\n}\n\nvoid SpotLight(in vec3 ecPosition3,\n               in vec3 normal,\n               inout vec4 ambient,\n               inout vec4 diffuse,\n               inout vec4 specular)\n{\n  float NdotD; // normal . light direction\n  float NdotHV;// normal . half vector\n  float pf;    // specular factor\n  float attenuation;\n  vec3 VP;     // direction from surface to light position\n  vec3 halfVector; // direction of maximum highlights\n  float spotDot; // cosine of angle between spotlight\n  float spotAttenuation; // spotlight attenuation factor\n  \n  attenuation = calcAttenuation(ecPosition3, VP);\n  VP = normalize(VP);\n  \n  // See if point on surface is inside cone of illumination\n  spotDot = dot(-VP, normalize(vnMatrix*LIGHT_DIRECTION));\n  if (spotDot < LIGHT_SPOT_COS_CUTOFF)\n    spotAttenuation = 0.0;\n  else spotAttenuation = pow(spotDot, LIGHT_SPOT_EXPONENT);\n  \n  attenuation *= spotAttenuation;\n  \n  halfVector = normalize(VP+vec3(0,0,1));\n  NdotD = max(0.0, dot(normal, VP));\n  NdotHV= max(0.0, dot(normal, halfVector));\n  \n  if (NdotD == 0.0) pf = 0.0;\n  else pf = pow(NdotHV, materialShininess);\n  \n  ambient += LIGHT_AMBIENT * attenuation;\n  diffuse += LIGHT_DIFFUSE * NdotD * attenuation;\n  specular += LIGHT_SPECULAR * pf * attenuation;\n}\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/functions/noise"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("/**\n * Classic and 'improved' (simplex) Perlin noise.\n *\n * This implementation attempts to use texture-based lookups if the client\n * hardware can support it. This is no problem in fragment shaders but can\n * be an issue in vertex shaders, where VTL is not supported by about 20%\n * of clients.\n *\n * In the event this is a vertex shader *and* the client doesn't support\n * VTL, the functions will fall back to 'ashima' noise\n * (https://github.com/ashima/webgl-noise) for a slower, non-texture-based\n * implementation.\n **/\n\n \n");if(shaderType!="vertex"||maxVertexTextureImageUnits>0){__p.push("\n  /*\n   * Author: Stefan Gustavson (stegu@itn.liu.se) 2004, 2005, 2012\n   * Stefan's original implementation: http://www.itn.liu.se/~stegu/simplexnoise/\n   */\n\n\n  /*\n   * 2D, 3D and 4D Perlin noise, classic and simplex, in a GLSL fragment shader.\n   *\n   * Classic noise is implemented by the functions:\n   * float noise(vec2 P)\n   * float noise(vec3 P)\n   * float noise(vec4 P)\n   *\n   * Simplex noise is implemented by the functions:\n   * float snoise(vec2 P)\n   * float snoise(vec3 P)\n   * float snoise(vec4 P)\n   *\n   * Author: Stefan Gustavson ITN-LiTH (stegu@itn.liu.se) 2004-12-05\n   * Simplex indexing functions by Bill Licea-Kane, ATI (bill@ati.com)\n   * Modified to use same texture for 2D, 3D and 4D 2012-03-27.\n   *\n   * You may use, modify and redistribute this code free of charge,\n   * provided that the author's names and this notice appear intact.\n   */\n\n  /*\n   * The value of classic 4D noise goes above 1.0 and below -1.0 at some\n   * points. Not much and only very sparsely, but it happens. This is a\n   * long standing bug from Perlin's original software implementation,\n   * so I left it untouched.\n   */\n\n\n  /*\n   * \"gradTexture\" is a 256x256 RGBA texture that is used for both the\n   * permutations, encoded in A, and the 2D, 3D and 4D gradients,\n   * encoded in RGB with x in R, y in B and z and w combined in B.\n   * For details, see the main C program.\n   */\n  shared uniform sampler2D gradTexture;\n\n  /*\n   * To create offsets of one texel and one half texel in the\n   * texture lookup, we need to know the texture image size.\n   */\n  #define ONE 0.00390625\n  #define ONEHALF 0.001953125\n  // The numbers above are 1/256 and 0.5/256, change accordingly\n  // if you change the code to use another texture size.\n\n\n  /*\n   * The interpolation function for classic noise. This could be a 1D texture\n   * lookup to possibly gain some speed, but it's not the main part of the\n   * algorithm, and the texture bandwidth is pretty choked up as it is.\n   */\n  shared float fade(float t) {\n    // return t*t*(3.0-2.0*t); // Old fade, yields discontinuous second derivative\n    return t*t*t*(t*(t*6.0-15.0)+10.0); // Improved fade, yields C2-continuous noise\n  }\n\n  /*\n   * Efficient simplex indexing functions by Bill Licea-Kane, ATI. Thanks!\n   * (This was originally implemented as a 1D texture lookup. Nice to avoid that.)\n   */\n  shared void simplex( const in vec3 P, out vec3 offset1, out vec3 offset2 )\n  {\n    vec3 offset0;\n \n    vec2 isX = step( P.yz, P.xx ); // P.x >= P.y ? 1.0 : 0.0;  P.x >= P.z ? 1.0 : 0.0;\n    offset0.x  = isX.x + isX.y;    // Accumulate all P.x >= other channels in offset.x\n    offset0.yz = 1.0 - isX;        // Accumulate all P.x <  other channels in offset.yz\n\n    float isY = step( P.z, P.y );  // P.y >= P.z ? 1.0 : 0.0;\n    offset0.y += isY;              // Accumulate P.y >= P.z in offset.y\n    offset0.z += 1.0 - isY;        // Accumulate P.y <  P.z in offset.z\n \n    // offset0 now contains the unique values 0,1,2 in each channel\n    // 2 for the channel greater than other channels\n    // 1 for the channel that is less than one but greater than another\n    // 0 for the channel less than other channels\n    // Equality ties are broken in favor of first x, then y\n    // (z always loses ties)\n\n    offset2 = clamp( offset0, 0.0, 1.0 );\n    // offset2 contains 1 in each channel that was 1 or 2\n    offset1 = clamp( offset0-1.0, 0.0, 1.0 );\n    // offset1 contains 1 in the single channel that was 1\n  }\n\n  shared void simplex( const in vec4 P, out vec4 offset1, out vec4 offset2, out vec4 offset3 )\n  {\n    vec4 offset0;\n \n    vec3 isX = step( P.yzw, P.xxx );        // See comments in 3D simplex function\n    offset0.x = isX.x + isX.y + isX.z;\n    offset0.yzw = 1.0 - isX;\n\n    vec2 isY = step( P.zw, P.yy );\n    offset0.y += isY.x + isY.y;\n    offset0.zw += 1.0 - isY;\n \n    float isZ = step( P.w, P.z );\n    offset0.z += isZ;\n    offset0.w += 1.0 - isZ;\n\n    // offset0 now contains the unique values 0,1,2,3 in each channel\n\n    offset3 = clamp( offset0, 0.0, 1.0 );\n    offset2 = clamp( offset0-1.0, 0.0, 1.0 );\n    offset1 = clamp( offset0-2.0, 0.0, 1.0 );\n  }\n\n\n  /*\n   * 2D classic Perlin noise. Fast, but less useful than 3D noise.\n   */\n  shared float noise(vec2 P)\n  {\n    vec2 Pi = ONE*floor(P)+ONEHALF; // Integer part, scaled and offset for texture lookup\n    vec2 Pf = fract(P);             // Fractional part for interpolation\n\n    // Noise contribution from lower left corner\n    vec2 grad00 = texture2D(gradTexture, Pi).rg * 4.0 - 2.0;\n    float n00 = dot(grad00, Pf);\n\n    // Noise contribution from lower right corner\n    vec2 grad10 = texture2D(gradTexture, Pi + vec2(ONE, 0.0)).rg * 4.0 - 2.0;\n    float n10 = dot(grad10, Pf - vec2(1.0, 0.0));\n\n    // Noise contribution from upper left corner\n    vec2 grad01 = texture2D(gradTexture, Pi + vec2(0.0, ONE)).rg * 4.0 - 2.0;\n    float n01 = dot(grad01, Pf - vec2(0.0, 1.0));\n\n    // Noise contribution from upper right corner\n    vec2 grad11 = texture2D(gradTexture, Pi + vec2(ONE, ONE)).rg * 4.0 - 2.0;\n    float n11 = dot(grad11, Pf - vec2(1.0, 1.0));\n\n    // Blend contributions along x\n    vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade(Pf.x));\n\n    // Blend contributions along y\n    float n_xy = mix(n_x.x, n_x.y, fade(Pf.y));\n\n    // We're done, return the final noise value.\n    return 1.7 * n_xy;\n  }\n\n\n  /*\n   * 3D classic noise. Slower, but a lot more useful than 2D noise.\n   */\n  shared float noise(vec3 P)\n  {\n    vec3 Pi = ONE*floor(P)+ONEHALF; // Integer part, scaled so +1 moves one texel\n                                    // and offset 1/2 texel to sample texel centers\n    vec3 Pf = fract(P);     // Fractional part for interpolation\n\n    // Noise contributions from (x=0, y=0), z=0 and z=1\n    float perm00 = texture2D(gradTexture, Pi.xy).a ;\n    vec3  grad000 = texture2D(gradTexture, vec2(perm00, Pi.z)).rgb * 4.0 - 2.0;\n    grad000.z = floor(grad000.z); // Remove small variations due to w\n    float n000 = dot(grad000, Pf);\n    vec3  grad001 = texture2D(gradTexture, vec2(perm00, Pi.z + ONE)).rgb * 4.0 - 2.0;\n    grad001.z = floor(grad001.z); // Remove small variations due to w\n    float n001 = dot(grad001, Pf - vec3(0.0, 0.0, 1.0));\n\n    // Noise contributions from (x=0, y=1), z=0 and z=1\n    float perm01 = texture2D(gradTexture, Pi.xy + vec2(0.0, ONE)).a ;\n    vec3  grad010 = texture2D(gradTexture, vec2(perm01, Pi.z)).rgb * 4.0 - 2.0;\n    grad010.z = floor(grad010.z); // Remove small variations due to w\n    float n010 = dot(grad010, Pf - vec3(0.0, 1.0, 0.0));\n    vec3  grad011 = texture2D(gradTexture, vec2(perm01, Pi.z + ONE)).rgb * 4.0 - 2.0;\n    grad011.z = floor(grad011.z); // Remove small variations due to w\n    float n011 = dot(grad011, Pf - vec3(0.0, 1.0, 1.0));\n\n    // Noise contributions from (x=1, y=0), z=0 and z=1\n    float perm10 = texture2D(gradTexture, Pi.xy + vec2(ONE, 0.0)).a ;\n    vec3  grad100 = texture2D(gradTexture, vec2(perm10, Pi.z)).rgb * 4.0 - 2.0;\n    grad100.z = floor(grad100.z); // Remove small variations due to w\n    float n100 = dot(grad100, Pf - vec3(1.0, 0.0, 0.0));\n    vec3  grad101 = texture2D(gradTexture, vec2(perm10, Pi.z + ONE)).rgb * 4.0 - 2.0;\n    grad101.z = floor(grad101.z); // Remove small variations due to w\n    float n101 = dot(grad101, Pf - vec3(1.0, 0.0, 1.0));\n\n    // Noise contributions from (x=1, y=1), z=0 and z=1\n    float perm11 = texture2D(gradTexture, Pi.xy + vec2(ONE, ONE)).a ;\n    vec3  grad110 = texture2D(gradTexture, vec2(perm11, Pi.z)).rgb * 4.0 - 2.0;\n    grad110.z = floor(grad110.z); // Remove small variations due to w\n    float n110 = dot(grad110, Pf - vec3(1.0, 1.0, 0.0));\n    vec3  grad111 = texture2D(gradTexture, vec2(perm11, Pi.z + ONE)).rgb * 4.0 - 2.0;\n    grad111.z = floor(grad111.z); // Remove small variations due to w\n    float n111 = dot(grad111, Pf - vec3(1.0, 1.0, 1.0));\n\n    // Blend contributions along x\n    vec4 n_x = mix(vec4(n000, n001, n010, n011),\n                   vec4(n100, n101, n110, n111), fade(Pf.x));\n\n    // Blend contributions along y\n    vec2 n_xy = mix(n_x.xy, n_x.zw, fade(Pf.y));\n\n    // Blend contributions along z\n    float n_xyz = mix(n_xy.x, n_xy.y, fade(Pf.z));\n\n    // We're done, return the final noise value.\n    return n_xyz;\n  }\n\n\n  /*\n   * 4D classic noise. Slow, but very useful. 4D simplex noise is a lot faster.\n   *\n   * This function performs 8 texture lookups and 16 dependent texture lookups,\n   * 16 dot products, 4 mix operations and a lot of additions and multiplications.\n   * Needless to say, it's not super fast. But it's not dead slow either.\n   */\n  shared float noise(vec4 P)\n  {\n    vec4 Pi = ONE*floor(P)+ONEHALF; // Integer part, scaled so +1 moves one texel\n                                    // and offset 1/2 texel to sample texel centers\n    vec4 Pf = fract(P);      // Fractional part for interpolation\n\n    // \"n0000\" is the noise contribution from (x=0, y=0, z=0, w=0), and so on\n    float perm00xy = texture2D(gradTexture, Pi.xy).a ;\n    float perm00zw = texture2D(gradTexture, Pi.zw).a ;\n    vec4 grad0000 = texture2D(gradTexture, vec2(perm00xy, perm00zw)).rgbb * 4.0 - 2.0;\n    grad0000.z = floor(grad0000.z); // Remove slight variation from w\n    grad0000.w = fract(grad0000.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n0000 = dot(grad0000, Pf);\n\n    float perm01zw = texture2D(gradTexture, Pi.zw  + vec2(0.0, ONE)).a ;\n    vec4 grad0001 = texture2D(gradTexture, vec2(perm00xy, perm01zw)).rgbb * 4.0 - 2.0;\n    grad0001.z = floor(grad0001.z); // Remove slight variation from w\n    grad0001.w = fract(grad0001.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n0001 = dot(grad0001, Pf - vec4(0.0, 0.0, 0.0, 1.0));\n\n    float perm10zw = texture2D(gradTexture, Pi.zw  + vec2(ONE, 0.0)).a ;\n    vec4 grad0010 = texture2D(gradTexture, vec2(perm00xy, perm10zw)).rgbb * 4.0 - 2.0;\n    grad0010.z = floor(grad0010.z); // Remove slight variation from w\n    grad0010.w = fract(grad0010.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n0010 = dot(grad0010, Pf - vec4(0.0, 0.0, 1.0, 0.0));\n\n    float perm11zw = texture2D(gradTexture, Pi.zw  + vec2(ONE, ONE)).a ;\n    vec4 grad0011 = texture2D(gradTexture, vec2(perm00xy, perm11zw)).rgbb * 4.0 - 2.0;\n    grad0011.z = floor(grad0011.z); // Remove slight variation from w\n    grad0011.w = fract(grad0011.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n0011 = dot(grad0011, Pf - vec4(0.0, 0.0, 1.0, 1.0));\n\n    float perm01xy = texture2D(gradTexture, Pi.xy + vec2(0.0, ONE)).a ;\n    vec4 grad0100 = texture2D(gradTexture, vec2(perm01xy, perm00zw)).rgbb * 4.0 - 2.0;\n    grad0100.z = floor(grad0100.z); // Remove slight variation from w\n    grad0100.w = fract(grad0100.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n0100 = dot(grad0100, Pf - vec4(0.0, 1.0, 0.0, 0.0));\n\n    vec4 grad0101 = texture2D(gradTexture, vec2(perm01xy, perm01zw)).rgbb * 4.0 - 2.0;\n    grad0101.z = floor(grad0101.z); // Remove slight variation from w\n    grad0101.w = fract(grad0101.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n0101 = dot(grad0101, Pf - vec4(0.0, 1.0, 0.0, 1.0));\n\n    vec4 grad0110 = texture2D(gradTexture, vec2(perm01xy, perm10zw)).rgbb * 4.0 - 2.0;\n    grad0110.z = floor(grad0110.z); // Remove slight variation from w\n    grad0110.w = fract(grad0110.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n0110 = dot(grad0110, Pf - vec4(0.0, 1.0, 1.0, 0.0));\n\n    vec4  grad0111 = texture2D(gradTexture, vec2(perm01xy, perm11zw)).rgbb * 4.0 - 2.0;\n    grad0111.z = floor(grad0111.z); // Remove slight variation from w\n    grad0111.w = fract(grad0111.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n0111 = dot(grad0111, Pf - vec4(0.0, 1.0, 1.0, 1.0));\n\n    float perm10xy = texture2D(gradTexture, Pi.xy + vec2(ONE, 0.0)).a ;\n    vec4  grad1000 = texture2D(gradTexture, vec2(perm10xy, perm00zw)).rgbb * 4.0 - 2.0;\n    grad1000.z = floor(grad1000.z); // Remove slight variation from w\n    grad1000.w = fract(grad1000.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n1000 = dot(grad1000, Pf - vec4(1.0, 0.0, 0.0, 0.0));\n\n    vec4  grad1001 = texture2D(gradTexture, vec2(perm10xy, perm01zw)).rgbb * 4.0 - 2.0;\n    grad1001.z = floor(grad1001.z); // Remove slight variation from w\n    grad1001.w = fract(grad1001.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n1001 = dot(grad1001, Pf - vec4(1.0, 0.0, 0.0, 1.0));\n\n    vec4  grad1010 = texture2D(gradTexture, vec2(perm10xy, perm10zw)).rgbb * 4.0 - 2.0;\n    grad1010.z = floor(grad1010.z); // Remove slight variation from w\n    grad1010.w = fract(grad1010.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n1010 = dot(grad1010, Pf - vec4(1.0, 0.0, 1.0, 0.0));\n\n    vec4  grad1011 = texture2D(gradTexture, vec2(perm10xy, perm11zw)).rgbb * 4.0 - 2.0;\n    grad1011.z = floor(grad1011.z); // Remove slight variation from w\n    grad1011.w = fract(grad1011.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n1011 = dot(grad1011, Pf - vec4(1.0, 0.0, 1.0, 1.0));\n\n    float perm11xy = texture2D(gradTexture, Pi.xy + vec2(ONE, ONE)).a ;\n    vec4  grad1100 = texture2D(gradTexture, vec2(perm11xy, perm00zw)).rgbb * 4.0 - 2.0;\n    grad1100.z = floor(grad1100.z); // Remove slight variation from w\n    grad1100.w = fract(grad1100.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n1100 = dot(grad1100, Pf - vec4(1.0, 1.0, 0.0, 0.0));\n\n    vec4  grad1101 = texture2D(gradTexture, vec2(perm11xy, perm01zw)).rgbb * 4.0 - 2.0;\n    grad1101.z = floor(grad1101.z); // Remove slight variation from w\n    grad1101.w = fract(grad1101.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n1101 = dot(grad1101, Pf - vec4(1.0, 1.0, 0.0, 1.0));\n\n    vec4  grad1110 = texture2D(gradTexture, vec2(perm11xy, perm10zw)).rgbb * 4.0 - 2.0;\n    grad1110.z = floor(grad1110.z); // Remove slight variation from w\n    grad1110.w = fract(grad1110.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n1110 = dot(grad1110, Pf - vec4(1.0, 1.0, 1.0, 0.0));\n\n    vec4  grad1111 = texture2D(gradTexture, vec2(perm11xy, perm11zw)).rgbb * 4.0 - 2.0;\n    grad1111.z = floor(grad1111.z); // Remove slight variation from w\n    grad1111.w = fract(grad1111.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n1111 = dot(grad1111, Pf - vec4(1.0, 1.0, 1.0, 1.0));\n\n    // Blend contributions along x\n    float fadex = fade(Pf.x);\n    vec4 n_x0 = mix(vec4(n0000, n0001, n0010, n0011),\n                    vec4(n1000, n1001, n1010, n1011), fadex);\n    vec4 n_x1 = mix(vec4(n0100, n0101, n0110, n0111),\n                    vec4(n1100, n1101, n1110, n1111), fadex);\n\n    // Blend contributions along y\n    vec4 n_xy = mix(n_x0, n_x1, fade(Pf.y));\n\n    // Blend contributions along z\n    vec2 n_xyz = mix(n_xy.xy, n_xy.zw, fade(Pf.z));\n\n    // Blend contributions along w\n    float n_xyzw = mix(n_xyz.x, n_xyz.y, fade(Pf.w));\n\n    // We're done, return the final noise value.\n    return n_xyzw;\n  }\n\n\n  /*\n   * 2D simplex noise. Somewhat slower but much better looking than classic noise.\n   */\n  shared float snoise(vec2 P) {\n\n  // Skew and unskew factors are a bit hairy for 2D, so define them as constants\n  // This is (sqrt(3.0)-1.0)/2.0\n  #define F2 0.366025403784\n  // This is (3.0-sqrt(3.0))/6.0\n  #define G2 0.211324865405\n\n    // Skew the (x,y) space to determine which cell of 2 simplices we're in\n   \tfloat s = (P.x + P.y) * F2;   // Hairy factor for 2D skewing\n    vec2 Pi = floor(P + s);\n    float t = (Pi.x + Pi.y) * G2; // Hairy factor for unskewing\n    vec2 P0 = Pi - t; // Unskew the cell origin back to (x,y) space\n    Pi = Pi * ONE + ONEHALF; // Integer part, scaled and offset for texture lookup\n\n    vec2 Pf0 = P - P0;  // The x,y distances from the cell origin\n\n    // For the 2D case, the simplex shape is an equilateral triangle.\n    // Find out whether we are above or below the x=y diagonal to\n    // determine which of the two triangles we're in.\n    vec2 o1;\n    if(Pf0.x > Pf0.y) o1 = vec2(1.0, 0.0);  // +x, +y traversal order\n    else o1 = vec2(0.0, 1.0);               // +y, +x traversal order\n\n    // Noise contribution from simplex origin\n    vec2 grad0 = texture2D(gradTexture, Pi).rg * 4.0 - 2.0;\n    float t0 = 0.5 - dot(Pf0, Pf0);\n    float n0;\n    if (t0 < 0.0) n0 = 0.0;\n    else {\n      t0 *= t0;\n      n0 = t0 * t0 * dot(grad0, Pf0);\n    }\n\n    // Noise contribution from middle corner\n    vec2 Pf1 = Pf0 - o1 + G2;\n    vec2 grad1 = texture2D(gradTexture, Pi + o1*ONE).rg * 4.0 - 2.0;\n    float t1 = 0.5 - dot(Pf1, Pf1);\n    float n1;\n    if (t1 < 0.0) n1 = 0.0;\n    else {\n      t1 *= t1;\n      n1 = t1 * t1 * dot(grad1, Pf1);\n    }\n  \n    // Noise contribution from last corner\n    vec2 Pf2 = Pf0 - vec2(1.0-2.0*G2);\n    vec2 grad2 = texture2D(gradTexture, Pi + vec2(ONE, ONE)).rg * 4.0 - 2.0;\n    float t2 = 0.5 - dot(Pf2, Pf2);\n    float n2;\n    if(t2 < 0.0) n2 = 0.0;\n    else {\n      t2 *= t2;\n      n2 = t2 * t2 * dot(grad2, Pf2);\n    }\n\n    // Sum up and scale the result to cover the range [-1,1]\n    return 100.0 * (n0 + n1 + n2);\n  }\n\n\n  /*\n   * 3D simplex noise. Comparable in speed to classic noise, better looking.\n   */\n  shared float snoise(vec3 P) {\n\n  // The skewing and unskewing factors are much simpler for the 3D case\n  #define F3 0.333333333333\n  #define G3 0.166666666667\n\n    // Skew the (x,y,z) space to determine which cell of 6 simplices we're in\n   \tfloat s = (P.x + P.y + P.z) * F3; // Factor for 3D skewing\n    vec3 Pi = floor(P + s);\n    float t = (Pi.x + Pi.y + Pi.z) * G3;\n    vec3 P0 = Pi - t; // Unskew the cell origin back to (x,y,z) space\n    Pi = Pi * ONE + ONEHALF; // Integer part, scaled and offset for texture lookup\n\n    vec3 Pf0 = P - P0;  // The x,y distances from the cell origin\n\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\n    // To find out which of the six possible tetrahedra we're in, we need to\n    // determine the magnitude ordering of x, y and z components of Pf0.\n    vec3 o1;\n    vec3 o2;\n    simplex(Pf0, o1, o2);\n\n    // Noise contribution from simplex origin\n    float perm0 = texture2D(gradTexture, Pi.xy).a;\n    vec3  grad0 = texture2D(gradTexture, vec2(perm0, Pi.z)).rgb * 4.0 - 2.0;\n    grad0.z = floor(grad0.z); // Remove small variations due to w\n    float t0 = 0.6 - dot(Pf0, Pf0);\n    float n0;\n    if (t0 < 0.0) n0 = 0.0;\n    else {\n      t0 *= t0;\n      n0 = t0 * t0 * dot(grad0, Pf0);\n    }\n\n    // Noise contribution from second corner\n    vec3 Pf1 = Pf0 - o1 + G3;\n    float perm1 = texture2D(gradTexture, Pi.xy + o1.xy*ONE).a;\n    vec3  grad1 = texture2D(gradTexture, vec2(perm1, Pi.z + o1.z*ONE)).rgb * 4.0 - 2.0;\n    grad1.z = floor(grad1.z); // Remove small variations due to w\n    float t1 = 0.6 - dot(Pf1, Pf1);\n    float n1;\n    if (t1 < 0.0) n1 = 0.0;\n    else {\n      t1 *= t1;\n      n1 = t1 * t1 * dot(grad1, Pf1);\n    }\n  \n    // Noise contribution from third corner\n    vec3 Pf2 = Pf0 - o2 + 2.0 * G3;\n    float perm2 = texture2D(gradTexture, Pi.xy + o2.xy*ONE).a;\n    vec3  grad2 = texture2D(gradTexture, vec2(perm2, Pi.z + o2.z*ONE)).rgb * 4.0 - 2.0;\n    grad2.z = floor(grad2.z); // Remove small variations due to w\n    float t2 = 0.6 - dot(Pf2, Pf2);\n    float n2;\n    if (t2 < 0.0) n2 = 0.0;\n    else {\n      t2 *= t2;\n      n2 = t2 * t2 * dot(grad2, Pf2);\n    }\n  \n    // Noise contribution from last corner\n    vec3 Pf3 = Pf0 - vec3(1.0-3.0*G3);\n    float perm3 = texture2D(gradTexture, Pi.xy + vec2(ONE, ONE)).a;\n    vec3  grad3 = texture2D(gradTexture, vec2(perm3, Pi.z + ONE)).rgb * 4.0 - 2.0;\n    grad3.z = floor(grad3.z); // Remove small variations due to w\n    float t3 = 0.6 - dot(Pf3, Pf3);\n    float n3;\n    if(t3 < 0.0) n3 = 0.0;\n    else {\n      t3 *= t3;\n      n3 = t3 * t3 * dot(grad3, Pf3);\n    }\n\n    // Sum up and scale the result to cover the range [-1,1]\n    return 20.0 * (n0 + n1 + n2 + n3);\n  }\n\n\n  /*\n   * 4D simplex noise. A lot faster than classic 4D noise, and better looking.\n   */\n\n  shared float snoise(vec4 P) {\n\n  // The skewing and unskewing factors are hairy again for the 4D case\n  // This is (sqrt(5.0)-1.0)/4.0\n  #define F4 0.309016994375\n  // This is (5.0-sqrt(5.0))/20.0\n  #define G4 0.138196601125\n\n    // Skew the (x,y,z,w) space to determine which cell of 24 simplices we're in\n   \tfloat s = (P.x + P.y + P.z + P.w) * F4; // Factor for 4D skewing\n    vec4 Pi = floor(P + s);\n    float t = (Pi.x + Pi.y + Pi.z + Pi.w) * G4;\n    vec4 P0 = Pi - t; // Unskew the cell origin back to (x,y,z,w) space\n    Pi = Pi * ONE + ONEHALF; // Integer part, scaled and offset for texture lookup\n\n    vec4 Pf0 = P - P0;  // The x,y distances from the cell origin\n\n    // For the 4D case, the simplex is a 4D shape I won't even try to describe.\n    // To find out which of the 24 possible simplices we're in, we need to\n    // determine the magnitude ordering of x, y, z and w components of Pf0.\n    vec4 o1;\n    vec4 o2;\n    vec4 o3;\n    simplex(Pf0, o1, o2, o3);  \n\n    // Noise contribution from simplex origin\n    float perm0xy = texture2D(gradTexture, Pi.xy).a;\n    float perm0zw = texture2D(gradTexture, Pi.zw).a;\n    vec4 grad0 = texture2D(gradTexture, vec2(perm0xy, perm0zw)).rgbb * 4.0 - 2.0;\n    grad0.z = floor(grad0.z); // Remove slight variation from w\n    grad0.w = fract(grad0.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float t0 = 0.6 - dot(Pf0, Pf0);\n    float n0;\n    if (t0 < 0.0) n0 = 0.0;\n    else {\n      t0 *= t0;\n      n0 = t0 * t0 * dot(grad0, Pf0);\n    }\n\n    // Noise contribution from second corner\n    vec4 Pf1 = Pf0 - o1 + G4;\n    o1 = o1 * ONE;\n    float perm1xy = texture2D(gradTexture, Pi.xy + o1.xy).a;\n    float perm1zw = texture2D(gradTexture, Pi.zw + o1.zw).a;\n    vec4 grad1 = texture2D(gradTexture, vec2(perm1xy, perm1zw)).rgbb * 4.0 - 2.0;\n    grad1.z = floor(grad1.z); // Remove slight variation from w\n    grad1.w = fract(grad1.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float t1 = 0.6 - dot(Pf1, Pf1);\n    float n1;\n    if (t1 < 0.0) n1 = 0.0;\n    else {\n      t1 *= t1;\n      n1 = t1 * t1 * dot(grad1, Pf1);\n    }\n  \n    // Noise contribution from third corner\n    vec4 Pf2 = Pf0 - o2 + 2.0 * G4;\n    o2 = o2 * ONE;\n    float perm2xy = texture2D(gradTexture, Pi.xy + o2.xy).a;\n    float perm2zw = texture2D(gradTexture, Pi.zw + o2.zw).a;\n    vec4 grad2 = texture2D(gradTexture, vec2(perm2xy, perm2zw)).rgbb * 4.0 - 2.0;\n    grad2.z = floor(grad2.z); // Remove slight variation from w\n    grad2.w = fract(grad2.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float t2 = 0.6 - dot(Pf2, Pf2);\n    float n2;\n    if (t2 < 0.0) n2 = 0.0;\n    else {\n      t2 *= t2;\n      n2 = t2 * t2 * dot(grad2, Pf2);\n    }\n  \n    // Noise contribution from fourth corner\n    vec4 Pf3 = Pf0 - o3 + 3.0 * G4;\n    o3 = o3 * ONE;\n    float perm3xy = texture2D(gradTexture, Pi.xy + o3.xy).a;\n    float perm3zw = texture2D(gradTexture, Pi.zw + o3.zw).a;\n    vec4 grad3 = texture2D(gradTexture, vec2(perm3xy, perm3zw)).rgbb * 4.0 - 2.0;\n    grad3.z = floor(grad3.z); // Remove slight variation from w\n    grad3.w = fract(grad3.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float t3 = 0.6 - dot(Pf3, Pf3);\n    float n3;\n    if (t3 < 0.0) n3 = 0.0;\n    else {\n      t3 *= t3;\n      n3 = t3 * t3 * dot(grad3, Pf3);\n    }\n  \n    // Noise contribution from last corner\n    vec4 Pf4 = Pf0 - vec4(1.0-4.0*G4);\n    float perm4xy = texture2D(gradTexture, Pi.xy + vec2(ONE, ONE)).a;\n    float perm4zw = texture2D(gradTexture, Pi.zw + vec2(ONE, ONE)).a;\n    vec4  grad4 = texture2D(gradTexture, vec2(perm4xy, perm4zw)).rgbb * 4.0 - 2.0;\n    grad4.z = floor(grad4.z); // Remove slight variation from w\n    grad4.w = fract(grad4.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float t4 = 0.6 - dot(Pf4, Pf4);\n    float n4;\n    if(t4 < 0.0) n4 = 0.0;\n    else {\n      t4 *= t4;\n      n4 = t4 * t4 * dot(grad4, Pf4);\n    }\n\n    // Sum up and scale the result to cover the range [-1,1]\n    return 27.0 * (n0 + n1 + n2 + n3 + n4);\n  }\n\n\n")}else{__p.push("\n\nshared vec4 permute(vec4 x)\n{\n  return mod(((x*34.0)+1.0)*x, 289.0);\n}\n\nshared vec3 permute(vec3 x)\n{\n  return mod(((x*34.0)+1.0)*x, 289.0);\n}\n\nshared float permute(float x)\n{\n  return floor(mod(((x*34.0)+1.0)*x, 289.0));\n}\n\nshared vec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nshared float taylorInvSqrt(float r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nshared vec4 grad4(float j, vec4 ip)\n{\n  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n  vec4 p,s;\n\n  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n  s = vec4(lessThan(p, vec4(0.0)));\n  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n  return p;\n}\n\nshared vec4 fade(vec4 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\nshared vec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\nshared vec2 fade(vec2 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n// Classic Perlin noise\nshared float cnoise(vec2 P)\n{\n  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n  Pi = mod(Pi, 289.0); // To avoid truncation effects in permutation\n  vec4 ix = Pi.xzxz;\n  vec4 iy = Pi.yyww;\n  vec4 fx = Pf.xzxz;\n  vec4 fy = Pf.yyww;\n\n  vec4 i = permute(permute(ix) + iy);\n\n  vec4 gx = 2.0 * fract(i / 41.0) - 1.0 ;\n  vec4 gy = abs(gx) - 0.5 ;\n  vec4 tx = floor(gx + 0.5);\n  gx = gx - tx;\n\n  vec2 g00 = vec2(gx.x,gy.x);\n  vec2 g10 = vec2(gx.y,gy.y);\n  vec2 g01 = vec2(gx.z,gy.z);\n  vec2 g11 = vec2(gx.w,gy.w);\n\n  vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n  g00 *= norm.x;\n  g01 *= norm.y;\n  g10 *= norm.z;\n  g11 *= norm.w;\n\n  float n00 = dot(g00, vec2(fx.x, fy.x));\n  float n10 = dot(g10, vec2(fx.y, fy.y));\n  float n01 = dot(g01, vec2(fx.z, fy.z));\n  float n11 = dot(g11, vec2(fx.w, fy.w));\n\n  vec2 fade_xy = fade(Pf.xy);\n  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n  return 2.3 * n_xy;\n}\n\n// Classic Perlin noise, periodic variant\nshared float pnoise(vec2 P, vec2 rep)\n{\n  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n  Pi = mod(Pi, rep.xyxy); // To create noise with explicit period\n  Pi = mod(Pi, 289.0); // To avoid truncation effects in permutation\n  vec4 ix = Pi.xzxz;\n  vec4 iy = Pi.yyww;\n  vec4 fx = Pf.xzxz;\n  vec4 fy = Pf.yyww;\n\n  vec4 i = permute(permute(ix) + iy);\n\n  vec4 gx = 2.0 * fract(i / 41.0) - 1.0 ;\n  vec4 gy = abs(gx) - 0.5 ;\n  vec4 tx = floor(gx + 0.5);\n  gx = gx - tx;\n\n  vec2 g00 = vec2(gx.x,gy.x);\n  vec2 g10 = vec2(gx.y,gy.y);\n  vec2 g01 = vec2(gx.z,gy.z);\n  vec2 g11 = vec2(gx.w,gy.w);\n\n  vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n  g00 *= norm.x;\n  g01 *= norm.y;\n  g10 *= norm.z;\n  g11 *= norm.w;\n\n  float n00 = dot(g00, vec2(fx.x, fy.x));\n  float n10 = dot(g10, vec2(fx.y, fy.y));\n  float n01 = dot(g01, vec2(fx.z, fy.z));\n  float n11 = dot(g11, vec2(fx.w, fy.w));\n\n  vec2 fade_xy = fade(Pf.xy);\n  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n  return 2.3 * n_xy;\n}\n\n// Classic Perlin noise\nshared float cnoise(vec3 P)\n{\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod(Pi0, 289.0);\n  Pi1 = mod(Pi1, 289.0);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 / 7.0;\n  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 / 7.0;\n  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n  return 2.2 * n_xyz;\n}\n\n// Classic Perlin noise, periodic variant\nshared float pnoise(vec3 P, vec3 rep)\n{\n  vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period\n  vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period\n  Pi0 = mod(Pi0, 289.0);\n  Pi1 = mod(Pi1, 289.0);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 / 7.0;\n  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 / 7.0;\n  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n  return 2.2 * n_xyz;\n}\n\n// Classic Perlin noise\nshared float cnoise(vec4 P)\n{\n  vec4 Pi0 = floor(P); // Integer part for indexing\n  vec4 Pi1 = Pi0 + 1.0; // Integer part + 1\n  Pi0 = mod(Pi0, 289.0);\n  Pi1 = mod(Pi1, 289.0);\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = vec4(Pi0.zzzz);\n  vec4 iz1 = vec4(Pi1.zzzz);\n  vec4 iw0 = vec4(Pi0.wwww);\n  vec4 iw1 = vec4(Pi1.wwww);\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n  vec4 ixy00 = permute(ixy0 + iw0);\n  vec4 ixy01 = permute(ixy0 + iw1);\n  vec4 ixy10 = permute(ixy1 + iw0);\n  vec4 ixy11 = permute(ixy1 + iw1);\n\n  vec4 gx00 = ixy00 / 7.0;\n  vec4 gy00 = floor(gx00) / 7.0;\n  vec4 gz00 = floor(gy00) / 6.0;\n  gx00 = fract(gx00) - 0.5;\n  gy00 = fract(gy00) - 0.5;\n  gz00 = fract(gz00) - 0.5;\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n  vec4 sw00 = step(gw00, vec4(0.0));\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n  vec4 gx01 = ixy01 / 7.0;\n  vec4 gy01 = floor(gx01) / 7.0;\n  vec4 gz01 = floor(gy01) / 6.0;\n  gx01 = fract(gx01) - 0.5;\n  gy01 = fract(gy01) - 0.5;\n  gz01 = fract(gz01) - 0.5;\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n  vec4 sw01 = step(gw01, vec4(0.0));\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n  vec4 gx10 = ixy10 / 7.0;\n  vec4 gy10 = floor(gx10) / 7.0;\n  vec4 gz10 = floor(gy10) / 6.0;\n  gx10 = fract(gx10) - 0.5;\n  gy10 = fract(gy10) - 0.5;\n  gz10 = fract(gz10) - 0.5;\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n  vec4 sw10 = step(gw10, vec4(0.0));\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n  vec4 gx11 = ixy11 / 7.0;\n  vec4 gy11 = floor(gx11) / 7.0;\n  vec4 gz11 = floor(gy11) / 6.0;\n  gx11 = fract(gx11) - 0.5;\n  gy11 = fract(gy11) - 0.5;\n  gz11 = fract(gz11) - 0.5;\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n  vec4 sw11 = step(gw11, vec4(0.0));\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n  vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n  g0000 *= norm00.x;\n  g0100 *= norm00.y;\n  g1000 *= norm00.z;\n  g1100 *= norm00.w;\n\n  vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n  g0001 *= norm01.x;\n  g0101 *= norm01.y;\n  g1001 *= norm01.z;\n  g1101 *= norm01.w;\n\n  vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n  g0010 *= norm10.x;\n  g0110 *= norm10.y;\n  g1010 *= norm10.z;\n  g1110 *= norm10.w;\n\n  vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n  g0011 *= norm11.x;\n  g0111 *= norm11.y;\n  g1011 *= norm11.z;\n  g1111 *= norm11.w;\n\n  float n0000 = dot(g0000, Pf0);\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n  float n1111 = dot(g1111, Pf1);\n\n  vec4 fade_xyzw = fade(Pf0);\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n  return 2.2 * n_xyzw;\n}\n\n// Classic Perlin noise, periodic version\nshared float cnoise(vec4 P, vec4 rep)\n{\n  vec4 Pi0 = mod(floor(P), rep); // Integer part modulo rep\n  vec4 Pi1 = mod(Pi0 + 1.0, rep); // Integer part + 1 mod rep\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = vec4(Pi0.zzzz);\n  vec4 iz1 = vec4(Pi1.zzzz);\n  vec4 iw0 = vec4(Pi0.wwww);\n  vec4 iw1 = vec4(Pi1.wwww);\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n  vec4 ixy00 = permute(ixy0 + iw0);\n  vec4 ixy01 = permute(ixy0 + iw1);\n  vec4 ixy10 = permute(ixy1 + iw0);\n  vec4 ixy11 = permute(ixy1 + iw1);\n\n  vec4 gx00 = ixy00 / 7.0;\n  vec4 gy00 = floor(gx00) / 7.0;\n  vec4 gz00 = floor(gy00) / 6.0;\n  gx00 = fract(gx00) - 0.5;\n  gy00 = fract(gy00) - 0.5;\n  gz00 = fract(gz00) - 0.5;\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n  vec4 sw00 = step(gw00, vec4(0.0));\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n  vec4 gx01 = ixy01 / 7.0;\n  vec4 gy01 = floor(gx01) / 7.0;\n  vec4 gz01 = floor(gy01) / 6.0;\n  gx01 = fract(gx01) - 0.5;\n  gy01 = fract(gy01) - 0.5;\n  gz01 = fract(gz01) - 0.5;\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n  vec4 sw01 = step(gw01, vec4(0.0));\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n  vec4 gx10 = ixy10 / 7.0;\n  vec4 gy10 = floor(gx10) / 7.0;\n  vec4 gz10 = floor(gy10) / 6.0;\n  gx10 = fract(gx10) - 0.5;\n  gy10 = fract(gy10) - 0.5;\n  gz10 = fract(gz10) - 0.5;\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n  vec4 sw10 = step(gw10, vec4(0.0));\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n  vec4 gx11 = ixy11 / 7.0;\n  vec4 gy11 = floor(gx11) / 7.0;\n  vec4 gz11 = floor(gy11) / 6.0;\n  gx11 = fract(gx11) - 0.5;\n  gy11 = fract(gy11) - 0.5;\n  gz11 = fract(gz11) - 0.5;\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n  vec4 sw11 = step(gw11, vec4(0.0));\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n  vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n  g0000 *= norm00.x;\n  g0100 *= norm00.y;\n  g1000 *= norm00.z;\n  g1100 *= norm00.w;\n\n  vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n  g0001 *= norm01.x;\n  g0101 *= norm01.y;\n  g1001 *= norm01.z;\n  g1101 *= norm01.w;\n\n  vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n  g0010 *= norm10.x;\n  g0110 *= norm10.y;\n  g1010 *= norm10.z;\n  g1110 *= norm10.w;\n\n  vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n  g0011 *= norm11.x;\n  g0111 *= norm11.y;\n  g1011 *= norm11.z;\n  g1111 *= norm11.w;\n\n  float n0000 = dot(g0000, Pf0);\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n  float n1111 = dot(g1111, Pf1);\n\n  vec4 fade_xyzw = fade(Pf0);\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n  return 2.2 * n_xyzw;\n}\n\nshared float snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187, // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439, // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626, // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i = floor(v + dot(v, C.yy) );\n  vec2 x0 = v - i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod(i, 289.0); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n+ i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Inlined for speed: m *= taylorInvSqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x = a0.x * x0.x + h.x * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\nshared float snoise(vec3 v)\n{\n  const vec2 C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i = floor(v + dot(v, C.yyy) );\n  vec3 x0 = v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  // x0 = x0 - 0.0 + 0.0 * C.xxx;\n  // x1 = x0 - i1 + 1.0 * C.xxx;\n  // x2 = x0 - i2 + 2.0 * C.xxx;\n  // x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy; // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod(i, 289.0 );\n  vec4 p = permute( permute( permute(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3 ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z); // mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ ); // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n}\n\nshared float snoise(vec4 v)\n{\n  const vec4 C = vec4( 0.138196601125011, // (5 - sqrt(5))/20 G4\n                        0.276393202250021, // 2 * G4\n                        0.414589803375032, // 3 * G4\n                       -0.447213595499958); // -1 + 4 * G4\n\n  // (sqrt(5) - 1)/4 = F4, used once below\n  #define F4 0.309016994374947451\n\n// First corner\n  vec4 i = floor(v + dot(v, vec4(F4)) );\n  vec4 x0 = v - i + dot(i, C.xxxx);\n\n// Other corners\n\n// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n  vec4 i0;\n  vec3 isX = step( x0.yzw, x0.xxx );\n  vec3 isYZ = step( x0.zww, x0.yyz );\n// i0.x = dot( isX, vec3( 1.0 ) );\n  i0.x = isX.x + isX.y + isX.z;\n  i0.yzw = 1.0 - isX;\n// i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n  i0.y += isYZ.x + isYZ.y;\n  i0.zw += 1.0 - isYZ.xy;\n  i0.z += isYZ.z;\n  i0.w += 1.0 - isYZ.z;\n\n  // i0 now contains the unique values 0,1,2,3 in each channel\n  vec4 i3 = clamp( i0, 0.0, 1.0 );\n  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n  // x0 = x0 - 0.0 + 0.0 * C.xxxx\n  // x1 = x0 - i1 + 0.0 * C.xxxx\n  // x2 = x0 - i2 + 0.0 * C.xxxx\n  // x3 = x0 - i3 + 0.0 * C.xxxx\n  // x4 = x0 - 1.0 + 4.0 * C.xxxx\n  vec4 x1 = x0 - i1 + C.xxxx;\n  vec4 x2 = x0 - i2 + C.yyyy;\n  vec4 x3 = x0 - i3 + C.zzzz;\n  vec4 x4 = x0 + C.wwww;\n\n  // Permutations\n  i = mod(i, 289.0);\n  float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\n  vec4 j1 = permute( permute( permute( permute (\n             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n  // Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\n  // 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n  vec4 p0 = grad4(j0, ip);\n  vec4 p1 = grad4(j1.x, ip);\n  vec4 p2 = grad4(j1.y, ip);\n  vec4 p3 = grad4(j1.z, ip);\n  vec4 p4 = grad4(j1.w, ip);\n\n  // Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n  p4 *= taylorInvSqrt(dot(p4,p4));\n\n  // Mix contributions from the five corners\n  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4) ), 0.0);\n  m0 = m0 * m0;\n  m1 = m1 * m1;\n  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n\n}\n\n")}__p.push("\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/functions/paraboloid"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("void mapToParaboloid(inout vec4 position, float zNear, float zFar) {\n  float L = length(position.xyz);\n  position /= L;\n  position.z += 1.0;\n  position.xy /= position.z;\n  position.z = (L - zNear) / (zFar - zNear);\n  position.w = 1.0;\n}\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/gamma_correction/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("uniform float GammaCorrectionFactor;\n\nvoid main(void) {\n  if (GammaCorrectionFactor == 0.0) {\n    // sRGB\n    vec3 c = gl_FragColor.rgb;\n    gl_FragColor.rgb = (step(0.0031308, c)*1.055*pow(c, vec3(1.0/2.4))-0.055) +\n                       (step(-0.0031308, -c)*12.92*c);\n  } else {\n    gl_FragColor.rgb = pow(gl_FragColor.rgb,\n                       vec3(GammaCorrectionFactor));\n  }\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.GammaCorrection=(function(superClass){extend(GammaCorrection,superClass);GammaCorrection.prototype.shaders={common:Jax.shaderTemplates["shaders/gamma_correction/common"],vertex:Jax.shaderTemplates["shaders/gamma_correction/vertex"],fragment:Jax.shaderTemplates["shaders/gamma_correction/fragment"]};function GammaCorrection(options){GammaCorrection.__super__.constructor.call(this,options)}GammaCorrection.prototype.setVariables=function(context,mesh,model,vars,pass){if(this.gamma===void 0){return vars.GammaCorrectionFactor=1/2.2}else{if(isNaN(this.gamma)){return vars.GammaCorrectionFactor=0}else{return vars.GammaCorrectionFactor=1/this.gamma}}};return GammaCorrection})(Jax.Material.Layer)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/lambert_diffuse/common"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("",require("shaders/lib/lights"),"\n\nshared uniform int PASS;\nshared uniform float MaterialDiffuseIntensity;\nshared uniform vec4 MaterialDiffuseColor;\nshared uniform mat3 NormalMatrix;\nshared uniform mat4 ModelViewMatrix;\n\nshared varying vec3 vEyeSpaceSurfaceNormal, vEyeSpaceSurfacePosition;\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/lambert_diffuse/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("// Lambert formula: L dot N * C * Il,\n//   where L is direction from surface to light, N is normal, C is color, Il is light intensity\n// This shader holds alpha constant at 1.0 and is intended to be blended\n// additively with a prior ambient pass. Light intensity is held constant \n// at 1.0 and attenuation is calculated in a different layer.\n\nvoid main(void) {\n  // no output on ambient pass\n  if (PASS != 0) {\n    cache(vec3, NormalizedEyeSpaceSurfaceNormal) {\n      bool useVertexNormal = true;\n      import(UseVertexNormal, useVertexNormal = UseVertexNormal);\n      vec3 normal = vec3(0.0, 0.0, 0.0);\n      if (useVertexNormal) normal = vEyeSpaceSurfaceNormal;\n      import(Normal, normal = normal + Normal);\n      // handle double sided lighting, when cull face isn't BACK\n      if (!gl_FrontFacing) normal = -normal;\n      NormalizedEyeSpaceSurfaceNormal = normalize(normal);\n    }\n  \n    vec3 L;\n    float d = 1.0;\n    if (LightType == ",Jax.DIRECTIONAL_LIGHT,") {\n      L = -EyeSpaceLightDirection;\n      d = 1.0;\n    } else {\n      L = EyeSpaceLightPosition - vEyeSpaceSurfacePosition;\n      d = length(L);\n      L /= d;\n    }\n  \n    cache(float, SpotAttenuation) {\n      float cosCurAngle = dot(-L, EyeSpaceLightDirection);\n      float cosInnerMinusOuterAngle = LightSpotInnerCos - LightSpotOuterCos;\n      SpotAttenuation = clamp((cosCurAngle - LightSpotOuterCos) / cosInnerMinusOuterAngle, 0.0, 1.0);\n    }\n  \n    // this is cached here so that attenuation can get a handle on it\n    // FIXME we probably need a better interface for this sort of thing\n    cache(float, LightDistanceFromSurface) { LightDistanceFromSurface = d; }\n  \n    float intensity = LightDiffuseColor.a * MaterialDiffuseIntensity;\n    vec3 C =  LightDiffuseColor.rgb * MaterialDiffuseColor.rgb;\n\n    float lambert = max(dot(NormalizedEyeSpaceSurfaceNormal, L), 0.0);\n    float diffuse = lambert * SpotAttenuation * intensity;\n    vec4 color = vec4(C * diffuse, MaterialDiffuseColor.a * diffuse);\n    import(VertexColor, color *= VertexColor);\n    gl_FragColor += color;\n  }\n}\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/lambert_diffuse/vertex"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("shared attribute vec4 VERTEX_COLOR, VERTEX_POSITION;\nshared attribute vec3 VERTEX_NORMAL;\n\nvoid main(void) {\n  if (PASS != 0) {\n    /* These variables are cached so that other shaders can replace their values */\n    cache(vec3, VertexNormal) { VertexNormal = VERTEX_NORMAL; }\n    cache(vec4, VertexPosition) { VertexPosition = VERTEX_POSITION; }\n    /* exports can also be used to modify the normal */\n    vec3 normal = VertexNormal;\n    import(VertexNormal, normal = normalize(normal + VertexNormal));\n    vEyeSpaceSurfaceNormal = NormalMatrix * normal;\n    vEyeSpaceSurfacePosition = (ModelViewMatrix * VertexPosition).xyz;\n  }\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.LambertDiffuse=(function(superClass){extend(LambertDiffuse,superClass);LambertDiffuse.prototype.shaders={common:Jax.shaderTemplates["shaders/lambert_diffuse/common"],vertex:Jax.shaderTemplates["shaders/lambert_diffuse/vertex"],fragment:Jax.shaderTemplates["shaders/lambert_diffuse/fragment"]};function LambertDiffuse(options){this.intensity=1;LambertDiffuse.__super__.constructor.call(this,options);this.meshDataMap={vertices:"VERTEX_POSITION",normals:"VERTEX_NORMAL"};this.eyeDir=vec3.create();this.eyePos=vec3.create()}LambertDiffuse.prototype.illuminate=function(context,mesh,model,vars,light){vars.LightDiffuseColor=light.color.diffuse;vars.LightSpotInnerCos=light.innerSpotAngleCos;vars.LightSpotOuterCos=light.outerSpotAngleCos;vars.LightType=light.type;vars.EyeSpaceLightDirection=light.eyeDirection(context.matrix_stack.getViewNormalMatrix(),this.eyeDir);vars.EyeSpaceLightPosition=light.eyePosition(context.matrix_stack.getViewMatrix(),this.eyePos);vars.NormalMatrix=context.matrix_stack.getNormalMatrix();vars.MaterialDiffuseIntensity=this.intensity;vars.MaterialDiffuseColor=this.color;vars.ModelViewMatrix=context.matrix_stack.getModelViewMatrix();return mesh.data.set(vars,this.meshDataMap)};return LambertDiffuse})(Jax.Material.IlluminationLayer)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/lib/lights"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("#define MAX_LIGHTS 1\n\nshared uniform vec4 LightDiffuseColor;\nshared uniform vec3 EyeSpaceLightDirection;\nshared uniform vec3 EyeSpaceLightPosition;\nshared uniform int LightType;\nshared uniform float LightSpotInnerCos;\nshared uniform float LightSpotOuterCos;\nshared uniform vec4 LightSpecularColor;\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/light_ambient/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("shared uniform int PASS;\nshared uniform float MaterialAmbientIntensity;\nshared uniform vec4 MaterialAmbientColor;\nshared uniform vec4 LightAmbientColor;\n\nvoid main(void) {\n  // no output on world ambient pass\n  if (PASS != 0) {\n    vec3 material = MaterialAmbientIntensity * MaterialAmbientColor.rgb;\n    vec4 color = vec4(LightAmbientColor.rgb * LightAmbientColor.a * material, MaterialAmbientColor.a);\n    import(VertexColor, color *= VertexColor);\n    gl_FragColor += color;\n  }\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.LightAmbient=(function(superClass){extend(LightAmbient,superClass);LightAmbient.prototype.shaders={common:Jax.shaderTemplates["shaders/light_ambient/common"],vertex:Jax.shaderTemplates["shaders/light_ambient/vertex"],fragment:Jax.shaderTemplates["shaders/light_ambient/fragment"]};function LightAmbient(options){this.color=Jax.Color.parse("#ffff");this.intensity=1;LightAmbient.__super__.constructor.call(this,options)}LightAmbient.prototype.illuminate=function(context,mesh,model,vars,light){vars.MaterialAmbientIntensity=this.intensity;vars.LightAmbientColor=light.color.ambient;return vars.MaterialAmbientColor=this.color};return LightAmbient})(Jax.Material.IlluminationLayer)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/noise/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("",require("shaders/functions/noise"),"\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/noise/vertex"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("",require("shaders/functions/noise"),"\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.Noise=(function(superClass){extend(Noise,superClass);function Noise(){return Noise.__super__.constructor.apply(this,arguments)}Noise.prototype.shaders={common:Jax.shaderTemplates["shaders/noise/common"],vertex:Jax.shaderTemplates["shaders/noise/vertex"],fragment:Jax.shaderTemplates["shaders/noise/fragment"]};Noise.prototype.setVariables=function(context,mesh,model,vars,pass){Jax.noise||(Jax.noise=new Jax.Noise());return vars.gradTexture=Jax.noise.grad};return Noise})(Jax.Material.Layer)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/normal_map/common"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("uniform sampler2D Texture;\nuniform float TextureScaleX, TextureScaleY;\nuniform bool UseSpecularChannel;\n\nshared varying vec2 vTexCoords;\n\nshared uniform mat3 NormalMatrix;\nshared uniform int PASS;\n\nvarying mat3 vTangentMatrix;\n\nvarying vec3 vN, vT, vB;\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/normal_map/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("void main() {\n  vec4 rgba = texture2D(Texture, vTexCoords *\n                vec2(TextureScaleX, TextureScaleY));\n  vec3 bump = normalize(rgba.xyz * 2.0 - 1.0);\n  \n  vec3 t = normalize(vT);\n  vec3 n = normalize(vN);\n  vec3 b = normalize(vB);\n  \n  // inverse\n  // float r0 = t.x, r1 = b.x, r2 = n.x,\n  //       r3 = t.y, r4 = b.y, r5 = n.y,\n  //       r6 = t.z, r7 = b.z, r8 = b.z;\n  \n  float r0 = t.x, r1 = t.y, r2 = t.z,\n        r3 = b.x, r4 = b.y, r5 = b.z,\n        r6 = n.x, r7 = n.y, r8 = n.z;\n  mat3 tangentMatrix = mat3(r0, r1, r2, r3, r4, r5, r6, r7, r8);\n  \n  bump = normalize(tangentMatrix * bump);\n  // vertex normal is already encoded in the tangent matrix\n  export(bool, UseVertexNormal, false);\n  export(vec3, Normal, bump);\n  \n  // Alpha channel may contain a specular map\n  float specular = 1.0;\n  if (UseSpecularChannel) specular = rgba.a;\n  export(float, SpecularIntensity, specular);\n}\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/normal_map/vertex"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("",require("shaders/lib/lights"),"\n\nshared attribute vec4 VERTEX_POSITION;\nshared attribute vec2 VERTEX_TEXCOORDS;\nshared attribute vec3 VERTEX_NORMAL;\nshared attribute vec4 VERTEX_TANGENT;\nshared attribute vec3 VERTEX_BITANGENT;\n\nvoid main(void) {\n  if (PASS != 0) {\n    vTexCoords = VERTEX_TEXCOORDS;\n    \n    vec3 n = VERTEX_NORMAL;\n    vec3 t = VERTEX_TANGENT.xyz;\n    vec3 b = cross(n, t) * VERTEX_TANGENT.w;\n    \n    vN = NormalMatrix * n;\n    vT = NormalMatrix * t;\n    vB = NormalMatrix * b;\n  }\n}\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/texture/common"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("uniform sampler2D Texture;\nuniform float TextureScaleX, TextureScaleY;\n\nshared varying vec2 vTexCoords;\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/texture/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("void main() {\n  vec4 t = texture2D(Texture, vTexCoords * vec2(TextureScaleX, TextureScaleY));\n  gl_FragColor *= t;\n}\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/texture/vertex"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("shared attribute vec2 VERTEX_TEXCOORDS;\n\nvoid main(void) {\n  vTexCoords = VERTEX_TEXCOORDS;\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.Texture=(function(superClass){extend(Texture,superClass);Texture.prototype.shaders={common:Jax.shaderTemplates["shaders/texture/common"],vertex:Jax.shaderTemplates["shaders/texture/vertex"],fragment:Jax.shaderTemplates["shaders/texture/fragment"]};function Texture(options){var texture;if(options&&options.instance){texture=options.instance}else{if(options&&options.texture){texture=options.texture}else{if(options){texture=options}}}if(!(texture instanceof Jax.Texture)){texture=new Jax.Texture.Bitmap(texture)}Texture.__super__.constructor.call(this,{shader:options!=null?options.shader:void 0});this.texture=texture;this.dataMap={textures:"VERTEX_TEXCOORDS"}}Texture.prototype.setVariables=function(context,mesh,model,vars,pass){vars.TextureScaleX=this.texture.get("scale_x")||this.texture.get("scale")||1;vars.TextureScaleY=this.texture.get("scale_y")||this.texture.get("scale")||1;vars.Texture=this.texture;return mesh.data.set(vars,this.dataMap)};return Texture})(Jax.Material.Layer)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.NormalMap=(function(superClass){extend(NormalMap,superClass);NormalMap.prototype.shaders={common:Jax.shaderTemplates["shaders/normal_map/common"],vertex:Jax.shaderTemplates["shaders/normal_map/vertex"],fragment:Jax.shaderTemplates["shaders/normal_map/fragment"]};function NormalMap(options){this.specularChannel=!!(options&&(options.specularChannel||(options.texture&&options.texture.specularChannel)));NormalMap.__super__.constructor.call(this,options);this.dataMap.tangents="VERTEX_TANGENT";this.dataMap.normals="VERTEX_NORMAL";this.dataMap.vertices="VERTEX_POSITION"}NormalMap.prototype.setVariables=function(context,mesh,model,vars,pass){NormalMap.__super__.setVariables.call(this,context,mesh,model,vars,pass);vars.NormalMatrix=context.matrix_stack.getNormalMatrix();vars.UseSpecularChannel=this.specularChannel;return true};return NormalMap})(Jax.Material.Layer.Texture)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/paraboloid/common"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("shared uniform mat4 ModelView;\n\nuniform float Near, Far;\nuniform float Direction;\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/paraboloid/vertex"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("\nshared attribute vec4 VERTEX_POSITION;\n                \nvoid main(void) {\n  vec4 position = ModelView * VERTEX_POSITION;\n  position /= position.w;\n  position.z *= Direction;\n  mapToParaboloid(position, Near, Far);\n  gl_Position = position;\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.Paraboloid=(function(superClass){extend(Paraboloid,superClass);Paraboloid.prototype.shaders={common:Jax.shaderTemplates["shaders/paraboloid/common"],vertex:Jax.shaderTemplates["shaders/paraboloid/vertex"],fragment:Jax.shaderTemplates["shaders/paraboloid/fragment"]};function Paraboloid(options){Paraboloid.__super__.constructor.call(this,options);this._meshMap={vertices:"VERTEX_POSITION"}}Paraboloid.prototype.setVariables=function(context,mesh,model,vars,pass){var direction;direction=this.direction;if(direction!==1&&direction!==-1){throw new Error("`direction` must be either 1 or -1")}mesh.data.set(vars,this._meshMap);vars.ModelView=context.matrix_stack.getModelViewMatrix();vars.Near=this.paraboloidNear||1;vars.Far=this.paraboloidFar||1;return vars.Direction=direction};return Paraboloid})(Jax.Material.Layer)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/phong_specular/common"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("",require("shaders/lib/lights"),"\n\nshared uniform int PASS;\nshared uniform float MaterialSpecularIntensity;\nshared uniform float MaterialShininess;\nshared uniform vec4 MaterialSpecularColor;\nshared uniform mat4 ModelViewMatrix;\nshared uniform mat3 NormalMatrix;\n\nshared varying vec3 vEyeSpaceSurfaceNormal;\nshared varying vec3 vEyeSpaceSurfacePosition;\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/phong_specular/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("// Phong formula: Is = Sm x Sl x pow( max(R dot E, 0.0), f )\n//   where Sl is the light specular color, Sm is the material specular color,\n//     E is the view vector, and R is the reflected light vector.\n//\n// This shader holds alpha constant at 1.0 and is intended to be blended\n// additively with a prior ambient pass.\n\nvoid main(void) {\n  // instead of `a && b`, use `all(bvec*)` for compatibility with ATI cards\n  bvec2 enabled = bvec2(\n    // no output on ambient pass\n    PASS != 0,\n\n    // if MaterialShininess == 0.0, then the specular formula will be \n    // fubarred so instead, it should be skipped entirely.\n    MaterialShininess > 0.0\n  );\n  if (all(enabled)) {\n    cache(vec3, NormalizedEyeSpaceSurfaceNormal) {\n      bool useVertexNormal = true;\n      import(UseVertexNormal, useVertexNormal = UseVertexNormal);\n      vec3 normal = vec3(0.0, 0.0, 0.0);\n      if (useVertexNormal) normal = vEyeSpaceSurfaceNormal;\n      import(Normal, normal = normal + Normal);\n      // handle double sided lighting, when cull face isn't BACK\n      if (!gl_FrontFacing) normal = -normal;\n      NormalizedEyeSpaceSurfaceNormal = normalize(normal);\n    }\n  \n    vec3 L;\n    if (LightType == ",Jax.DIRECTIONAL_LIGHT,") {\n      L = -EyeSpaceLightDirection;\n    } else {\n      L = normalize(EyeSpaceLightPosition - vEyeSpaceSurfacePosition);\n    }\n\n    cache(float, SpotAttenuation) {\n      float cosCurAngle = dot(-L, EyeSpaceLightDirection);\n      float cosInnerMinusOuterAngle = LightSpotInnerCos - LightSpotOuterCos;\n      SpotAttenuation = clamp((cosCurAngle - LightSpotOuterCos) / cosInnerMinusOuterAngle, 0.0, 1.0);\n    }\n\n    float lambert = dot(NormalizedEyeSpaceSurfaceNormal, L);\n    if (lambert > 0.0) {\n      vec3 R = reflect(L, NormalizedEyeSpaceSurfaceNormal);\n      vec3 C = MaterialSpecularColor.rgb * LightSpecularColor.rgb;\n      vec3 E = normalize(vEyeSpaceSurfacePosition);\n      float specularIntensity = MaterialSpecularIntensity;\n      import(SpecularIntensity, specularIntensity *= SpecularIntensity);\n      specularIntensity *= SpotAttenuation * pow(clamp(dot(R, E), 0.0, 1.0), MaterialShininess) * LightSpecularColor.a;\n      gl_FragColor += vec4(C * specularIntensity, MaterialSpecularColor.a * specularIntensity);\n    }\n  }\n}\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/phong_specular/vertex"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("shared attribute vec4 VERTEX_COLOR, VERTEX_POSITION;\nshared attribute vec3 VERTEX_NORMAL;\n\nvoid main(void) {\n  if (PASS != 0) {\n    /* These variables are cached so that other shaders can replace their values */\n    cache(vec3, VertexNormal) { VertexNormal = VERTEX_NORMAL; }\n    cache(vec4, VertexPosition) { VertexPosition = VERTEX_POSITION; }\n    /* exports can also be used to modify the normal */\n    vec3 normal = VertexNormal;\n    import(VertexNormal, normal = normalize(normal + VertexNormal));\n    vEyeSpaceSurfaceNormal = NormalMatrix * normal;\n    vEyeSpaceSurfacePosition = (ModelViewMatrix * VertexPosition).xyz;\n  }\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.PhongSpecular=(function(superClass){extend(PhongSpecular,superClass);PhongSpecular.prototype.shaders={common:Jax.shaderTemplates["shaders/phong_specular/common"],vertex:Jax.shaderTemplates["shaders/phong_specular/vertex"],fragment:Jax.shaderTemplates["shaders/phong_specular/fragment"]};function PhongSpecular(options){this.intensity=1;PhongSpecular.__super__.constructor.call(this,options);this.meshDataMap={vertices:"VERTEX_POSITION",normals:"VERTEX_NORMAL"};this.eyeDir=vec3.create();this.eyePos=vec3.create()}PhongSpecular.prototype.illuminate=function(context,mesh,model,vars,light){vars.LightSpecularColor=light.color.specular;vars.EyeSpaceLightDirection=light.eyeDirection(context.matrix_stack.getViewNormalMatrix(),this.eyeDir);vars.LightType=light.type;vars.LightSpotInnerCos=light.innerSpotAngleCos;vars.LightSpotOuterCos=light.outerSpotAngleCos;vars.EyeSpaceLightPosition=light.eyePosition(context.matrix_stack.getViewMatrix(),this.eyePos);vars.ModelViewMatrix=context.matrix_stack.getModelViewMatrix();vars.NormalMatrix=context.matrix_stack.getNormalMatrix();vars.MaterialShininess=this.shininess;vars.MaterialSpecularIntensity=this.intensity;vars.MaterialSpecularColor=this.color;return mesh.data.set(vars,this.meshDataMap)};return PhongSpecular})(Jax.Material.IlluminationLayer)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/picking/common"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("uniform float INDEX;\nvarying vec4 vPickingColor;\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/picking/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("void main(void) {\n  if (INDEX == -1.0) discard;\n  gl_FragColor = vPickingColor;\n}\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/picking/vertex"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("void main(void) {\n  /*\n    Note that the agorithm here must be followed exactly on the JS side in order\n    to reconstitute the index when it is read.\n    \n    This supports 65,535 objects. If more are needed, we could feasibly open up\n    the alpha channel, as long as blending is disabled. Need to do more tests\n    on this first, however.\n  */\n  \n  \n  // equivalent to [ int(INDEX/256), INDEX % 256 ] / 255. The last division\n  // is necessary to scale to the [0..1] range.\n  \n  float d = 1.0 / 255.0;\n  float f = floor(INDEX / 256.0);\n  vPickingColor = vec4(f * d, (INDEX - 256.0 * f) * d, 1.0, 1.0);\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.Picking=(function(superClass){extend(Picking,superClass);function Picking(){return Picking.__super__.constructor.apply(this,arguments)}Picking.prototype.shaders={common:Jax.shaderTemplates["shaders/picking/common"],vertex:Jax.shaderTemplates["shaders/picking/vertex"],fragment:Jax.shaderTemplates["shaders/picking/fragment"]};Picking.prototype.setVariables=function(context,mesh,model,vars){var modelIndex;modelIndex=model.__unique_id;if(modelIndex===void 0){modelIndex=-1}return vars.INDEX=modelIndex};return Picking})(Jax.Material.Layer)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/position/vertex"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("shared uniform mat4 ModelViewProjectionMatrix;\nshared attribute vec4 VERTEX_POSITION;\n\nvoid main(void) {\n  cache(vec4, VertexPosition) { VertexPosition = VERTEX_POSITION; }\n  gl_Position = ModelViewProjectionMatrix * VertexPosition;\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.Position=(function(superClass){extend(Position,superClass);Position.prototype.shaders={common:Jax.shaderTemplates["shaders/position/common"],vertex:Jax.shaderTemplates["shaders/position/vertex"],fragment:Jax.shaderTemplates["shaders/position/fragment"]};function Position(options){Position.__super__.constructor.call(this,options);this.meshMap={vertices:"VERTEX_POSITION"}}Position.prototype.setVariables=function(context,mesh,model,vars){mesh.data.set(vars,this.meshMap);return vars.ModelViewProjectionMatrix=context.matrix_stack.getModelViewProjectionMatrix()};return Position})(Jax.Material.Layer)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/shadow_map/common"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("",require("shaders/lib/lights"),"\n\nshared uniform int PASS;\nshared uniform mat4 mMatrix, pMatrix;\n\nshared uniform bool IsDualParaboloid;\nshared uniform bool SHADOWMAP_ENABLED;\nshared uniform sampler2D SHADOWMAP0, SHADOWMAP1;\nshared uniform mat4 SHADOWMAP_MATRIX;\nshared uniform bool SHADOWMAP_PCF_ENABLED;\nshared uniform float ParaboloidNear, ParaboloidFar;\nshared uniform float SHADOWMAP_WIDTH, SHADOWMAP_HEIGHT;\n\nshared varying vec4 vShadowCoord;\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/shadow_map/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("",require("shaders/functions/depth_map"),"\n",require("shaders/functions/paraboloid"),"\n\nvec4 shadowCoord;\n\n/*\n  Since we set the clear color to transparent while rendering the\n  shadowmap, no depth recorded in texture means nothing blocked the\n  light.\n  \n  This is what allows us to do testing beyond the view frustum\n  of the shadow matrix, so at the cost of a branching operation it's\n  much more accurate when some objects such as the floor are\n  excluded from casting shadows.\n*/\n\nfloat dp_lookup(vec2 offset, sampler2D shadowmap) {\n  vec4 rgba_depth = texture2D(shadowmap, shadowCoord.xy * 0.5 + 0.5 + offset);\n  float shadowDepth = unpack_depth(rgba_depth);\n  if (shadowDepth == 0.0) return 1.0;\n  if (shadowDepth - shadowCoord.z > -0.005)\n    return 1.0;\n  else\n    return 0.0;\n}\n      \nfloat depth_lookup(vec2 offset, sampler2D shadowmap) {\n  vec4 rgba_depth = texture2D(shadowmap, shadowCoord.xy + offset);\n  float d = unpack_depth(rgba_depth);\n  if (d == 0.0) return 1.0;\n  if (shadowCoord.z - d > 0.00002)\n    return 0.0;\n  else\n    return 1.0;\n}\n\nvoid main() {\n  /* if (a && b) is broken on some hardware, use if (all(bvec)) instead */\n  float visibility = 1.0;\n  if (PASS != 0) {\n    float dx, dy;\n    bool front;\n\n    if (SHADOWMAP_ENABLED) {\n      shadowCoord = vShadowCoord / vShadowCoord.w;\n      visibility = 0.0;\n      dx = 1.0 / SHADOWMAP_WIDTH;\n      dy = 1.0 / SHADOWMAP_HEIGHT;\n      front = false;\n\n      // for PCF, nested loops break on some ATI cards, so the loop must be unrolled\n      // explicitly. Luckily we have EJS....\n\n      if (IsDualParaboloid) {\n        if (shadowCoord.z > 0.0) front = true;\n        else shadowCoord.z *= -1.0;\n        mapToParaboloid(shadowCoord, ParaboloidNear, ParaboloidFar);\n        shadowCoord.z = shadowCoord.z * 0.5 + 0.5;\n        \n        if (front) {\n          if (SHADOWMAP_PCF_ENABLED) {\n            ");for(var x=-1.5;x<=1.5;x+=1.5){__p.push("\n              ");for(var y=-1.5;y<=1.5;y+=1.5){__p.push("\n                visibility += dp_lookup(vec2(",x.toFixed(6)," * dx, ",y.toFixed(6)," * dy), SHADOWMAP0);\n              ")}__p.push("\n            ")}__p.push("\n            visibility /= 9.0;\n          } else {\n            visibility += dp_lookup(vec2(0.0, 0.0), SHADOWMAP0);\n          }\n        } else {\n          if (SHADOWMAP_PCF_ENABLED) {\n            ");for(var x=-1.5;x<=1.5;x+=1.5){__p.push("\n              ");for(var y=-1.5;y<=1.5;y+=1.5){__p.push("\n                visibility += dp_lookup(vec2(",x.toFixed(6)," * dx, ",y.toFixed(6)," * dy), SHADOWMAP1);\n              ")}__p.push("\n            ")}__p.push("\n            visibility /= 9.0;\n          } else {\n            visibility += dp_lookup(vec2(0.0, 0.0), SHADOWMAP1);\n          }\n        }\n      } else {\n        if (SHADOWMAP_PCF_ENABLED) {\n          ");for(var x=-1.5;x<=1.5;x+=1.5){__p.push("\n            ");for(var y=-1.5;y<=1.5;y+=1.5){__p.push("\n              visibility += depth_lookup(vec2(",x.toFixed(6)," * dx, ",y.toFixed(6)," * dy), SHADOWMAP0);\n            ")}__p.push("\n          ")}__p.push("\n          visibility /= 9.0;\n        } else {\n          visibility += depth_lookup(vec2(0.0, 0.0), SHADOWMAP0);\n        }\n      }\n    }\n  }\n\n  gl_FragColor.rgb *= visibility;\n}\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/shadow_map/vertex"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("shared attribute vec4 VERTEX_POSITION;\n\nvoid main(void) {\n  if (PASS != 0) {\n    if (SHADOWMAP_ENABLED)\n      vShadowCoord = SHADOWMAP_MATRIX * mMatrix * VERTEX_POSITION;\n  }\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.ShadowMap=(function(superClass){extend(ShadowMap,superClass);ShadowMap.prototype.shaders={common:Jax.shaderTemplates["shaders/shadow_map/common"],vertex:Jax.shaderTemplates["shaders/shadow_map/vertex"],fragment:Jax.shaderTemplates["shaders/shadow_map/fragment"]};function ShadowMap(options){this.pcf=true;this.meshMap={vertices:"VERTEX_POSITION"};ShadowMap.__super__.constructor.call(this,options)}ShadowMap.prototype.numPasses=function(context){return context.world.lights.length+1};ShadowMap.prototype.prepare=function(context,mesh,model){var i,j,light,ref;for(i=j=1,ref=this.numPasses(context);1<=ref?j<ref:j>ref;i=1<=ref?++j:--j){light=context.world.lights[i-1];if(light.shadows&&light.shadowmap){light.shadowmap.validate(context)}}return true};ShadowMap.prototype.setVariables=function(context,mesh,model,vars,pass){var light;vars.PASS=pass;vars.SHADOWMAP_ENABLED=false;if(!pass){return}light=context.world.lights[pass-1];vars.SHADOWMAP_ENABLED=light.shadows&&!!light.shadowmap&&model.receiveShadow;vars.mMatrix=context.matrix_stack.getModelMatrix();mesh.data.set(vars,this.meshMap);if(vars.SHADOWMAP_ENABLED){vars.ParaboloidNear=light.shadowmap.paraboloidNear||1;vars.ParaboloidFar=light.shadowmap.paraboloidFar||200;vars.SHADOWMAP_PCF_ENABLED=this.pcf;vars.SHADOWMAP_MATRIX=light.shadowmap.shadowMatrix;vars.SHADOWMAP_WIDTH=light.shadowmap.width;vars.SHADOWMAP_HEIGHT=light.shadowmap.height;vars.IsDualParaboloid=light.shadowmap.isDualParaboloid();return light.shadowmap.bindTextures(context,vars,"SHADOWMAP0","SHADOWMAP1")}};return ShadowMap})(Jax.Material.Layer)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/vertex_color/common"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("shared uniform int PASS;\n\nshared varying vec4 vColor;\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/vertex_color/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("void main(void) {\n  export(vec4, VertexColor, vColor);\n  if (PASS == 0) gl_FragColor = vColor;\n}\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/vertex_color/vertex"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("shared attribute vec4 VERTEX_COLOR;\n\nvoid main(void) {\n  vColor = VERTEX_COLOR;\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.VertexColor=(function(superClass){extend(VertexColor,superClass);VertexColor.prototype.shaders={common:Jax.shaderTemplates["shaders/vertex_color/common"],vertex:Jax.shaderTemplates["shaders/vertex_color/vertex"],fragment:Jax.shaderTemplates["shaders/vertex_color/fragment"]};function VertexColor(options){VertexColor.__super__.constructor.call(this,options);this.dataMap={colors:"VERTEX_COLOR"}}VertexColor.prototype.setVariables=function(context,mesh,model,vars,pass){vars.PASS=pass;return mesh.data.set(vars,this.dataMap)};return VertexColor})(Jax.Material.Layer)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/wire/common"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("/*\nSingle-pass wire frame implementation - see http://cgg-journal.com/2008-2/06/index.html\n*/\n\n\nvarying vec3 dist;\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/wire/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("// uniform vec4 WireColor;\n// uniform vec4 FillColor;\n\nvoid main(void)\n{\n  // Undo perspective correction.\n\tvec3 dist_vec = dist * gl_FragCoord.w;\n\t\n  // Compute the shortest distance to the edge\n\tfloat d =min(dist_vec[0],min(dist_vec[1],dist_vec[2]));\n\t\n\t// Compute line intensity and then fragment color\n \tfloat I = exp2(-2.0*d*d);\n \t\n  const vec4 fillColor = vec4(0.0, 0.0, 0.0, 0.0);\n  vec4 wireColor = gl_FragColor;\n \t\n \tgl_FragColor = I*wireColor + (1.0 - I)*fillColor;\n}\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/wire/vertex"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("uniform vec2 WIN_SCALE;\nuniform mat4 MVP;\n\nattribute vec4 position;\nattribute vec4 p1_3d;\nattribute vec4 p2_3d;\n\nvoid main(void)\n{\n\t // We store the vertex id (0,1, or 2) in the w coord of the vertex\n\t // which then has to be restored to w=1.\n\t float swizz = p1_3d.w;\n\t vec4 p1_3d_ = p1_3d;\n\t p1_3d_.w = 1.0;\n\t \n\t // Compute the vertex position in the usual fashion.\n   gl_Position = MVP * position;\n   \n\t // p0 is the 2D position of the current vertex.\n\t vec2 p0 = gl_Position.xy/gl_Position.w;\n\t \n\t // Project p1 and p2 and compute the vectors v1 = p1-p0\n\t // and v2 = p2-p0\n\t p1_3d_ = MVP * p1_3d_;\n\t vec2 v1 = WIN_SCALE*(p1_3d_.xy / p1_3d_.w - p0);\n\t vec4 p2_3d_ = MVP * p2_3d;\n\t vec2 v2 = WIN_SCALE*(p2_3d_.xy / p2_3d_.w - p0);\n\t \n\t // Compute 2D area of triangle.\n\t float area2 = abs(v1.x*v2.y - v1.y * v2.x);\n\t \n   // Compute distance from vertex to line in 2D coords\n   float h = area2/length(v1-v2);\n   \n   // ---\n   // The swizz variable tells us which of the three vertices\n   // we are dealing with. The ugly comparisons would not be needed if\n   // swizz was an int.\n   if(swizz<0.1)\n      dist = vec3(h,0,0);\n   else if(swizz<1.1)\n      dist = vec3(0,h,0);\n   else\n      dist = vec3(0,0,h);\n      \n   // ----\n   // Quick fix to defy perspective correction\n   dist *= gl_Position.w;\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.Wire=(function(superClass){extend(Wire,superClass);Wire.prototype.shaders={common:Jax.shaderTemplates["shaders/wire/common"],vertex:Jax.shaderTemplates["shaders/wire/vertex"],fragment:Jax.shaderTemplates["shaders/wire/fragment"]};Jax.Mesh.Data.endpoints.p2verts=4;Jax.Mesh.Data.endpoints.p3verts=3;function Wire(options){this._dataMap={vertices:"position",p2verts:"p1_3d",p3verts:"p2_3d"};this._winScale=[0,0];Wire.__super__.constructor.call(this,options)}Wire.prototype.prepare=function(context,mesh,model){var b1,b2,b3,c1,c2,c3,colorBuffer,data,i,i1,i2,i3,indexBuffer,j,normalBuffer,ref,ref1,ref2,ref3,ref4,ref5,t1,t2,t3,textureCoordsBuffer,v1,v2,v3,vertexBuffer;if(!mesh.data.wired){indexBuffer=mesh.data.indexBuffer;colorBuffer=mesh.data.colorBuffer;normalBuffer=mesh.data.normalBuffer;textureCoordsBuffer=mesh.data.textureCoordsBuffer;vertexBuffer=mesh.data.vertexBuffer;data=new Jax.Mesh.Data(indexBuffer.length*3);data.wired=true;for(i=j=0,ref=indexBuffer.length;j<ref;i=j+=3){ref1=[i,i+1,i+2],i1=ref1[0],i2=ref1[1],i3=ref1[2];ref2=[indexBuffer[i1],indexBuffer[i2],indexBuffer[i3]],b1=ref2[0],b2=ref2[1],b3=ref2[2];ref3=[b1*3,b2*3,b3*3],v1=ref3[0],v2=ref3[1],v3=ref3[2];ref4=[b1*4,b2*4,b3*4],c1=ref4[0],c2=ref4[1],c3=ref4[2];ref5=[b1*2,b2*2,b3*3],t1=ref5[0],t2=ref5[1],t3=ref5[2];data.vertexBuffer[i1*3]=vertexBuffer[v1];data.vertexBuffer[i1*3+1]=vertexBuffer[v1+1];data.vertexBuffer[i1*3+2]=vertexBuffer[v1+2];data.normalBuffer[i1*3]=normalBuffer[v1];data.normalBuffer[i1*3+1]=normalBuffer[v1+1];data.normalBuffer[i1*3+2]=normalBuffer[v1+2];data.colorBuffer[i1*4]=colorBuffer[c1];data.colorBuffer[i1*4+1]=colorBuffer[c1+1];data.colorBuffer[i1*4+2]=colorBuffer[c1+2];data.colorBuffer[i1*4+3]=colorBuffer[c1+3];data.textureCoordsBuffer[i1*2]=textureCoordsBuffer[t1];data.textureCoordsBuffer[i1*2+1]=textureCoordsBuffer[t1+1];data.p2verts[i1*4]=vertexBuffer[v2];data.p2verts[i1*4+1]=vertexBuffer[v2+1];data.p2verts[i1*4+2]=vertexBuffer[v2+2];data.p2verts[i1*4+3]=0;data.p3verts[i1*3]=vertexBuffer[v3];data.p3verts[i1*3+1]=vertexBuffer[v3+1];data.p3verts[i1*3+2]=vertexBuffer[v3+2];data.vertexBuffer[i2*3]=vertexBuffer[v2];data.vertexBuffer[i2*3+1]=vertexBuffer[v2+1];data.vertexBuffer[i2*3+2]=vertexBuffer[v2+2];data.normalBuffer[i2*3]=normalBuffer[v2];data.normalBuffer[i2*3+1]=normalBuffer[v2+1];data.normalBuffer[i2*3+2]=normalBuffer[v2+2];data.colorBuffer[i2*4]=colorBuffer[c2];data.colorBuffer[i2*4+1]=colorBuffer[c2+1];data.colorBuffer[i2*4+2]=colorBuffer[c2+2];data.colorBuffer[i2*4+3]=colorBuffer[c2+3];data.textureCoordsBuffer[i2*2]=textureCoordsBuffer[t2];data.textureCoordsBuffer[i2*2+1]=textureCoordsBuffer[t2+1];data.p2verts[i2*4]=vertexBuffer[v3];data.p2verts[i2*4+1]=vertexBuffer[v3+1];data.p2verts[i2*4+2]=vertexBuffer[v3+2];data.p2verts[i2*4+3]=1;data.p3verts[i2*3]=vertexBuffer[v1];data.p3verts[i2*3+1]=vertexBuffer[v1+1];data.p3verts[i2*3+2]=vertexBuffer[v1+2];data.vertexBuffer[i3*3]=vertexBuffer[v3];data.vertexBuffer[i3*3+1]=vertexBuffer[v3+1];data.vertexBuffer[i3*3+2]=vertexBuffer[v3+2];data.normalBuffer[i3*3]=normalBuffer[v3];data.normalBuffer[i3*3+1]=normalBuffer[v3+1];data.normalBuffer[i3*3+2]=normalBuffer[v3+2];data.colorBuffer[i3*4]=colorBuffer[c3];data.colorBuffer[i3*4+1]=colorBuffer[c3+1];data.colorBuffer[i3*4+2]=colorBuffer[c3+2];data.colorBuffer[i3*4+3]=colorBuffer[c3+3];data.textureCoordsBuffer[i3*2]=textureCoordsBuffer[t3];data.textureCoordsBuffer[i3*2+1]=textureCoordsBuffer[t3+1];data.p2verts[i3*4]=vertexBuffer[v1];data.p2verts[i3*4+1]=vertexBuffer[v1+1];data.p2verts[i3*4+2]=vertexBuffer[v1+2];data.p2verts[i3*4+3]=2;data.p3verts[i3*3]=vertexBuffer[v2];data.p3verts[i3*3+1]=vertexBuffer[v2+1];data.p3verts[i3*3+2]=vertexBuffer[v2+2]}return mesh.data=data}};Wire.prototype.setVariables=function(context,mesh,model,vars,pass){var ref;mesh.data.set(vars,this._dataMap);ref=[context.canvas.width/2,context.canvas.height/2],this._winScale[0]=ref[0],this._winScale[1]=ref[1];vars.WIN_SCALE=this._winScale;return vars.MVP=context.matrix_stack.getModelViewProjectionMatrix()};return Wire})(Jax.Material.Layer)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/world_ambient/common"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("shared uniform int PASS;\nshared uniform float MaterialAmbientIntensity;\nshared uniform vec4 WorldAmbientColor;\nshared uniform vec4 MaterialAmbientColor;\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/world_ambient/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("void main(void) {\n  if (PASS == 0) {\n    // ambient pass only\n    vec3 material = MaterialAmbientIntensity * MaterialAmbientColor.rgb * MaterialAmbientColor.a;\n    vec4 color = vec4(WorldAmbientColor.rgb * WorldAmbientColor.a * material, 1.0);\n    import(VertexColor, color *= VertexColor);\n\tgl_FragColor = color;\n  }\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.WorldAmbient=(function(superClass){extend(WorldAmbient,superClass);WorldAmbient.prototype.shaders={common:Jax.shaderTemplates["shaders/world_ambient/common"],vertex:Jax.shaderTemplates["shaders/world_ambient/vertex"],fragment:Jax.shaderTemplates["shaders/world_ambient/fragment"]};function WorldAmbient(options){this.intensity=1;this.color=Jax.Color.parse("#ffff");WorldAmbient.__super__.constructor.call(this,options)}WorldAmbient.prototype.setVariables=function(context,mesh,model,vars,pass){vars.PASS=pass;vars.WorldAmbientColor=context.world.ambientColor.toVec4();vars.MaterialAmbientColor=this.color;return vars.MaterialAmbientIntensity=this.intensity};return WorldAmbient})(Jax.Material.Layer)}).call(this);(function(){}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/ghost/avertex"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("// Note that this file is named avertex to hotfix a bug in jax.\n\n// We don't need to repeat that definition here\n// but we do it nonetheless for clarity.\n// It is scrubbed by the shader preprocessor anyway.\nshared attribute vec4 VERTEX_POSITION;\n\nvoid main(void) {\n    vFragmentPosition = VERTEX_POSITION.xyz;\n}\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/ghost/common"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("// We probably can grab that from the position shader\nvarying vec3 vFragmentPosition;\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/ghost/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("// Number of seconds since the beginning\nuniform float time;\n\n#define M_PI 3.1415926535897932384626433832795\n\nvec4 permute(vec4 x) { return mod(x*x*34.0+x,289.); }\n\nfloat snoise(vec3 v) {\n  const vec2  C = vec2(0.166666667, 0.33333333333) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 = v - i + dot(i, C.xxx) ;\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy;\n  vec3 x3 = x0 - D.yyy;\n  i = mod(i, 289.);\n  vec4 p = permute(permute(permute(\n\t  i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t+ i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n\t+ i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n  vec3 ns = 0.142857142857 * D.wyz - D.xzx;\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);\n  vec4 x_ = floor(j * ns.z);\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = floor(j - 7.0 * x_ ) *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n  vec4 norm = inversesqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m * m;\n  return .5 + 12.0 * dot(m, vec4(dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3)));\n}\n\nvoid main(void) {\n\n    //vec2 uv = gl_FragCoord.xy / iResolution.xy;\n\n    // # 001 Simple noise\n    /*\n    vec2 uv = vFragmentPosition.xy;\n    vec2 pos = uv * 100.;\n    float noise = snoise(vec3(-pos.x, pos.y, 0.382*time));\n    gl_FragColor[3] = clamp(noise, 0.618, 1.0);  // Set alpha\n    */\n\n    // # 004 Clean noise\n    /*\n    vec2 uv = vFragmentPosition.xy;\n    vec2 pos = uv * 20.;\n    float noise = snoise(vec3(-pos.x, pos.y, 0.382*time));\n    float alpha = step(noise, 0.618);\n    if (alpha == 0.0) alpha = 0.618;\n    gl_FragColor[3] = alpha;  // Set alpha\n    */\n    /////////////////////\n\n    // # 002 Circles\n    /*\n    float alpha = 1.0;\n    float rings = 1.0 / 42.0;\n    if (mod(abs(vFragmentPosition.z-0.00582*(time+42.)), rings) < 0.618 * rings) {\n        alpha = 0.618;\n    }\n    gl_FragColor[3] = alpha;  // Set alpha\n    */\n    ////////////////\n\n    // # 003 Cake\n    /*\n    float alpha = 1.0;\n    float rings = 1.0 / 21.0;\n    vec2 pos = vFragmentPosition.xy * 50.;\n    float noise = snoise(vec3(-pos.x, pos.y, 0.382*time));\n    if (mod(abs(vFragmentPosition.z-0.00582*(time+42.)), rings) < 0.618 * rings * noise) {\n        alpha = 0.618;\n    }\n    gl_FragColor[3] = alpha;  // Set alpha\n    */\n    ////////////////\n\n    // # 004 target\n\n    float z = abs(vFragmentPosition.z);\n    float alpha = 1.0;\n    float rings = 1.0 / 10.0;\n    if (\n        (mod(abs(z-0.0582*(time+42.)), rings) < 0.618 * rings)\n        ||\n        (abs(vFragmentPosition.x) < 0.013)\n        ||\n        (abs(vFragmentPosition.y) < 0.013)\n    ) {\n        alpha = 0.0;\n    }\n    // pulsating cap\n    if (z > 0.092 + abs(sin(3.6558*(time+42.))) * 0.005) alpha = 1.0;\n    // pulsating down circle going to transparent (white)\n    float t = 3.6558*(time+42.+M_PI);\n    float zcircle = 0.1 * abs(sin(t));\n    if (z > zcircle - 0.005 && z < zcircle + 0.005 && cos(t) > 0. && cos(t+M_PI/2.) > 0.) {\n        alpha = min(1.0, z*z*100.);\n    }\n    gl_FragColor[3] = alpha;  // Set alpha\n\n\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.Ghost=(function(superClass){extend(Ghost,superClass);function Ghost(){return Ghost.__super__.constructor.apply(this,arguments)}Ghost.prototype.shaders={common:Jax.shaderTemplates["shaders/ghost/common"],vertex:Jax.shaderTemplates["shaders/ghost/avertex"],fragment:Jax.shaderTemplates["shaders/ghost/fragment"]};Ghost.prototype.numPasses=function(){return 1};Ghost.prototype.setVariables=function(context,mesh,options,vars){return vars.time=context.uptime};return Ghost})(Jax.Material.Layer)}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/ghost_important/avertex"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("// Note that this file is named avertex to hotfix a bug in jax.\n\n// We don't need to repeat that definition here\n// but we do it nonetheless for clarity.\n// It is scrubbed by the shader preprocessor anyway.\nshared attribute vec4 VERTEX_POSITION;\n\nvoid main(void) {\n    vFragmentPosition = VERTEX_POSITION.xyz;\n}\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/ghost_important/common"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("// We probably can grab that from the position shader\nvarying vec3 vFragmentPosition;\n")}return __p.join("")}}).call(this);(function(){Jax.shaderTemplates||(Jax.shaderTemplates={});Jax.shaderTemplates["shaders/ghost_important/fragment"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{}){__p.push("// Number of seconds since the beginning\nuniform float time;\n\n#define M_PI 3.1415926535897932384626433832795\n\nvec4 permute(vec4 x) { return mod(x*x*34.0+x,289.); }\n\nfloat snoise(vec3 v) {\n  const vec2  C = vec2(0.166666667, 0.33333333333) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 = v - i + dot(i, C.xxx) ;\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy;\n  vec3 x3 = x0 - D.yyy;\n  i = mod(i, 289.);\n  vec4 p = permute(permute(permute(\n\t  i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t+ i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n\t+ i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n  vec3 ns = 0.142857142857 * D.wyz - D.xzx;\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);\n  vec4 x_ = floor(j * ns.z);\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = floor(j - 7.0 * x_ ) *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n  vec4 norm = inversesqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m * m;\n  return .5 + 12.0 * dot(m, vec4(dot(p0,x0), dot(p1,x1), dot(p2,x2), dot(p3,x3)));\n}\n\nvoid main(void) {\n\n    //vec2 uv = gl_FragCoord.xy / iResolution.xy;\n\n    // # 001 Simple noise\n    /*\n    vec2 uv = vFragmentPosition.xy;\n    vec2 pos = uv * 100.;\n    float noise = snoise(vec3(-pos.x, pos.y, 0.382*time));\n    gl_FragColor[3] = clamp(noise, 0.618, 1.0);  // Set alpha\n    */\n\n    // # 004 Clean noise\n    /*\n    vec2 uv = vFragmentPosition.xy;\n    vec2 pos = uv * 20.;\n    float noise = snoise(vec3(-pos.x, pos.y, 0.382*time));\n    float alpha = step(noise, 0.618);\n    if (alpha == 0.0) alpha = 0.618;\n    gl_FragColor[3] = alpha;  // Set alpha\n    */\n    /////////////////////\n\n    // # 002 Circles\n    /*\n    float alpha = 1.0;\n    float rings = 1.0 / 42.0;\n    if (mod(abs(vFragmentPosition.z-0.00582*(time+42.)), rings) < 0.618 * rings) {\n        alpha = 0.618;\n    }\n    gl_FragColor[3] = alpha;  // Set alpha\n    */\n    ////////////////\n\n    // # 003 Cake\n    /*\n    float alpha = 1.0;\n    float rings = 1.0 / 33.0;\n    vec2 pos = vFragmentPosition.xy * 50.;\n    float noise = snoise(vec3(-pos.x, pos.y, 0.382*time));\n    if (mod(abs(vFragmentPosition.z-0.00582*(time+42.)), rings) < 0.618 * rings * noise) {\n        alpha = 0.618;\n    }\n    gl_FragColor[3] = alpha;  // Set alpha\n    */\n    ////////////////\n\n    // # 004 target\n\n    float z = abs(vFragmentPosition.z);\n    float alpha = 1.0;\n    float rings = 1.0 / 10.0;\n    if (\n        (mod(abs(z-0.0582*2.0*(time+42.)), rings) < 0.618 * rings)\n    ) {\n        alpha = 0.0;\n    }\n    // pulsating cap\n    if (z > 0.092 + abs(sin(3.6558*(time+42.))) * 0.005) alpha = 1.0;\n    // pulsating down circle going to transparent (white)\n    float t = 3.6558*(time+42.+M_PI);\n    float zcircle = 0.1 * abs(sin(t));\n    if (z > zcircle - 0.005 && z < zcircle + 0.005 && cos(t) > 0. && cos(t+M_PI/2.) > 0.) {\n        alpha = min(1.0, z*z*100.);\n    }\n\n    gl_FragColor[3] = alpha;  // Set alpha\n\n\n    // # 005 blackboard\n    /*\n    float alpha = 0.0;\n    if (\n        abs(vFragmentPosition.x) < 0.011\n    ) {\n        alpha = 1.0;\n    }\n    gl_FragColor[3] = alpha;\n    */\n}\n")}return __p.join("")}}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key)){child[key]=parent[key]}}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Jax.Material.Layer.GhostImportant=(function(superClass){extend(GhostImportant,superClass);function GhostImportant(){return GhostImportant.__super__.constructor.apply(this,arguments)}GhostImportant.prototype.shaders={common:Jax.shaderTemplates["shaders/ghost_important/common"],vertex:Jax.shaderTemplates["shaders/ghost_important/avertex"],fragment:Jax.shaderTemplates["shaders/ghost_important/fragment"]};GhostImportant.prototype.numPasses=function(){return 1};GhostImportant.prototype.setVariables=function(context,mesh,options,vars){return vars.time=context.uptime};return GhostImportant})(Jax.Material.Layer)}).call(this);(function(){}).call(this);(function(){Jax.views.push("HotseatGame/index",function(){this.context.renderer.clear();return this.world.render()})}).call(this);(function(){Jax.views.push("SinglePlayerGame/index",function(){this.context.renderer.clear();return this.world.render()})}).call(this);((function(){function messageFor(owner,newProp,oldProp){if(newProp){return"`"+owner.name+"#"+oldProp.replace(/\./g,"#")+"` has been deprecated. Please use `"+owner.name+"#"+newProp.replace(/\./g,"#")+"` instead."}else{return"`"+owner.name+"#"+oldProp.replace(/\./g,"#")+"` has been deprecated. Please see the documentation."}}function createDelegator(oldProp,newProp,message){var setter=false;if(newProp){setter=newProp.charAt(newProp.length-1)==="=";newProp=newProp.replace(/=$/,"")}return(function(){var _value;var src=this;if(newProp){var prop=newProp.split(".");while(prop.length>1){src=src[prop.shift()];if(src===undefined){throw new Error(message)}}prop=prop[0];_value=src[prop];if(Jax.deprecate.level>0){console.log(new Error(message).stack)}else{console.log(message)}if(_value instanceof Function){return _value.apply(this,arguments)}else{if(setter){if(arguments.length>1){return src[prop]=arguments}else{return src[prop]=arguments[0]}}else{return _value}}}else{throw new Error(message)}})}Jax.deprecate=function(owner,oldProp,newProp,message){if(!owner){throw new Error("Can't deprecate '"+oldProp+"' without an owner")}var _proto=owner.prototype||owner;var delegator=createDelegator(oldProp,newProp,message||messageFor(owner,newProp,oldProp));_proto[oldProp]=delegator};Jax.deprecateProperty=function(owner,oldProp,newProp,message){if(!owner){throw new Error("Can't deprecate '"+oldProp+"' without an owner")}var _proto=owner.prototype||owner;var delegator=createDelegator(oldProp,newProp,message||messageFor(owner,newProp,oldProp));Object.defineProperty(_proto,oldProp,{get:delegator,set:delegator})}})());Jax.deprecate.level=1;Jax.deprecate(Jax.Util,"normalizeOptions","jQuery.extend","Jax.Util.normalizeOptions has been deprecated in favor of jQuery.extend.");(function(){}).call(this);